"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const fs_helpers_1 = require("@helpers/fs-helpers");
const helpers_1 = require("@helpers/helpers");
const log_helpers_1 = require("@helpers/log-helpers");
const gps_distance_1 = __importDefault(require("gps-distance"));
const log = log_helpers_1.createLog('Combine');
exports.default = (async () => {
    const myPoint = [39.627071500, -104.893322500]; // 4982 S Ulster St
    const combined = [];
    const files = await fs_helpers_1.getAllFilesFromDirectory('data/repeaters/results/CO');
    log('Got', files.length, 'files');
    const found = {};
    files.forEach((file) => {
        log('Got', file.length, 'repeaters');
        file.forEach((item) => {
            if (!found[`${item.state_id}-${item.ID}`]) {
                found[`${item.state_id}-${item.ID}`] = true;
                combined.push(item);
                const distance = gps_distance_1.default([myPoint, [item.Latitude, item.Longitude]]);
                item.Mi = distance * 0.62137119;
            }
        });
    });
    log('Got', combined.length, 'unique repeaters');
    combined.sort((a, b) => {
        const aMi = helpers_1.numberToString(a.Mi || 0, 4, 24);
        const bMi = helpers_1.numberToString(b.Mi || 0, 4, 24);
        const aRepeaterName = a.Call;
        const bRepeaterName = b.Call;
        const aFrequency = helpers_1.numberToString(a.Frequency || 0, 4, 5);
        const bFrequency = helpers_1.numberToString(b.Frequency || 0, 4, 5);
        const aStr = `${aMi} ${aRepeaterName} ${aFrequency}`;
        const bStr = `${bMi} ${bRepeaterName} ${bFrequency}`;
        return aStr > bStr ? 1 : aStr < bStr ? -1 : 0;
    });
    const stats = combined.reduce((result, data) => {
        const freq = Math.round(data.Frequency || 0).toString();
        const pow = Math.pow(10, Math.max(freq.length - 2, 0)) * 2;
        const group = Math.round((data.Frequency || 0) / pow) * pow;
        // console.log(freq, pow, group);
        const count = result[group] || 0;
        return { ...result, [group]: count + 1 };
    }, {});
    // tslint:disable-next-line:no-console
    console.log('STATS', stats);
    // combined.slice(0, 100).forEach((c) => log(c.Call, "\t", c.Latitude, "\t", c.Longitude, "\t", c.Mi));
    await fs_helpers_1.writeToJsonAndCsv('data/repeaters/combined/CO', combined);
})();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29tYmluZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uL3NyYy9jb21iaW5lLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBQUEsb0RBQWtGO0FBQ2xGLDhDQUFrRDtBQUNsRCxzREFBaUQ7QUFFakQsZ0VBQWtEO0FBRWxELE1BQU0sR0FBRyxHQUE0Qix1QkFBUyxDQUFDLFNBQVMsQ0FBQyxDQUFDO0FBRTFELGtCQUFlLENBQUMsS0FBSyxJQUFtQixFQUFFO0lBQ3hDLE1BQU0sT0FBTyxHQUFVLENBQUMsWUFBWSxFQUFFLENBQUMsYUFBYSxDQUFDLENBQUMsQ0FBQyxtQkFBbUI7SUFDMUUsTUFBTSxRQUFRLEdBQW1CLEVBQUUsQ0FBQztJQUNwQyxNQUFNLEtBQUssR0FBcUIsTUFBTSxxQ0FBd0IsQ0FBaUIsMkJBQTJCLENBQUMsQ0FBQztJQUM1RyxHQUFHLENBQUMsS0FBSyxFQUFFLEtBQUssQ0FBQyxNQUFNLEVBQUUsT0FBTyxDQUFDLENBQUM7SUFDbEMsTUFBTSxLQUFLLEdBQTJDLEVBQUUsQ0FBQztJQUN6RCxLQUFLLENBQUMsT0FBTyxDQUFDLENBQUMsSUFBb0IsRUFBRSxFQUFFO1FBQ3JDLEdBQUcsQ0FBQyxLQUFLLEVBQUUsSUFBSSxDQUFDLE1BQU0sRUFBRSxXQUFXLENBQUMsQ0FBQztRQUNyQyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUMsSUFBa0IsRUFBRSxFQUFFO1lBQ2xDLElBQUksQ0FBQyxLQUFLLENBQUMsR0FBRyxJQUFJLENBQUMsUUFBUSxJQUFJLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQyxFQUFFO2dCQUN6QyxLQUFLLENBQUMsR0FBRyxJQUFJLENBQUMsUUFBUSxJQUFJLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQyxHQUFHLElBQUksQ0FBQztnQkFDNUMsUUFBUSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztnQkFDcEIsTUFBTSxRQUFRLEdBQVcsc0JBQVcsQ0FBQyxDQUFDLE9BQU8sRUFBRSxDQUFDLElBQUksQ0FBQyxRQUFRLEVBQUUsSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUMsQ0FBQztnQkFDakYsSUFBSSxDQUFDLEVBQUUsR0FBRyxRQUFRLEdBQUcsVUFBVSxDQUFDO2FBQ2pDO1FBQ0gsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztJQUNILEdBQUcsQ0FBQyxLQUFLLEVBQUUsUUFBUSxDQUFDLE1BQU0sRUFBRSxrQkFBa0IsQ0FBQyxDQUFDO0lBQ2hELFFBQVEsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFlLEVBQUUsQ0FBZSxFQUFFLEVBQUU7UUFDakQsTUFBTSxHQUFHLEdBQVcsd0JBQWMsQ0FBQyxDQUFDLENBQUMsRUFBRSxJQUFJLENBQUMsRUFBRSxDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUM7UUFDckQsTUFBTSxHQUFHLEdBQVcsd0JBQWMsQ0FBQyxDQUFDLENBQUMsRUFBRSxJQUFJLENBQUMsRUFBRSxDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUM7UUFDckQsTUFBTSxhQUFhLEdBQXVCLENBQUMsQ0FBQyxJQUFJLENBQUM7UUFDakQsTUFBTSxhQUFhLEdBQXVCLENBQUMsQ0FBQyxJQUFJLENBQUM7UUFDakQsTUFBTSxVQUFVLEdBQVcsd0JBQWMsQ0FBQyxDQUFDLENBQUMsU0FBUyxJQUFJLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUM7UUFDbEUsTUFBTSxVQUFVLEdBQVcsd0JBQWMsQ0FBQyxDQUFDLENBQUMsU0FBUyxJQUFJLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUM7UUFDbEUsTUFBTSxJQUFJLEdBQVcsR0FBRyxHQUFHLElBQUksYUFBYSxJQUFJLFVBQVUsRUFBRSxDQUFDO1FBQzdELE1BQU0sSUFBSSxHQUFXLEdBQUcsR0FBRyxJQUFJLGFBQWEsSUFBSSxVQUFVLEVBQUUsQ0FBQztRQUU3RCxPQUFPLElBQUksR0FBRyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxHQUFHLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztJQUNoRCxDQUFDLENBQUMsQ0FBQztJQUNILE1BQU0sS0FBSyxHQUErQixRQUFRLENBQUMsTUFBTSxDQUFDLENBQUMsTUFBbUMsRUFBRSxJQUFrQixFQUFFLEVBQUU7UUFDcEgsTUFBTSxJQUFJLEdBQVcsSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsU0FBUyxJQUFJLENBQUMsQ0FBQyxDQUFDLFFBQVEsRUFBRSxDQUFDO1FBQ2hFLE1BQU0sR0FBRyxHQUFXLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxFQUFFLElBQUksQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLE1BQU0sR0FBRyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUM7UUFDbkUsTUFBTSxLQUFLLEdBQVcsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLElBQUksQ0FBQyxTQUFTLElBQUksQ0FBQyxDQUFDLEdBQUcsR0FBRyxDQUFDLEdBQUcsR0FBRyxDQUFDO1FBQ3BFLGlDQUFpQztRQUNqQyxNQUFNLEtBQUssR0FBVyxNQUFNLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQ3pDLE9BQU8sRUFBRSxHQUFHLE1BQU0sRUFBRSxDQUFDLEtBQUssQ0FBQyxFQUFFLEtBQUssR0FBRyxDQUFDLEVBQUUsQ0FBQztJQUMzQyxDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUM7SUFDUCxzQ0FBc0M7SUFDdEMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxPQUFPLEVBQUUsS0FBSyxDQUFDLENBQUM7SUFDNUIsdUdBQXVHO0lBQ3ZHLE1BQU0sOEJBQWlCLENBQUMsNEJBQTRCLEVBQUUsUUFBUSxDQUFDLENBQUM7QUFDbEUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGdldEFsbEZpbGVzRnJvbURpcmVjdG9yeSwgd3JpdGVUb0pzb25BbmRDc3YgfSBmcm9tICdAaGVscGVycy9mcy1oZWxwZXJzJztcclxuaW1wb3J0IHsgbnVtYmVyVG9TdHJpbmcgfSBmcm9tICdAaGVscGVycy9oZWxwZXJzJztcclxuaW1wb3J0IHsgY3JlYXRlTG9nIH0gZnJvbSAnQGhlbHBlcnMvbG9nLWhlbHBlcnMnO1xyXG5pbXBvcnQgeyBJUmVwZWF0ZXJSYXcgfSBmcm9tICdAaW50ZXJmYWNlcy9pLXJlcGVhdGVyLXJhdyc7XHJcbmltcG9ydCBncHNEaXN0YW5jZSwgeyBQb2ludCB9IGZyb20gJ2dwcy1kaXN0YW5jZSc7XHJcblxyXG5jb25zdCBsb2c6ICguLi5tc2c6IGFueVtdKSA9PiB2b2lkID0gY3JlYXRlTG9nKCdDb21iaW5lJyk7XHJcblxyXG5leHBvcnQgZGVmYXVsdCAoYXN5bmMgKCk6IFByb21pc2U8dm9pZD4gPT4ge1xyXG4gIGNvbnN0IG15UG9pbnQ6IFBvaW50ID0gWzM5LjYyNzA3MTUwMCwgLTEwNC44OTMzMjI1MDBdOyAvLyA0OTgyIFMgVWxzdGVyIFN0XHJcbiAgY29uc3QgY29tYmluZWQ6IElSZXBlYXRlclJhd1tdID0gW107XHJcbiAgY29uc3QgZmlsZXM6IElSZXBlYXRlclJhd1tdW10gPSBhd2FpdCBnZXRBbGxGaWxlc0Zyb21EaXJlY3Rvcnk8SVJlcGVhdGVyUmF3W10+KCdkYXRhL3JlcGVhdGVycy9yZXN1bHRzL0NPJyk7XHJcbiAgbG9nKCdHb3QnLCBmaWxlcy5sZW5ndGgsICdmaWxlcycpO1xyXG4gIGNvbnN0IGZvdW5kOiB7IFtrZXk6IHN0cmluZ106IGJvb2xlYW4gfCB1bmRlZmluZWQgfSA9IHt9O1xyXG4gIGZpbGVzLmZvckVhY2goKGZpbGU6IElSZXBlYXRlclJhd1tdKSA9PiB7XHJcbiAgICBsb2coJ0dvdCcsIGZpbGUubGVuZ3RoLCAncmVwZWF0ZXJzJyk7XHJcbiAgICBmaWxlLmZvckVhY2goKGl0ZW06IElSZXBlYXRlclJhdykgPT4ge1xyXG4gICAgICBpZiAoIWZvdW5kW2Ake2l0ZW0uc3RhdGVfaWR9LSR7aXRlbS5JRH1gXSkge1xyXG4gICAgICAgIGZvdW5kW2Ake2l0ZW0uc3RhdGVfaWR9LSR7aXRlbS5JRH1gXSA9IHRydWU7XHJcbiAgICAgICAgY29tYmluZWQucHVzaChpdGVtKTtcclxuICAgICAgICBjb25zdCBkaXN0YW5jZTogbnVtYmVyID0gZ3BzRGlzdGFuY2UoW215UG9pbnQsIFtpdGVtLkxhdGl0dWRlLCBpdGVtLkxvbmdpdHVkZV1dKTtcclxuICAgICAgICBpdGVtLk1pID0gZGlzdGFuY2UgKiAwLjYyMTM3MTE5O1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9KTtcclxuICBsb2coJ0dvdCcsIGNvbWJpbmVkLmxlbmd0aCwgJ3VuaXF1ZSByZXBlYXRlcnMnKTtcclxuICBjb21iaW5lZC5zb3J0KChhOiBJUmVwZWF0ZXJSYXcsIGI6IElSZXBlYXRlclJhdykgPT4ge1xyXG4gICAgY29uc3QgYU1pOiBzdHJpbmcgPSBudW1iZXJUb1N0cmluZyhhLk1pIHx8IDAsIDQsIDI0KTtcclxuICAgIGNvbnN0IGJNaTogc3RyaW5nID0gbnVtYmVyVG9TdHJpbmcoYi5NaSB8fCAwLCA0LCAyNCk7XHJcbiAgICBjb25zdCBhUmVwZWF0ZXJOYW1lOiBzdHJpbmcgfCB1bmRlZmluZWQgPSBhLkNhbGw7XHJcbiAgICBjb25zdCBiUmVwZWF0ZXJOYW1lOiBzdHJpbmcgfCB1bmRlZmluZWQgPSBiLkNhbGw7XHJcbiAgICBjb25zdCBhRnJlcXVlbmN5OiBzdHJpbmcgPSBudW1iZXJUb1N0cmluZyhhLkZyZXF1ZW5jeSB8fCAwLCA0LCA1KTtcclxuICAgIGNvbnN0IGJGcmVxdWVuY3k6IHN0cmluZyA9IG51bWJlclRvU3RyaW5nKGIuRnJlcXVlbmN5IHx8IDAsIDQsIDUpO1xyXG4gICAgY29uc3QgYVN0cjogc3RyaW5nID0gYCR7YU1pfSAke2FSZXBlYXRlck5hbWV9ICR7YUZyZXF1ZW5jeX1gO1xyXG4gICAgY29uc3QgYlN0cjogc3RyaW5nID0gYCR7Yk1pfSAke2JSZXBlYXRlck5hbWV9ICR7YkZyZXF1ZW5jeX1gO1xyXG5cclxuICAgIHJldHVybiBhU3RyID4gYlN0ciA/IDEgOiBhU3RyIDwgYlN0ciA/IC0xIDogMDtcclxuICB9KTtcclxuICBjb25zdCBzdGF0czogeyBbIGtleTogc3RyaW5nXTogbnVtYmVyIH0gPSBjb21iaW5lZC5yZWR1Y2UoKHJlc3VsdDogeyBbIGtleTogc3RyaW5nIF06IG51bWJlciB9LCBkYXRhOiBJUmVwZWF0ZXJSYXcpID0+IHtcclxuICAgIGNvbnN0IGZyZXE6IHN0cmluZyA9IE1hdGgucm91bmQoZGF0YS5GcmVxdWVuY3kgfHwgMCkudG9TdHJpbmcoKTtcclxuICAgIGNvbnN0IHBvdzogbnVtYmVyID0gTWF0aC5wb3coMTAsIE1hdGgubWF4KGZyZXEubGVuZ3RoIC0gMiwgMCkpICogMjtcclxuICAgIGNvbnN0IGdyb3VwOiBudW1iZXIgPSBNYXRoLnJvdW5kKChkYXRhLkZyZXF1ZW5jeSB8fCAwKSAvIHBvdykgKiBwb3c7XHJcbiAgICAvLyBjb25zb2xlLmxvZyhmcmVxLCBwb3csIGdyb3VwKTtcclxuICAgIGNvbnN0IGNvdW50OiBudW1iZXIgPSByZXN1bHRbZ3JvdXBdIHx8IDA7XHJcbiAgICByZXR1cm4geyAuLi5yZXN1bHQsIFtncm91cF06IGNvdW50ICsgMSB9O1xyXG4gIH0sIHt9KTtcclxuICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6bm8tY29uc29sZVxyXG4gIGNvbnNvbGUubG9nKCdTVEFUUycsIHN0YXRzKTtcclxuICAvLyBjb21iaW5lZC5zbGljZSgwLCAxMDApLmZvckVhY2goKGMpID0+IGxvZyhjLkNhbGwsIFwiXFx0XCIsIGMuTGF0aXR1ZGUsIFwiXFx0XCIsIGMuTG9uZ2l0dWRlLCBcIlxcdFwiLCBjLk1pKSk7XHJcbiAgYXdhaXQgd3JpdGVUb0pzb25BbmRDc3YoJ2RhdGEvcmVwZWF0ZXJzL2NvbWJpbmVkL0NPJywgY29tYmluZWQpO1xyXG59KSgpO1xyXG4iXX0=