"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
require("module-alias/register");
const fs_helpers_1 = require("@helpers/fs-helpers");
const log_helpers_1 = require("@helpers/log-helpers");
const i_repeater_structured_1 = require("@interfaces/i-repeater-structured");
const gps_distance_1 = __importDefault(require("gps-distance"));
const log = log_helpers_1.createLog('Make Chirp');
const chirp = {
    Location: null,
    Name: '',
    Frequency: null,
    Duplex: '',
    Offset: null,
    Tone: '',
    rToneFreq: null,
    cToneFreq: null,
    DtcsCode: null,
    DtcsRxCode: null,
    DtcsPolarity: 'NN',
    Mode: 'FM',
    TStep: 5,
    Comment: '',
};
const myPoint = [39.627071500, -104.893322500]; // 4982 S Ulster St
async function doIt(inFileName, outFileName) {
    const simplex = JSON.parse((await fs_helpers_1.readFileAsync('data/frequencies.json')).toString())
        .map((map) => ({ Callsign: map.Name, Frequency: { Output: map.Frequency, Input: map.Frequency } }))
        .filter((filter) => /FM|Voice|Simplex/i.test(filter.Callsign))
        .filter((filter) => !(/Data|Digital|Packet/i.test(filter.Callsign)));
    const repeaters = JSON.parse((await fs_helpers_1.readFileAsync(inFileName)).toString());
    repeaters.forEach((each) => {
        each.Location.Distance = gps_distance_1.default([myPoint, [each.Location.Latitude, each.Location.Longitude]]);
    });
    repeaters.sort((a, b) => a.Location.Distance > b.Location.Distance ? 1 :
        a.Location.Distance < b.Location.Distance ? -1 : 0);
    const mapped = [
        ...simplex,
        ...repeaters
            .filter((filter) => (filter.Frequency.Output >= 144 && filter.Frequency.Output <= 148) ||
            (filter.Frequency.Output >= 222 && filter.Frequency.Output <= 225) ||
            (filter.Frequency.Output >= 420 && filter.Frequency.Output <= 450))
            .filter((filter) => !filter.Digital &&
            filter.Status !== i_repeater_structured_1.RepeaterStatus.OffAir &&
            filter.Use === i_repeater_structured_1.RepeaterUse.Open),
    ]
        .map((map, index) => ({ ...convertToRadio(map), Location: index }));
    const short = mapped
        .slice(0, 128)
        .sort((a, b) => a.Frequency - b.Frequency)
        .map((map, index) => ({ ...map, Location: index }));
    const long = mapped
        .slice(0, 200)
        .sort((a, b) => a.Frequency - b.Frequency)
        .map((map, index) => ({ ...map, Location: index }));
    await fs_helpers_1.writeToJsonAndCsv(outFileName + '-short', short);
    await fs_helpers_1.writeToJsonAndCsv(outFileName + '-long', long);
}
function convertToRadio(repeater) {
    let Name = '';
    if (repeater.Callsign) {
        Name += repeater.Callsign.trim();
    }
    if (repeater.Location && repeater.Location.Local) {
        Name += (Name ? ' ' : '') + repeater.Location.Local.trim();
    }
    if (repeater.Frequency && repeater.Frequency.Output) {
        Name += (Name ? ' ' : '') + repeater.Frequency.Output.toString().trim();
    }
    Name = Name.replace(/[^0-9.a-zA-Z \/]/g, '').trim();
    Name = Name.replace(/[ ]+/g, ' ').trim();
    Name = Name.substr(0, 8).trim();
    const Frequency = repeater.Frequency.Output;
    let Offset = repeater.Frequency.Input - repeater.Frequency.Output;
    const Duplex = Offset > 0 ? '+' : Offset < 0 ? '-' : '';
    Offset = Math.abs(Math.round(Offset * 100) / 100);
    let rToneFreq = (repeater.SquelchTone && repeater.SquelchTone.Input);
    let cToneFreq = (repeater.SquelchTone && repeater.SquelchTone.Output);
    let DtcsCode = (repeater.DigitalTone && repeater.DigitalTone.Input);
    let DtcsRxCode = (repeater.DigitalTone && repeater.DigitalTone.Output);
    let Tone = '';
    const Mode = 'FM';
    let Comment = `${repeater.StateID} ${repeater.ID} ${repeater.Location && repeater.Location.Distance && repeater.Location.Distance.toFixed(2)} ${repeater.Location && repeater.Location.State} ${repeater.Location && repeater.Location.County} ${repeater.Location && repeater.Location.Local} ${repeater.Callsign}`;
    Comment = Comment.replace(/undefined/g, ' ').replace(/\s+/g, ' ').trim();
    // `${item['ST/PR'] || ''} ${item.County || ''} ${item.Location || ''} ${item.Call || ''} ${item.Sponsor || ''} ${item.Affiliate || ''} ${item.Frequency} ${item.Use || ''} ${item['Op Status'] || ''} ${item.Comment || ''}`.replace(/\s+/g, ' ');
    // Comment = Comment.trim().replace(",", "").substring(0, 31).trim();
    if (rToneFreq) {
        Tone = 'Tone';
    }
    else if (DtcsCode) {
        Tone = 'DTCS';
    }
    if (cToneFreq) {
        Tone = 'TSQL';
    }
    else if (DtcsRxCode) {
        Tone = 'DTCS';
    }
    if ((rToneFreq && cToneFreq && (rToneFreq !== cToneFreq))) {
        Tone = 'Cross';
    }
    cToneFreq = cToneFreq || 88.5;
    rToneFreq = rToneFreq || 88.5;
    DtcsCode = DtcsCode || 23;
    DtcsRxCode = DtcsRxCode || 23;
    // log(chalk.green("Made Row"), row);
    return {
        ...chirp,
        // Location,
        Name,
        Frequency,
        Duplex,
        Offset,
        rToneFreq,
        cToneFreq,
        DtcsCode,
        DtcsRxCode,
        Tone,
        Mode,
        Comment,
    };
}
async function start() {
    // const coFiles = (await readdirAsync("./repeaters/data/CO/")).map((f) => `data/CO/${f}`);
    // const utFiles = (await readdirAsync("./repeaters/data/UT/")).map((f) => `data/UT/${f}`);
    // const nmFiles = (await readdirAsync("./repeaters/data/NM/")).map((f) => `data/NM/${f}`);
    // const coGroups = (await readdirAsync("./repeaters/groups/CO/")).map((f) => `groups/CO/${f}`);
    // const utGroups = (await readdirAsync("./repeaters/groups/UT/")).map((f) => `groups/UT/${f}`);
    // const nmGroups = (await readdirAsync("./repeaters/groups/NM/")).map((f) => `groups/NM/${f}`);
    // const allFiles = [...coFiles, ...utFiles, ...nmFiles, ...coGroups, ...utGroups, ...nmGroups].filter((f) => /\.json$/.test(f)).map((f) => f.replace(".json", ""));
    // for (const file of allFiles) {
    //   await doIt(file);
    // }
    // await doIt("data/repeaters/groups/CO/Colorado Springs - Call.json", "data/repeaters/chirp/groups/CO/Colorado Springs - Call");
    // await doIt("data/repeaters/results/CO/Colorado Springs.json", "data/repeaters/chirp/CO/Colorado Springs");
    await doIt('data/repeaters/converted/CO.json', 'data/repeaters/chirp/CO');
    // await doIt('data/repeaters/groups/combined/CO - Call.json', 'data/repeaters/chirp/groups/CO - Call');
}
exports.default = start();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWFrZS1jaGlycC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9zY3JpcHRzL21ha2UtY2hpcnAudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQSxpQ0FBK0I7QUFFL0Isb0RBQXVFO0FBQ3ZFLHNEQUFpRDtBQUVqRCw2RUFBcUc7QUFFckcsZ0VBQWtEO0FBRWxELE1BQU0sR0FBRyxHQUE0Qix1QkFBUyxDQUFDLFlBQVksQ0FBQyxDQUFDO0FBRTdELE1BQU0sS0FBSyxHQUFXO0lBQ3BCLFFBQVEsRUFBRSxJQUFXO0lBQ3JCLElBQUksRUFBRSxFQUFFO0lBQ1IsU0FBUyxFQUFFLElBQVc7SUFDdEIsTUFBTSxFQUFFLEVBQUU7SUFDVixNQUFNLEVBQUUsSUFBVztJQUNuQixJQUFJLEVBQUUsRUFBRTtJQUNSLFNBQVMsRUFBRSxJQUFXO0lBQ3RCLFNBQVMsRUFBRSxJQUFXO0lBQ3RCLFFBQVEsRUFBRSxJQUFXO0lBQ3JCLFVBQVUsRUFBRSxJQUFXO0lBQ3ZCLFlBQVksRUFBRSxJQUFJO0lBQ2xCLElBQUksRUFBRSxJQUFJO0lBQ1YsS0FBSyxFQUFFLENBQUM7SUFDUixPQUFPLEVBQUUsRUFBRTtDQUNaLENBQUM7QUFFRixNQUFNLE9BQU8sR0FBVSxDQUFDLFlBQVksRUFBRSxDQUFDLGFBQWEsQ0FBQyxDQUFDLENBQUMsbUJBQW1CO0FBRTFFLEtBQUssVUFBVSxJQUFJLENBQUMsVUFBa0IsRUFBRSxXQUFtQjtJQUN6RCxNQUFNLE9BQU8sR0FDWCxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsTUFBTSwwQkFBYSxDQUFDLHVCQUF1QixDQUFDLENBQUMsQ0FBQyxRQUFRLEVBQUUsQ0FBQztTQUNsRSxHQUFHLENBQUMsQ0FBQyxHQUFzQixFQUFFLEVBQUUsQ0FDOUIsQ0FBQyxFQUFFLFFBQVEsRUFBRSxHQUFHLENBQUMsSUFBSSxFQUFFLFNBQVMsRUFBRSxFQUFFLE1BQU0sRUFBRSxHQUFHLENBQUMsU0FBUyxFQUFFLEtBQUssRUFBRSxHQUFHLENBQUMsU0FBUyxFQUFFLEVBQUUsQ0FBQyxDQUFDO1NBQ3RGLE1BQU0sQ0FBQyxDQUFDLE1BQTJCLEVBQUUsRUFBRSxDQUFDLG1CQUFtQixDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsUUFBUSxDQUFDLENBQUM7U0FDbEYsTUFBTSxDQUFDLENBQUMsTUFBMkIsRUFBRSxFQUFFLENBQUMsQ0FBQyxDQUFDLHNCQUFzQixDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBRTlGLE1BQU0sU0FBUyxHQUNiLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQyxNQUFNLDBCQUFhLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQyxRQUFRLEVBQUUsQ0FBQyxDQUFDO0lBRTNELFNBQVMsQ0FBQyxPQUFPLENBQUMsQ0FBQyxJQUF5QixFQUFFLEVBQUU7UUFDOUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxRQUFRLEdBQUcsc0JBQVcsQ0FBQyxDQUFDLE9BQU8sRUFBRSxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsUUFBUSxFQUFFLElBQUksQ0FBQyxRQUFRLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBQ3JHLENBQUMsQ0FBQyxDQUFDO0lBRUgsU0FBUyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQXNCLEVBQUUsQ0FBc0IsRUFBRSxFQUFFLENBQ2hFLENBQUMsQ0FBQyxRQUFRLENBQUMsUUFBUyxHQUFHLENBQUMsQ0FBQyxRQUFRLENBQUMsUUFBUyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUMvQyxDQUFDLENBQUMsUUFBUSxDQUFDLFFBQVMsR0FBRyxDQUFDLENBQUMsUUFBUSxDQUFDLFFBQVMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBQzFELE1BQU0sTUFBTSxHQUFhO1FBQ3ZCLEdBQUcsT0FBTztRQUNWLEdBQUcsU0FBUzthQUNULE1BQU0sQ0FBQyxDQUFDLE1BQTJCLEVBQUUsRUFBRSxDQUN0QyxDQUFDLE1BQU0sQ0FBQyxTQUFTLENBQUMsTUFBTSxJQUFJLEdBQUcsSUFBSSxNQUFNLENBQUMsU0FBUyxDQUFDLE1BQU0sSUFBSSxHQUFHLENBQUM7WUFDbEUsQ0FBQyxNQUFNLENBQUMsU0FBUyxDQUFDLE1BQU0sSUFBSSxHQUFHLElBQUksTUFBTSxDQUFDLFNBQVMsQ0FBQyxNQUFNLElBQUksR0FBRyxDQUFDO1lBQ2xFLENBQUMsTUFBTSxDQUFDLFNBQVMsQ0FBQyxNQUFNLElBQUksR0FBRyxJQUFJLE1BQU0sQ0FBQyxTQUFTLENBQUMsTUFBTSxJQUFJLEdBQUcsQ0FBQyxDQUFDO2FBQ3BFLE1BQU0sQ0FBQyxDQUFDLE1BQTJCLEVBQUUsRUFBRSxDQUN0QyxDQUFDLE1BQU0sQ0FBQyxPQUFPO1lBQ2YsTUFBTSxDQUFDLE1BQU0sS0FBSyxzQ0FBYyxDQUFDLE1BQU07WUFDdkMsTUFBTSxDQUFDLEdBQUcsS0FBSyxtQ0FBVyxDQUFDLElBQUksQ0FBQztLQUNyQztTQUNFLEdBQUcsQ0FBQyxDQUFDLEdBQXdCLEVBQUUsS0FBYSxFQUFVLEVBQUUsQ0FBQyxDQUFDLEVBQUUsR0FBRyxjQUFjLENBQUMsR0FBRyxDQUFDLEVBQUUsUUFBUSxFQUFFLEtBQUssRUFBRSxDQUFDLENBQUMsQ0FBQztJQUUzRyxNQUFNLEtBQUssR0FBYSxNQUFNO1NBQzNCLEtBQUssQ0FBQyxDQUFDLEVBQUUsR0FBRyxDQUFDO1NBQ2IsSUFBSSxDQUFDLENBQUMsQ0FBUyxFQUFFLENBQVMsRUFBRSxFQUFFLENBQUMsQ0FBQyxDQUFDLFNBQVMsR0FBRyxDQUFDLENBQUMsU0FBUyxDQUFDO1NBQ3pELEdBQUcsQ0FBQyxDQUFDLEdBQVcsRUFBRSxLQUFhLEVBQVUsRUFBRSxDQUFDLENBQUMsRUFBRSxHQUFHLEdBQUcsRUFBRSxRQUFRLEVBQUUsS0FBSyxFQUFFLENBQUMsQ0FBQyxDQUFDO0lBRTlFLE1BQU0sSUFBSSxHQUFhLE1BQU07U0FDMUIsS0FBSyxDQUFDLENBQUMsRUFBRSxHQUFHLENBQUM7U0FDYixJQUFJLENBQUMsQ0FBQyxDQUFTLEVBQUUsQ0FBUyxFQUFFLEVBQUUsQ0FBQyxDQUFDLENBQUMsU0FBUyxHQUFHLENBQUMsQ0FBQyxTQUFTLENBQUM7U0FDekQsR0FBRyxDQUFDLENBQUMsR0FBVyxFQUFFLEtBQWEsRUFBVSxFQUFFLENBQUMsQ0FBQyxFQUFFLEdBQUcsR0FBRyxFQUFFLFFBQVEsRUFBRSxLQUFLLEVBQUUsQ0FBQyxDQUFDLENBQUM7SUFFOUUsTUFBTSw4QkFBaUIsQ0FBQyxXQUFXLEdBQUcsUUFBUSxFQUFFLEtBQUssQ0FBQyxDQUFDO0lBQ3ZELE1BQU0sOEJBQWlCLENBQUMsV0FBVyxHQUFHLE9BQU8sRUFBRSxJQUFJLENBQUMsQ0FBQztBQUN2RCxDQUFDO0FBRUQsU0FBUyxjQUFjLENBQUMsUUFBNkI7SUFDbkQsSUFBSSxJQUFJLEdBQVcsRUFBRSxDQUFDO0lBRXRCLElBQUksUUFBUSxDQUFDLFFBQVEsRUFBRTtRQUNyQixJQUFJLElBQUksUUFBUSxDQUFDLFFBQVEsQ0FBQyxJQUFJLEVBQUUsQ0FBQztLQUNsQztJQUVELElBQUksUUFBUSxDQUFDLFFBQVEsSUFBSSxRQUFRLENBQUMsUUFBUSxDQUFDLEtBQUssRUFBRTtRQUNoRCxJQUFJLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLEdBQUcsUUFBUSxDQUFDLFFBQVEsQ0FBQyxLQUFLLENBQUMsSUFBSSxFQUFFLENBQUM7S0FDNUQ7SUFFRCxJQUFJLFFBQVEsQ0FBQyxTQUFTLElBQUksUUFBUSxDQUFDLFNBQVMsQ0FBQyxNQUFNLEVBQUU7UUFDbkQsSUFBSSxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxHQUFHLFFBQVEsQ0FBQyxTQUFTLENBQUMsTUFBTSxDQUFDLFFBQVEsRUFBRSxDQUFDLElBQUksRUFBRSxDQUFDO0tBQ3pFO0lBRUQsSUFBSSxHQUFHLElBQUksQ0FBQyxPQUFPLENBQUMsbUJBQW1CLEVBQUUsRUFBRSxDQUFDLENBQUMsSUFBSSxFQUFFLENBQUM7SUFDcEQsSUFBSSxHQUFHLElBQUksQ0FBQyxPQUFPLENBQUMsT0FBTyxFQUFFLEdBQUcsQ0FBQyxDQUFDLElBQUksRUFBRSxDQUFDO0lBQ3pDLElBQUksR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxJQUFJLEVBQUUsQ0FBQztJQUVoQyxNQUFNLFNBQVMsR0FBVyxRQUFRLENBQUMsU0FBUyxDQUFDLE1BQU0sQ0FBQztJQUNwRCxJQUFJLE1BQU0sR0FBVyxRQUFRLENBQUMsU0FBUyxDQUFDLEtBQUssR0FBRyxRQUFRLENBQUMsU0FBUyxDQUFDLE1BQU0sQ0FBQztJQUMxRSxNQUFNLE1BQU0sR0FBZ0IsTUFBTSxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQztJQUNyRSxNQUFNLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLE1BQU0sR0FBRyxHQUFHLENBQUMsR0FBRyxHQUFHLENBQUMsQ0FBQztJQUNsRCxJQUFJLFNBQVMsR0FBdUIsQ0FBQyxRQUFRLENBQUMsV0FBVyxJQUFJLFFBQVEsQ0FBQyxXQUFXLENBQUMsS0FBSyxDQUFDLENBQUM7SUFDekYsSUFBSSxTQUFTLEdBQXVCLENBQUMsUUFBUSxDQUFDLFdBQVcsSUFBSSxRQUFRLENBQUMsV0FBVyxDQUFDLE1BQU0sQ0FBQyxDQUFDO0lBQzFGLElBQUksUUFBUSxHQUF1QixDQUFDLFFBQVEsQ0FBQyxXQUFXLElBQUksUUFBUSxDQUFDLFdBQVcsQ0FBQyxLQUFLLENBQUMsQ0FBQztJQUN4RixJQUFJLFVBQVUsR0FBdUIsQ0FBQyxRQUFRLENBQUMsV0FBVyxJQUFJLFFBQVEsQ0FBQyxXQUFXLENBQUMsTUFBTSxDQUFDLENBQUM7SUFDM0YsSUFBSSxJQUFJLEdBQWMsRUFBRSxDQUFDO0lBQ3pCLE1BQU0sSUFBSSxHQUFjLElBQUksQ0FBQztJQUM3QixJQUFJLE9BQU8sR0FBVyxHQUFHLFFBQVEsQ0FBQyxPQUFPLElBQUksUUFBUSxDQUFDLEVBQUUsSUFBSSxRQUFRLENBQUMsUUFBUSxJQUFJLFFBQVEsQ0FBQyxRQUFRLENBQUMsUUFBUSxJQUFJLFFBQVEsQ0FBQyxRQUFRLENBQUMsUUFBUSxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsSUFBSSxRQUFRLENBQUMsUUFBUSxJQUFJLFFBQVEsQ0FBQyxRQUFRLENBQUMsS0FBSyxJQUFJLFFBQVEsQ0FBQyxRQUFRLElBQUksUUFBUSxDQUFDLFFBQVEsQ0FBQyxNQUFNLElBQUksUUFBUSxDQUFDLFFBQVEsSUFBSSxRQUFRLENBQUMsUUFBUSxDQUFDLEtBQUssSUFBSSxRQUFRLENBQUMsUUFBUSxFQUFFLENBQUM7SUFDN1QsT0FBTyxHQUFHLE9BQU8sQ0FBQyxPQUFPLENBQUMsWUFBWSxFQUFFLEdBQUcsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxNQUFNLEVBQUUsR0FBRyxDQUFDLENBQUMsSUFBSSxFQUFFLENBQUM7SUFDekUsbVBBQW1QO0lBQ25QLHFFQUFxRTtJQUVyRSxJQUFJLFNBQVMsRUFBRTtRQUNiLElBQUksR0FBRyxNQUFNLENBQUM7S0FDZjtTQUFNLElBQUksUUFBUSxFQUFFO1FBQ25CLElBQUksR0FBRyxNQUFNLENBQUM7S0FDZjtJQUVELElBQUksU0FBUyxFQUFFO1FBQ2IsSUFBSSxHQUFHLE1BQU0sQ0FBQztLQUNmO1NBQU0sSUFBSSxVQUFVLEVBQUU7UUFDckIsSUFBSSxHQUFHLE1BQU0sQ0FBQztLQUNmO0lBRUQsSUFBSSxDQUFDLFNBQVMsSUFBSSxTQUFTLElBQUksQ0FBQyxTQUFTLEtBQUssU0FBUyxDQUFDLENBQUMsRUFBRTtRQUN6RCxJQUFJLEdBQUcsT0FBTyxDQUFDO0tBQ2hCO0lBRUQsU0FBUyxHQUFHLFNBQVMsSUFBSSxJQUFJLENBQUM7SUFDOUIsU0FBUyxHQUFHLFNBQVMsSUFBSSxJQUFJLENBQUM7SUFDOUIsUUFBUSxHQUFHLFFBQVEsSUFBSSxFQUFFLENBQUM7SUFDMUIsVUFBVSxHQUFHLFVBQVUsSUFBSSxFQUFFLENBQUM7SUFFaEMscUNBQXFDO0lBQ25DLE9BQU87UUFDTCxHQUFHLEtBQUs7UUFDWixZQUFZO1FBQ1IsSUFBSTtRQUNKLFNBQVM7UUFDVCxNQUFNO1FBQ04sTUFBTTtRQUNOLFNBQVM7UUFDVCxTQUFTO1FBQ1QsUUFBUTtRQUNSLFVBQVU7UUFDVixJQUFJO1FBQ0osSUFBSTtRQUNKLE9BQU87S0FDUixDQUFDO0FBQ0osQ0FBQztBQUVELEtBQUssVUFBVSxLQUFLO0lBQ3BCLDJGQUEyRjtJQUMzRiwyRkFBMkY7SUFDM0YsMkZBQTJGO0lBQzNGLGdHQUFnRztJQUNoRyxnR0FBZ0c7SUFDaEcsZ0dBQWdHO0lBQ2hHLG9LQUFvSztJQUNwSyxpQ0FBaUM7SUFDakMsc0JBQXNCO0lBQ3RCLElBQUk7SUFFSixpSUFBaUk7SUFDakksNkdBQTZHO0lBQzNHLE1BQU0sSUFBSSxDQUFDLGtDQUFrQyxFQUFFLHlCQUF5QixDQUFDLENBQUM7SUFDMUUsd0dBQXdHO0FBQzFHLENBQUM7QUFFRCxrQkFBZSxLQUFLLEVBQUUsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAnbW9kdWxlLWFsaWFzL3JlZ2lzdGVyJztcclxuXHJcbmltcG9ydCB7IHJlYWRGaWxlQXN5bmMsIHdyaXRlVG9Kc29uQW5kQ3N2IH0gZnJvbSAnQGhlbHBlcnMvZnMtaGVscGVycyc7XHJcbmltcG9ydCB7IGNyZWF0ZUxvZyB9IGZyb20gJ0BoZWxwZXJzL2xvZy1oZWxwZXJzJztcclxuaW1wb3J0IHsgQ2hpcnBEdXBsZXgsIENoaXJwTW9kZSwgQ2hpcnBUb25lLCBJQ2hpcnAgfSBmcm9tICdAaW50ZXJmYWNlcy9pLWNoaXJwJztcclxuaW1wb3J0IHsgSVJlcGVhdGVyU3RydWN0dXJlZCwgUmVwZWF0ZXJTdGF0dXMsIFJlcGVhdGVyVXNlIH0gZnJvbSAnQGludGVyZmFjZXMvaS1yZXBlYXRlci1zdHJ1Y3R1cmVkJztcclxuaW1wb3J0IHsgSVNpbXBsZXhGcmVxdWVuY3kgfSBmcm9tICdAaW50ZXJmYWNlcy9pLXNpbXBsZXgtZnJlcXVlbmN5JztcclxuaW1wb3J0IGdwc0Rpc3RhbmNlLCB7IFBvaW50IH0gZnJvbSAnZ3BzLWRpc3RhbmNlJztcclxuXHJcbmNvbnN0IGxvZzogKC4uLm1zZzogYW55W10pID0+IHZvaWQgPSBjcmVhdGVMb2coJ01ha2UgQ2hpcnAnKTtcclxuXHJcbmNvbnN0IGNoaXJwOiBJQ2hpcnAgPSB7XHJcbiAgTG9jYXRpb246IG51bGwgYXMgYW55LFxyXG4gIE5hbWU6ICcnLFxyXG4gIEZyZXF1ZW5jeTogbnVsbCBhcyBhbnksXHJcbiAgRHVwbGV4OiAnJyxcclxuICBPZmZzZXQ6IG51bGwgYXMgYW55LFxyXG4gIFRvbmU6ICcnLFxyXG4gIHJUb25lRnJlcTogbnVsbCBhcyBhbnksXHJcbiAgY1RvbmVGcmVxOiBudWxsIGFzIGFueSxcclxuICBEdGNzQ29kZTogbnVsbCBhcyBhbnksXHJcbiAgRHRjc1J4Q29kZTogbnVsbCBhcyBhbnksXHJcbiAgRHRjc1BvbGFyaXR5OiAnTk4nLFxyXG4gIE1vZGU6ICdGTScsXHJcbiAgVFN0ZXA6IDUsXHJcbiAgQ29tbWVudDogJycsXHJcbn07XHJcblxyXG5jb25zdCBteVBvaW50OiBQb2ludCA9IFszOS42MjcwNzE1MDAsIC0xMDQuODkzMzIyNTAwXTsgLy8gNDk4MiBTIFVsc3RlciBTdFxyXG5cclxuYXN5bmMgZnVuY3Rpb24gZG9JdChpbkZpbGVOYW1lOiBzdHJpbmcsIG91dEZpbGVOYW1lOiBzdHJpbmcpOiBQcm9taXNlPHZvaWQ+IHtcclxuICBjb25zdCBzaW1wbGV4OiBJUmVwZWF0ZXJTdHJ1Y3R1cmVkW10gPVxyXG4gICAgSlNPTi5wYXJzZSgoYXdhaXQgcmVhZEZpbGVBc3luYygnZGF0YS9mcmVxdWVuY2llcy5qc29uJykpLnRvU3RyaW5nKCkpXHJcbiAgICAgIC5tYXAoKG1hcDogSVNpbXBsZXhGcmVxdWVuY3kpID0+XHJcbiAgICAgICAgKHsgQ2FsbHNpZ246IG1hcC5OYW1lLCBGcmVxdWVuY3k6IHsgT3V0cHV0OiBtYXAuRnJlcXVlbmN5LCBJbnB1dDogbWFwLkZyZXF1ZW5jeSB9IH0pKVxyXG4gICAgICAuZmlsdGVyKChmaWx0ZXI6IElSZXBlYXRlclN0cnVjdHVyZWQpID0+IC9GTXxWb2ljZXxTaW1wbGV4L2kudGVzdChmaWx0ZXIuQ2FsbHNpZ24pKVxyXG4gICAgICAuZmlsdGVyKChmaWx0ZXI6IElSZXBlYXRlclN0cnVjdHVyZWQpID0+ICEoL0RhdGF8RGlnaXRhbHxQYWNrZXQvaS50ZXN0KGZpbHRlci5DYWxsc2lnbikpKTtcclxuXHJcbiAgY29uc3QgcmVwZWF0ZXJzOiBJUmVwZWF0ZXJTdHJ1Y3R1cmVkW10gPVxyXG4gICAgSlNPTi5wYXJzZSgoYXdhaXQgcmVhZEZpbGVBc3luYyhpbkZpbGVOYW1lKSkudG9TdHJpbmcoKSk7XHJcblxyXG4gIHJlcGVhdGVycy5mb3JFYWNoKChlYWNoOiBJUmVwZWF0ZXJTdHJ1Y3R1cmVkKSA9PiB7XHJcbiAgICBlYWNoLkxvY2F0aW9uLkRpc3RhbmNlID0gZ3BzRGlzdGFuY2UoW215UG9pbnQsIFtlYWNoLkxvY2F0aW9uLkxhdGl0dWRlLCBlYWNoLkxvY2F0aW9uLkxvbmdpdHVkZV1dKTtcclxuICB9KTtcclxuXHJcbiAgcmVwZWF0ZXJzLnNvcnQoKGE6IElSZXBlYXRlclN0cnVjdHVyZWQsIGI6IElSZXBlYXRlclN0cnVjdHVyZWQpID0+XHJcbiAgICBhLkxvY2F0aW9uLkRpc3RhbmNlISA+IGIuTG9jYXRpb24uRGlzdGFuY2UhID8gMSA6XHJcbiAgICAgIGEuTG9jYXRpb24uRGlzdGFuY2UhIDwgYi5Mb2NhdGlvbi5EaXN0YW5jZSEgPyAtMSA6IDApO1xyXG4gIGNvbnN0IG1hcHBlZDogSUNoaXJwW10gPSBbXHJcbiAgICAuLi5zaW1wbGV4LFxyXG4gICAgLi4ucmVwZWF0ZXJzXHJcbiAgICAgIC5maWx0ZXIoKGZpbHRlcjogSVJlcGVhdGVyU3RydWN0dXJlZCkgPT5cclxuICAgICAgICAoZmlsdGVyLkZyZXF1ZW5jeS5PdXRwdXQgPj0gMTQ0ICYmIGZpbHRlci5GcmVxdWVuY3kuT3V0cHV0IDw9IDE0OCkgfHxcclxuICAgICAgICAoZmlsdGVyLkZyZXF1ZW5jeS5PdXRwdXQgPj0gMjIyICYmIGZpbHRlci5GcmVxdWVuY3kuT3V0cHV0IDw9IDIyNSkgfHxcclxuICAgICAgICAoZmlsdGVyLkZyZXF1ZW5jeS5PdXRwdXQgPj0gNDIwICYmIGZpbHRlci5GcmVxdWVuY3kuT3V0cHV0IDw9IDQ1MCkpXHJcbiAgICAgIC5maWx0ZXIoKGZpbHRlcjogSVJlcGVhdGVyU3RydWN0dXJlZCkgPT5cclxuICAgICAgICAhZmlsdGVyLkRpZ2l0YWwgJiZcclxuICAgICAgICBmaWx0ZXIuU3RhdHVzICE9PSBSZXBlYXRlclN0YXR1cy5PZmZBaXIgJiZcclxuICAgICAgICBmaWx0ZXIuVXNlID09PSBSZXBlYXRlclVzZS5PcGVuKSxcclxuICBdXHJcbiAgICAubWFwKChtYXA6IElSZXBlYXRlclN0cnVjdHVyZWQsIGluZGV4OiBudW1iZXIpOiBJQ2hpcnAgPT4gKHsgLi4uY29udmVydFRvUmFkaW8obWFwKSwgTG9jYXRpb246IGluZGV4IH0pKTtcclxuXHJcbiAgY29uc3Qgc2hvcnQ6IElDaGlycFtdID0gbWFwcGVkXHJcbiAgICAuc2xpY2UoMCwgMTI4KVxyXG4gICAgLnNvcnQoKGE6IElDaGlycCwgYjogSUNoaXJwKSA9PiBhLkZyZXF1ZW5jeSAtIGIuRnJlcXVlbmN5KVxyXG4gICAgLm1hcCgobWFwOiBJQ2hpcnAsIGluZGV4OiBudW1iZXIpOiBJQ2hpcnAgPT4gKHsgLi4ubWFwLCBMb2NhdGlvbjogaW5kZXggfSkpO1xyXG5cclxuICBjb25zdCBsb25nOiBJQ2hpcnBbXSA9IG1hcHBlZFxyXG4gICAgLnNsaWNlKDAsIDIwMClcclxuICAgIC5zb3J0KChhOiBJQ2hpcnAsIGI6IElDaGlycCkgPT4gYS5GcmVxdWVuY3kgLSBiLkZyZXF1ZW5jeSlcclxuICAgIC5tYXAoKG1hcDogSUNoaXJwLCBpbmRleDogbnVtYmVyKTogSUNoaXJwID0+ICh7IC4uLm1hcCwgTG9jYXRpb246IGluZGV4IH0pKTtcclxuXHJcbiAgYXdhaXQgd3JpdGVUb0pzb25BbmRDc3Yob3V0RmlsZU5hbWUgKyAnLXNob3J0Jywgc2hvcnQpO1xyXG4gIGF3YWl0IHdyaXRlVG9Kc29uQW5kQ3N2KG91dEZpbGVOYW1lICsgJy1sb25nJywgbG9uZyk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGNvbnZlcnRUb1JhZGlvKHJlcGVhdGVyOiBJUmVwZWF0ZXJTdHJ1Y3R1cmVkKTogSUNoaXJwIHtcclxuICBsZXQgTmFtZTogc3RyaW5nID0gJyc7XHJcblxyXG4gIGlmIChyZXBlYXRlci5DYWxsc2lnbikge1xyXG4gICAgTmFtZSArPSByZXBlYXRlci5DYWxsc2lnbi50cmltKCk7XHJcbiAgfVxyXG5cclxuICBpZiAocmVwZWF0ZXIuTG9jYXRpb24gJiYgcmVwZWF0ZXIuTG9jYXRpb24uTG9jYWwpIHtcclxuICAgIE5hbWUgKz0gKE5hbWUgPyAnICcgOiAnJykgKyByZXBlYXRlci5Mb2NhdGlvbi5Mb2NhbC50cmltKCk7XHJcbiAgfVxyXG5cclxuICBpZiAocmVwZWF0ZXIuRnJlcXVlbmN5ICYmIHJlcGVhdGVyLkZyZXF1ZW5jeS5PdXRwdXQpIHtcclxuICAgIE5hbWUgKz0gKE5hbWUgPyAnICcgOiAnJykgKyByZXBlYXRlci5GcmVxdWVuY3kuT3V0cHV0LnRvU3RyaW5nKCkudHJpbSgpO1xyXG4gIH1cclxuXHJcbiAgTmFtZSA9IE5hbWUucmVwbGFjZSgvW14wLTkuYS16QS1aIFxcL10vZywgJycpLnRyaW0oKTtcclxuICBOYW1lID0gTmFtZS5yZXBsYWNlKC9bIF0rL2csICcgJykudHJpbSgpO1xyXG4gIE5hbWUgPSBOYW1lLnN1YnN0cigwLCA4KS50cmltKCk7XHJcblxyXG4gIGNvbnN0IEZyZXF1ZW5jeTogbnVtYmVyID0gcmVwZWF0ZXIuRnJlcXVlbmN5Lk91dHB1dDtcclxuICBsZXQgT2Zmc2V0OiBudW1iZXIgPSByZXBlYXRlci5GcmVxdWVuY3kuSW5wdXQgLSByZXBlYXRlci5GcmVxdWVuY3kuT3V0cHV0O1xyXG4gIGNvbnN0IER1cGxleDogQ2hpcnBEdXBsZXggPSBPZmZzZXQgPiAwID8gJysnIDogT2Zmc2V0IDwgMCA/ICctJyA6ICcnO1xyXG4gIE9mZnNldCA9IE1hdGguYWJzKE1hdGgucm91bmQoT2Zmc2V0ICogMTAwKSAvIDEwMCk7XHJcbiAgbGV0IHJUb25lRnJlcTogbnVtYmVyIHwgdW5kZWZpbmVkID0gKHJlcGVhdGVyLlNxdWVsY2hUb25lICYmIHJlcGVhdGVyLlNxdWVsY2hUb25lLklucHV0KTtcclxuICBsZXQgY1RvbmVGcmVxOiBudW1iZXIgfCB1bmRlZmluZWQgPSAocmVwZWF0ZXIuU3F1ZWxjaFRvbmUgJiYgcmVwZWF0ZXIuU3F1ZWxjaFRvbmUuT3V0cHV0KTtcclxuICBsZXQgRHRjc0NvZGU6IG51bWJlciB8IHVuZGVmaW5lZCA9IChyZXBlYXRlci5EaWdpdGFsVG9uZSAmJiByZXBlYXRlci5EaWdpdGFsVG9uZS5JbnB1dCk7XHJcbiAgbGV0IER0Y3NSeENvZGU6IG51bWJlciB8IHVuZGVmaW5lZCA9IChyZXBlYXRlci5EaWdpdGFsVG9uZSAmJiByZXBlYXRlci5EaWdpdGFsVG9uZS5PdXRwdXQpO1xyXG4gIGxldCBUb25lOiBDaGlycFRvbmUgPSAnJztcclxuICBjb25zdCBNb2RlOiBDaGlycE1vZGUgPSAnRk0nO1xyXG4gIGxldCBDb21tZW50OiBzdHJpbmcgPSBgJHtyZXBlYXRlci5TdGF0ZUlEfSAke3JlcGVhdGVyLklEfSAke3JlcGVhdGVyLkxvY2F0aW9uICYmIHJlcGVhdGVyLkxvY2F0aW9uLkRpc3RhbmNlICYmIHJlcGVhdGVyLkxvY2F0aW9uLkRpc3RhbmNlLnRvRml4ZWQoMil9ICR7cmVwZWF0ZXIuTG9jYXRpb24gJiYgcmVwZWF0ZXIuTG9jYXRpb24uU3RhdGV9ICR7cmVwZWF0ZXIuTG9jYXRpb24gJiYgcmVwZWF0ZXIuTG9jYXRpb24uQ291bnR5fSAke3JlcGVhdGVyLkxvY2F0aW9uICYmIHJlcGVhdGVyLkxvY2F0aW9uLkxvY2FsfSAke3JlcGVhdGVyLkNhbGxzaWdufWA7XHJcbiAgQ29tbWVudCA9IENvbW1lbnQucmVwbGFjZSgvdW5kZWZpbmVkL2csICcgJykucmVwbGFjZSgvXFxzKy9nLCAnICcpLnRyaW0oKTtcclxuICAvLyBgJHtpdGVtWydTVC9QUiddIHx8ICcnfSAke2l0ZW0uQ291bnR5IHx8ICcnfSAke2l0ZW0uTG9jYXRpb24gfHwgJyd9ICR7aXRlbS5DYWxsIHx8ICcnfSAke2l0ZW0uU3BvbnNvciB8fCAnJ30gJHtpdGVtLkFmZmlsaWF0ZSB8fCAnJ30gJHtpdGVtLkZyZXF1ZW5jeX0gJHtpdGVtLlVzZSB8fCAnJ30gJHtpdGVtWydPcCBTdGF0dXMnXSB8fCAnJ30gJHtpdGVtLkNvbW1lbnQgfHwgJyd9YC5yZXBsYWNlKC9cXHMrL2csICcgJyk7XHJcbiAgLy8gQ29tbWVudCA9IENvbW1lbnQudHJpbSgpLnJlcGxhY2UoXCIsXCIsIFwiXCIpLnN1YnN0cmluZygwLCAzMSkudHJpbSgpO1xyXG5cclxuICBpZiAoclRvbmVGcmVxKSB7XHJcbiAgICBUb25lID0gJ1RvbmUnO1xyXG4gIH0gZWxzZSBpZiAoRHRjc0NvZGUpIHtcclxuICAgIFRvbmUgPSAnRFRDUyc7XHJcbiAgfVxyXG5cclxuICBpZiAoY1RvbmVGcmVxKSB7XHJcbiAgICBUb25lID0gJ1RTUUwnO1xyXG4gIH0gZWxzZSBpZiAoRHRjc1J4Q29kZSkge1xyXG4gICAgVG9uZSA9ICdEVENTJztcclxuICB9XHJcblxyXG4gIGlmICgoclRvbmVGcmVxICYmIGNUb25lRnJlcSAmJiAoclRvbmVGcmVxICE9PSBjVG9uZUZyZXEpKSkge1xyXG4gICAgVG9uZSA9ICdDcm9zcyc7XHJcbiAgfVxyXG5cclxuICBjVG9uZUZyZXEgPSBjVG9uZUZyZXEgfHwgODguNTtcclxuICByVG9uZUZyZXEgPSByVG9uZUZyZXEgfHwgODguNTtcclxuICBEdGNzQ29kZSA9IER0Y3NDb2RlIHx8IDIzO1xyXG4gIER0Y3NSeENvZGUgPSBEdGNzUnhDb2RlIHx8IDIzO1xyXG5cclxuLy8gbG9nKGNoYWxrLmdyZWVuKFwiTWFkZSBSb3dcIiksIHJvdyk7XHJcbiAgcmV0dXJuIHtcclxuICAgIC4uLmNoaXJwLFxyXG4vLyBMb2NhdGlvbixcclxuICAgIE5hbWUsXHJcbiAgICBGcmVxdWVuY3ksXHJcbiAgICBEdXBsZXgsXHJcbiAgICBPZmZzZXQsXHJcbiAgICByVG9uZUZyZXEsXHJcbiAgICBjVG9uZUZyZXEsXHJcbiAgICBEdGNzQ29kZSxcclxuICAgIER0Y3NSeENvZGUsXHJcbiAgICBUb25lLFxyXG4gICAgTW9kZSxcclxuICAgIENvbW1lbnQsXHJcbiAgfTtcclxufVxyXG5cclxuYXN5bmMgZnVuY3Rpb24gc3RhcnQoKTogUHJvbWlzZTx2b2lkPiB7XHJcbi8vIGNvbnN0IGNvRmlsZXMgPSAoYXdhaXQgcmVhZGRpckFzeW5jKFwiLi9yZXBlYXRlcnMvZGF0YS9DTy9cIikpLm1hcCgoZikgPT4gYGRhdGEvQ08vJHtmfWApO1xyXG4vLyBjb25zdCB1dEZpbGVzID0gKGF3YWl0IHJlYWRkaXJBc3luYyhcIi4vcmVwZWF0ZXJzL2RhdGEvVVQvXCIpKS5tYXAoKGYpID0+IGBkYXRhL1VULyR7Zn1gKTtcclxuLy8gY29uc3Qgbm1GaWxlcyA9IChhd2FpdCByZWFkZGlyQXN5bmMoXCIuL3JlcGVhdGVycy9kYXRhL05NL1wiKSkubWFwKChmKSA9PiBgZGF0YS9OTS8ke2Z9YCk7XHJcbi8vIGNvbnN0IGNvR3JvdXBzID0gKGF3YWl0IHJlYWRkaXJBc3luYyhcIi4vcmVwZWF0ZXJzL2dyb3Vwcy9DTy9cIikpLm1hcCgoZikgPT4gYGdyb3Vwcy9DTy8ke2Z9YCk7XHJcbi8vIGNvbnN0IHV0R3JvdXBzID0gKGF3YWl0IHJlYWRkaXJBc3luYyhcIi4vcmVwZWF0ZXJzL2dyb3Vwcy9VVC9cIikpLm1hcCgoZikgPT4gYGdyb3Vwcy9VVC8ke2Z9YCk7XHJcbi8vIGNvbnN0IG5tR3JvdXBzID0gKGF3YWl0IHJlYWRkaXJBc3luYyhcIi4vcmVwZWF0ZXJzL2dyb3Vwcy9OTS9cIikpLm1hcCgoZikgPT4gYGdyb3Vwcy9OTS8ke2Z9YCk7XHJcbi8vIGNvbnN0IGFsbEZpbGVzID0gWy4uLmNvRmlsZXMsIC4uLnV0RmlsZXMsIC4uLm5tRmlsZXMsIC4uLmNvR3JvdXBzLCAuLi51dEdyb3VwcywgLi4ubm1Hcm91cHNdLmZpbHRlcigoZikgPT4gL1xcLmpzb24kLy50ZXN0KGYpKS5tYXAoKGYpID0+IGYucmVwbGFjZShcIi5qc29uXCIsIFwiXCIpKTtcclxuLy8gZm9yIChjb25zdCBmaWxlIG9mIGFsbEZpbGVzKSB7XHJcbi8vICAgYXdhaXQgZG9JdChmaWxlKTtcclxuLy8gfVxyXG5cclxuLy8gYXdhaXQgZG9JdChcImRhdGEvcmVwZWF0ZXJzL2dyb3Vwcy9DTy9Db2xvcmFkbyBTcHJpbmdzIC0gQ2FsbC5qc29uXCIsIFwiZGF0YS9yZXBlYXRlcnMvY2hpcnAvZ3JvdXBzL0NPL0NvbG9yYWRvIFNwcmluZ3MgLSBDYWxsXCIpO1xyXG4vLyBhd2FpdCBkb0l0KFwiZGF0YS9yZXBlYXRlcnMvcmVzdWx0cy9DTy9Db2xvcmFkbyBTcHJpbmdzLmpzb25cIiwgXCJkYXRhL3JlcGVhdGVycy9jaGlycC9DTy9Db2xvcmFkbyBTcHJpbmdzXCIpO1xyXG4gIGF3YWl0IGRvSXQoJ2RhdGEvcmVwZWF0ZXJzL2NvbnZlcnRlZC9DTy5qc29uJywgJ2RhdGEvcmVwZWF0ZXJzL2NoaXJwL0NPJyk7XHJcbiAgLy8gYXdhaXQgZG9JdCgnZGF0YS9yZXBlYXRlcnMvZ3JvdXBzL2NvbWJpbmVkL0NPIC0gQ2FsbC5qc29uJywgJ2RhdGEvcmVwZWF0ZXJzL2NoaXJwL2dyb3Vwcy9DTyAtIENhbGwnKTtcclxufVxyXG5cclxuZXhwb3J0IGRlZmF1bHQgc3RhcnQoKTtcclxuIl19