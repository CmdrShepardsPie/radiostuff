"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
require("module-alias/register");
const fs_helpers_1 = require("@helpers/fs-helpers");
const log_helpers_1 = require("@helpers/log-helpers");
const i_adms400_1 = require("@interfaces/i-adms400");
const gps_distance_1 = __importDefault(require("gps-distance"));
const chalk_1 = __importDefault(require("chalk"));
const radio_helpers_1 = require("@helpers/radio-helpers");
const log = log_helpers_1.createLog("Make Adms400");
const homePoint = [39.627071500, -104.893322500]; // 4982 S Ulster St
const DenverPoint = [39.742043, -104.991531];
const ColoradoSpringsPoint = [38.846127, -104.800644];
async function doIt(inFileName, outFileName) {
    const simplex = JSON.parse((await fs_helpers_1.readFileAsync("../data/frequencies.json")).toString())
        .map((map) => ({ Callsign: map.Name, Frequency: { Output: map.Frequency, Input: map.Frequency } }))
        .filter((filter) => /FM|Voice|Simplex/i.test(filter.Callsign));
    // .filter((filter: IRepeaterStructured) => !(/Data|Digital|Packet/i.test(filter.Callsign)));
    const repeaters = JSON.parse((await fs_helpers_1.readFileAsync(inFileName)).toString());
    repeaters.forEach((each) => {
        each.Location.Distance = Math.min(gps_distance_1.default([homePoint, [each.Location.Latitude, each.Location.Longitude]]));
    });
    repeaters.sort((a, b) => a.Location.Distance - b.Location.Distance);
    const mapped = [
        ...simplex
            .filter(radio_helpers_1.filterFrequencies(radio_helpers_1.FrequencyBand.$2_m, radio_helpers_1.FrequencyBand.$70_cm)),
        ...repeaters
            .filter(radio_helpers_1.filterFrequencies(radio_helpers_1.FrequencyBand.$2_m, radio_helpers_1.FrequencyBand.$70_cm))
            .filter(radio_helpers_1.filterDistance(100))
            .filter(radio_helpers_1.filterMode(radio_helpers_1.Mode.FM, radio_helpers_1.Mode.YSF)),
    ]
        .map((map, index) => ({ ...convertToRadio(map), "Channel Number": index + 1 }))
        .slice(0, 500)
        .sort((a, b) => a["Receive Frequency"] - b["Receive Frequency"])
        .map((map, index) => ({ ...map, "Channel Number": index + 1 }));
    return fs_helpers_1.writeToJsonAndCsv(outFileName, mapped, mapped);
}
function convertToRadio(repeater) {
    const Name = radio_helpers_1.buildName(repeater);
    const Receive = repeater.Frequency.Output;
    const Transmit = repeater.Frequency.Input;
    const OffsetFrequency = repeater.Frequency.Input - repeater.Frequency.Output;
    const TransmitSquelchTone = (repeater.SquelchTone && repeater.SquelchTone.Input);
    const ReceiveSquelchTone = (repeater.SquelchTone && repeater.SquelchTone.Output);
    const TransmitDigitalTone = (repeater.DigitalTone && repeater.DigitalTone.Input);
    const ReceiveDigitalTone = (repeater.DigitalTone && repeater.DigitalTone.Output);
    const Comment = radio_helpers_1.buildComment(repeater);
    let ToneMode = i_adms400_1.Adms400ToneMode.None;
    if (TransmitSquelchTone) {
        ToneMode = i_adms400_1.Adms400ToneMode.Tone; // "TONE ENC";
    }
    else if (TransmitDigitalTone) {
        ToneMode = i_adms400_1.Adms400ToneMode.DCS; // "DCS";
    }
    if (TransmitSquelchTone && ReceiveSquelchTone && TransmitSquelchTone === ReceiveSquelchTone) {
        ToneMode = i_adms400_1.Adms400ToneMode.T_Sql; // "TONE SQL";
    }
    else if (TransmitDigitalTone && ReceiveDigitalTone && TransmitDigitalTone === ReceiveDigitalTone) {
        // ToneMode = Adms400ToneMode.T_DCS; // "DCS";
    }
    const CTCSS = ((TransmitSquelchTone || 100).toFixed(1) + " Hz");
    const DCS = radio_helpers_1.buildDCS(TransmitDigitalTone);
    return new i_adms400_1.Adms400({
        // "Channel Number": number;
        "Receive Frequency": Receive.toFixed(5),
        "Transmit Frequency": Transmit.toFixed(5),
        "Offset Frequency": convertOffsetFrequency(OffsetFrequency),
        "Offset Direction": convertOffsetDirection(OffsetFrequency),
        // "Operating Mode": Adms400OperatingMode,
        Name,
        // "Show Name": Adms400ShowName,
        "Tone Mode": ToneMode,
        CTCSS,
        DCS,
        // "Tx Power": Adms400TxPower,
        // Skip: Adms400Skip,
        // Step: Adms400Step,
        // "Clock Shift": Adms400ClockShift,
        Comment,
    });
}
function convertOffsetFrequency(OffsetFrequency) {
    switch (Math.abs(Math.round(OffsetFrequency * 10)) / 10) {
        case 0:
            return i_adms400_1.Adms400OffsetFrequency.None;
        case 0.1:
            return i_adms400_1.Adms400OffsetFrequency.$100_kHz;
        case 0.5:
            return i_adms400_1.Adms400OffsetFrequency.$500_kHz;
        case 0.6:
            return i_adms400_1.Adms400OffsetFrequency.$600_kHz;
        case 1:
            return i_adms400_1.Adms400OffsetFrequency.$1_00_MHz;
        case 1.6:
            return i_adms400_1.Adms400OffsetFrequency.$1_60_MHz;
        case 3:
            return i_adms400_1.Adms400OffsetFrequency.$3_00_MHz;
        case 5:
            return i_adms400_1.Adms400OffsetFrequency.$5_00_MHz;
        case 7.6:
            return i_adms400_1.Adms400OffsetFrequency.$7_60_MHz;
    }
    log(chalk_1.default.red("ERROR"), "convertOffsetFrequency", "unknown", OffsetFrequency);
    return i_adms400_1.Adms400OffsetFrequency.None;
}
function convertOffsetDirection(OffsetFrequency) {
    if (OffsetFrequency === 0) {
        return i_adms400_1.Adms400OffsetDirection.Simplex;
    }
    else if (OffsetFrequency < 0) {
        return i_adms400_1.Adms400OffsetDirection.Minus;
    }
    else if (OffsetFrequency > 0) {
        return i_adms400_1.Adms400OffsetDirection.Plus;
    }
    log(chalk_1.default.red("ERROR"), "convertOffsetDirection", "unknown", OffsetFrequency);
    return i_adms400_1.Adms400OffsetDirection.Simplex;
}
module.exports = doIt("../data/repeaters/converted/CO.json", "../data/repeaters/adms400/CO");
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWFrZS1hZG1zNDAwLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vc3JjL21ha2UtYWRtczQwMC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQUEsaUNBQStCO0FBRS9CLG9EQUF1RTtBQUN2RSxzREFBaUQ7QUFHakQscURBUStCO0FBQy9CLGdFQUFrRDtBQUNsRCxrREFBMEI7QUFDMUIsMERBU2dDO0FBRWhDLE1BQU0sR0FBRyxHQUE0Qix1QkFBUyxDQUFDLGNBQWMsQ0FBQyxDQUFDO0FBRS9ELE1BQU0sU0FBUyxHQUFVLENBQUMsWUFBWSxFQUFFLENBQUMsYUFBYSxDQUFDLENBQUMsQ0FBQyxtQkFBbUI7QUFDNUUsTUFBTSxXQUFXLEdBQVUsQ0FBQyxTQUFTLEVBQUUsQ0FBQyxVQUFVLENBQUMsQ0FBQztBQUNwRCxNQUFNLG9CQUFvQixHQUFVLENBQUMsU0FBUyxFQUFFLENBQUMsVUFBVSxDQUFDLENBQUM7QUFFN0QsS0FBSyxVQUFVLElBQUksQ0FBQyxVQUFrQixFQUFFLFdBQW1CO0lBQ3pELE1BQU0sT0FBTyxHQUNYLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQyxNQUFNLDBCQUFhLENBQUMsMEJBQTBCLENBQUMsQ0FBQyxDQUFDLFFBQVEsRUFBRSxDQUFDO1NBQ3JFLEdBQUcsQ0FBQyxDQUFDLEdBQXNCLEVBQXVCLEVBQUUsQ0FDbkQsQ0FBQyxFQUFFLFFBQVEsRUFBRSxHQUFHLENBQUMsSUFBSSxFQUFFLFNBQVMsRUFBRSxFQUFFLE1BQU0sRUFBRSxHQUFHLENBQUMsU0FBUyxFQUFFLEtBQUssRUFBRSxHQUFHLENBQUMsU0FBUyxFQUFFLEVBQUUsQ0FBd0IsQ0FBQztTQUM3RyxNQUFNLENBQUMsQ0FBQyxNQUEyQixFQUFXLEVBQUUsQ0FBQyxtQkFBbUIsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUM7SUFDakcsNkZBQTZGO0lBRTdGLE1BQU0sU0FBUyxHQUNiLElBQUksQ0FBQyxLQUFLLENB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LENBQUMsS0FBSyxDQUFDO0tBQ3JDO1NBQU0sSUFBSSxlQUFlLEdBQUcsQ0FBQyxFQUFFO1FBQzlCLE9BQU8sa0NBQXNCLENBQUMsSUFBSSxDQUFDO0tBQ3BDO0lBQ0QsR0FBRyxDQUFDLGVBQUssQ0FBQyxHQUFHLENBQUMsT0FBTyxDQUFDLEVBQUUsd0JBQXdCLEVBQUUsU0FBUyxFQUFFLGVBQWUsQ0FBQyxDQUFDO0lBQzlFLE9BQU8sa0NBQXNCLENBQUMsT0FBTyxDQUFDO0FBQ3hDLENBQUM7QUFFRCxpQkFBUyxJQUFJLENBQUMscUNBQXFDLEVBQUUsOEJBQThCLENBQUMsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBcIm1vZHVsZS1hbGlhcy9yZWdpc3RlclwiO1xuXG5pbXBvcnQgeyByZWFkRmlsZUFzeW5jLCB3cml0ZVRvSnNvbkFuZENzdiB9IGZyb20gXCJAaGVscGVycy9mcy1oZWxwZXJzXCI7XG5pbXBvcnQgeyBjcmVhdGVMb2cgfSBmcm9tIFwiQGhlbHBlcnMvbG9nLWhlbHBlcnNcIjtcbmltcG9ydCB7IElSZXBlYXRlclN0cnVjdHVyZWQgfSBmcm9tIFwiQGludGVyZmFjZXMvaS1yZXBlYXRlci1zdHJ1Y3R1cmVkXCI7XG5pbXBvcnQgeyBJU2ltcGxleEZyZXF1ZW5jeSB9IGZyb20gXCJAaW50ZXJmYWNlcy9pLXNpbXBsZXgtZnJlcXVlbmN5XCI7XG5pbXBvcnQge1xuICBBZG1zNDAwLFxuICBBZG1zNDAwQ3Rjc3NUb25lLFxuICBBZG1zNDAwRGNzVG9uZSxcbiAgQWRtczQwME9mZnNldERpcmVjdGlvbixcbiAgQWRtczQwME9mZnNldEZyZXF1ZW5jeSxcbiAgQWRtczQwMFRvbmVNb2RlLFxuICBJQWRtczQwMCxcbn0gZnJvbSBcIkBpbnRlcmZhY2VzL2ktYWRtczQwMFwiO1xuaW1wb3J0IGdwc0Rpc3RhbmNlLCB7IFBvaW50IH0gZnJvbSBcImdwcy1kaXN0YW5jZVwiO1xuaW1wb3J0IGNoYWxrIGZyb20gXCJjaGFsa1wiO1xuaW1wb3J0IHtcbiAgYnVpbGRDb21tZW50LFxuICBidWlsZERDUyxcbiAgYnVpbGROYW1lLFxuICBmaWx0ZXJEaXN0YW5jZSxcbiAgZmlsdGVyRnJlcXVlbmNpZXMsXG4gIGZpbHRlck1vZGUsXG4gIEZyZXF1ZW5jeUJhbmQsXG4gIE1vZGVcbn0gZnJvbSBcIkBoZWxwZXJzL3JhZGlvLWhlbHBlcnNcIjtcblxuY29uc3QgbG9nOiAoLi4ubXNnOiBhbnlbXSkgPT4gdm9pZCA9IGNyZWF0ZUxvZyhcIk1ha2UgQWRtczQwMFwiKTtcblxuY29uc3QgaG9tZVBvaW50OiBQb2ludCA9IFszOS42MjcwNzE1MDAsIC0xMDQuODkzMzIyNTAwXTsgLy8gNDk4MiBTIFVsc3RlciBTdFxuY29uc3QgRGVudmVyUG9pbnQ6IFBvaW50ID0gWzM5Ljc0MjA0MywgLTEwNC45OTE1MzFdO1xuY29uc3QgQ29sb3JhZG9TcHJpbmdzUG9pbnQ6IFBvaW50ID0gWzM4Ljg0NjEyNywgLTEwNC44MDA2NDRdO1xuXG5hc3luYyBmdW5jdGlvbiBkb0l0KGluRmlsZU5hbWU6IHN0cmluZywgb3V0RmlsZU5hbWU6IHN0cmluZyk6IFByb21pc2U8dm9pZD4ge1xuICBjb25zdCBzaW1wbGV4OiBJUmVwZWF0ZXJTdHJ1Y3R1cmVkW10gPVxuICAgIEpTT04ucGFyc2UoKGF3YWl0IHJlYWRGaWxlQXN5bmMoXCIuLi9kYXRhL2ZyZXF1ZW5jaWVzLmpzb25cIikpLnRvU3RyaW5nKCkpXG4gICAgICAubWFwKChtYXA6IElTaW1wbGV4RnJlcXVlbmN5KTogSVJlcGVhdGVyU3RydWN0dXJlZCA9PlxuICAgICAgICAoeyBDYWxsc2lnbjogbWFwLk5hbWUsIEZyZXF1ZW5jeTogeyBPdXRwdXQ6IG1hcC5GcmVxdWVuY3ksIElucHV0OiBtYXAuRnJlcXVlbmN5IH0gfSkgYXMgSVJlcGVhdGVyU3RydWN0dXJlZClcbiAgICAgIC5maWx0ZXIoKGZpbHRlcjogSVJlcGVhdGVyU3RydWN0dXJlZCk6IGJvb2xlYW4gPT4gL0ZNfFZvaWNlfFNpbXBsZXgvaS50ZXN0KGZpbHRlci5DYWxsc2lnbikpO1xuICAvLyAuZmlsdGVyKChmaWx0ZXI6IElSZXBlYXRlclN0cnVjdHVyZWQpID0+ICEoL0RhdGF8RGlnaXRhbHxQYWNrZXQvaS50ZXN0KGZpbHRlci5DYWxsc2lnbikpKTtcblxuICBjb25zdCByZXBlYXRlcnM6IElSZXBlYXRlclN0cnVjdHVyZWRbXSA9XG4gICAgSlNPTi5wYXJzZSgoYXdhaXQgcmVhZEZpbGVBc3luYyhpbkZpbGVOYW1lKSkudG9TdHJpbmcoKSk7XG5cbiAgcmVwZWF0ZXJzLmZvckVhY2goKGVhY2g6IElSZXBlYXRlclN0cnVjdHVyZWQpOiB2b2lkID0+IHtcbiAgICBlYWNoLkxvY2F0aW9uLkRpc3RhbmNlID0gTWF0aC5taW4oXG4gICAgICBncHNEaXN0YW5jZShbaG9tZVBvaW50LCBbZWFjaC5Mb2NhdGlvbi5MYXRpdHVkZSwgZWFjaC5Mb2NhdGlvbi5Mb25naXR1ZGVdXSksXG4gICAgICAvLyBncHNEaXN0YW5jZShbRGVudmVyUG9pbnQsIFtlYWNoLkxvY2F0aW9uLkxhdGl0dWRlLCBlYWNoLkxvY2F0aW9uLkxvbmdpdHVkZV1dKSxcbiAgICAgIC8vIGdwc0Rpc3RhbmNlKFtDb2xvcmFkb1NwcmluZ3NQb2ludCwgW2VhY2guTG9jYXRpb24uTGF0aXR1ZGUsIGVhY2guTG9jYXRpb24uTG9uZ2l0dWRlXV0pLFxuICAgICk7XG4gIH0pO1xuXG4gIHJlcGVhdGVycy5zb3J0KChhOiBJUmVwZWF0ZXJTdHJ1Y3R1cmVkLCBiOiBJUmVwZWF0ZXJTdHJ1Y3R1cmVkKTogbnVtYmVyID0+IGEuTG9jYXRpb24uRGlzdGFuY2UhIC0gYi5Mb2NhdGlvbi5EaXN0YW5jZSEpO1xuXG4gIGNvbnN0IG1hcHBlZDogSUFkbXM0MDBbXSA9IFtcbiAgICAuLi5zaW1wbGV4XG4gICAgICAuZmlsdGVyKGZpbHRlckZyZXF1ZW5jaWVzKEZyZXF1ZW5jeUJhbmQuJDJfbSwgRnJlcXVlbmN5QmFuZC4kNzBfY20pKSxcbiAgICAuLi5yZXBlYXRlcnNcbiAgICAgIC5maWx0ZXIoZmlsdGVyRnJlcXVlbmNpZXMoRnJlcXVlbmN5QmFuZC4kMl9tLCBGcmVxdWVuY3lCYW5kLiQ3MF9jbSkpXG4gICAgICAuZmlsdGVyKGZpbHRlckRpc3RhbmNlKDEwMCkpXG4gICAgICAuZmlsdGVyKGZpbHRlck1vZGUoTW9kZS5GTSwgTW9kZS5ZU0YpKSxcbiAgXVxuICAgIC5tYXAoKG1hcDogSVJlcGVhdGVyU3RydWN0dXJlZCwgaW5kZXg6IG51bWJlcik6IElBZG1zNDAwID0+ICh7IC4uLmNvbnZlcnRUb1JhZGlvKG1hcCksIFwiQ2hhbm5lbCBOdW1iZXJcIjogaW5kZXggKyAxIH0pKVxuICAgIC5zbGljZSgwLCA1MDApXG4gICAgLnNvcnQoKGE6IElBZG1zNDAwLCBiOiBJQWRtczQwMCk6IG51bWJlciA9PiBhW1wiUmVjZWl2ZSBGcmVxdWVuY3lcIl0gLSBiW1wiUmVjZWl2ZSBGcmVxdWVuY3lcIl0pXG4gICAgLm1hcCgobWFwOiBJQWRtczQwMCwgaW5kZXg6IG51bWJlcik6IElBZG1zNDAwID0+ICh7IC4uLm1hcCwgXCJDaGFubmVsIE51bWJlclwiOiBpbmRleCArIDEgfSkpO1xuXG4gIHJldHVybiB3cml0ZVRvSnNvbkFuZENzdihvdXRGaWxlTmFtZSwgbWFwcGVkLCBtYXBwZWQpO1xufVxuXG5mdW5jdGlvbiBjb252ZXJ0VG9SYWRpbyhyZXBlYXRlcjogSVJlcGVhdGVyU3RydWN0dXJlZCk6IElBZG1zNDAwIHtcbiAgY29uc3QgTmFtZTogc3RyaW5nID0gYnVpbGROYW1lKHJlcGVhdGVyKTtcblxuICBjb25zdCBSZWNlaXZlOiBudW1iZXIgPSByZXBlYXRlci5GcmVxdWVuY3kuT3V0cHV0O1xuICBjb25zdCBUcmFuc21pdDogbnVtYmVyID0gcmVwZWF0ZXIuRnJlcXVlbmN5LklucHV0O1xuICBjb25zdCBPZmZzZXRGcmVxdWVuY3k6IG51bWJlciA9IHJlcGVhdGVyLkZyZXF1ZW5jeS5JbnB1dCAtIHJlcGVhdGVyLkZyZXF1ZW5jeS5PdXRwdXQ7XG4gIGNvbnN0IFRyYW5zbWl0U3F1ZWxjaFRvbmU6IG51bWJlciB8IHVuZGVmaW5lZCA9IChyZXBlYXRlci5TcXVlbGNoVG9uZSAmJiByZXBlYXRlci5TcXVlbGNoVG9uZS5JbnB1dCk7XG4gIGNvbnN0IFJlY2VpdmVTcXVlbGNoVG9uZTogbnVtYmVyIHwgdW5kZWZpbmVkID0gKHJlcGVhdGVyLlNxdWVsY2hUb25lICYmIHJlcGVhdGVyLlNxdWVsY2hUb25lLk91dHB1dCk7XG4gIGNvbnN0IFRyYW5zbWl0RGlnaXRhbFRvbmU6IG51bWJlciB8IHVuZGVmaW5lZCA9IChyZXBlYXRlci5EaWdpdGFsVG9uZSAmJiByZXBlYXRlci5EaWdpdGFsVG9uZS5JbnB1dCk7XG4gIGNvbnN0IFJlY2VpdmVEaWdpdGFsVG9uZTogbnVtYmVyIHwgdW5kZWZpbmVkID0gKHJlcGVhdGVyLkRpZ2l0YWxUb25lICYmIHJlcGVhdGVyLkRpZ2l0YWxUb25lLk91dHB1dCk7XG4gIGNvbnN0IENvbW1lbnQ6IHN0cmluZyA9IGJ1aWxkQ29tbWVudChyZXBlYXRlcik7XG5cbiAgbGV0IFRvbmVNb2RlOiBBZG1zNDAwVG9uZU1vZGUgPSBBZG1zNDAwVG9uZU1vZGUuTm9uZTtcblxuICBpZiAoVHJhbnNtaXRTcXVlbGNoVG9uZSkge1xuICAgIFRvbmVNb2RlID0gQWRtczQwMFRvbmVNb2RlLlRvbmU7IC8vIFwiVE9ORSBFTkNcIjtcbiAgfSBlbHNlIGlmIChUcmFuc21pdERpZ2l0YWxUb25lKSB7XG4gICAgVG9uZU1vZGUgPSBBZG1zNDAwVG9uZU1vZGUuRENTOyAvLyBcIkRDU1wiO1xuICB9XG5cbiAgaWYgKFRyYW5zbWl0U3F1ZWxjaFRvbmUgJiYgUmVjZWl2ZVNxdWVsY2hUb25lICYmIFRyYW5zbWl0U3F1ZWxjaFRvbmUgPT09IFJlY2VpdmVTcXVlbGNoVG9uZSkge1xuICAgIFRvbmVNb2RlID0gQWRtczQwMFRvbmVNb2RlLlRfU3FsOyAvLyBcIlRPTkUgU1FMXCI7XG4gIH0gZWxzZSBpZiAoVHJhbnNtaXREaWdpdGFsVG9uZSAmJiBSZWNlaXZlRGlnaXRhbFRvbmUgJiYgVHJhbnNtaXREaWdpdGFsVG9uZSA9PT0gUmVjZWl2ZURpZ2l0YWxUb25lKSB7XG4gICAgLy8gVG9uZU1vZGUgPSBBZG1zNDAwVG9uZU1vZGUuVF9EQ1M7IC8vIFwiRENTXCI7XG4gIH1cblxuICBjb25zdCBDVENTUzogQWRtczQwMEN0Y3NzVG9uZSA9ICgoVHJhbnNtaXRTcXVlbGNoVG9uZSB8fCAxMDApLnRvRml4ZWQoMSkgKyBcIiBIelwiKSBhcyBBZG1zNDAwQ3Rjc3NUb25lO1xuICBjb25zdCBEQ1M6IEFkbXM0MDBEY3NUb25lID0gYnVpbGREQ1MoVHJhbnNtaXREaWdpdGFsVG9uZSkgYXMgQWRtczQwMERjc1RvbmU7XG5cbiAgcmV0dXJuIG5ldyBBZG1zNDAwKHtcbiAgICAvLyBcIkNoYW5uZWwgTnVtYmVyXCI6IG51bWJlcjtcbiAgICBcIlJlY2VpdmUgRnJlcXVlbmN5XCI6IFJlY2VpdmUudG9GaXhlZCg1KSBhcyBhbnksXG4gICAgXCJUcmFuc21pdCBGcmVxdWVuY3lcIjogVHJhbnNtaXQudG9GaXhlZCg1KSBhcyBhbnksXG4gICAgXCJPZmZzZXQgRnJlcXVlbmN5XCI6IGNvbnZlcnRPZmZzZXRGcmVxdWVuY3koT2Zmc2V0RnJlcXVlbmN5KSxcbiAgICBcIk9mZnNldCBEaXJlY3Rpb25cIjogY29udmVydE9mZnNldERpcmVjdGlvbihPZmZzZXRGcmVxdWVuY3kpLFxuICAgIC8vIFwiT3BlcmF0aW5nIE1vZGVcIjogQWRtczQwME9wZXJhdGluZ01vZGUsXG4gICAgTmFtZSxcbiAgICAvLyBcIlNob3cgTmFtZVwiOiBBZG1zNDAwU2hvd05hbWUsXG4gICAgXCJUb25lIE1vZGVcIjogVG9uZU1vZGUsXG4gICAgQ1RDU1MsXG4gICAgRENTLFxuICAgIC8vIFwiVHggUG93ZXJcIjogQWRtczQwMFR4UG93ZXIsXG4gICAgLy8gU2tpcDogQWRtczQwMFNraXAsXG4gICAgLy8gU3RlcDogQWRtczQwMFN0ZXAsXG4gICAgLy8gXCJDbG9jayBTaGlmdFwiOiBBZG1zNDAwQ2xvY2tTaGlmdCxcbiAgICBDb21tZW50LFxuICAgIC8vIFwiVXNlciBDVENTU1wiOiBBZG1zNDAwVXNlckN0Y3NzLFxuICB9KTtcbn1cblxuZnVuY3Rpb24gY29udmVydE9mZnNldEZyZXF1ZW5jeShPZmZzZXRGcmVxdWVuY3k6IG51bWJlcik6IEFkbXM0MDBPZmZzZXRGcmVxdWVuY3kge1xuICBzd2l0Y2ggKE1hdGguYWJzKE1hdGgucm91bmQoT2Zmc2V0RnJlcXVlbmN5ICogMTApKSAvIDEwKSB7XG4gICAgY2FzZSAwOlxuICAgICAgcmV0dXJuIEFkbXM0MDBPZmZzZXRGcmVxdWVuY3kuTm9uZTtcbiAgICBjYXNlIDAuMTpcbiAgICAgIHJldHVybiBBZG1zNDAwT2Zmc2V0RnJlcXVlbmN5LiQxMDBfa0h6O1xuICAgIGNhc2UgMC41OlxuICAgICAgcmV0dXJuIEFkbXM0MDBPZmZzZXRGcmVxdWVuY3kuJDUwMF9rSHo7XG4gICAgY2FzZSAwLjY6XG4gICAgICByZXR1cm4gQWRtczQwME9mZnNldEZyZXF1ZW5jeS4kNjAwX2tIejtcbiAgICBjYXNlIDE6XG4gICAgICByZXR1cm4gQWRtczQwME9mZnNldEZyZXF1ZW5jeS4kMV8wMF9NSHo7XG4gICAgY2FzZSAxLjY6XG4gICAgICByZXR1cm4gQWRtczQwME9mZnNldEZyZXF1ZW5jeS4kMV82MF9NSHo7XG4gICAgY2FzZSAzOlxuICAgICAgcmV0dXJuIEFkbXM0MDBPZmZzZXRGcmVxdWVuY3kuJDNfMDBfTUh6O1xuICAgIGNhc2UgNTpcbiAgICAgIHJldHVybiBBZG1zNDAwT2Zmc2V0RnJlcXVlbmN5LiQ1XzAwX01IejtcbiAgICBjYXNlIDcuNjpcbiAgICAgIHJldHVybiBBZG1zNDAwT2Zmc2V0RnJlcXVlbmN5LiQ3XzYwX01IejtcbiAgfVxuICBsb2coY2hhbGsucmVkKFwiRVJST1JcIiksIFwiY29udmVydE9mZnNldEZyZXF1ZW5jeVwiLCBcInVua25vd25cIiwgT2Zmc2V0RnJlcXVlbmN5KTtcbiAgcmV0dXJuIEFkbXM0MDBPZmZzZXRGcmVxdWVuY3kuTm9uZTtcbn1cblxuZnVuY3Rpb24gY29udmVydE9mZnNldERpcmVjdGlvbihPZmZzZXRGcmVxdWVuY3k6IG51bWJlcik6IEFkbXM0MDBPZmZzZXREaXJlY3Rpb24ge1xuICBpZiAoT2Zmc2V0RnJlcXVlbmN5ID09PSAwKSB7XG4gICAgcmV0dXJuIEFkbXM0MDBPZmZzZXREaXJlY3Rpb24uU2ltcGxleDtcbiAgfSBlbHNlIGlmIChPZmZzZXRGcmVxdWVuY3kgPCAwKSB7XG4gICAgcmV0dXJuIEFkbXM0MDBPZmZzZXREaXJlY3Rpb24uTWludXM7XG4gIH0gZWxzZSBpZiAoT2Zmc2V0RnJlcXVlbmN5ID4gMCkge1xuICAgIHJldHVybiBBZG1zNDAwT2Zmc2V0RGlyZWN0aW9uLlBsdXM7XG4gIH1cbiAgbG9nKGNoYWxrLnJlZChcIkVSUk9SXCIpLCBcImNvbnZlcnRPZmZzZXREaXJlY3Rpb25cIiwgXCJ1bmtub3duXCIsIE9mZnNldEZyZXF1ZW5jeSk7XG4gIHJldHVybiBBZG1zNDAwT2Zmc2V0RGlyZWN0aW9uLlNpbXBsZXg7XG59XG5cbmV4cG9ydCA9IGRvSXQoXCIuLi9kYXRhL3JlcGVhdGVycy9jb252ZXJ0ZWQvQ08uanNvblwiLCBcIi4uL2RhdGEvcmVwZWF0ZXJzL2FkbXM0MDAvQ09cIik7XG4iXX0=