"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
require("module-alias/register");
const fs_helpers_1 = require("@helpers/fs-helpers");
const log_helpers_1 = require("@helpers/log-helpers");
const i_adms400_1 = require("@interfaces/i-adms400");
const gps_distance_1 = __importDefault(require("gps-distance"));
const chalk_1 = __importDefault(require("chalk"));
const radio_helpers_1 = require("@helpers/radio-helpers");
const log = log_helpers_1.createLog("Make Adms400");
const homePoint = [39.627071500, -104.893322500]; // 4982 S Ulster St
const DenverPoint = [39.742043, -104.991531];
const ColoradoSpringsPoint = [38.846127, -104.800644];
async function doIt(inFileName, outFileName) {
    const simplex = JSON.parse((await fs_helpers_1.readFileAsync("../data/frequencies.json")).toString())
        .map((map) => ({ Callsign: map.Name, Frequency: { Output: map.Frequency, Input: map.Frequency } }))
        .filter((filter) => /FM|Voice|Simplex/i.test(filter.Callsign));
    // .filter((filter: IRepeaterStructured) => !(/Data|Digital|Packet/i.test(filter.Callsign)));
    const repeaters = JSON.parse((await fs_helpers_1.readFileAsync(inFileName)).toString());
    repeaters.forEach((each) => {
        each.Location.Distance = Math.min(gps_distance_1.default([homePoint, [each.Location.Latitude, each.Location.Longitude]]));
    });
    repeaters.sort((a, b) => a.Location.Distance - b.Location.Distance);
    const mapped = [
        ...simplex
            .filter(radio_helpers_1.filterFrequencies(radio_helpers_1.FrequencyBand.$2_m, radio_helpers_1.FrequencyBand.$70_cm)),
        ...repeaters
            .filter(radio_helpers_1.filterFrequencies(radio_helpers_1.FrequencyBand.$2_m, radio_helpers_1.FrequencyBand.$70_cm))
            .filter(radio_helpers_1.filterDistance(100))
            .filter(radio_helpers_1.filterMode(radio_helpers_1.Mode.FM, radio_helpers_1.Mode.YSF)),
    ]
        .map((map, index) => ({ ...convertToRadio(map), "Channel Number": index + 1 }))
        .slice(0, 500)
        .sort((a, b) => a["Receive Frequency"] - b["Receive Frequency"])
        .map((map, index) => ({ ...map, "Channel Number": index + 1 }));
    return fs_helpers_1.writeToJsonAndCsv(outFileName, mapped, mapped);
}
function convertToRadio(repeater) {
    const Name = radio_helpers_1.buildName(repeater);
    const Receive = repeater.Frequency.Output;
    const Transmit = repeater.Frequency.Input;
    const OffsetFrequency = repeater.Frequency.Input - repeater.Frequency.Output;
    const TransmitSquelchTone = (repeater.SquelchTone && repeater.SquelchTone.Input);
    const ReceiveSquelchTone = (repeater.SquelchTone && repeater.SquelchTone.Output);
    const TransmitDigitalTone = (repeater.DigitalTone && repeater.DigitalTone.Input);
    const ReceiveDigitalTone = (repeater.DigitalTone && repeater.DigitalTone.Output);
    const Comment = radio_helpers_1.buildComment(repeater);
    let ToneMode = i_adms400_1.Adms400ToneMode.None;
    if (TransmitSquelchTone) {
        ToneMode = i_adms400_1.Adms400ToneMode.Tone; // "TONE ENC";
    }
    else if (TransmitDigitalTone) {
        ToneMode = i_adms400_1.Adms400ToneMode.DCS; // "DCS";
    }
    if (TransmitSquelchTone && ReceiveSquelchTone && TransmitSquelchTone === ReceiveSquelchTone) {
        ToneMode = i_adms400_1.Adms400ToneMode.T_Sql; // "TONE SQL";
    }
    else if (TransmitDigitalTone && ReceiveDigitalTone && TransmitDigitalTone === ReceiveDigitalTone) {
        // ToneMode = Adms400ToneMode.T_DCS; // "DCS";
    }
    const CTCSS = ((TransmitSquelchTone || 100).toFixed(1) + " Hz");
    const DCS = radio_helpers_1.buildDCS(TransmitDigitalTone);
    return new i_adms400_1.Adms400({
        // "Channel Number": number;
        "Receive Frequency": Receive.toFixed(5),
        "Transmit Frequency": Transmit.toFixed(5),
        "Offset Frequency": convertOffsetFrequency(OffsetFrequency),
        "Offset Direction": convertOffsetDirection(OffsetFrequency),
        // "Operating Mode": Adms400OperatingMode,
        Name,
        // "Show Name": Adms400ShowName,
        "Tone Mode": ToneMode,
        CTCSS,
        DCS,
        // "Tx Power": Adms400TxPower,
        // Skip: Adms400Skip,
        // Step: Adms400Step,
        // "Clock Shift": Adms400ClockShift,
        Comment,
    });
}
function convertOffsetFrequency(OffsetFrequency) {
    switch (Math.abs(Math.round(OffsetFrequency * 10)) / 10) {
        case 0:
            return i_adms400_1.Adms400OffsetFrequency.None;
        case 0.1:
            return i_adms400_1.Adms400OffsetFrequency.$100_kHz;
        case 0.5:
            return i_adms400_1.Adms400OffsetFrequency.$500_kHz;
        case 0.6:
            return i_adms400_1.Adms400OffsetFrequency.$600_kHz;
        case 1:
            return i_adms400_1.Adms400OffsetFrequency.$1_00_MHz;
        case 1.6:
            return i_adms400_1.Adms400OffsetFrequency.$1_60_MHz;
        case 3:
            return i_adms400_1.Adms400OffsetFrequency.$3_00_MHz;
        case 5:
            return i_adms400_1.Adms400OffsetFrequency.$5_00_MHz;
        case 7.6:
            return i_adms400_1.Adms400OffsetFrequency.$7_60_MHz;
    }
    log(chalk_1.default.red("ERROR"), "convertOffsetFrequency", "unknown", OffsetFrequency);
    return i_adms400_1.Adms400OffsetFrequency.None;
}
function convertOffsetDirection(OffsetFrequency) {
    if (OffsetFrequency === 0) {
        return i_adms400_1.Adms400OffsetDirection.Simplex;
    }
    else if (OffsetFrequency < 0) {
        return i_adms400_1.Adms400OffsetDirection.Minus;
    }
    else if (OffsetFrequency > 0) {
        return i_adms400_1.Adms400OffsetDirection.Plus;
    }
    log(chalk_1.default.red("ERROR"), "convertOffsetDirection", "unknown", OffsetFrequency);
    return i_adms400_1.Adms400OffsetDirection.Simplex;
}
module.exports = doIt("../data/repeaters/converted/CO.json", "../data/repeaters/adms400/CO");
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWFrZS1hZG1zNDAwLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vc3JjL21ha2UtYWRtczQwMC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQUEsaUNBQStCO0FBRS9CLG9EQUF1RTtBQUN2RSxzREFBaUQ7QUFHakQscURBUStCO0FBQy9CLGdFQUFrRDtBQUNsRCxrREFBMEI7QUFDMUIsMERBU2dDO0FBRWhDLE1BQU0sR0FBRyxHQUE0Qix1QkFBUyxDQUFDLGNBQWMsQ0FBQyxDQUFDO0FBRS9ELE1BQU0sU0FBUyxHQUFVLENBQUMsWUFBWSxFQUFFLENBQUMsYUFBYSxDQUFDLENBQUMsQ0FBQyxtQkFBbUI7QUFDNUUsTUFBTSxXQUFXLEdBQVUsQ0FBQyxTQUFTLEVBQUUsQ0FBQyxVQUFVLENBQUMsQ0FBQztBQUNwRCxNQUFNLG9CQUFvQixHQUFVLENBQUMsU0FBUyxFQUFFLENBQUMsVUFBVSxDQUFDLENBQUM7QUFFN0QsS0FBSyxVQUFVLElBQUksQ0FBQyxVQUFrQixFQUFFLFdBQW1CO0lBQ3pELE1BQU0sT0FBTyxHQUNYLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQyxNQUFNLDBCQUFhLENBQUMsMEJBQTBCLENBQUMsQ0FBQyxDQUFDLFFBQVEsRUFBRSxDQUFDO1NBQ3JFLEdBQUcsQ0FBQyxDQUFDLEdBQXNCLEVBQXVCLEVBQUUsQ0FDbkQsQ0FBQyxFQUFFLFFBQVEsRUFBRSxHQUFHLENBQUMsSUFBSSxFQUFFLFNBQVMsRUFBRSxFQUFFLE1BQU0sRUFBRSxHQUFHLENBQUMsU0FBUyxFQUFFLEtBQUssRUFBRSxHQUFHLENBQUMsU0FBUyxFQUFFLEVBQUUsQ0FBd0IsQ0FBQztTQUM3RyxNQUFNLENBQUMsQ0FBQyxNQUEyQixFQUFXLEVBQUUsQ0FBQyxtQkFBbUIsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUM7SUFDakcsNkZBQTZGO0lBRTdGLE1BQU0sU0FBUyxHQUNiLElBQUksQ0FBQyxLQUFLLENB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LENBQUMsS0FBSyxDQUFDO0tBQ3JDO1NBQU0sSUFBSSxlQUFlLEdBQUcsQ0FBQyxFQUFFO1FBQzlCLE9BQU8sa0NBQXNCLENBQUMsSUFBSSxDQUFDO0tBQ3BDO0lBQ0QsR0FBRyxDQUFDLGVBQUssQ0FBQyxHQUFHLENBQUMsT0FBTyxDQUFDLEVBQUUsd0JBQXdCLEVBQUUsU0FBUyxFQUFFLGVBQWUsQ0FBQyxDQUFDO0lBQzlFLE9BQU8sa0NBQXNCLENBQUMsT0FBTyxDQUFDO0FBQ3hDLENBQUM7QUFFRCxpQkFBUyxJQUFJLENBQUMscUNBQXFDLEVBQUUsOEJBQThCLENBQUMsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBcIm1vZHVsZS1hbGlhcy9yZWdpc3RlclwiO1xyXG5cclxuaW1wb3J0IHsgcmVhZEZpbGVBc3luYywgd3JpdGVUb0pzb25BbmRDc3YgfSBmcm9tIFwiQGhlbHBlcnMvZnMtaGVscGVyc1wiO1xyXG5pbXBvcnQgeyBjcmVhdGVMb2cgfSBmcm9tIFwiQGhlbHBlcnMvbG9nLWhlbHBlcnNcIjtcclxuaW1wb3J0IHsgSVJlcGVhdGVyU3RydWN0dXJlZCB9IGZyb20gXCJAaW50ZXJmYWNlcy9pLXJlcGVhdGVyLXN0cnVjdHVyZWRcIjtcclxuaW1wb3J0IHsgSVNpbXBsZXhGcmVxdWVuY3kgfSBmcm9tIFwiQGludGVyZmFjZXMvaS1zaW1wbGV4LWZyZXF1ZW5jeVwiO1xyXG5pbXBvcnQge1xyXG4gIEFkbXM0MDAsXHJcbiAgQWRtczQwMEN0Y3NzVG9uZSxcclxuICBBZG1zNDAwRGNzVG9uZSxcclxuICBBZG1zNDAwT2Zmc2V0RGlyZWN0aW9uLFxyXG4gIEFkbXM0MDBPZmZzZXRGcmVxdWVuY3ksXHJcbiAgQWRtczQwMFRvbmVNb2RlLFxyXG4gIElBZG1zNDAwLFxyXG59IGZyb20gXCJAaW50ZXJmYWNlcy9pLWFkbXM0MDBcIjtcclxuaW1wb3J0IGdwc0Rpc3RhbmNlLCB7IFBvaW50IH0gZnJvbSBcImdwcy1kaXN0YW5jZVwiO1xyXG5pbXBvcnQgY2hhbGsgZnJvbSBcImNoYWxrXCI7XHJcbmltcG9ydCB7XHJcbiAgYnVpbGRDb21tZW50LFxyXG4gIGJ1aWxkRENTLFxyXG4gIGJ1aWxkTmFtZSxcclxuICBmaWx0ZXJEaXN0YW5jZSxcclxuICBmaWx0ZXJGcmVxdWVuY2llcyxcclxuICBmaWx0ZXJNb2RlLFxyXG4gIEZyZXF1ZW5jeUJhbmQsXHJcbiAgTW9kZVxyXG59IGZyb20gXCJAaGVscGVycy9yYWRpby1oZWxwZXJzXCI7XHJcblxyXG5jb25zdCBsb2c6ICguLi5tc2c6IGFueVtdKSA9PiB2b2lkID0gY3JlYXRlTG9nKFwiTWFrZSBBZG1zNDAwXCIpO1xyXG5cclxuY29uc3QgaG9tZVBvaW50OiBQb2ludCA9IFszOS42MjcwNzE1MDAsIC0xMDQuODkzMzIyNTAwXTsgLy8gNDk4MiBTIFVsc3RlciBTdFxyXG5jb25zdCBEZW52ZXJQb2ludDogUG9pbnQgPSBbMzkuNzQyMDQzLCAtMTA0Ljk5MTUzMV07XHJcbmNvbnN0IENvbG9yYWRvU3ByaW5nc1BvaW50OiBQb2ludCA9IFszOC44NDYxMjcsIC0xMDQuODAwNjQ0XTtcclxuXHJcbmFzeW5jIGZ1bmN0aW9uIGRvSXQoaW5GaWxlTmFtZTogc3RyaW5nLCBvdXRGaWxlTmFtZTogc3RyaW5nKTogUHJvbWlzZTx2b2lkPiB7XHJcbiAgY29uc3Qgc2ltcGxleDogSVJlcGVhdGVyU3RydWN0dXJlZFtdID1cclxuICAgIEpTT04ucGFyc2UoKGF3YWl0IHJlYWRGaWxlQXN5bmMoXCIuLi9kYXRhL2ZyZXF1ZW5jaWVzLmpzb25cIikpLnRvU3RyaW5nKCkpXHJcbiAgICAgIC5tYXAoKG1hcDogSVNpbXBsZXhGcmVxdWVuY3kpOiBJUmVwZWF0ZXJTdHJ1Y3R1cmVkID0+XHJcbiAgICAgICAgKHsgQ2FsbHNpZ246IG1hcC5OYW1lLCBGcmVxdWVuY3k6IHsgT3V0cHV0OiBtYXAuRnJlcXVlbmN5LCBJbnB1dDogbWFwLkZyZXF1ZW5jeSB9IH0pIGFzIElSZXBlYXRlclN0cnVjdHVyZWQpXHJcbiAgICAgIC5maWx0ZXIoKGZpbHRlcjogSVJlcGVhdGVyU3RydWN0dXJlZCk6IGJvb2xlYW4gPT4gL0ZNfFZvaWNlfFNpbXBsZXgvaS50ZXN0KGZpbHRlci5DYWxsc2lnbikpO1xyXG4gIC8vIC5maWx0ZXIoKGZpbHRlcjogSVJlcGVhdGVyU3RydWN0dXJlZCkgPT4gISgvRGF0YXxEaWdpdGFsfFBhY2tldC9pLnRlc3QoZmlsdGVyLkNhbGxzaWduKSkpO1xyXG5cclxuICBjb25zdCByZXBlYXRlcnM6IElSZXBlYXRlclN0cnVjdHVyZWRbXSA9XHJcbiAgICBKU09OLnBhcnNlKChhd2FpdCByZWFkRmlsZUFzeW5jKGluRmlsZU5hbWUpKS50b1N0cmluZygpKTtcclxuXHJcbiAgcmVwZWF0ZXJzLmZvckVhY2goKGVhY2g6IElSZXBlYXRlclN0cnVjdHVyZWQpOiB2b2lkID0+IHtcclxuICAgIGVhY2guTG9jYXRpb24uRGlzdGFuY2UgPSBNYXRoLm1pbihcclxuICAgICAgZ3BzRGlzdGFuY2UoW2hvbWVQb2ludCwgW2VhY2guTG9jYXRpb24uTGF0aXR1ZGUsIGVhY2guTG9jYXRpb24uTG9uZ2l0dWRlXV0pLFxyXG4gICAgICAvLyBncHNEaXN0YW5jZShbRGVudmVyUG9pbnQsIFtlYWNoLkxvY2F0aW9uLkxhdGl0dWRlLCBlYWNoLkxvY2F0aW9uLkxvbmdpdHVkZV1dKSxcclxuICAgICAgLy8gZ3BzRGlzdGFuY2UoW0NvbG9yYWRvU3ByaW5nc1BvaW50LCBbZWFjaC5Mb2NhdGlvbi5MYXRpdHVkZSwgZWFjaC5Mb2NhdGlvbi5Mb25naXR1ZGVdXSksXHJcbiAgICApO1xyXG4gIH0pO1xyXG5cclxuICByZXBlYXRlcnMuc29ydCgoYTogSVJlcGVhdGVyU3RydWN0dXJlZCwgYjogSVJlcGVhdGVyU3RydWN0dXJlZCk6IG51bWJlciA9PiBhLkxvY2F0aW9uLkRpc3RhbmNlISAtIGIuTG9jYXRpb24uRGlzdGFuY2UhKTtcclxuXHJcbiAgY29uc3QgbWFwcGVkOiBJQWRtczQwMFtdID0gW1xyXG4gICAgLi4uc2ltcGxleFxyXG4gICAgICAuZmlsdGVyKGZpbHRlckZyZXF1ZW5jaWVzKEZyZXF1ZW5jeUJhbmQuJDJfbSwgRnJlcXVlbmN5QmFuZC4kNzBfY20pKSxcclxuICAgIC4uLnJlcGVhdGVyc1xyXG4gICAgICAuZmlsdGVyKGZpbHRlckZyZXF1ZW5jaWVzKEZyZXF1ZW5jeUJhbmQuJDJfbSwgRnJlcXVlbmN5QmFuZC4kNzBfY20pKVxyXG4gICAgICAuZmlsdGVyKGZpbHRlckRpc3RhbmNlKDEwMCkpXHJcbiAgICAgIC5maWx0ZXIoZmlsdGVyTW9kZShNb2RlLkZNLCBNb2RlLllTRikpLFxyXG4gIF1cclxuICAgIC5tYXAoKG1hcDogSVJlcGVhdGVyU3RydWN0dXJlZCwgaW5kZXg6IG51bWJlcik6IElBZG1zNDAwID0+ICh7IC4uLmNvbnZlcnRUb1JhZGlvKG1hcCksIFwiQ2hhbm5lbCBOdW1iZXJcIjogaW5kZXggKyAxIH0pKVxyXG4gICAgLnNsaWNlKDAsIDUwMClcclxuICAgIC5zb3J0KChhOiBJQWRtczQwMCwgYjogSUFkbXM0MDApOiBudW1iZXIgPT4gYVtcIlJlY2VpdmUgRnJlcXVlbmN5XCJdIC0gYltcIlJlY2VpdmUgRnJlcXVlbmN5XCJdKVxyXG4gICAgLm1hcCgobWFwOiBJQWRtczQwMCwgaW5kZXg6IG51bWJlcik6IElBZG1zNDAwID0+ICh7IC4uLm1hcCwgXCJDaGFubmVsIE51bWJlclwiOiBpbmRleCArIDEgfSkpO1xyXG5cclxuICByZXR1cm4gd3JpdGVUb0pzb25BbmRDc3Yob3V0RmlsZU5hbWUsIG1hcHBlZCwgbWFwcGVkKTtcclxufVxyXG5cclxuZnVuY3Rpb24gY29udmVydFRvUmFkaW8ocmVwZWF0ZXI6IElSZXBlYXRlclN0cnVjdHVyZWQpOiBJQWRtczQwMCB7XHJcbiAgY29uc3QgTmFtZTogc3RyaW5nID0gYnVpbGROYW1lKHJlcGVhdGVyKTtcclxuXHJcbiAgY29uc3QgUmVjZWl2ZTogbnVtYmVyID0gcmVwZWF0ZXIuRnJlcXVlbmN5Lk91dHB1dDtcclxuICBjb25zdCBUcmFuc21pdDogbnVtYmVyID0gcmVwZWF0ZXIuRnJlcXVlbmN5LklucHV0O1xyXG4gIGNvbnN0IE9mZnNldEZyZXF1ZW5jeTogbnVtYmVyID0gcmVwZWF0ZXIuRnJlcXVlbmN5LklucHV0IC0gcmVwZWF0ZXIuRnJlcXVlbmN5Lk91dHB1dDtcclxuICBjb25zdCBUcmFuc21pdFNxdWVsY2hUb25lOiBudW1iZXIgfCB1bmRlZmluZWQgPSAocmVwZWF0ZXIuU3F1ZWxjaFRvbmUgJiYgcmVwZWF0ZXIuU3F1ZWxjaFRvbmUuSW5wdXQpO1xyXG4gIGNvbnN0IFJlY2VpdmVTcXVlbGNoVG9uZTogbnVtYmVyIHwgdW5kZWZpbmVkID0gKHJlcGVhdGVyLlNxdWVsY2hUb25lICYmIHJlcGVhdGVyLlNxdWVsY2hUb25lLk91dHB1dCk7XHJcbiAgY29uc3QgVHJhbnNtaXREaWdpdGFsVG9uZTogbnVtYmVyIHwgdW5kZWZpbmVkID0gKHJlcGVhdGVyLkRpZ2l0YWxUb25lICYmIHJlcGVhdGVyLkRpZ2l0YWxUb25lLklucHV0KTtcclxuICBjb25zdCBSZWNlaXZlRGlnaXRhbFRvbmU6IG51bWJlciB8IHVuZGVmaW5lZCA9IChyZXBlYXRlci5EaWdpdGFsVG9uZSAmJiByZXBlYXRlci5EaWdpdGFsVG9uZS5PdXRwdXQpO1xyXG4gIGNvbnN0IENvbW1lbnQ6IHN0cmluZyA9IGJ1aWxkQ29tbWVudChyZXBlYXRlcik7XHJcblxyXG4gIGxldCBUb25lTW9kZTogQWRtczQwMFRvbmVNb2RlID0gQWRtczQwMFRvbmVNb2RlLk5vbmU7XHJcblxyXG4gIGlmIChUcmFuc21pdFNxdWVsY2hUb25lKSB7XHJcbiAgICBUb25lTW9kZSA9IEFkbXM0MDBUb25lTW9kZS5Ub25lOyAvLyBcIlRPTkUgRU5DXCI7XHJcbiAgfSBlbHNlIGlmIChUcmFuc21pdERpZ2l0YWxUb25lKSB7XHJcbiAgICBUb25lTW9kZSA9IEFkbXM0MDBUb25lTW9kZS5EQ1M7IC8vIFwiRENTXCI7XHJcbiAgfVxyXG5cclxuICBpZiAoVHJhbnNtaXRTcXVlbGNoVG9uZSAmJiBSZWNlaXZlU3F1ZWxjaFRvbmUgJiYgVHJhbnNtaXRTcXVlbGNoVG9uZSA9PT0gUmVjZWl2ZVNxdWVsY2hUb25lKSB7XHJcbiAgICBUb25lTW9kZSA9IEFkbXM0MDBUb25lTW9kZS5UX1NxbDsgLy8gXCJUT05FIFNRTFwiO1xyXG4gIH0gZWxzZSBpZiAoVHJhbnNtaXREaWdpdGFsVG9uZSAmJiBSZWNlaXZlRGlnaXRhbFRvbmUgJiYgVHJhbnNtaXREaWdpdGFsVG9uZSA9PT0gUmVjZWl2ZURpZ2l0YWxUb25lKSB7XHJcbiAgICAvLyBUb25lTW9kZSA9IEFkbXM0MDBUb25lTW9kZS5UX0RDUzsgLy8gXCJEQ1NcIjtcclxuICB9XHJcblxyXG4gIGNvbnN0IENUQ1NTOiBBZG1zNDAwQ3Rjc3NUb25lID0gKChUcmFuc21pdFNxdWVsY2hUb25lIHx8IDEwMCkudG9GaXhlZCgxKSArIFwiIEh6XCIpIGFzIEFkbXM0MDBDdGNzc1RvbmU7XHJcbiAgY29uc3QgRENTOiBBZG1zNDAwRGNzVG9uZSA9IGJ1aWxkRENTKFRyYW5zbWl0RGlnaXRhbFRvbmUpIGFzIEFkbXM0MDBEY3NUb25lO1xyXG5cclxuICByZXR1cm4gbmV3IEFkbXM0MDAoe1xyXG4gICAgLy8gXCJDaGFubmVsIE51bWJlclwiOiBudW1iZXI7XHJcbiAgICBcIlJlY2VpdmUgRnJlcXVlbmN5XCI6IFJlY2VpdmUudG9GaXhlZCg1KSBhcyBhbnksXHJcbiAgICBcIlRyYW5zbWl0IEZyZXF1ZW5jeVwiOiBUcmFuc21pdC50b0ZpeGVkKDUpIGFzIGFueSxcclxuICAgIFwiT2Zmc2V0IEZyZXF1ZW5jeVwiOiBjb252ZXJ0T2Zmc2V0RnJlcXVlbmN5KE9mZnNldEZyZXF1ZW5jeSksXHJcbiAgICBcIk9mZnNldCBEaXJlY3Rpb25cIjogY29udmVydE9mZnNldERpcmVjdGlvbihPZmZzZXRGcmVxdWVuY3kpLFxyXG4gICAgLy8gXCJPcGVyYXRpbmcgTW9kZVwiOiBBZG1zNDAwT3BlcmF0aW5nTW9kZSxcclxuICAgIE5hbWUsXHJcbiAgICAvLyBcIlNob3cgTmFtZVwiOiBBZG1zNDAwU2hvd05hbWUsXHJcbiAgICBcIlRvbmUgTW9kZVwiOiBUb25lTW9kZSxcclxuICAgIENUQ1NTLFxyXG4gICAgRENTLFxyXG4gICAgLy8gXCJUeCBQb3dlclwiOiBBZG1zNDAwVHhQb3dlcixcclxuICAgIC8vIFNraXA6IEFkbXM0MDBTa2lwLFxyXG4gICAgLy8gU3RlcDogQWRtczQwMFN0ZXAsXHJcbiAgICAvLyBcIkNsb2NrIFNoaWZ0XCI6IEFkbXM0MDBDbG9ja1NoaWZ0LFxyXG4gICAgQ29tbWVudCxcclxuICAgIC8vIFwiVXNlciBDVENTU1wiOiBBZG1zNDAwVXNlckN0Y3NzLFxyXG4gIH0pO1xyXG59XHJcblxyXG5mdW5jdGlvbiBjb252ZXJ0T2Zmc2V0RnJlcXVlbmN5KE9mZnNldEZyZXF1ZW5jeTogbnVtYmVyKTogQWRtczQwME9mZnNldEZyZXF1ZW5jeSB7XHJcbiAgc3dpdGNoIChNYXRoLmFicyhNYXRoLnJvdW5kKE9mZnNldEZyZXF1ZW5jeSAqIDEwKSkgLyAxMCkge1xyXG4gICAgY2FzZSAwOlxyXG4gICAgICByZXR1cm4gQWRtczQwME9mZnNldEZyZXF1ZW5jeS5Ob25lO1xyXG4gICAgY2FzZSAwLjE6XHJcbiAgICAgIHJldHVybiBBZG1zNDAwT2Zmc2V0RnJlcXVlbmN5LiQxMDBfa0h6O1xyXG4gICAgY2FzZSAwLjU6XHJcbiAgICAgIHJldHVybiBBZG1zNDAwT2Zmc2V0RnJlcXVlbmN5LiQ1MDBfa0h6O1xyXG4gICAgY2FzZSAwLjY6XHJcbiAgICAgIHJldHVybiBBZG1zNDAwT2Zmc2V0RnJlcXVlbmN5LiQ2MDBfa0h6O1xyXG4gICAgY2FzZSAxOlxyXG4gICAgICByZXR1cm4gQWRtczQwME9mZnNldEZyZXF1ZW5jeS4kMV8wMF9NSHo7XHJcbiAgICBjYXNlIDEuNjpcclxuICAgICAgcmV0dXJuIEFkbXM0MDBPZmZzZXRGcmVxdWVuY3kuJDFfNjBfTUh6O1xyXG4gICAgY2FzZSAzOlxyXG4gICAgICByZXR1cm4gQWRtczQwME9mZnNldEZyZXF1ZW5jeS4kM18wMF9NSHo7XHJcbiAgICBjYXNlIDU6XHJcbiAgICAgIHJldHVybiBBZG1zNDAwT2Zmc2V0RnJlcXVlbmN5LiQ1XzAwX01IejtcclxuICAgIGNhc2UgNy42OlxyXG4gICAgICByZXR1cm4gQWRtczQwME9mZnNldEZyZXF1ZW5jeS4kN182MF9NSHo7XHJcbiAgfVxyXG4gIGxvZyhjaGFsay5yZWQoXCJFUlJPUlwiKSwgXCJjb252ZXJ0T2Zmc2V0RnJlcXVlbmN5XCIsIFwidW5rbm93blwiLCBPZmZzZXRGcmVxdWVuY3kpO1xyXG4gIHJldHVybiBBZG1zNDAwT2Zmc2V0RnJlcXVlbmN5Lk5vbmU7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGNvbnZlcnRPZmZzZXREaXJlY3Rpb24oT2Zmc2V0RnJlcXVlbmN5OiBudW1iZXIpOiBBZG1zNDAwT2Zmc2V0RGlyZWN0aW9uIHtcclxuICBpZiAoT2Zmc2V0RnJlcXVlbmN5ID09PSAwKSB7XHJcbiAgICByZXR1cm4gQWRtczQwME9mZnNldERpcmVjdGlvbi5TaW1wbGV4O1xyXG4gIH0gZWxzZSBpZiAoT2Zmc2V0RnJlcXVlbmN5IDwgMCkge1xyXG4gICAgcmV0dXJuIEFkbXM0MDBPZmZzZXREaXJlY3Rpb24uTWludXM7XHJcbiAgfSBlbHNlIGlmIChPZmZzZXRGcmVxdWVuY3kgPiAwKSB7XHJcbiAgICByZXR1cm4gQWRtczQwME9mZnNldERpcmVjdGlvbi5QbHVzO1xyXG4gIH1cclxuICBsb2coY2hhbGsucmVkKFwiRVJST1JcIiksIFwiY29udmVydE9mZnNldERpcmVjdGlvblwiLCBcInVua25vd25cIiwgT2Zmc2V0RnJlcXVlbmN5KTtcclxuICByZXR1cm4gQWRtczQwME9mZnNldERpcmVjdGlvbi5TaW1wbGV4O1xyXG59XHJcblxyXG5leHBvcnQgPSBkb0l0KFwiLi4vZGF0YS9yZXBlYXRlcnMvY29udmVydGVkL0NPLmpzb25cIiwgXCIuLi9kYXRhL3JlcGVhdGVycy9hZG1zNDAwL0NPXCIpO1xyXG4iXX0=