"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
require("module-alias/register");
const fs_helpers_1 = require("@helpers/fs-helpers");
const log_helpers_1 = require("@helpers/log-helpers");
const i_repeater_structured_1 = require("@interfaces/i-repeater-structured");
const gps_distance_1 = __importDefault(require("gps-distance"));
const log = log_helpers_1.createLog('Make Yaesu');
const Adms400;
Channel_Number;
Receive_Frequency;
Transmit_Frequency;
Offset_Frequency;
Offset_Direction;
Operating_Mode;
Name;
Show_Name;
Tone_Mode;
CTCSS;
DCS;
Tx_Power;
Skip;
Step;
Clock_Shift;
Comment;
User_CTCSS;
const yaesu = {
    Channel_Number: null,
    Receive: '',
    Transmit: '',
    Offset: (0).toFixed(5),
    Direction: 'OFF',
    Mode: 'FM',
    Name: '',
    ToneMode: 'OFF',
    CTCSS: '100 Hz',
    DCS: '023',
    UserCTCSS: '1500 Hz',
    Power: 'HIGH',
    Skip: 'OFF',
    Step: '25.0KHz',
    ClockShift: 0,
    Comment: '',
    Bank: 0,
};
const myPoint = [39.627071500, -104.893322500]; // 4982 S Ulster St
async function doIt(inFileName, outFileName) {
    const simplex = JSON.parse((await fs_helpers_1.readFileAsync('../data/frequencies.json')).toString())
        .map((map) => ({ Callsign: map.Name, Frequency: { Output: map.Frequency, Input: map.Frequency } }))
        .filter((filter) => /FM|Voice|Simplex/i.test(filter.Callsign));
    // .filter((filter: IRepeaterStructured) => !(/Data|Digital|Packet/i.test(filter.Callsign)));
    const repeaters = JSON.parse((await fs_helpers_1.readFileAsync(inFileName)).toString());
    repeaters.forEach((each) => {
        each.Location.Distance = gps_distance_1.default([myPoint, [each.Location.Latitude, each.Location.Longitude]]);
    });
    repeaters.sort((a, b) => a.Location.Distance > b.Location.Distance ? 1 :
        a.Location.Distance < b.Location.Distance ? -1 : 0);
    const mapped = [
        ...simplex,
        ...repeaters
            .filter((filter) => (filter.Frequency.Output >= 144 && filter.Frequency.Output <= 148) ||
            // (filter.Frequency.Output >= 222 && filter.Frequency.Output <= 225) ||
            (filter.Frequency.Output >= 420 && filter.Frequency.Output <= 450))
            .filter((filter) => (!filter.Digital || filter.Digital.YSF) &&
            filter.Status !== i_repeater_structured_1.RepeaterStatus.OffAir &&
            filter.Use === i_repeater_structured_1.RepeaterUse.Open),
    ]
        .map((map, index) => ({ ...convertToRadio(map), Number: index + 1 }))
        .slice(0, 500)
        .sort((a, b) => parseFloat(a.Receive) - parseFloat(b.Receive))
        .map((map, index) => ({ ...map, Number: index + 1 }));
    return fs_helpers_1.writeToJsonAndCsv(outFileName, mapped, mapped, false);
}
function convertToRadio(repeater) {
    let Name = '';
    if (repeater.Callsign) {
        Name += repeater.Callsign.trim();
    }
    if (repeater.Location && repeater.Location.Local) {
        Name += (Name ? ' ' : '') + repeater.Location.Local.trim();
    }
    if (repeater.Frequency && repeater.Frequency.Output) {
        Name += (Name ? ' ' : '') + repeater.Frequency.Output.toString().trim();
    }
    Name = Name.replace(/[^0-9.a-zA-Z \/]/g, '').trim();
    Name = Name.replace(/[ ]+/g, ' ').trim();
    Name = Name.substr(0, 8).trim();
    const Receive = repeater.Frequency.Output.toFixed(5);
    const Transmit = repeater.Frequency.Input.toFixed(5);
    const OffsetNumber = repeater.Frequency.Input - repeater.Frequency.Output;
    const Direction = OffsetNumber > 0 ? '+RPT' : OffsetNumber < 0 ? '-RPT' : 'OFF';
    const Offset = Math.abs(Math.round(OffsetNumber * 100) / 100).toFixed(5);
    const TransmitSquelchTone = (repeater.SquelchTone && repeater.SquelchTone.Input);
    const ReceiveSquelchTone = (repeater.SquelchTone && repeater.SquelchTone.Output);
    const TransmitDigitalTone = (repeater.DigitalTone && repeater.DigitalTone.Input);
    const ReceiveDigitalTone = (repeater.DigitalTone && repeater.DigitalTone.Output);
    let ToneMode = 'OFF';
    const Mode = 'FM';
    let Comment = `${repeater.StateID} ${repeater.ID} ${repeater.Location && repeater.Location.Distance && repeater.Location.Distance.toFixed(2)} ${repeater.Location && repeater.Location.State} ${repeater.Location && repeater.Location.County} ${repeater.Location && repeater.Location.Local} ${repeater.Callsign}`;
    Comment = Comment.replace(/undefined/g, ' ').replace(/\s+/g, ' ').trim();
    if (TransmitSquelchTone) {
        ToneMode = 'TONE ENC';
    }
    else if (TransmitDigitalTone) {
        ToneMode = 'DCS';
    }
    if (TransmitSquelchTone && ReceiveSquelchTone && TransmitSquelchTone === ReceiveSquelchTone) {
        ToneMode = 'TONE SQL';
    }
    else if (TransmitDigitalTone && ReceiveDigitalTone && TransmitDigitalTone === ReceiveDigitalTone) {
        ToneMode = 'DCS';
    }
    const CTCSS = (TransmitSquelchTone || 100).toFixed(1) + ' Hz';
    const DCSNumber = (TransmitDigitalTone || 23);
    const DCS = DCSNumber < 100 ? '0' + DCSNumber : '' + DCSNumber;
    return {
        ...yaesu,
        Receive,
        Transmit,
        Offset,
        Direction,
        Name,
        ToneMode,
        CTCSS,
        DCS,
        Mode,
        Comment,
    };
}
async function start() {
    // const coFiles = (await readdirAsync("./repeaters/data/CO/")).map((f) => `../data/CO/${f}`);
    // const utFiles = (await readdirAsync("./repeaters/data/UT/")).map((f) => `../data/UT/${f}`);
    // const nmFiles = (await readdirAsync("./repeaters/data/NM/")).map((f) => `../data/NM/${f}`);
    // const coGroups = (await readdirAsync("./repeaters/groups/CO/")).map((f) => `groups/CO/${f}`);
    // const utGroups = (await readdirAsync("./repeaters/groups/UT/")).map((f) => `groups/UT/${f}`);
    // const nmGroups = (await readdirAsync("./repeaters/groups/NM/")).map((f) => `groups/NM/${f}`);
    // const allFiles = [...coFiles, ...utFiles, ...nmFiles, ...coGroups, ...utGroups, ...nmGroups].filter((f) => /\.json$/.test(f)).map((f) => f.replace(".json", ""));
    // for (const file of allFiles) {
    //   await doIt(file);
    // }
    // await doIt("data/repeaters/groups/CO/Colorado Springs - Call.json", "data/repeaters/yaesu/groups/CO/Colorado Springs - Call");
    // await doIt("data/repeaters/results/CO/Colorado Springs.json", "data/repeaters/yaesu/CO/Colorado Springs");
    await doIt('../data/repeaters/converted/CO.json', '../data/repeaters/yaesu/CO');
    // await doIt('../data/repeaters/groups/combined/CO - Call.json', '../data/repeaters/yaesu/groups/CO - Call');
}
exports.default = start();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWFrZS1hZG1zNDAwLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vc3JjL21ha2UtYWRtczQwMC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUFBLGlDQUErQjtBQUUvQixvREFBdUU7QUFDdkUsc0RBQWlEO0FBQ2pELDZFQUFxRztBQUdyRyxnRUFBa0Q7QUFFbEQsTUFBTSxHQUFHLEdBQTRCLHVCQUFTLENBQUMsWUFBWSxDQUFDLENBQUM7QUFFN0QsTUFBTSxPQUFpQixDQUFBO0FBQ3ZCLGNBQWMsQ0FBQTtBQUNkLGlCQUFpQixDQUFBO0FBQ2pCLGtCQUFrQixDQUFBO0FBQ2xCLGdCQUFnQixDQUFBO0FBQ2hCLGdCQUFnQixDQUFBO0FBQ2hCLGNBQWMsQ0FBQTtBQUNkLElBQUksQ0FBQTtBQUNKLFNBQVMsQ0FBQTtBQUNULFNBQVMsQ0FBQTtBQUNULEtBQUssQ0FBQTtBQUNMLEdBQUcsQ0FBQTtBQUNILFFBQVEsQ0FBQTtBQUNSLElBQUksQ0FBQTtBQUNKLElBQUksQ0FBQTtBQUNKLFdBQVcsQ0FBQTtBQUNYLE9BQU8sQ0FBQTtBQUNQLFVBQVUsQ0FBQTtBQUVWLE1BQU0sS0FBSyxHQUFXO0lBQ3BCLGNBQWMsRUFBRSxJQUFXO0lBQzNCLE9BQU8sRUFBRSxFQUFFO0lBQ1gsUUFBUSxFQUFFLEVBQUU7SUFDWixNQUFNLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDO0lBQ3RCLFNBQVMsRUFBRSxLQUFLO0lBQ2hCLElBQUksRUFBRSxJQUFJO0lBQ1YsSUFBSSxFQUFFLEVBQUU7SUFDUixRQUFRLEVBQUUsS0FBSztJQUNmLEtBQUssRUFBRSxRQUFRO0lBQ2YsR0FBRyxFQUFFLEtBQUs7SUFDVixTQUFTLEVBQUUsU0FBUztJQUNwQixLQUFLLEVBQUUsTUFBTTtJQUNiLElBQUksRUFBRSxLQUFLO0lBQ1gsSUFBSSxFQUFFLFNBQVM7SUFDZixVQUFVLEVBQUUsQ0FBQztJQUNiLE9BQU8sRUFBRSxFQUFF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SUFBSSxHQUFHLENBQUMsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLEdBQUcsS0FBSyxDQUFDO0lBQ3RFLE1BQU0sU0FBUyxHQUFXLENBQUMsbUJBQW1CLElBQUksRUFBRSxDQUFDLENBQUM7SUFDdEQsTUFBTSxHQUFHLEdBQVcsU0FBUyxHQUFHLEdBQUcsQ0FBQyxDQUFDLENBQUMsR0FBRyxHQUFHLFNBQVMsQ0FBQyxDQUFDLENBQUMsRUFBRSxHQUFHLFNBQVMsQ0FBQztJQUV2RSxPQUFPO1FBQ0wsR0FBRyxLQUFLO1FBQ1IsT0FBTztRQUNQLFFBQVE7UUFDUixNQUFNO1FBQ04sU0FBUztRQUNULElBQUk7UUFDSixRQUFRO1FBQ1IsS0FBSztRQUNMLEdBQUc7UUFDSCxJQUFJO1FBQ0osT0FBTztLQUNSLENBQUM7QUFDSixDQUFDO0FBRUQsS0FBSyxVQUFVLEtBQUs7SUFDcEIsOEZBQThGO0lBQzlGLDhGQUE4RjtJQUM5Riw4RkFBOEY7SUFDOUYsZ0dBQWdHO0lBQ2hHLGdHQUFnRztJQUNoRyxnR0FBZ0c7SUFDaEcsb0tBQW9LO0lBQ3BLLGlDQUFpQztJQUNqQyxzQkFBc0I7SUFDdEIsSUFBSTtJQUVKLGlJQUFpSTtJQUNqSSw2R0FBNkc7SUFDM0csTUFBTSxJQUFJLENBQUMscUNBQXFDLEVBQUUsNEJBQTRCLENBQUMsQ0FBQztJQUNoRiw4R0FBOEc7QUFDaEgsQ0FBQztBQUVELGtCQUFlLEtBQUssRUFBRSxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0ICdtb2R1bGUtYWxpYXMvcmVnaXN0ZXInO1xuXG5pbXBvcnQgeyByZWFkRmlsZUFzeW5jLCB3cml0ZVRvSnNvbkFuZENzdiB9IGZyb20gJ0BoZWxwZXJzL2ZzLWhlbHBlcnMnO1xuaW1wb3J0IHsgY3JlYXRlTG9nIH0gZnJvbSAnQGhlbHBlcnMvbG9nLWhlbHBlcnMnO1xuaW1wb3J0IHsgSVJlcGVhdGVyU3RydWN0dXJlZCwgUmVwZWF0ZXJTdGF0dXMsIFJlcGVhdGVyVXNlIH0gZnJvbSAnQGludGVyZmFjZXMvaS1yZXBlYXRlci1zdHJ1Y3R1cmVkJztcbmltcG9ydCB7IElTaW1wbGV4RnJlcXVlbmN5IH0gZnJvbSAnQGludGVyZmFjZXMvaS1zaW1wbGV4LWZyZXF1ZW5jeSc7XG5pbXBvcnQgeyBJWWFlc3UsIFlhZXN1RGlyZWN0aW9uLCBZYWVzdU1vZGUsIFlhZXN1VG9uZU1vZGUgfSBmcm9tICdAaW50ZXJmYWNlcy9pLUFkbXM3JztcbmltcG9ydCBncHNEaXN0YW5jZSwgeyBQb2ludCB9IGZyb20gJ2dwcy1kaXN0YW5jZSc7XG5cbmNvbnN0IGxvZzogKC4uLm1zZzogYW55W10pID0+IHZvaWQgPSBjcmVhdGVMb2coJ01ha2UgWWFlc3UnKTtcblxuY29uc3QgQWRtczQwMDogSUFkbXM0MDBcbkNoYW5uZWxfTnVtYmVyXG5SZWNlaXZlX0ZyZXF1ZW5jeVxuVHJhbnNtaXRfRnJlcXVlbmN5XG5PZmZzZXRfRnJlcXVlbmN5XG5PZmZzZXRfRGlyZWN0aW9uXG5PcGVyYXRpbmdfTW9kZVxuTmFtZVxuU2hvd19OYW1lXG5Ub25lX01vZGVcbkNUQ1NTXG5EQ1NcblR4X1Bvd2VyXG5Ta2lwXG5TdGVwXG5DbG9ja19TaGlmdFxuQ29tbWVudFxuVXNlcl9DVENTU1xuXG5jb25zdCB5YWVzdTogSVlhZXN1ID0ge1xuICBDaGFubmVsX051bWJlcjogbnVsbCBhcyBhbnksXG4gIFJlY2VpdmU6ICcnLFxuICBUcmFuc21pdDogJycsXG4gIE9mZnNldDogKDApLnRvRml4ZWQoNSksXG4gIERpcmVjdGlvbjogJ09GRicsXG4gIE1vZGU6ICdGTScsXG4gIE5hbWU6ICcnLFxuICBUb25lTW9kZTogJ09GRicsXG4gIENUQ1NTOiAnMTAwIEh6JyxcbiAgRENTOiAnMDIzJyxcbiAgVXNlckNUQ1NTOiAnMTUwMCBIeicsXG4gIFBvd2VyOiAnSElHSCcsXG4gIFNraXA6ICdPRkYnLFxuICBTdGVwOiAnMjUuMEtIeicsXG4gIENsb2NrU2hpZnQ6IDAsXG4gIENvbW1lbnQ6ICcnLFxuICBCYW5rOiAwLFxufTtcblxuY29uc3QgbXlQb2ludDogUG9pbnQgPSBbMzkuNjI3MDcxNTAwLCAtMTA0Ljg5MzMyMjUwMF07IC8vIDQ5ODIgUyBVbHN0ZXIgU3RcblxuYXN5bmMgZnVuY3Rpb24gZG9JdChpbkZpbGVOYW1lOiBzdHJpbmcsIG91dEZpbGVOYW1lOiBzdHJpbmcpOiBQcm9taXNlPHZvaWQ+IHtcbiAgY29uc3Qgc2ltcGxleDogSVJlcGVhdGVyU3RydWN0dXJlZFtdID1cbiAgICBKU09OLnBhcnNlKChhd2FpdCByZWFkRmlsZUFzeW5jKCcuLi9kYXRhL2ZyZXF1ZW5jaWVzLmpzb24nKSkudG9TdHJpbmcoKSlcbiAgICAgIC5tYXAoKG1hcDogSVNpbXBsZXhGcmVxdWVuY3kpID0+XG4gICAgICAgICh7IENhbGxzaWduOiBtYXAuTmFtZSwgRnJlcXVlbmN5OiB7IE91dHB1dDogbWFwLkZyZXF1ZW5jeSwgSW5wdXQ6IG1hcC5GcmVxdWVuY3kgfSB9KSlcbiAgICAgIC5maWx0ZXIoKGZpbHRlcjogSVJlcGVhdGVyU3RydWN0dXJlZCkgPT4gL0ZNfFZvaWNlfFNpbXBsZXgvaS50ZXN0KGZpbHRlci5DYWxsc2lnbikpO1xuICAvLyAuZmlsdGVyKChmaWx0ZXI6IElSZXBlYXRlclN0cnVjdHVyZWQpID0+ICEoL0RhdGF8RGlnaXRhbHxQYWNrZXQvaS50ZXN0KGZpbHRlci5DYWxsc2lnbikpKTtcblxuICBjb25zdCByZXBlYXRlcnM6IElSZXBlYXRlclN0cnVjdHVyZWRbXSA9XG4gICAgSlNPTi5wYXJzZSgoYXdhaXQgcmVhZEZpbGVBc3luYyhpbkZpbGVOYW1lKSkudG9TdHJpbmcoKSk7XG5cbiAgcmVwZWF0ZXJzLmZvckVhY2goKGVhY2g6IElSZXBlYXRlclN0cnVjdHVyZWQpID0+IHtcbiAgICBlYWNoLkxvY2F0aW9uLkRpc3RhbmNlID0gZ3BzRGlzdGFuY2UoW215UG9pbnQsIFtlYWNoLkxvY2F0aW9uLkxhdGl0dWRlLCBlYWNoLkxvY2F0aW9uLkxvbmdpdHVkZV1dKTtcbiAgfSk7XG5cbiAgcmVwZWF0ZXJzLnNvcnQoKGE6IElSZXBlYXRlclN0cnVjdHVyZWQsIGI6IElSZXBlYXRlclN0cnVjdHVyZWQpID0+XG4gICAgYS5Mb2NhdGlvbi5EaXN0YW5jZSEgPiBiLkxvY2F0aW9uLkRpc3RhbmNlISA/IDEgOlxuICAgICAgYS5Mb2NhdGlvbi5EaXN0YW5jZSEgPCBiLkxvY2F0aW9uLkRpc3RhbmNlISA/IC0xIDogMCk7XG4gIGNvbnN0IG1hcHBlZDogSVlhZXN1W10gPSBbXG4gICAgLi4uc2ltcGxleCxcbiAgICAuLi5yZXBlYXRlcnNcbiAgICAgIC5maWx0ZXIoKGZpbHRlcjogSVJlcGVhdGVyU3RydWN0dXJlZCkgPT5cbiAgICAgICAgKGZpbHRlci5GcmVxdWVuY3kuT3V0cHV0ID49IDE0NCAmJiBmaWx0ZXIuRnJlcXVlbmN5Lk91dHB1dCA8PSAxNDgpIHx8XG4gICAgICAgIC8vIChmaWx0ZXIuRnJlcXVlbmN5Lk91dHB1dCA+PSAyMjIgJiYgZmlsdGVyLkZyZXF1ZW5jeS5PdXRwdXQgPD0gMjI1KSB8fFxuICAgICAgICAoZmlsdGVyLkZyZXF1ZW5jeS5PdXRwdXQgPj0gNDIwICYmIGZpbHRlci5GcmVxdWVuY3kuT3V0cHV0IDw9IDQ1MCkpXG4gICAgICAuZmlsdGVyKChmaWx0ZXI6IElSZXBlYXRlclN0cnVjdHVyZWQpID0+XG4gICAgICAgICghZmlsdGVyLkRpZ2l0YWwgfHwgZmlsdGVyLkRpZ2l0YWwuWVNGKSAmJlxuICAgICAgICBmaWx0ZXIuU3RhdHVzICE9PSBSZXBlYXRlclN0YXR1cy5PZmZBaXIgJiZcbiAgICAgICAgZmlsdGVyLlVzZSA9PT0gUmVwZWF0ZXJVc2UuT3BlbiksXG4gIF1cbiAgICAubWFwKChtYXA6IElSZXBlYXRlclN0cnVjdHVyZWQsIGluZGV4OiBudW1iZXIpOiBJWWFlc3UgPT4gKHsgLi4uY29udmVydFRvUmFkaW8obWFwKSwgTnVtYmVyOiBpbmRleCArIDEgfSkpXG4gICAgLnNsaWNlKDAsIDUwMClcbiAgICAuc29ydCgoYTogSVlhZXN1LCBiOiBJWWFlc3UpID0+IHBhcnNlRmxvYXQoYS5SZWNlaXZlKSAtIHBhcnNlRmxvYXQoYi5SZWNlaXZlKSlcbiAgICAubWFwKChtYXA6IElZYWVzdSwgaW5kZXg6IG51bWJlcik6IElZYWVzdSA9PiAoeyAuLi5tYXAsIE51bWJlcjogaW5kZXggKyAxIH0pKTtcblxuICByZXR1cm4gd3JpdGVUb0pzb25BbmRDc3Yob3V0RmlsZU5hbWUsIG1hcHBlZCwgbWFwcGVkLCBmYWxzZSk7XG59XG5cbmZ1bmN0aW9uIGNvbnZlcnRUb1JhZGlvKHJlcGVhdGVyOiBJUmVwZWF0ZXJTdHJ1Y3R1cmVkKTogSVlhZXN1IHtcbiAgbGV0IE5hbWU6IHN0cmluZyA9ICcnO1xuXG4gIGlmIChyZXBlYXRlci5DYWxsc2lnbikge1xuICAgIE5hbWUgKz0gcmVwZWF0ZXIuQ2FsbHNpZ24udHJpbSgpO1xuICB9XG5cbiAgaWYgKHJlcGVhdGVyLkxvY2F0aW9uICYmIHJlcGVhdGVyLkxvY2F0aW9uLkxvY2FsKSB7XG4gICAgTmFtZSArPSAoTmFtZSA/ICcgJyA6ICcnKSArIHJlcGVhdGVyLkxvY2F0aW9uLkxvY2FsLnRyaW0oKTtcbiAgfVxuXG4gIGlmIChyZXBlYXRlci5GcmVxdWVuY3kgJiYgcmVwZWF0ZXIuRnJlcXVlbmN5Lk91dHB1dCkge1xuICAgIE5hbWUgKz0gKE5hbWUgPyAnICcgOiAnJykgKyByZXBlYXRlci5GcmVxdWVuY3kuT3V0cHV0LnRvU3RyaW5nKCkudHJpbSgpO1xuICB9XG5cbiAgTmFtZSA9IE5hbWUucmVwbGFjZSgvW14wLTkuYS16QS1aIFxcL10vZywgJycpLnRyaW0oKTtcbiAgTmFtZSA9IE5hbWUucmVwbGFjZSgvWyBdKy9nLCAnICcpLnRyaW0oKTtcbiAgTmFtZSA9IE5hbWUuc3Vic3RyKDAsIDgpLnRyaW0oKTtcblxuICBjb25zdCBSZWNlaXZlOiBzdHJpbmcgPSByZXBlYXRlci5GcmVxdWVuY3kuT3V0cHV0LnRvRml4ZWQoNSk7XG4gIGNvbnN0IFRyYW5zbWl0OiBzdHJpbmcgPSByZXBlYXRlci5GcmVxdWVuY3kuSW5wdXQudG9GaXhlZCg1KTtcbiAgY29uc3QgT2Zmc2V0TnVtYmVyOiBudW1iZXIgPSByZXBlYXRlci5GcmVxdWVuY3kuSW5wdXQgLSByZXBlYXRlci5GcmVxdWVuY3kuT3V0cHV0O1xuICBjb25zdCBEaXJlY3Rpb246IFlhZXN1RGlyZWN0aW9uID0gT2Zmc2V0TnVtYmVyID4gMCA/ICcrUlBUJyA6IE9mZnNldE51bWJlciA8IDAgPyAnLVJQVCcgOiAnT0ZGJztcbiAgY29uc3QgT2Zmc2V0OiBzdHJpbmcgPSBNYXRoLmFicyhNYXRoLnJvdW5kKE9mZnNldE51bWJlciAqIDEwMCkgLyAxMDApLnRvRml4ZWQoNSk7XG4gIGNvbnN0IFRyYW5zbWl0U3F1ZWxjaFRvbmU6IG51bWJlciB8IHVuZGVmaW5lZCA9IChyZXBlYXRlci5TcXVlbGNoVG9uZSAmJiByZXBlYXRlci5TcXVlbGNoVG9uZS5JbnB1dCk7XG4gIGNvbnN0IFJlY2VpdmVTcXVlbGNoVG9uZTogbnVtYmVyIHwgdW5kZWZpbmVkID0gKHJlcGVhdGVyLlNxdWVsY2hUb25lICYmIHJlcGVhdGVyLlNxdWVsY2hUb25lLk91dHB1dCk7XG4gIGNvbnN0IFRyYW5zbWl0RGlnaXRhbFRvbmU6IG51bWJlciB8IHVuZGVmaW5lZCA9IChyZXBlYXRlci5EaWdpdGFsVG9uZSAmJiByZXBlYXRlci5EaWdpdGFsVG9uZS5JbnB1dCk7XG4gIGNvbnN0IFJlY2VpdmVEaWdpdGFsVG9uZTogbnVtYmVyIHwgdW5kZWZpbmVkID0gKHJlcGVhdGVyLkRpZ2l0YWxUb25lICYmIHJlcGVhdGVyLkRpZ2l0YWxUb25lLk91dHB1dCk7XG4gIGxldCBUb25lTW9kZTogWWFlc3VUb25lTW9kZSA9ICdPRkYnO1xuICBjb25zdCBNb2RlOiBZYWVzdU1vZGUgPSAnRk0nO1xuICBsZXQgQ29tbWVudDogc3RyaW5nID0gYCR7cmVwZWF0ZXIuU3RhdGVJRH0gJHtyZXBlYXRlci5JRH0gJHtyZXBlYXRlci5Mb2NhdGlvbiAmJiByZXBlYXRlci5Mb2NhdGlvbi5EaXN0YW5jZSAmJiByZXBlYXRlci5Mb2NhdGlvbi5EaXN0YW5jZS50b0ZpeGVkKDIpfSAke3JlcGVhdGVyLkxvY2F0aW9uICYmIHJlcGVhdGVyLkxvY2F0aW9uLlN0YXRlfSAke3JlcGVhdGVyLkxvY2F0aW9uICYmIHJlcGVhdGVyLkxvY2F0aW9uLkNvdW50eX0gJHtyZXBlYXRlci5Mb2NhdGlvbiAmJiByZXBlYXRlci5Mb2NhdGlvbi5Mb2NhbH0gJHtyZXBlYXRlci5DYWxsc2lnbn1gO1xuICBDb21tZW50ID0gQ29tbWVudC5yZXBsYWNlKC91bmRlZmluZWQvZywgJyAnKS5yZXBsYWNlKC9cXHMrL2csICcgJykudHJpbSgpO1xuXG4gIGlmIChUcmFuc21pdFNxdWVsY2hUb25lKSB7XG4gICAgVG9uZU1vZGUgPSAnVE9ORSBFTkMnO1xuICB9IGVsc2UgaWYgKFRyYW5zbWl0RGlnaXRhbFRvbmUpIHtcbiAgICBUb25lTW9kZSA9ICdEQ1MnO1xuICB9XG5cbiAgaWYgKFRyYW5zbWl0U3F1ZWxjaFRvbmUgJiYgUmVjZWl2ZVNxdWVsY2hUb25lICYmIFRyYW5zbWl0U3F1ZWxjaFRvbmUgPT09IFJlY2VpdmVTcXVlbGNoVG9uZSkge1xuICAgIFRvbmVNb2RlID0gJ1RPTkUgU1FMJztcbiAgfSBlbHNlIGlmIChUcmFuc21pdERpZ2l0YWxUb25lICYmIFJlY2VpdmVEaWdpdGFsVG9uZSAmJiBUcmFuc21pdERpZ2l0YWxUb25lID09PSBSZWNlaXZlRGlnaXRhbFRvbmUpIHtcbiAgICBUb25lTW9kZSA9ICdEQ1MnO1xuICB9XG5cbiAgY29uc3QgQ1RDU1M6IHN0cmluZyA9IChUcmFuc21pdFNxdWVsY2hUb25lIHx8IDEwMCkudG9GaXhlZCgxKSArICcgSHonO1xuICBjb25zdCBEQ1NOdW1iZXI6IG51bWJlciA9IChUcmFuc21pdERpZ2l0YWxUb25lIHx8IDIzKTtcbiAgY29uc3QgRENTOiBzdHJpbmcgPSBEQ1NOdW1iZXIgPCAxMDAgPyAnMCcgKyBEQ1NOdW1iZXIgOiAnJyArIERDU051bWJlcjtcblxuICByZXR1cm4ge1xuICAgIC4uLnlhZXN1LFxuICAgIFJlY2VpdmUsXG4gICAgVHJhbnNtaXQsXG4gICAgT2Zmc2V0LFxuICAgIERpcmVjdGlvbixcbiAgICBOYW1lLFxuICAgIFRvbmVNb2RlLFxuICAgIENUQ1NTLFxuICAgIERDUyxcbiAgICBNb2RlLFxuICAgIENvbW1lbnQsXG4gIH07XG59XG5cbmFzeW5jIGZ1bmN0aW9uIHN0YXJ0KCk6IFByb21pc2U8dm9pZD4ge1xuLy8gY29uc3QgY29GaWxlcyA9IChhd2FpdCByZWFkZGlyQXN5bmMoXCIuL3JlcGVhdGVycy9kYXRhL0NPL1wiKSkubWFwKChmKSA9PiBgLi4vZGF0YS9DTy8ke2Z9YCk7XG4vLyBjb25zdCB1dEZpbGVzID0gKGF3YWl0IHJlYWRkaXJBc3luYyhcIi4vcmVwZWF0ZXJzL2RhdGEvVVQvXCIpKS5tYXAoKGYpID0+IGAuLi9kYXRhL1VULyR7Zn1gKTtcbi8vIGNvbnN0IG5tRmlsZXMgPSAoYXdhaXQgcmVhZGRpckFzeW5jKFwiLi9yZXBlYXRlcnMvZGF0YS9OTS9cIikpLm1hcCgoZikgPT4gYC4uL2RhdGEvTk0vJHtmfWApO1xuLy8gY29uc3QgY29Hcm91cHMgPSAoYXdhaXQgcmVhZGRpckFzeW5jKFwiLi9yZXBlYXRlcnMvZ3JvdXBzL0NPL1wiKSkubWFwKChmKSA9PiBgZ3JvdXBzL0NPLyR7Zn1gKTtcbi8vIGNvbnN0IHV0R3JvdXBzID0gKGF3YWl0IHJlYWRkaXJBc3luYyhcIi4vcmVwZWF0ZXJzL2dyb3Vwcy9VVC9cIikpLm1hcCgoZikgPT4gYGdyb3Vwcy9VVC8ke2Z9YCk7XG4vLyBjb25zdCBubUdyb3VwcyA9IChhd2FpdCByZWFkZGlyQXN5bmMoXCIuL3JlcGVhdGVycy9ncm91cHMvTk0vXCIpKS5tYXAoKGYpID0+IGBncm91cHMvTk0vJHtmfWApO1xuLy8gY29uc3QgYWxsRmlsZXMgPSBbLi4uY29GaWxlcywgLi4udXRGaWxlcywgLi4ubm1GaWxlcywgLi4uY29Hcm91cHMsIC4uLnV0R3JvdXBzLCAuLi5ubUdyb3Vwc10uZmlsdGVyKChmKSA9PiAvXFwuanNvbiQvLnRlc3QoZikpLm1hcCgoZikgPT4gZi5yZXBsYWNlKFwiLmpzb25cIiwgXCJcIikpO1xuLy8gZm9yIChjb25zdCBmaWxlIG9mIGFsbEZpbGVzKSB7XG4vLyAgIGF3YWl0IGRvSXQoZmlsZSk7XG4vLyB9XG5cbi8vIGF3YWl0IGRvSXQoXCJkYXRhL3JlcGVhdGVycy9ncm91cHMvQ08vQ29sb3JhZG8gU3ByaW5ncyAtIENhbGwuanNvblwiLCBcImRhdGEvcmVwZWF0ZXJzL3lhZXN1L2dyb3Vwcy9DTy9Db2xvcmFkbyBTcHJpbmdzIC0gQ2FsbFwiKTtcbi8vIGF3YWl0IGRvSXQoXCJkYXRhL3JlcGVhdGVycy9yZXN1bHRzL0NPL0NvbG9yYWRvIFNwcmluZ3MuanNvblwiLCBcImRhdGEvcmVwZWF0ZXJzL3lhZXN1L0NPL0NvbG9yYWRvIFNwcmluZ3NcIik7XG4gIGF3YWl0IGRvSXQoJy4uL2RhdGEvcmVwZWF0ZXJzL2NvbnZlcnRlZC9DTy5qc29uJywgJy4uL2RhdGEvcmVwZWF0ZXJzL3lhZXN1L0NPJyk7XG4gIC8vIGF3YWl0IGRvSXQoJy4uL2RhdGEvcmVwZWF0ZXJzL2dyb3Vwcy9jb21iaW5lZC9DTyAtIENhbGwuanNvbicsICcuLi9kYXRhL3JlcGVhdGVycy95YWVzdS9ncm91cHMvQ08gLSBDYWxsJyk7XG59XG5cbmV4cG9ydCBkZWZhdWx0IHN0YXJ0KCk7XG4iXX0=