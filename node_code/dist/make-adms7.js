"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
require("module-alias/register");
const fs_helpers_1 = require("@helpers/fs-helpers");
const log_helpers_1 = require("@helpers/log-helpers");
const i_repeater_structured_1 = require("@interfaces/i-repeater-structured");
const gps_distance_1 = __importDefault(require("gps-distance"));
const log = log_helpers_1.createLog("Make Adms7");
const Adms7 = {
    Number: null,
    Receive: "",
    Transmit: "",
    Offset: (0).toFixed(5),
    Direction: "OFF",
    Mode: "FM",
    Name: "",
    ToneMode: "OFF",
    CTCSS: "100 Hz",
    DCS: "023",
    UserCTCSS: "1500 Hz",
    Power: "HIGH",
    Skip: "OFF",
    Step: "25.0KHz",
    ClockShift: 0,
    Comment: "",
    Bank: 0,
};
const myPoint = [39.627071500, -104.893322500]; // 4982 S Ulster St
async function doIt(inFileName, outFileName) {
    const simplex = JSON.parse((await fs_helpers_1.readFileAsync("../data/frequencies.json")).toString())
        .map((map) => ({ Callsign: map.Name, Frequency: { Output: map.Frequency, Input: map.Frequency } }))
        .filter((filter) => /FM|Voice|Simplex/i.test(filter.Callsign));
    // .filter((filter: IRepeaterStructured) => !(/Data|Digital|Packet/i.test(filter.Callsign)));
    const repeaters = JSON.parse((await fs_helpers_1.readFileAsync(inFileName)).toString());
    repeaters.forEach((each) => {
        each.Location.Distance = gps_distance_1.default([myPoint, [each.Location.Latitude, each.Location.Longitude]]);
    });
    repeaters.sort((a, b) => a.Location.Distance > b.Location.Distance ? 1 :
        a.Location.Distance < b.Location.Distance ? -1 : 0);
    const mapped = [
        ...simplex,
        ...repeaters
            .filter((filter) => (filter.Frequency.Output >= 144 && filter.Frequency.Output <= 148) ||
            // (filter.Frequency.Output >= 222 && filter.Frequency.Output <= 225) ||
            (filter.Frequency.Output >= 420 && filter.Frequency.Output <= 450))
            .filter((filter) => (!filter.Digital || filter.Digital.YSF) &&
            filter.Status !== i_repeater_structured_1.RepeaterStatus.OffAir &&
            filter.Use === i_repeater_structured_1.RepeaterUse.Open),
    ]
        .map((map, index) => ({ ...convertToRadio(map), Number: index + 1 }))
        .slice(0, 500)
        .sort((a, b) => parseFloat(a.Receive) - parseFloat(b.Receive))
        .map((map, index) => ({ ...map, Number: index + 1 }));
    return fs_helpers_1.writeToJsonAndCsv(outFileName, mapped, mapped, false);
}
function convertToRadio(repeater) {
    let Name = "";
    if (repeater.Callsign) {
        Name += repeater.Callsign.trim();
    }
    if (repeater.Location && repeater.Location.Local) {
        Name += (Name ? " " : "") + repeater.Location.Local.trim();
    }
    if (repeater.Frequency && repeater.Frequency.Output) {
        Name += (Name ? " " : "") + repeater.Frequency.Output.toString().trim();
    }
    Name = Name.replace(/[^0-9.a-zA-Z \/]/g, "").trim();
    Name = Name.replace(/[ ]+/g, " ").trim();
    Name = Name.substr(0, 8).trim();
    const Receive = repeater.Frequency.Output.toFixed(5);
    const Transmit = repeater.Frequency.Input.toFixed(5);
    const OffsetNumber = repeater.Frequency.Input - repeater.Frequency.Output;
    const Direction = OffsetNumber > 0 ? "+RPT" : OffsetNumber < 0 ? "-RPT" : "OFF";
    const Offset = Math.abs(Math.round(OffsetNumber * 100) / 100).toFixed(5);
    const TransmitSquelchTone = (repeater.SquelchTone && repeater.SquelchTone.Input);
    const ReceiveSquelchTone = (repeater.SquelchTone && repeater.SquelchTone.Output);
    const TransmitDigitalTone = (repeater.DigitalTone && repeater.DigitalTone.Input);
    const ReceiveDigitalTone = (repeater.DigitalTone && repeater.DigitalTone.Output);
    let ToneMode = "OFF";
    const Mode = "FM";
    let Comment = `${repeater.StateID} ${repeater.ID} ${repeater.Location && repeater.Location.Distance && repeater.Location.Distance.toFixed(2)} ${repeater.Location && repeater.Location.State} ${repeater.Location && repeater.Location.County} ${repeater.Location && repeater.Location.Local} ${repeater.Callsign}`;
    Comment = Comment.replace(/undefined/g, " ").replace(/\s+/g, " ").trim();
    if (TransmitSquelchTone) {
        ToneMode = "TONE ENC";
    }
    else if (TransmitDigitalTone) {
        ToneMode = "DCS";
    }
    if (TransmitSquelchTone && ReceiveSquelchTone && TransmitSquelchTone === ReceiveSquelchTone) {
        ToneMode = "TONE SQL";
    }
    else if (TransmitDigitalTone && ReceiveDigitalTone && TransmitDigitalTone === ReceiveDigitalTone) {
        ToneMode = "DCS";
    }
    const CTCSS = (TransmitSquelchTone || 100).toFixed(1) + " Hz";
    const DCSNumber = (TransmitDigitalTone || 23);
    const DCS = DCSNumber < 100 ? "0" + DCSNumber : "" + DCSNumber;
    return {
        ...Adms7,
        Receive,
        Transmit,
        Offset,
        Direction,
        Name,
        ToneMode,
        CTCSS,
        DCS,
        Mode,
        Comment,
    };
}
async function start() {
    // const coFiles = (await readdirAsync("./repeaters/data/CO/")).map((f) => `../data/CO/${f}`);
    // const utFiles = (await readdirAsync("./repeaters/data/UT/")).map((f) => `../data/UT/${f}`);
    // const nmFiles = (await readdirAsync("./repeaters/data/NM/")).map((f) => `../data/NM/${f}`);
    // const coGroups = (await readdirAsync("./repeaters/groups/CO/")).map((f) => `groups/CO/${f}`);
    // const utGroups = (await readdirAsync("./repeaters/groups/UT/")).map((f) => `groups/UT/${f}`);
    // const nmGroups = (await readdirAsync("./repeaters/groups/NM/")).map((f) => `groups/NM/${f}`);
    // const allFiles = [...coFiles, ...utFiles, ...nmFiles, ...coGroups, ...utGroups, ...nmGroups].filter((f) => /\.json$/.test(f)).map((f) => f.replace(".json", ""));
    // for (const file of allFiles) {
    //   await doIt(file);
    // }
    // await doIt("data/repeaters/groups/CO/Colorado Springs - Call.json", "data/repeaters/Adms7/groups/CO/Colorado Springs - Call");
    // await doIt("data/repeaters/results/CO/Colorado Springs.json", "data/repeaters/Adms7/CO/Colorado Springs");
    await doIt("../data/repeaters/converted/CO.json", "../data/repeaters/adms7/CO");
    // await doIt("../data/repeaters/groups/combined/CO - Call.json", "../data/repeaters/Adms7/groups/CO - Call");
}
exports.default = start();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWFrZS1hZG1zNy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uL3NyYy9tYWtlLWFkbXM3LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBQUEsaUNBQStCO0FBRS9CLG9EQUF1RTtBQUN2RSxzREFBaUQ7QUFDakQsNkVBQXFHO0FBR3JHLGdFQUFrRDtBQUVsRCxNQUFNLEdBQUcsR0FBNEIsdUJBQVMsQ0FBQyxZQUFZLENBQUMsQ0FBQztBQUU3RCxNQUFNLEtBQUssR0FBVztJQUNwQixNQUFNLEVBQUUsSUFBVztJQUNuQixPQUFPLEVBQUUsRUFBRTtJQUNYLFFBQVEsRUFBRSxFQUFFO0lBQ1osTUFBTSxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQztJQUN0QixTQUFTLEVBQUUsS0FBSztJQUNoQixJQUFJLEVBQUUsSUFBSTtJQUNWLElBQUksRUFBRSxFQUFFO0lBQ1IsUUFBUSxFQUFFLEtBQUs7SUFDZixLQUFLLEVBQUUsUUFBUTtJQUNmLEdBQUcsRUFBRSxLQUFLO0lBQ1YsU0FBUyxFQUFFLFNBQVM7SUFDcEIsS0FBSyxFQUFFLE1BQU07SUFDYixJQUFJLEVBQUUsS0FBSztJQUNYLElBQUksRUFBRSxTQUFTO0lBQ2YsVUFBVSxFQUFFLENBQUM7SUFDYixPQUFPLEVBQUUsRUFBRTtJQUNYLElBQUksRUFBRSxDQUFDO0NBQ1IsQ0FBQztBQUVGLE1BQU0sT0FBTyxHQUFVLENBQUMsWUFBWSxFQUFFLENBQUMsYUFBYSxDQUFDLENBQUMsQ0FBQyxtQkFBbUI7QUFFMUUsS0FBSyxVQUFVLElBQUksQ0FBQyxVQUFrQixFQUFFLFdBQW1CO0lBQ3pELE1BQU0sT0FBTyxHQUNYLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQyxNQUFNLDBCQUFhLENBQUMsMEJBQTBCLENBQUMsQ0FBQyxDQUFDLFFBQVEsRUFBRSxDQUFDO1NBQ3JFLEdBQUcsQ0FBQyxDQUFDLEdBQXNCLEVBQUUsRUFBRSxDQUM5QixDQUFDLEVBQUUs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TSxZQUFZLEdBQVcsUUFBUSxDQUFDLFNBQVMsQ0FBQyxLQUFLLEdBQUcsUUFBUSxDQUFDLFNBQVMsQ0FBQyxNQUFNLENBQUM7SUFDbEYsTUFBTSxTQUFTLEdBQW1CLFlBQVksR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsWUFBWSxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUM7SUFDaEcsTUFBTSxNQUFNLEdBQVcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLFlBQVksR0FBRyxHQUFHLENBQUMsR0FBRyxHQUFHLENBQUMsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUM7SUFDakYsTUFBTSxtQkFBbUIsR0FBdUIsQ0FBQyxRQUFRLENBQUMsV0FBVyxJQUFJLFFBQVEsQ0FBQyxXQUFXLENBQUMsS0FBSyxDQUFDLENBQUM7SUFDckcsTUFBTSxrQkFBa0IsR0FBdUIsQ0FBQyxRQUFRLENBQUMsV0FBVyxJQUFJLFFBQVEsQ0FBQyxXQUFXLENBQUMsTUFBTSxDQUFDLENBQUM7SUFDckcsTUFBTSxtQkFBbUIsR0FBdUIsQ0FBQyxRQUFRLENBQUMsV0FBVyxJQUFJLFFBQVEsQ0FBQyxXQUFXLENBQUMsS0FBSyxDQUFDLENBQUM7SUFDckcsTUFBTSxrQkFBa0IsR0FBdUIsQ0FBQyxRQUFRLENBQUMsV0FBVyxJQUFJLFFBQVEsQ0FBQyxXQUFXLENBQUMsTUFBTSxDQUFDLENBQUM7SUFDckcsSUFBSSxRQUFRLEdBQWtCLEtBQUssQ0FBQztJQUNwQyxNQUFNLElBQUksR0FBYyxJQUFJLENBQUM7SUFDN0IsSUFBSSxPQUFPLEdBQVcsR0FBRyxRQUFRLENBQUMsT0FBTyxJQUFJLFFBQVEsQ0FBQyxFQUFFLElBQUksUUFBUSxDQUFDLFFBQVEsSUFBSSxRQUFRLENBQUMsUUFBUSxDQUFDLFFBQVEsSUFBSSxRQUFRLENBQUMsUUFBUSxDQUFDLFFBQVEsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLElBQUksUUFBUSxDQUFDLFFBQVEsSUFBSSxRQUFRLENBQUMsUUFBUSxDQUFDLEtBQUssSUFBSSxRQUFRLENBQUMsUUFBUSxJQUFJLFFBQVEsQ0FBQyxRQUFRLENBQUMsTUFBTSxJQUFJLFFBQVEsQ0FBQyxRQUFRLElBQUksUUFBUSxDQUFDLFFBQVEsQ0FBQyxLQUFLLElBQUksUUFBUSxDQUFDLFFBQVEsRUFBRSxDQUFDO0lBQzdULE9BQU8sR0FBRyxPQUFPLENBQUMsT0FBTyxDQUFDLFlBQVksRUFBRSxHQUFHLENBQUMsQ0FBQyxPQUFPLENBQUMsTUFBTSxFQUFFLEdBQUcsQ0FBQyxDQUFDLElBQUksRUFBRSxDQUFDO0lBRXpFLElBQUksbUJBQW1CLEVBQUU7UUFDdkIsUUFBUSxHQUFHLFVBQVUsQ0FBQztLQUN2QjtTQUFNLElBQUksbUJBQW1CLEVBQUU7UUFDOUIsUUFBUSxHQUFHLEtBQUssQ0FBQztLQUNsQjtJQUVELElBQUksbUJBQW1CLElBQUksa0JBQWtCLElBQUksbUJBQW1CLEtBQUssa0JBQWtCLEVBQUU7UUFDM0YsUUFBUSxHQUFHLFVBQVUsQ0FBQztLQUN2QjtTQUFNLElBQUksbUJBQW1CLElBQUksa0JBQWtCLElBQUksbUJBQW1CLEtBQUssa0JBQWtCLEVBQUU7UUFDbEcsUUFBUSxHQUFHLEtBQUssQ0FBQztLQUNsQjtJQUVELE1BQU0sS0FBSyxHQUFXLENBQUMsbUJBQW1CLElBQUksR0FBRyxDQUFDLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxHQUFHLEtBQUssQ0FBQztJQUN0RSxNQUFNLFNBQVMsR0FBVyxDQUFDLG1CQUFtQixJQUFJLEVBQUUsQ0FBQyxDQUFDO0lBQ3RELE1BQU0sR0FBRyxHQUFXLFNBQVMsR0FBRyxHQUFHLENBQUMsQ0FBQyxDQUFDLEdBQUcsR0FBRyxTQUFTLENBQUMsQ0FBQyxDQUFDLEVBQUUsR0FBRyxTQUFTLENBQUM7SUFFdkUsT0FBTztRQUNMLEdBQUcsS0FBSztRQUNSLE9BQU87UUFDUCxRQUFRO1FBQ1IsTUFBTTtRQUNOLFNBQVM7UUFDVCxJQUFJO1FBQ0osUUFBUTtRQUNSLEtBQUs7UUFDTCxHQUFHO1FBQ0gsSUFBSTtRQUNKLE9BQU87S0FDUixDQUFDO0FBQ0osQ0FBQztBQUVELEtBQUssVUFBVSxLQUFLO0lBQ3BCLDhGQUE4RjtJQUM5Riw4RkFBOEY7SUFDOUYsOEZBQThGO0lBQzlGLGdHQUFnRztJQUNoRyxnR0FBZ0c7SUFDaEcsZ0dBQWdHO0lBQ2hHLG9LQUFvSztJQUNwSyxpQ0FBaUM7SUFDakMsc0JBQXNCO0lBQ3RCLElBQUk7SUFFSixpSUFBaUk7SUFDakksNkdBQTZHO0lBQzNHLE1BQU0sSUFBSSxDQUFDLHFDQUFxQyxFQUFFLDRCQUE0QixDQUFDLENBQUM7SUFDaEYsOEdBQThHO0FBQ2hILENBQUM7QUFFRCxrQkFBZSxLQUFLLEVBQUUsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBcIm1vZHVsZS1hbGlhcy9yZWdpc3RlclwiO1xyXG5cclxuaW1wb3J0IHsgcmVhZEZpbGVBc3luYywgd3JpdGVUb0pzb25BbmRDc3YgfSBmcm9tIFwiQGhlbHBlcnMvZnMtaGVscGVyc1wiO1xyXG5pbXBvcnQgeyBjcmVhdGVMb2cgfSBmcm9tIFwiQGhlbHBlcnMvbG9nLWhlbHBlcnNcIjtcclxuaW1wb3J0IHsgSVJlcGVhdGVyU3RydWN0dXJlZCwgUmVwZWF0ZXJTdGF0dXMsIFJlcGVhdGVyVXNlIH0gZnJvbSBcIkBpbnRlcmZhY2VzL2ktcmVwZWF0ZXItc3RydWN0dXJlZFwiO1xyXG5pbXBvcnQgeyBJU2ltcGxleEZyZXF1ZW5jeSB9IGZyb20gXCJAaW50ZXJmYWNlcy9pLXNpbXBsZXgtZnJlcXVlbmN5XCI7XHJcbmltcG9ydCB7IEFkbXM3RGlyZWN0aW9uLCBBZG1zN01vZGUsIEFkbXM3VG9uZU1vZGUsIElBZG1zNyB9IGZyb20gXCJAaW50ZXJmYWNlcy9pLWFkbXM3XCI7XHJcbmltcG9ydCBncHNEaXN0YW5jZSwgeyBQb2ludCB9IGZyb20gXCJncHMtZGlzdGFuY2VcIjtcclxuXHJcbmNvbnN0IGxvZzogKC4uLm1zZzogYW55W10pID0+IHZvaWQgPSBjcmVhdGVMb2coXCJNYWtlIEFkbXM3XCIpO1xyXG5cclxuY29uc3QgQWRtczc6IElBZG1zNyA9IHtcclxuICBOdW1iZXI6IG51bGwgYXMgYW55LFxyXG4gIFJlY2VpdmU6IFwiXCIsXHJcbiAgVHJhbnNtaXQ6IFwiXCIsXHJcbiAgT2Zmc2V0OiAoMCkudG9GaXhlZCg1KSxcclxuICBEaXJlY3Rpb246IFwiT0ZGXCIsXHJcbiAgTW9kZTogXCJGTVwiLFxyXG4gIE5hbWU6IFwiXCIsXHJcbiAgVG9uZU1vZGU6IFwiT0ZGXCIsXHJcbiAgQ1RDU1M6IFwiMTAwIEh6XCIsXHJcbiAgRENTOiBcIjAyM1wiLFxyXG4gIFVzZXJDVENTUzogXCIxNTAwIEh6XCIsXHJcbiAgUG93ZXI6IFwiSElHSFwiLFxyXG4gIFNraXA6IFwiT0ZGXCIsXHJcbiAgU3RlcDogXCIyNS4wS0h6XCIsXHJcbiAgQ2xvY2tTaGlmdDogMCxcclxuICBDb21tZW50OiBcIlwiLFxyXG4gIEJhbms6IDAsXHJcbn07XHJcblxyXG5jb25zdCBteVBvaW50OiBQb2ludCA9IFszOS42MjcwNzE1MDAsIC0xMDQuODkzMzIyNTAwXTsgLy8gNDk4MiBTIFVsc3RlciBTdFxyXG5cclxuYXN5bmMgZnVuY3Rpb24gZG9JdChpbkZpbGVOYW1lOiBzdHJpbmcsIG91dEZpbGVOYW1lOiBzdHJpbmcpOiBQcm9taXNlPHZvaWQ+IHtcclxuICBjb25zdCBzaW1wbGV4OiBJUmVwZWF0ZXJTdHJ1Y3R1cmVkW10gPVxyXG4gICAgSlNPTi5wYXJzZSgoYXdhaXQgcmVhZEZpbGVBc3luYyhcIi4uL2RhdGEvZnJlcXVlbmNpZXMuanNvblwiKSkudG9TdHJpbmcoKSlcclxuICAgICAgLm1hcCgobWFwOiBJU2ltcGxleEZyZXF1ZW5jeSkgPT5cclxuICAgICAgICAoeyBDYWxsc2lnbjogbWFwLk5hbWUsIEZyZXF1ZW5jeTogeyBPdXRwdXQ6IG1hcC5GcmVxdWVuY3ksIElucHV0OiBtYXAuRnJlcXVlbmN5IH0gfSkpXHJcbiAgICAgIC5maWx0ZXIoKGZpbHRlcjogSVJlcGVhdGVyU3RydWN0dXJlZCkgPT4gL0ZNfFZvaWNlfFNpbXBsZXgvaS50ZXN0KGZpbHRlci5DYWxsc2lnbikpO1xyXG4gIC8vIC5maWx0ZXIoKGZpbHRlcjogSVJlcGVhdGVyU3RydWN0dXJlZCkgPT4gISgvRGF0YXxEaWdpdGFsfFBhY2tldC9pLnRlc3QoZmlsdGVyLkNhbGxzaWduKSkpO1xyXG5cclxuICBjb25zdCByZXBlYXRlcnM6IElSZXBlYXRlclN0cnVjdHVyZWRbXSA9XHJcbiAgICBKU09OLnBhcnNlKChhd2FpdCByZWFkRmlsZUFzeW5jKGluRmlsZU5hbWUpKS50b1N0cmluZygpKTtcclxuXHJcbiAgcmVwZWF0ZXJzLmZvckVhY2goKGVhY2g6IElSZXBlYXRlclN0cnVjdHVyZWQpID0+IHtcclxuICAgIGVhY2guTG9jYXRpb24uRGlzdGFuY2UgPSBncHNEaXN0YW5jZShbbXlQb2ludCwgW2VhY2guTG9jYXRpb24uTGF0aXR1ZGUsIGVhY2guTG9jYXRpb24uTG9uZ2l0dWRlXV0pO1xyXG4gIH0pO1xyXG5cclxuICByZXBlYXRlcnMuc29ydCgoYTogSVJlcGVhdGVyU3RydWN0dXJlZCwgYjogSVJlcGVhdGVyU3RydWN0dXJlZCkgPT5cclxuICAgIGEuTG9jYXRpb24uRGlzdGFuY2UhID4gYi5Mb2NhdGlvbi5EaXN0YW5jZSEgPyAxIDpcclxuICAgICAgYS5Mb2NhdGlvbi5EaXN0YW5jZSEgPCBiLkxvY2F0aW9uLkRpc3RhbmNlISA/IC0xIDogMCk7XHJcbiAgY29uc3QgbWFwcGVkOiBJQWRtczdbXSA9IFtcclxuICAgIC4uLnNpbXBsZXgsXHJcbiAgICAuLi5yZXBlYXRlcnNcclxuICAgICAgLmZpbHRlcigoZmlsdGVyOiBJUmVwZWF0ZXJTdHJ1Y3R1cmVkKSA9PlxyXG4gICAgICAgIChmaWx0ZXIuRnJlcXVlbmN5Lk91dHB1dCA+PSAxNDQgJiYgZmlsdGVyLkZyZXF1ZW5jeS5PdXRwdXQgPD0gMTQ4KSB8fFxyXG4gICAgICAgIC8vIChmaWx0ZXIuRnJlcXVlbmN5Lk91dHB1dCA+PSAyMjIgJiYgZmlsdGVyLkZyZXF1ZW5jeS5PdXRwdXQgPD0gMjI1KSB8fFxyXG4gICAgICAgIChmaWx0ZXIuRnJlcXVlbmN5Lk91dHB1dCA+PSA0MjAgJiYgZmlsdGVyLkZyZXF1ZW5jeS5PdXRwdXQgPD0gNDUwKSlcclxuICAgICAgLmZpbHRlcigoZmlsdGVyOiBJUmVwZWF0ZXJTdHJ1Y3R1cmVkKSA9PlxyXG4gICAgICAgICghZmlsdGVyLkRpZ2l0YWwgfHwgZmlsdGVyLkRpZ2l0YWwuWVNGKSAmJlxyXG4gICAgICAgIGZpbHRlci5TdGF0dXMgIT09IFJlcGVhdGVyU3RhdHVzLk9mZkFpciAmJlxyXG4gICAgICAgIGZpbHRlci5Vc2UgPT09IFJlcGVhdGVyVXNlLk9wZW4pLFxyXG4gIF1cclxuICAgIC5tYXAoKG1hcDogSVJlcGVhdGVyU3RydWN0dXJlZCwgaW5kZXg6IG51bWJlcik6IElBZG1zNyA9PiAoeyAuLi5jb252ZXJ0VG9SYWRpbyhtYXApLCBOdW1iZXI6IGluZGV4ICsgMSB9KSlcclxuICAgIC5zbGljZSgwLCA1MDApXHJcbiAgICAuc29ydCgoYTogSUFkbXM3LCBiOiBJQWRtczcpID0+IHBhcnNlRmxvYXQoYS5SZWNlaXZlKSAtIHBhcnNlRmxvYXQoYi5SZWNlaXZlKSlcclxuICAgIC5tYXAoKG1hcDogSUFkbXM3LCBpbmRleDogbnVtYmVyKTogSUFkbXM3ID0+ICh7IC4uLm1hcCwgTnVtYmVyOiBpbmRleCArIDEgfSkpO1xyXG5cclxuICByZXR1cm4gd3JpdGVUb0pzb25BbmRDc3Yob3V0RmlsZU5hbWUsIG1hcHBlZCwgbWFwcGVkLCBmYWxzZSk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGNvbnZlcnRUb1JhZGlvKHJlcGVhdGVyOiBJUmVwZWF0ZXJTdHJ1Y3R1cmVkKTogSUFkbXM3IHtcclxuICBsZXQgTmFtZTogc3RyaW5nID0gXCJcIjtcclxuXHJcbiAgaWYgKHJlcGVhdGVyLkNhbGxzaWduKSB7XHJcbiAgICBOYW1lICs9IHJlcGVhdGVyLkNhbGxzaWduLnRyaW0oKTtcclxuICB9XHJcblxyXG4gIGlmIChyZXBlYXRlci5Mb2NhdGlvbiAmJiByZXBlYXRlci5Mb2NhdGlvbi5Mb2NhbCkge1xyXG4gICAgTmFtZSArPSAoTmFtZSA/IFwiIFwiIDogXCJcIikgKyByZXBlYXRlci5Mb2NhdGlvbi5Mb2NhbC50cmltKCk7XHJcbiAgfVxyXG5cclxuICBpZiAocmVwZWF0ZXIuRnJlcXVlbmN5ICYmIHJlcGVhdGVyLkZyZXF1ZW5jeS5PdXRwdXQpIHtcclxuICAgIE5hbWUgKz0gKE5hbWUgPyBcIiBcIiA6IFwiXCIpICsgcmVwZWF0ZXIuRnJlcXVlbmN5Lk91dHB1dC50b1N0cmluZygpLnRyaW0oKTtcclxuICB9XHJcblxyXG4gIE5hbWUgPSBOYW1lLnJlcGxhY2UoL1teMC05LmEtekEtWiBcXC9dL2csIFwiXCIpLnRyaW0oKTtcclxuICBOYW1lID0gTmFtZS5yZXBsYWNlKC9bIF0rL2csIFwiIFwiKS50cmltKCk7XHJcbiAgTmFtZSA9IE5hbWUuc3Vic3RyKDAsIDgpLnRyaW0oKTtcclxuXHJcbiAgY29uc3QgUmVjZWl2ZTogc3RyaW5nID0gcmVwZWF0ZXIuRnJlcXVlbmN5Lk91dHB1dC50b0ZpeGVkKDUpO1xyXG4gIGNvbnN0IFRyYW5zbWl0OiBzdHJpbmcgPSByZXBlYXRlci5GcmVxdWVuY3kuSW5wdXQudG9GaXhlZCg1KTtcclxuICBjb25zdCBPZmZzZXROdW1iZXI6IG51bWJlciA9IHJlcGVhdGVyLkZyZXF1ZW5jeS5JbnB1dCAtIHJlcGVhdGVyLkZyZXF1ZW5jeS5PdXRwdXQ7XHJcbiAgY29uc3QgRGlyZWN0aW9uOiBBZG1zN0RpcmVjdGlvbiA9IE9mZnNldE51bWJlciA+IDAgPyBcIitSUFRcIiA6IE9mZnNldE51bWJlciA8IDAgPyBcIi1SUFRcIiA6IFwiT0ZGXCI7XHJcbiAgY29uc3QgT2Zmc2V0OiBzdHJpbmcgPSBNYXRoLmFicyhNYXRoLnJvdW5kKE9mZnNldE51bWJlciAqIDEwMCkgLyAxMDApLnRvRml4ZWQoNSk7XHJcbiAgY29uc3QgVHJhbnNtaXRTcXVlbGNoVG9uZTogbnVtYmVyIHwgdW5kZWZpbmVkID0gKHJlcGVhdGVyLlNxdWVsY2hUb25lICYmIHJlcGVhdGVyLlNxdWVsY2hUb25lLklucHV0KTtcclxuICBjb25zdCBSZWNlaXZlU3F1ZWxjaFRvbmU6IG51bWJlciB8IHVuZGVmaW5lZCA9IChyZXBlYXRlci5TcXVlbGNoVG9uZSAmJiByZXBlYXRlci5TcXVlbGNoVG9uZS5PdXRwdXQpO1xyXG4gIGNvbnN0IFRyYW5zbWl0RGlnaXRhbFRvbmU6IG51bWJlciB8IHVuZGVmaW5lZCA9IChyZXBlYXRlci5EaWdpdGFsVG9uZSAmJiByZXBlYXRlci5EaWdpdGFsVG9uZS5JbnB1dCk7XHJcbiAgY29uc3QgUmVjZWl2ZURpZ2l0YWxUb25lOiBudW1iZXIgfCB1bmRlZmluZWQgPSAocmVwZWF0ZXIuRGlnaXRhbFRvbmUgJiYgcmVwZWF0ZXIuRGlnaXRhbFRvbmUuT3V0cHV0KTtcclxuICBsZXQgVG9uZU1vZGU6IEFkbXM3VG9uZU1vZGUgPSBcIk9GRlwiO1xyXG4gIGNvbnN0IE1vZGU6IEFkbXM3TW9kZSA9IFwiRk1cIjtcclxuICBsZXQgQ29tbWVudDogc3RyaW5nID0gYCR7cmVwZWF0ZXIuU3RhdGVJRH0gJHtyZXBlYXRlci5JRH0gJHtyZXBlYXRlci5Mb2NhdGlvbiAmJiByZXBlYXRlci5Mb2NhdGlvbi5EaXN0YW5jZSAmJiByZXBlYXRlci5Mb2NhdGlvbi5EaXN0YW5jZS50b0ZpeGVkKDIpfSAke3JlcGVhdGVyLkxvY2F0aW9uICYmIHJlcGVhdGVyLkxvY2F0aW9uLlN0YXRlfSAke3JlcGVhdGVyLkxvY2F0aW9uICYmIHJlcGVhdGVyLkxvY2F0aW9uLkNvdW50eX0gJHtyZXBlYXRlci5Mb2NhdGlvbiAmJiByZXBlYXRlci5Mb2NhdGlvbi5Mb2NhbH0gJHtyZXBlYXRlci5DYWxsc2lnbn1gO1xyXG4gIENvbW1lbnQgPSBDb21tZW50LnJlcGxhY2UoL3VuZGVmaW5lZC9nLCBcIiBcIikucmVwbGFjZSgvXFxzKy9nLCBcIiBcIikudHJpbSgpO1xyXG5cclxuICBpZiAoVHJhbnNtaXRTcXVlbGNoVG9uZSkge1xyXG4gICAgVG9uZU1vZGUgPSBcIlRPTkUgRU5DXCI7XHJcbiAgfSBlbHNlIGlmIChUcmFuc21pdERpZ2l0YWxUb25lKSB7XHJcbiAgICBUb25lTW9kZSA9IFwiRENTXCI7XHJcbiAgfVxyXG5cclxuICBpZiAoVHJhbnNtaXRTcXVlbGNoVG9uZSAmJiBSZWNlaXZlU3F1ZWxjaFRvbmUgJiYgVHJhbnNtaXRTcXVlbGNoVG9uZSA9PT0gUmVjZWl2ZVNxdWVsY2hUb25lKSB7XHJcbiAgICBUb25lTW9kZSA9IFwiVE9ORSBTUUxcIjtcclxuICB9IGVsc2UgaWYgKFRyYW5zbWl0RGlnaXRhbFRvbmUgJiYgUmVjZWl2ZURpZ2l0YWxUb25lICYmIFRyYW5zbWl0RGlnaXRhbFRvbmUgPT09IFJlY2VpdmVEaWdpdGFsVG9uZSkge1xyXG4gICAgVG9uZU1vZGUgPSBcIkRDU1wiO1xyXG4gIH1cclxuXHJcbiAgY29uc3QgQ1RDU1M6IHN0cmluZyA9IChUcmFuc21pdFNxdWVsY2hUb25lIHx8IDEwMCkudG9GaXhlZCgxKSArIFwiIEh6XCI7XHJcbiAgY29uc3QgRENTTnVtYmVyOiBudW1iZXIgPSAoVHJhbnNtaXREaWdpdGFsVG9uZSB8fCAyMyk7XHJcbiAgY29uc3QgRENTOiBzdHJpbmcgPSBEQ1NOdW1iZXIgPCAxMDAgPyBcIjBcIiArIERDU051bWJlciA6IFwiXCIgKyBEQ1NOdW1iZXI7XHJcblxyXG4gIHJldHVybiB7XHJcbiAgICAuLi5BZG1zNyxcclxuICAgIFJlY2VpdmUsXHJcbiAgICBUcmFuc21pdCxcclxuICAgIE9mZnNldCxcclxuICAgIERpcmVjdGlvbixcclxuICAgIE5hbWUsXHJcbiAgICBUb25lTW9kZSxcclxuICAgIENUQ1NTLFxyXG4gICAgRENTLFxyXG4gICAgTW9kZSxcclxuICAgIENvbW1lbnQsXHJcbiAgfTtcclxufVxyXG5cclxuYXN5bmMgZnVuY3Rpb24gc3RhcnQoKTogUHJvbWlzZTx2b2lkPiB7XHJcbi8vIGNvbnN0IGNvRmlsZXMgPSAoYXdhaXQgcmVhZGRpckFzeW5jKFwiLi9yZXBlYXRlcnMvZGF0YS9DTy9cIikpLm1hcCgoZikgPT4gYC4uL2RhdGEvQ08vJHtmfWApO1xyXG4vLyBjb25zdCB1dEZpbGVzID0gKGF3YWl0IHJlYWRkaXJBc3luYyhcIi4vcmVwZWF0ZXJzL2RhdGEvVVQvXCIpKS5tYXAoKGYpID0+IGAuLi9kYXRhL1VULyR7Zn1gKTtcclxuLy8gY29uc3Qgbm1GaWxlcyA9IChhd2FpdCByZWFkZGlyQXN5bmMoXCIuL3JlcGVhdGVycy9kYXRhL05NL1wiKSkubWFwKChmKSA9PiBgLi4vZGF0YS9OTS8ke2Z9YCk7XHJcbi8vIGNvbnN0IGNvR3JvdXBzID0gKGF3YWl0IHJlYWRkaXJBc3luYyhcIi4vcmVwZWF0ZXJzL2dyb3Vwcy9DTy9cIikpLm1hcCgoZikgPT4gYGdyb3Vwcy9DTy8ke2Z9YCk7XHJcbi8vIGNvbnN0IHV0R3JvdXBzID0gKGF3YWl0IHJlYWRkaXJBc3luYyhcIi4vcmVwZWF0ZXJzL2dyb3Vwcy9VVC9cIikpLm1hcCgoZikgPT4gYGdyb3Vwcy9VVC8ke2Z9YCk7XHJcbi8vIGNvbnN0IG5tR3JvdXBzID0gKGF3YWl0IHJlYWRkaXJBc3luYyhcIi4vcmVwZWF0ZXJzL2dyb3Vwcy9OTS9cIikpLm1hcCgoZikgPT4gYGdyb3Vwcy9OTS8ke2Z9YCk7XHJcbi8vIGNvbnN0IGFsbEZpbGVzID0gWy4uLmNvRmlsZXMsIC4uLnV0RmlsZXMsIC4uLm5tRmlsZXMsIC4uLmNvR3JvdXBzLCAuLi51dEdyb3VwcywgLi4ubm1Hcm91cHNdLmZpbHRlcigoZikgPT4gL1xcLmpzb24kLy50ZXN0KGYpKS5tYXAoKGYpID0+IGYucmVwbGFjZShcIi5qc29uXCIsIFwiXCIpKTtcclxuLy8gZm9yIChjb25zdCBmaWxlIG9mIGFsbEZpbGVzKSB7XHJcbi8vICAgYXdhaXQgZG9JdChmaWxlKTtcclxuLy8gfVxyXG5cclxuLy8gYXdhaXQgZG9JdChcImRhdGEvcmVwZWF0ZXJzL2dyb3Vwcy9DTy9Db2xvcmFkbyBTcHJpbmdzIC0gQ2FsbC5qc29uXCIsIFwiZGF0YS9yZXBlYXRlcnMvQWRtczcvZ3JvdXBzL0NPL0NvbG9yYWRvIFNwcmluZ3MgLSBDYWxsXCIpO1xyXG4vLyBhd2FpdCBkb0l0KFwiZGF0YS9yZXBlYXRlcnMvcmVzdWx0cy9DTy9Db2xvcmFkbyBTcHJpbmdzLmpzb25cIiwgXCJkYXRhL3JlcGVhdGVycy9BZG1zNy9DTy9Db2xvcmFkbyBTcHJpbmdzXCIpO1xyXG4gIGF3YWl0IGRvSXQoXCIuLi9kYXRhL3JlcGVhdGVycy9jb252ZXJ0ZWQvQ08uanNvblwiLCBcIi4uL2RhdGEvcmVwZWF0ZXJzL2FkbXM3L0NPXCIpO1xyXG4gIC8vIGF3YWl0IGRvSXQoXCIuLi9kYXRhL3JlcGVhdGVycy9ncm91cHMvY29tYmluZWQvQ08gLSBDYWxsLmpzb25cIiwgXCIuLi9kYXRhL3JlcGVhdGVycy9BZG1zNy9ncm91cHMvQ08gLSBDYWxsXCIpO1xyXG59XHJcblxyXG5leHBvcnQgZGVmYXVsdCBzdGFydCgpO1xyXG4iXX0=