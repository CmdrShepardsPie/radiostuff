"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
require("module-alias/register");
const fs_helpers_1 = require("@helpers/fs-helpers");
const log_helpers_1 = require("@helpers/log-helpers");
const i_repeater_structured_1 = require("@interfaces/i-repeater-structured");
const log = log_helpers_1.createLog('Convert Repeaters');
exports.default = (async () => {
    const raw = await fs_helpers_1.getAllFilesFromDirectory('../data/repeaters/results/CO');
    log('Got', raw.length, 'files');
    const ids = [];
    const converted = raw
        .reduce((output, input, index) => {
        log('Got', input.length, 'repeaters from file', index + 1);
        return [...output, ...input.map(convertRepeater)];
    }, [])
        .filter((repeater) => {
        if (ids.includes(repeater.ID)) {
            return false;
        }
        else {
            ids.push(repeater.ID);
            return true;
        }
    });
    log('Converted', converted.length, 'repeaters');
    await fs_helpers_1.writeToJsonAndCsv('../data/repeaters/converted/CO', converted);
})();
function convertRepeater(raw) {
    return {
        ID: convertNumber(raw.ID),
        StateID: convertNumber(raw.state_id),
        Callsign: raw.Call,
        Location: { Latitude: raw.Latitude, Longitude: raw.Longitude, County: raw.County, State: raw['ST/PR'], Local: raw.Location },
        Use: convertRepeaterUse(raw.Use),
        Status: convertRepeaterStatus(raw['Op Status']),
        Frequency: { Input: convertNumber(raw.Uplink) || (raw.Downlink + raw.Offset), Output: raw.Downlink },
        SquelchTone: convertRepeaterSquelchTone(raw['Uplink Tone'], raw['Downlink Tone']),
        DigitalTone: convertRepeaterDigitalTone(raw['Uplink Tone'], raw['Downlink Tone']),
        Digital: convertRepeaterDigitalData(raw),
        VOIP: convertRepeaterVOIP(raw),
    };
}
function convertRepeaterUse(raw) {
    switch (raw.toLowerCase()) {
        case 'open':
            return i_repeater_structured_1.RepeaterUse.Open;
        case 'closed':
            return i_repeater_structured_1.RepeaterUse.Closed;
        case 'private':
            return i_repeater_structured_1.RepeaterUse.Private;
        default:
            return i_repeater_structured_1.RepeaterUse.Other;
    }
}
function convertRepeaterStatus(raw) {
    if (!raw) {
        return i_repeater_structured_1.RepeaterStatus.Other;
    }
    switch (raw.toLowerCase()) {
        case 'on-air':
            return i_repeater_structured_1.RepeaterStatus.OnAir;
        case 'off-air':
            return i_repeater_structured_1.RepeaterStatus.OffAir;
        case 'testing':
            return i_repeater_structured_1.RepeaterStatus.Testing;
        case 'unknown':
            return i_repeater_structured_1.RepeaterStatus.Unknown;
        default:
            return i_repeater_structured_1.RepeaterStatus.Other;
    }
}
function convertRepeaterSquelchTone(rawInput, rawOutput) {
    if (!rawInput && !rawOutput) {
        return undefined;
    }
    const converted = {
        Input: convertNumber(rawInput),
        Output: convertNumber(rawOutput),
    };
    if (converted.Input || converted.Output) {
        return converted;
    }
    return undefined;
}
function convertRepeaterDigitalTone(rawInput, rawOutput) {
    if (!rawInput && !rawOutput) {
        return undefined;
    }
    const digitalFilter = /^D(\d+)$/;
    const converted = {
        Input: typeof rawInput === 'string' ? convertNumber(rawInput, digitalFilter) : undefined,
        Output: typeof rawOutput === 'string' ? convertNumber(rawOutput, digitalFilter) : undefined,
    };
    if (converted.Input || converted.Output) {
        return converted;
    }
    return undefined;
}
function convertNumber(input, numberFilter = /^([+-]?\d+\.?\d*)$/) {
    if (typeof input === 'number' && !isNaN(input)) {
        return input;
    }
    else if (typeof input === 'number' && isNaN(input)) {
        return undefined;
    }
    else if (typeof input === 'string' && numberFilter.test(input)) {
        const match = input.match(numberFilter);
        if (match && match[1]) {
            const converted = parseFloat(match[1]);
            return !isNaN(converted) ? converted : undefined;
        }
    }
}
function convertRepeaterDigitalData(raw) {
    const converted = {
        // TODO: ATV?: boolean;
        DMR: (raw.DGTL.includes('D') || raw['DMR Enabled']) ? { ColorCode: convertNumber(raw['Color Code']), ID: convertNumber(raw['DMR ID']) } : undefined,
        P25: (raw.DGTL.includes('P') || raw['P-25 Digital Enabled']) ? { NAC: convertNumber(raw.NAC) } : undefined,
        DStar: (raw.DGTL.includes('S') || raw['D-STAR Enabled']) ? { Node: raw.Node } : undefined,
        YSF: (raw.DGTL.includes('Y') || raw['YSF Digital Enabled']) ? {
            GroupID: {
                Input: typeof raw['DG-ID'] === 'number' ? raw['DG-ID'] : typeof raw['DG-ID'] === 'string' ? raw['DG-ID'].split('/')[0].trim() : undefined,
                Output: typeof raw['DG-ID'] === 'number' ? raw['DG-ID'] : typeof raw['DG-ID'] === 'string' ? raw['DG-ID'].split('/')[1].trim() : undefined,
            },
        } : undefined,
    };
    if (converted.DMR || converted.P25 || converted.DStar || converted.YSF) {
        return converted;
    }
}
function convertRepeaterVOIP(raw) {
    const converted = {
        AllStar: (raw.VOIP.includes('A') || raw.AllStar) ? { NodeID: convertNumber(raw.AllStar) } : undefined,
        EchoLink: (raw.VOIP.includes('E') || raw.EchoLink) ? {
            NodeID: raw.EchoLink,
        } : undefined,
        IRLP: (raw.VOIP.includes('I') || raw.IRLP) ? { NodeID: convertNumber(raw.IRLP) } : undefined,
        Wires: (raw.VOIP.includes('W') || raw['WIRES-X']) ? { ID: convertNumber(raw['WIRES-X']) } : undefined,
    };
    if (converted.AllStar || converted.EchoLink || converted.IRLP || converted.Wires) {
        return converted;
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29udmVydC1yZXBlYXRlcnMuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi9zcmMvY29udmVydC1yZXBlYXRlcnMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSxpQ0FBK0I7QUFFL0Isb0RBQWtGO0FBQ2xGLHNEQUFpRDtBQUVqRCw2RUFNMkM7QUFFM0MsTUFBTSxHQUFHLEdBQTRCLHVCQUFTLENBQUMsbUJBQW1CLENBQUMsQ0FBQztBQUVwRSxrQkFBZSxDQUFDLEtBQUssSUFBbUIsRUFBRTtJQUN4QyxNQUFNLEdBQUcsR0FBcUIsTUFBTSxxQ0FBd0IsQ0FBQyw4QkFBOEIsQ0FBQyxDQUFDO0lBQzdGLEdBQUcsQ0FBQyxLQUFLLEVBQUUsR0FBRyxDQUFDLE1BQU0sRUFBRSxPQUFPLENBQUMsQ0FBQztJQUNoQyxNQUFNLEdBQUcsR0FBYSxFQUFFLENBQUM7SUFDekIsTUFBTSxTQUFTLEdBQTBCLEdBQUc7U0FDekMsTUFBTSxDQUFDLENBQUMsTUFBNkIsRUFBRSxLQUFxQixFQUFFLEtBQWEsRUFBRSxFQUFFO1FBQzlFLEdBQUcsQ0FBQyxLQUFLLEVBQUUsS0FBSyxDQUFDLE1BQU0sRUFBRSxxQkFBcUIsRUFBRSxLQUFLLEdBQUcsQ0FBQyxDQUFDLENBQUM7UUFDM0QsT0FBTyxDQUFDLEdBQUcsTUFBTSxFQUFFLEdBQUcsS0FBSyxDQUFDLEdBQUcsQ0FBQyxlQUFlLENBQUMsQ0FBQyxDQUFDO0lBQ3BELENBQUMsRUFBRSxFQUFFLENBQUM7U0FDTCxNQUFNLENBQUMsQ0FBQyxRQUE2QixFQUFFLEVBQUU7UUFDeEMsSUFBSSxHQUFHLENBQUMsUUFBUSxDQUFDLFFBQVEsQ0FBQyxFQUFFLENBQUMsRUFBRTtZQUM3QixPQUFPLEtBQUssQ0FBQztTQUNkO2FBQU07WUFDTCxHQUFHLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxFQUFFLENBQUMsQ0FBQztZQUN0QixPQUFPLElBQUksQ0FBQztTQUNiO0lBQ0gsQ0FBQyxDQUFDLENBQUM7SUFD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LENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRSxNQUFNLEVBQUUsYUFBYSxDQUFDLEdBQUcsQ0FBQyxPQUFPLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxTQUFTO1FBQ3JHLFFBQVEsRUFBRSxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLEdBQUcsQ0FBQyxJQUFJLEdBQUcsQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDbkQsTUFBTSxFQUFFLEdBQUcsQ0FBQyxRQUFRO1NBQ3JCLENBQUMsQ0FBQyxDQUFDLFNBQVM7UUFDYixJQUFJLEVBQUUsQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxHQUFHLENBQUMsSUFBSSxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUUsTUFBTSxFQUFFLGFBQWEsQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsU0FBUztRQUM1RixLQUFLLEVBQUUsQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxHQUFHLENBQUMsSUFBSSxHQUFHLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRSxFQUFFLEVBQUUsYUFBYSxDQUFDLEdBQUcsQ0FBQyxTQUFTLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLFNBQVM7S0FDdEcsQ0FBQztJQUNGLElBQUksU0FBUyxDQUFDLE9BQU8sSUFBSSxTQUFTLENBQUMsUUFBUSxJQUFJLFNBQVMsQ0FBQyxJQUFJLElBQUksU0FBUyxDQUFDLEtBQUssRUFBRTtRQUNoRixPQUFPLFNBQVMsQ0FBQztLQUNsQjtBQUNILENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgJ21vZHVsZS1hbGlhcy9yZWdpc3Rlcic7XG5cbmltcG9ydCB7IGdldEFsbEZpbGVzRnJvbURpcmVjdG9yeSwgd3JpdGVUb0pzb25BbmRDc3YgfSBmcm9tICdAaGVscGVycy9mcy1oZWxwZXJzJztcbmltcG9ydCB7IGNyZWF0ZUxvZyB9IGZyb20gJ0BoZWxwZXJzL2xvZy1oZWxwZXJzJztcbmltcG9ydCB7IElSZXBlYXRlclJhdyB9IGZyb20gJ0BpbnRlcmZhY2VzL2ktcmVwZWF0ZXItcmF3JztcbmltcG9ydCB7XG4gIElSZXBlYXRlckRpZ2l0YWxNb2RlcyxcbiAgSVJlcGVhdGVyU3RydWN0dXJlZCxcbiAgSVJlcGVhdGVyVk9JUE1vZGVzLFxuICBSZXBlYXRlclN0YXR1cyxcbiAgUmVwZWF0ZXJVc2UsXG59IGZyb20gJ0BpbnRlcmZhY2VzL2ktcmVwZWF0ZXItc3RydWN0dXJlZCc7XG5cbmNvbnN0IGxvZzogKC4uLm1zZzogYW55W10pID0+IHZvaWQgPSBjcmVhdGVMb2coJ0NvbnZlcnQgUmVwZWF0ZXJzJyk7XG5cbmV4cG9ydCBkZWZhdWx0IChhc3luYyAoKTogUHJvbWlzZTx2b2lkPiA9PiB7XG4gIGNvbnN0IHJhdzogSVJlcGVhdGVyUmF3W11bXSA9IGF3YWl0IGdldEFsbEZpbGVzRnJvbURpcmVjdG9yeSgnLi4vZGF0YS9yZXBlYXRlcnMvcmVzdWx0cy9DTycpO1xuICBsb2coJ0dvdCcsIHJhdy5sZW5ndGgsICdmaWxlcycpO1xuICBjb25zdCBpZHM6IG51bWJlcltdID0gW107XG4gIGNvbnN0IGNvbnZlcnRlZDogSVJlcGVhdGVyU3RydWN0dXJlZFtdID0gcmF3XG4gICAgLnJlZHVjZSgob3V0cHV0OiBJUmVwZWF0ZXJTdHJ1Y3R1cmVkW10sIGlucHV0OiBJUmVwZWF0ZXJSYXdbXSwgaW5kZXg6IG51bWJlcikgPT4ge1xuICAgICAgbG9nKCdHb3QnLCBpbnB1dC5sZW5ndGgsICdyZXBlYXRlcnMgZnJvbSBmaWxlJywgaW5kZXggKyAxKTtcbiAgICAgIHJldHVybiBbLi4ub3V0cHV0LCAuLi5pbnB1dC5tYXAoY29udmVydFJlcGVhdGVyKV07XG4gICAgfSwgW10pXG4gICAgLmZpbHRlcigocmVwZWF0ZXI6IElSZXBlYXRlclN0cnVjdHVyZWQpID0+IHtcbiAgICAgIGlmIChpZHMuaW5jbHVkZXMocmVwZWF0ZXIuSUQpKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGlkcy5wdXNoKHJlcGVhdGVyLklEKTtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICB9XG4gICAgfSk7XG4gIGxvZygnQ29udmVydGVkJywgY29udmVydGVkLmxlbmd0aCwgJ3JlcGVhdGVycycpO1xuICBhd2FpdCB3cml0ZVRvSnNvbkFuZENzdignLi4vZGF0YS9yZXBlYXRlcnMvY29udmVydGVkL0NPJywgY29udmVydGVkKTtcbn0pKCk7XG5cbmZ1bmN0aW9uIGNvbnZlcnRSZXBlYXRlcihyYXc6IElSZXBlYXRlclJhdyk6IElSZXBlYXRlclN0cnVjdHVyZWQge1xuICByZXR1cm4ge1xuICAgIElEOiBjb252ZXJ0TnVtYmVyKHJhdy5JRCkgYXMgbnVtYmVyLFxuICAgIFN0YXRlSUQ6IGNvbnZlcnROdW1iZXIocmF3LnN0YXRlX2lkKSBhcyBudW1iZXIsXG4gICAgQ2FsbHNpZ246IHJhdy5DYWxsLFxuICAgIExvY2F0aW9uOiB7IExhdGl0dWRlOiByYXcuTGF0aXR1ZGUsIExvbmdpdHVkZTogcmF3LkxvbmdpdHVkZSwgQ291bnR5OiByYXcuQ291bnR5LCBTdGF0ZTogcmF3WydTVC9QUiddLCBMb2NhbDogcmF3LkxvY2F0aW9uIH0sXG4gICAgVXNlOiBjb252ZXJ0UmVwZWF0ZXJVc2UocmF3LlVzZSksXG4gICAgU3RhdHVzOiBjb252ZXJ0UmVwZWF0ZXJTdGF0dXMocmF3WydPcCBTdGF0dXMnXSksXG4gICAgRnJlcXVlbmN5OiB7IElucHV0OiBjb252ZXJ0TnVtYmVyKHJhdy5VcGxpbmspIHx8IChyYXcuRG93bmxpbmsgKyByYXcuT2Zmc2V0KSwgT3V0cHV0OiByYXcuRG93bmxpbmsgfSxcbiAgICBTcXVlbGNoVG9uZTogY29udmVydFJlcGVhdGVyU3F1ZWxjaFRvbmUocmF3WydVcGxpbmsgVG9uZSddLCByYXdbJ0Rvd25saW5rIFRvbmUnXSksXG4gICAgRGlnaXRhbFRvbmU6IGNvbnZlcnRSZXBlYXRlckRpZ2l0YWxUb25lKHJhd1snVXBsaW5rIFRvbmUnXSwgcmF3WydEb3dubGluayBUb25lJ10pLFxuICAgIERpZ2l0YWw6IGNvbnZlcnRSZXBlYXRlckRpZ2l0YWxEYXRhKHJhdyksXG4gICAgVk9JUDogY29udmVydFJlcGVhdGVyVk9JUChyYXcpLFxuICB9O1xufVxuXG5mdW5jdGlvbiBjb252ZXJ0UmVwZWF0ZXJVc2UocmF3OiBzdHJpbmcpOiBSZXBlYXRlclVzZSB7XG4gIHN3aXRjaCAocmF3LnRvTG93ZXJDYXNlKCkpIHtcbiAgICBjYXNlICdvcGVuJzpcbiAgICAgIHJldHVybiBSZXBlYXRlclVzZS5PcGVuO1xuICAgIGNhc2UgJ2Nsb3NlZCc6XG4gICAgICByZXR1cm4gUmVwZWF0ZXJVc2UuQ2xvc2VkO1xuICAgIGNhc2UgJ3ByaXZhdGUnOlxuICAgICAgcmV0dXJuIFJlcGVhdGVyVXNlLlByaXZhdGU7XG4gICAgZGVmYXVsdDpcbiAgICAgIHJldHVybiBSZXBlYXRlclVzZS5PdGhlcjtcbiAgfVxufVxuXG5mdW5jdGlvbiBjb252ZXJ0UmVwZWF0ZXJTdGF0dXMocmF3OiBzdHJpbmcgfCB1bmRlZmluZWQpOiBSZXBlYXRlclN0YXR1cyB7XG4gIGlmICghcmF3KSB7XG4gICAgcmV0dXJuIFJlcGVhdGVyU3RhdHVzLk90aGVyO1xuICB9XG4gIHN3aXRjaCAocmF3LnRvTG93ZXJDYXNlKCkpIHtcbiAgICBjYXNlICdvbi1haXInOlxuICAgICAgcmV0dXJuIFJlcGVhdGVyU3RhdHVzLk9uQWlyO1xuICAgIGNhc2UgJ29mZi1haXInOlxuICAgICAgcmV0dXJuIFJlcGVhdGVyU3RhdHVzLk9mZkFpcjtcbiAgICBjYXNlICd0ZXN0aW5nJzpcbiAgICAgIHJldHVybiBSZXBlYXRlclN0YXR1cy5UZXN0aW5nO1xuICAgIGNhc2UgJ3Vua25vd24nOlxuICAgICAgcmV0dXJuIFJlcGVhdGVyU3RhdHVzLlVua25vd247XG4gICAgZGVmYXVsdDpcbiAgICAgIHJldHVybiBSZXBlYXRlclN0YXR1cy5PdGhlcjtcbiAgfVxufVxuXG5mdW5jdGlvbiBjb252ZXJ0UmVwZWF0ZXJTcXVlbGNoVG9uZShyYXdJbnB1dDogc3RyaW5nIHwgbnVtYmVyIHwgdW5kZWZpbmVkLCByYXdPdXRwdXQ6IHN0cmluZyB8IG51bWJlciB8IHVuZGVmaW5lZCk6IHsgSW5wdXQ/OiBudW1iZXI7IE91dHB1dD86IG51bWJlciB9IHwgdW5kZWZpbmVkIHtcbiAgaWYgKCFyYXdJbnB1dCAmJiAhcmF3T3V0cHV0KSB7XG4gICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgfVxuICBjb25zdCBjb252ZXJ0ZWQ6IHsgSW5wdXQ6IG51bWJlciB8IHVuZGVmaW5lZDsgT3V0cHV0OiBudW1iZXIgfCB1bmRlZmluZWQgfSA9IHtcbiAgICBJbnB1dDogY29udmVydE51bWJlcihyYXdJbnB1dCksXG4gICAgT3V0cHV0OiBjb252ZXJ0TnVtYmVyKHJhd091dHB1dCksXG4gIH07XG4gIGlmIChjb252ZXJ0ZWQuSW5wdXQgfHwgY29udmVydGVkLk91dHB1dCkge1xuICAgIHJldHVybiBjb252ZXJ0ZWQ7XG4gIH1cbiAgcmV0dXJuIHVuZGVmaW5lZDtcbn1cblxuZnVuY3Rpb24gY29udmVydFJlcGVhdGVyRGlnaXRhbFRvbmUocmF3SW5wdXQ6IHN0cmluZyB8IG51bWJlciB8IHVuZGVmaW5lZCwgcmF3T3V0cHV0OiBzdHJpbmcgfCBudW1iZXIgfCB1bmRlZmluZWQpOiB7IElucHV0PzogbnVtYmVyOyBPdXRwdXQ/OiBudW1iZXIgfSB8IHVuZGVmaW5lZCB7XG4gIGlmICghcmF3SW5wdXQgJiYgIXJhd091dHB1dCkge1xuICAgIHJldHVybiB1bmRlZmluZWQ7XG4gIH1cbiAgY29uc3QgZGlnaXRhbEZpbHRlcjogUmVnRXhwID0gL15EKFxcZCspJC87XG4gIGNvbnN0IGNvbnZlcnRlZDogeyBJbnB1dDogbnVtYmVyIHwgdW5kZWZpbmVkOyBPdXRwdXQ6IG51bWJlciB8IHVuZGVmaW5lZCB9ID0ge1xuICAgIElucHV0OiB0eXBlb2YgcmF3SW5wdXQgPT09ICdzdHJpbmcnID8gY29udmVydE51bWJlcihyYXdJbnB1dCwgZGlnaXRhbEZpbHRlcikgOiB1bmRlZmluZWQsXG4gICAgT3V0cHV0OiB0eXBlb2YgcmF3T3V0cHV0ID09PSAnc3RyaW5nJyA/IGNvbnZlcnROdW1iZXIocmF3T3V0cHV0LCBkaWdpdGFsRmlsdGVyKSA6IHVuZGVmaW5lZCxcbiAgfTtcbiAgaWYgKGNvbnZlcnRlZC5JbnB1dCB8fCBjb252ZXJ0ZWQuT3V0cHV0KSB7XG4gICAgcmV0dXJuIGNvbnZlcnRlZDtcbiAgfVxuICByZXR1cm4gdW5kZWZpbmVkO1xufVxuXG5mdW5jdGlvbiBjb252ZXJ0TnVtYmVyKGlucHV0OiBzdHJpbmcgfCBudW1iZXIgfCB1bmRlZmluZWQsIG51bWJlckZpbHRlcjogUmVnRXhwID0gL14oWystXT9cXGQrXFwuP1xcZCopJC8pOiBudW1iZXIgfCB1bmRlZmluZWQge1xuICBpZiAodHlwZW9mIGlucHV0ID09PSAnbnVtYmVyJyAmJiAhaXNOYU4oaW5wdXQpKSB7XG4gICAgcmV0dXJuIGlucHV0O1xuICB9IGVsc2UgaWYgKHR5cGVvZiBpbnB1dCA9PT0gJ251bWJlcicgJiYgaXNOYU4oaW5wdXQpKSB7XG4gICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgfSBlbHNlIGlmICh0eXBlb2YgaW5wdXQgPT09ICdzdHJpbmcnICYmIG51bWJlckZpbHRlci50ZXN0KGlucHV0KSkge1xuICAgIGNvbnN0IG1hdGNoOiBSZWdFeHBNYXRjaEFycmF5IHwgbnVsbCA9IGlucHV0Lm1hdGNoKG51bWJlckZpbHRlcik7XG4gICAgaWYgKG1hdGNoICYmIG1hdGNoWzFdKSB7XG4gICAgICBjb25zdCBjb252ZXJ0ZWQ6IG51bWJlciA9IHBhcnNlRmxvYXQobWF0Y2hbMV0pO1xuICAgICAgcmV0dXJuICFpc05hTihjb252ZXJ0ZWQpID8gY29udmVydGVkIDogdW5kZWZpbmVkO1xuICAgIH1cbiAgfVxufVxuXG5mdW5jdGlvbiBjb252ZXJ0UmVwZWF0ZXJEaWdpdGFsRGF0YShyYXc6IElSZXBlYXRlclJhdyk6IElSZXBlYXRlckRpZ2l0YWxNb2RlcyB8IHVuZGVmaW5lZCB7XG4gIGNvbnN0IGNvbnZlcnRlZDogSVJlcGVhdGVyRGlnaXRhbE1vZGVzID0ge1xuICAgIC8vIFRPRE86IEFUVj86IGJvb2xlYW47XG4gICAgRE1SOiAocmF3LkRHVEwuaW5jbHVkZXMoJ0QnKSB8fCByYXdbJ0RNUiBFbmFibGVkJ10pID8geyBDb2xvckNvZGU6IGNvbnZlcnROdW1iZXIocmF3WydDb2xvciBDb2RlJ10pLCBJRDogY29udmVydE51bWJlcihyYXdbJ0RNUiBJRCddKSB9IDogdW5kZWZpbmVkLFxuICAgIFAyNTogKHJhdy5ER1RMLmluY2x1ZGVzKCdQJykgfHwgcmF3WydQLTI1IERpZ2l0YWwgRW5hYmxlZCddKSA/IHsgTkFDOiBjb252ZXJ0TnVtYmVyKHJhdy5OQUMpIH0gOiB1bmRlZmluZWQsXG4gICAgRFN0YXI6IChyYXcuREdUTC5pbmNsdWRlcygnUycpIHx8IHJhd1snRC1TVEFSIEVuYWJsZWQnXSkgPyB7IE5vZGU6IHJhdy5Ob2RlIH0gOiB1bmRlZmluZWQsXG4gICAgWVNGOiAocmF3LkRHVEwuaW5jbHVkZXMoJ1knKSB8fCByYXdbJ1lTRiBEaWdpdGFsIEVuYWJsZWQnXSkgPyB7XG4gICAgICBHcm91cElEOiB7XG4gICAgICAgIElucHV0OiB0eXBlb2YgcmF3WydERy1JRCddID09PSAnbnVtYmVyJyA/IHJhd1snREctSUQnXSA6IHR5cGVvZiByYXdbJ0RHLUlEJ10gPT09ICdzdHJpbmcnID8gcmF3WydERy1JRCddLnNwbGl0KCcvJylbMF0udHJpbSgpIDogdW5kZWZpbmVkLFxuICAgICAgICBPdXRwdXQ6IHR5cGVvZiByYXdbJ0RHLUlEJ10gPT09ICdudW1iZXInID8gcmF3WydERy1JRCddIDogdHlwZW9mIHJhd1snREctSUQnXSA9PT0gJ3N0cmluZycgPyByYXdbJ0RHLUlEJ10uc3BsaXQoJy8nKVsxXS50cmltKCkgOiB1bmRlZmluZWQsXG4gICAgICB9LFxuICAgIH0gOiB1bmRlZmluZWQsXG4gIH07XG4gIGlmIChjb252ZXJ0ZWQuRE1SIHx8IGNvbnZlcnRlZC5QMjUgfHwgY29udmVydGVkLkRTdGFyIHx8IGNvbnZlcnRlZC5ZU0YpIHtcbiAgICByZXR1cm4gY29udmVydGVkO1xuICB9XG59XG5cbmZ1bmN0aW9uIGNvbnZlcnRSZXBlYXRlclZPSVAocmF3OiBJUmVwZWF0ZXJSYXcpOiBJUmVwZWF0ZXJWT0lQTW9kZXMgfCB1bmRlZmluZWQge1xuICBjb25zdCBjb252ZXJ0ZWQ6IElSZXBlYXRlclZPSVBNb2RlcyA9IHtcbiAgICBBbGxTdGFyOiAocmF3LlZPSVAuaW5jbHVkZXMoJ0EnKSB8fCByYXcuQWxsU3RhcikgPyB7IE5vZGVJRDogY29udmVydE51bWJlcihyYXcuQWxsU3RhcikgfSA6IHVuZGVmaW5lZCxcbiAgICBFY2hvTGluazogKHJhdy5WT0lQLmluY2x1ZGVzKCdFJykgfHwgcmF3LkVjaG9MaW5rKSA/IHtcbiAgICAgIE5vZGVJRDogcmF3LkVjaG9MaW5rLFxuICAgIH0gOiB1bmRlZmluZWQsIC8vIFRPRE86IFN0YXR1cz86IEVjaG9MaW5rTm9kZVN0YXR1c1xuICAgIElSTFA6IChyYXcuVk9JUC5pbmNsdWRlcygnSScpIHx8IHJhdy5JUkxQKSA/IHsgTm9kZUlEOiBjb252ZXJ0TnVtYmVyKHJhdy5JUkxQKSB9IDogdW5kZWZpbmVkLFxuICAgIFdpcmVzOiAocmF3LlZPSVAuaW5jbHVkZXMoJ1cnKSB8fCByYXdbJ1dJUkVTLVgnXSkgPyB7IElEOiBjb252ZXJ0TnVtYmVyKHJhd1snV0lSRVMtWCddKSB9IDogdW5kZWZpbmVkLFxuICB9O1xuICBpZiAoY29udmVydGVkLkFsbFN0YXIgfHwgY29udmVydGVkLkVjaG9MaW5rIHx8IGNvbnZlcnRlZC5JUkxQIHx8IGNvbnZlcnRlZC5XaXJlcykge1xuICAgIHJldHVybiBjb252ZXJ0ZWQ7XG4gIH1cbn1cbiJdfQ==