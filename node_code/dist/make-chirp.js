"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
require("module-alias/register");
const fs_helpers_1 = require("@helpers/fs-helpers");
const log_helpers_1 = require("@helpers/log-helpers");
const i_repeater_structured_1 = require("@interfaces/i-repeater-structured");
const gps_distance_1 = __importDefault(require("gps-distance"));
const log = log_helpers_1.createLog("Make Chirp");
const chirp = {
    Location: null,
    Name: "",
    Frequency: null,
    Duplex: "",
    Offset: null,
    Tone: "",
    rToneFreq: null,
    cToneFreq: null,
    DtcsCode: null,
    DtcsRxCode: null,
    DtcsPolarity: "NN",
    Mode: "FM",
    TStep: 5,
    Comment: "",
};
const myPoint = [39.627071500, -104.893322500]; // 4982 S Ulster St
// const myPoint: Point = [39.742043, -104.991531]; // Denver
async function doIt(inFileName, outFileName) {
    const simplex = JSON.parse((await fs_helpers_1.readFileAsync("../data/frequencies.json")).toString())
        .map((map) => ({ Callsign: map.Name, Frequency: { Output: map.Frequency, Input: map.Frequency } }))
        .filter((filter) => /FM|Voice|Simplex/i.test(filter.Callsign))
        .filter((filter) => !(/Data|Digital|Packet/i.test(filter.Callsign)));
    const repeaters = JSON.parse((await fs_helpers_1.readFileAsync(inFileName)).toString());
    repeaters.forEach((each) => {
        each.Location.Distance = gps_distance_1.default([myPoint, [each.Location.Latitude, each.Location.Longitude]]);
    });
    repeaters.sort((a, b) => a.Location.Distance > b.Location.Distance ? 1 :
        a.Location.Distance < b.Location.Distance ? -1 : 0);
    const mapped = [
        ...simplex,
        ...repeaters
            .filter((filter) => (filter.Frequency.Output >= 144 && filter.Frequency.Output <= 148) ||
            (filter.Frequency.Output >= 222 && filter.Frequency.Output <= 225) ||
            (filter.Frequency.Output >= 420 && filter.Frequency.Output <= 450))
            .filter((filter) => !filter.Digital &&
            filter.Status !== i_repeater_structured_1.RepeaterStatus.OffAir &&
            filter.Use === i_repeater_structured_1.RepeaterUse.Open),
    ]
        .map((map, index) => ({ ...convertToRadio(map), Location: index }));
    const short = mapped
        .slice(0, 128)
        // .sort((a: IChirp, b: IChirp) => a.Frequency - b.Frequency)
        .map((map, index) => ({ ...map, Location: index }));
    const long = mapped
        .slice(0, 200)
        // .sort((a: IChirp, b: IChirp) => a.Frequency - b.Frequency)
        .map((map, index) => ({ ...map, Location: index }));
    await fs_helpers_1.writeToJsonAndCsv(outFileName + "-short", short);
    await fs_helpers_1.writeToJsonAndCsv(outFileName + "-long", long);
}
function convertToRadio(repeater) {
    let Name = "";
    if (repeater.Callsign) {
        Name += repeater.Callsign.trim();
    }
    if (repeater.Location && repeater.Location.Local) {
        Name += (Name ? " " : "") + repeater.Location.Local.trim();
    }
    if (repeater.Frequency && repeater.Frequency.Output) {
        Name += (Name ? " " : "") + repeater.Frequency.Output.toString().trim();
    }
    Name = Name.replace(/[^0-9.a-zA-Z \/]/g, "").trim();
    Name = Name.replace(/[ ]+/g, " ").trim();
    Name = Name.substr(0, 8).trim();
    const Frequency = repeater.Frequency.Output;
    let Offset = repeater.Frequency.Input - repeater.Frequency.Output;
    const Duplex = Offset > 0 ? "+" : Offset < 0 ? "-" : "";
    Offset = Math.abs(Math.round(Offset * 100) / 100);
    let rToneFreq = (repeater.SquelchTone && repeater.SquelchTone.Input);
    let cToneFreq = (repeater.SquelchTone && repeater.SquelchTone.Output);
    let DtcsCode = (repeater.DigitalTone && repeater.DigitalTone.Input);
    let DtcsRxCode = (repeater.DigitalTone && repeater.DigitalTone.Output);
    let Tone = "";
    const Mode = "FM";
    let Comment = `${repeater.StateID} ${repeater.ID} ${repeater.Location && repeater.Location.Distance && repeater.Location.Distance.toFixed(2)} ${repeater.Location && repeater.Location.State} ${repeater.Location && repeater.Location.County} ${repeater.Location && repeater.Location.Local} ${repeater.Callsign}`;
    Comment = Comment.replace(/undefined/g, " ").replace(/\s+/g, " ").trim();
    // `${item["ST/PR"] || ""} ${item.County || ""} ${item.Location || ""} ${item.Call || ""} ${item.Sponsor || ""} ${item.Affiliate || ""} ${item.Frequency} ${item.Use || ""} ${item["Op Status"] || ""} ${item.Comment || ""}`.replace(/\s+/g, " ");
    // Comment = Comment.trim().replace(",", "").substring(0, 31).trim();
    if (rToneFreq) {
        Tone = "Tone";
    }
    else if (DtcsCode) {
        Tone = "DTCS";
    }
    if (cToneFreq) {
        Tone = "TSQL";
    }
    else if (DtcsRxCode) {
        Tone = "DTCS";
    }
    if ((rToneFreq && cToneFreq && (rToneFreq !== cToneFreq))) {
        Tone = "Cross";
    }
    cToneFreq = cToneFreq || 88.5;
    rToneFreq = rToneFreq || 88.5;
    DtcsCode = DtcsCode || 23;
    DtcsRxCode = DtcsRxCode || 23;
    // log(chalk.green("Made Row"), row);
    return {
        ...chirp,
        // Location,
        Name,
        Frequency,
        Duplex,
        Offset,
        rToneFreq,
        cToneFreq,
        DtcsCode,
        DtcsRxCode,
        Tone,
        Mode,
        Comment,
    };
}
async function start() {
    // const coFiles = (await readdirAsync("./repeaters/data/CO/")).map((f) => `../data/CO/${f}`);
    // const utFiles = (await readdirAsync("./repeaters/data/UT/")).map((f) => `../data/UT/${f}`);
    // const nmFiles = (await readdirAsync("./repeaters/data/NM/")).map((f) => `../data/NM/${f}`);
    // const coGroups = (await readdirAsync("./repeaters/groups/CO/")).map((f) => `groups/CO/${f}`);
    // const utGroups = (await readdirAsync("./repeaters/groups/UT/")).map((f) => `groups/UT/${f}`);
    // const nmGroups = (await readdirAsync("./repeaters/groups/NM/")).map((f) => `groups/NM/${f}`);
    // const allFiles = [...coFiles, ...utFiles, ...nmFiles, ...coGroups, ...utGroups, ...nmGroups].filter((f) => /\.json$/.test(f)).map((f) => f.replace(".json", ""));
    // for (const file of allFiles) {
    //   await doIt(file);
    // }
    // await doIt("data/repeaters/groups/CO/Colorado Springs - Call.json", "data/repeaters/chirp/groups/CO/Colorado Springs - Call");
    // await doIt("data/repeaters/results/CO/Colorado Springs.json", "data/repeaters/chirp/CO/Colorado Springs");
    await doIt("../data/repeaters/converted/CO.json", "../data/repeaters/chirp/CO");
    // await doIt("../data/repeaters/groups/combined/CO - Call.json", "../data/repeaters/chirp/groups/CO - Call");
}
exports.default = start();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWFrZS1jaGlycC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uL3NyYy9tYWtlLWNoaXJwLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBQUEsaUNBQStCO0FBRS9CLG9EQUF1RTtBQUN2RSxzREFBaUQ7QUFFakQsNkVBQXFHO0FBRXJHLGdFQUFrRDtBQUVsRCxNQUFNLEdBQUcsR0FBNEIsdUJBQVMsQ0FBQyxZQUFZLENBQUMsQ0FBQztBQUU3RCxNQUFNLEtBQUssR0FBVztJQUNwQixRQUFRLEVBQUUsSUFBVztJQUNyQixJQUFJLEVBQUUsRUFBRTtJQUNSLFNBQVMsRUFBRSxJQUFXO0lBQ3RCLE1BQU0sRUFBRSxFQUFFO0lBQ1YsTUFBTSxFQUFFLElBQVc7SUFDbkIsSUFBSSxFQUFFLEVBQUU7SUFDUixTQUFTLEVBQUUsSUFBVztJQUN0QixTQUFTLEVBQUUsSUFBVztJQUN0QixRQUFRLEVBQUUsSUFBVztJQUNyQixVQUFVLEVBQUUsSUFBVztJQUN2QixZQUFZLEVBQUUsSUFBSTtJQUNsQixJQUFJLEVBQUUsSUFBSTtJQUNWLEtBQUssRUFBRSxDQUFDO0lBQ1IsT0FBTyxFQUFFLEVBQUU7Q0FDWixDQUFDO0FBRUYsTUFBTSxPQUFPLEdBQVUsQ0FBQyxZQUFZLEVBQUUsQ0FBQyxhQUFhLENBQUMsQ0FBQyxDQUFDLG1CQUFtQjtBQUMxRSw2REFBNkQ7QUFFN0QsS0FBSyxVQUFVLElBQUksQ0FBQyxVQUFrQixFQUFFLFdBQW1CO0lBQ3pELE1BQU0sT0FBTyxHQUNYLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQyxNQUFNLDBCQUFhLENBQUMsMEJBQTBCLENBQUMsQ0FBQyxDQUFDLFFBQVEsRUFBRSxDQUFDO1NBQ3JFLEdBQUcsQ0FBQyxDQUFDLEdBQXNCLEVBQUUsRUFBRSxDQUM5QixDQUFDLEVBQUUsUUFBUSxFQUFFLEdBQUcsQ0FBQyxJQUFJLEVBQUUsU0FBUyxFQUFFLEVBQUUsTUFBTSxFQUFFLEdBQUcsQ0FBQyxTQUFTLEVBQUUsS0FB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U0FBUztRQUNULFNBQVM7UUFDVCxRQUFRO1FBQ1IsVUFBVTtRQUNWLElBQUk7UUFDSixJQUFJO1FBQ0osT0FBTztLQUNSLENBQUM7QUFDSixDQUFDO0FBRUQsS0FBSyxVQUFVLEtBQUs7SUFDcEIsOEZBQThGO0lBQzlGLDhGQUE4RjtJQUM5Riw4RkFBOEY7SUFDOUYsZ0dBQWdHO0lBQ2hHLGdHQUFnRztJQUNoRyxnR0FBZ0c7SUFDaEcsb0tBQW9LO0lBQ3BLLGlDQUFpQztJQUNqQyxzQkFBc0I7SUFDdEIsSUFBSTtJQUVKLGlJQUFpSTtJQUNqSSw2R0FBNkc7SUFDM0csTUFBTSxJQUFJLENBQUMscUNBQXFDLEVBQUUsNEJBQTRCLENBQUMsQ0FBQztJQUNoRiw4R0FBOEc7QUFDaEgsQ0FBQztBQUVELGtCQUFlLEtBQUssRUFBRSxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFwibW9kdWxlLWFsaWFzL3JlZ2lzdGVyXCI7XHJcblxyXG5pbXBvcnQgeyByZWFkRmlsZUFzeW5jLCB3cml0ZVRvSnNvbkFuZENzdiB9IGZyb20gXCJAaGVscGVycy9mcy1oZWxwZXJzXCI7XHJcbmltcG9ydCB7IGNyZWF0ZUxvZyB9IGZyb20gXCJAaGVscGVycy9sb2ctaGVscGVyc1wiO1xyXG5pbXBvcnQgeyBDaGlycER1cGxleCwgQ2hpcnBNb2RlLCBDaGlycFRvbmUsIElDaGlycCB9IGZyb20gXCJAaW50ZXJmYWNlcy9pLWNoaXJwXCI7XHJcbmltcG9ydCB7IElSZXBlYXRlclN0cnVjdHVyZWQsIFJlcGVhdGVyU3RhdHVzLCBSZXBlYXRlclVzZSB9IGZyb20gXCJAaW50ZXJmYWNlcy9pLXJlcGVhdGVyLXN0cnVjdHVyZWRcIjtcclxuaW1wb3J0IHsgSVNpbXBsZXhGcmVxdWVuY3kgfSBmcm9tIFwiQGludGVyZmFjZXMvaS1zaW1wbGV4LWZyZXF1ZW5jeVwiO1xyXG5pbXBvcnQgZ3BzRGlzdGFuY2UsIHsgUG9pbnQgfSBmcm9tIFwiZ3BzLWRpc3RhbmNlXCI7XHJcblxyXG5jb25zdCBsb2c6ICguLi5tc2c6IGFueVtdKSA9PiB2b2lkID0gY3JlYXRlTG9nKFwiTWFrZSBDaGlycFwiKTtcclxuXHJcbmNvbnN0IGNoaXJwOiBJQ2hpcnAgPSB7XHJcbiAgTG9jYXRpb246IG51bGwgYXMgYW55LFxyXG4gIE5hbWU6IFwiXCIsXHJcbiAgRnJlcXVlbmN5OiBudWxsIGFzIGFueSxcclxuICBEdXBsZXg6IFwiXCIsXHJcbiAgT2Zmc2V0OiBudWxsIGFzIGFueSxcclxuICBUb25lOiBcIlwiLFxyXG4gIHJUb25lRnJlcTogbnVsbCBhcyBhbnksXHJcbiAgY1RvbmVGcmVxOiBudWxsIGFzIGFueSxcclxuICBEdGNzQ29kZTogbnVsbCBhcyBhbnksXHJcbiAgRHRjc1J4Q29kZTogbnVsbCBhcyBhbnksXHJcbiAgRHRjc1BvbGFyaXR5OiBcIk5OXCIsXHJcbiAgTW9kZTogXCJGTVwiLFxyXG4gIFRTdGVwOiA1LFxyXG4gIENvbW1lbnQ6IFwiXCIsXHJcbn07XHJcblxyXG5jb25zdCBteVBvaW50OiBQb2ludCA9IFszOS42MjcwNzE1MDAsIC0xMDQuODkzMzIyNTAwXTsgLy8gNDk4MiBTIFVsc3RlciBTdFxyXG4vLyBjb25zdCBteVBvaW50OiBQb2ludCA9IFszOS43NDIwNDMsIC0xMDQuOTkxNTMxXTsgLy8gRGVudmVyXHJcblxyXG5hc3luYyBmdW5jdGlvbiBkb0l0KGluRmlsZU5hbWU6IHN0cmluZywgb3V0RmlsZU5hbWU6IHN0cmluZyk6IFByb21pc2U8dm9pZD4ge1xyXG4gIGNvbnN0IHNpbXBsZXg6IElSZXBlYXRlclN0cnVjdHVyZWRbXSA9XHJcbiAgICBKU09OLnBhcnNlKChhd2FpdCByZWFkRmlsZUFzeW5jKFwiLi4vZGF0YS9mcmVxdWVuY2llcy5qc29uXCIpKS50b1N0cmluZygpKVxyXG4gICAgICAubWFwKChtYXA6IElTaW1wbGV4RnJlcXVlbmN5KSA9PlxyXG4gICAgICAgICh7IENhbGxzaWduOiBtYXAuTmFtZSwgRnJlcXVlbmN5OiB7IE91dHB1dDogbWFwLkZyZXF1ZW5jeSwgSW5wdXQ6IG1hcC5GcmVxdWVuY3kgfSB9KSlcclxuICAgICAgLmZpbHRlcigoZmlsdGVyOiBJUmVwZWF0ZXJTdHJ1Y3R1cmVkKSA9PiAvRk18Vm9pY2V8U2ltcGxleC9pLnRlc3QoZmlsdGVyLkNhbGxzaWduKSlcclxuICAgICAgLmZpbHRlcigoZmlsdGVyOiBJUmVwZWF0ZXJTdHJ1Y3R1cmVkKSA9PiAhKC9EYXRhfERpZ2l0YWx8UGFja2V0L2kudGVzdChmaWx0ZXIuQ2FsbHNpZ24pKSk7XHJcblxyXG4gIGNvbnN0IHJlcGVhdGVyczogSVJlcGVhdGVyU3RydWN0dXJlZFtdID1cclxuICAgIEpTT04ucGFyc2UoKGF3YWl0IHJlYWRGaWxlQXN5bmMoaW5GaWxlTmFtZSkpLnRvU3RyaW5nKCkpO1xyXG5cclxuICByZXBlYXRlcnMuZm9yRWFjaCgoZWFjaDogSVJlcGVhdGVyU3RydWN0dXJlZCkgPT4ge1xyXG4gICAgZWFjaC5Mb2NhdGlvbi5EaXN0YW5jZSA9IGdwc0Rpc3RhbmNlKFtteVBvaW50LCBbZWFjaC5Mb2NhdGlvbi5MYXRpdHVkZSwgZWFjaC5Mb2NhdGlvbi5Mb25naXR1ZGVdXSk7XHJcbiAgfSk7XHJcblxyXG4gIHJlcGVhdGVycy5zb3J0KChhOiBJUmVwZWF0ZXJTdHJ1Y3R1cmVkLCBiOiBJUmVwZWF0ZXJTdHJ1Y3R1cmVkKSA9PlxyXG4gICAgYS5Mb2NhdGlvbi5EaXN0YW5jZSEgPiBiLkxvY2F0aW9uLkRpc3RhbmNlISA/IDEgOlxyXG4gICAgICBhLkxvY2F0aW9uLkRpc3RhbmNlISA8IGIuTG9jYXRpb24uRGlzdGFuY2UhID8gLTEgOiAwKTtcclxuICBjb25zdCBtYXBwZWQ6IElDaGlycFtdID0gW1xyXG4gICAgLi4uc2ltcGxleCxcclxuICAgIC4uLnJlcGVhdGVyc1xyXG4gICAgICAuZmlsdGVyKChmaWx0ZXI6IElSZXBlYXRlclN0cnVjdHVyZWQpID0+XHJcbiAgICAgICAgKGZpbHRlci5GcmVxdWVuY3kuT3V0cHV0ID49IDE0NCAmJiBmaWx0ZXIuRnJlcXVlbmN5Lk91dHB1dCA8PSAxNDgpIHx8XHJcbiAgICAgICAgKGZpbHRlci5GcmVxdWVuY3kuT3V0cHV0ID49IDIyMiAmJiBmaWx0ZXIuRnJlcXVlbmN5Lk91dHB1dCA8PSAyMjUpIHx8XHJcbiAgICAgICAgKGZpbHRlci5GcmVxdWVuY3kuT3V0cHV0ID49IDQyMCAmJiBmaWx0ZXIuRnJlcXVlbmN5Lk91dHB1dCA8PSA0NTApKVxyXG4gICAgICAuZmlsdGVyKChmaWx0ZXI6IElSZXBlYXRlclN0cnVjdHVyZWQpID0+XHJcbiAgICAgICAgIWZpbHRlci5EaWdpdGFsICYmXHJcbiAgICAgICAgZmlsdGVyLlN0YXR1cyAhPT0gUmVwZWF0ZXJTdGF0dXMuT2ZmQWlyICYmXHJcbiAgICAgICAgZmlsdGVyLlVzZSA9PT0gUmVwZWF0ZXJVc2UuT3BlbiksXHJcbiAgXVxyXG4gICAgLm1hcCgobWFwOiBJUmVwZWF0ZXJTdHJ1Y3R1cmVkLCBpbmRleDogbnVtYmVyKTogSUNoaXJwID0+ICh7IC4uLmNvbnZlcnRUb1JhZGlvKG1hcCksIExvY2F0aW9uOiBpbmRleCB9KSk7XHJcblxyXG4gIGNvbnN0IHNob3J0OiBJQ2hpcnBbXSA9IG1hcHBlZFxyXG4gICAgLnNsaWNlKDAsIDEyOClcclxuICAgIC8vIC5zb3J0KChhOiBJQ2hpcnAsIGI6IElDaGlycCkgPT4gYS5GcmVxdWVuY3kgLSBiLkZyZXF1ZW5jeSlcclxuICAgIC5tYXAoKG1hcDogSUNoaXJwLCBpbmRleDogbnVtYmVyKTogSUNoaXJwID0+ICh7IC4uLm1hcCwgTG9jYXRpb246IGluZGV4IH0pKTtcclxuXHJcbiAgY29uc3QgbG9uZzogSUNoaXJwW10gPSBtYXBwZWRcclxuICAgIC5zbGljZSgwLCAyMDApXHJcbiAgICAvLyAuc29ydCgoYTogSUNoaXJwLCBiOiBJQ2hpcnApID0+IGEuRnJlcXVlbmN5IC0gYi5GcmVxdWVuY3kpXHJcbiAgICAubWFwKChtYXA6IElDaGlycCwgaW5kZXg6IG51bWJlcik6IElDaGlycCA9PiAoeyAuLi5tYXAsIExvY2F0aW9uOiBpbmRleCB9KSk7XHJcblxyXG4gIGF3YWl0IHdyaXRlVG9Kc29uQW5kQ3N2KG91dEZpbGVOYW1lICsgXCItc2hvcnRcIiwgc2hvcnQpO1xyXG4gIGF3YWl0IHdyaXRlVG9Kc29uQW5kQ3N2KG91dEZpbGVOYW1lICsgXCItbG9uZ1wiLCBsb25nKTtcclxufVxyXG5cclxuZnVuY3Rpb24gY29udmVydFRvUmFkaW8ocmVwZWF0ZXI6IElSZXBlYXRlclN0cnVjdHVyZWQpOiBJQ2hpcnAge1xyXG4gIGxldCBOYW1lOiBzdHJpbmcgPSBcIlwiO1xyXG5cclxuICBpZiAocmVwZWF0ZXIuQ2FsbHNpZ24pIHtcclxuICAgIE5hbWUgKz0gcmVwZWF0ZXIuQ2FsbHNpZ24udHJpbSgpO1xyXG4gIH1cclxuXHJcbiAgaWYgKHJlcGVhdGVyLkxvY2F0aW9uICYmIHJlcGVhdGVyLkxvY2F0aW9uLkxvY2FsKSB7XHJcbiAgICBOYW1lICs9IChOYW1lID8gXCIgXCIgOiBcIlwiKSArIHJlcGVhdGVyLkxvY2F0aW9uLkxvY2FsLnRyaW0oKTtcclxuICB9XHJcblxyXG4gIGlmIChyZXBlYXRlci5GcmVxdWVuY3kgJiYgcmVwZWF0ZXIuRnJlcXVlbmN5Lk91dHB1dCkge1xyXG4gICAgTmFtZSArPSAoTmFtZSA/IFwiIFwiIDogXCJcIikgKyByZXBlYXRlci5GcmVxdWVuY3kuT3V0cHV0LnRvU3RyaW5nKCkudHJpbSgpO1xyXG4gIH1cclxuXHJcbiAgTmFtZSA9IE5hbWUucmVwbGFjZSgvW14wLTkuYS16QS1aIFxcL10vZywgXCJcIikudHJpbSgpO1xyXG4gIE5hbWUgPSBOYW1lLnJlcGxhY2UoL1sgXSsvZywgXCIgXCIpLnRyaW0oKTtcclxuICBOYW1lID0gTmFtZS5zdWJzdHIoMCwgOCkudHJpbSgpO1xyXG5cclxuICBjb25zdCBGcmVxdWVuY3k6IG51bWJlciA9IHJlcGVhdGVyLkZyZXF1ZW5jeS5PdXRwdXQ7XHJcbiAgbGV0IE9mZnNldDogbnVtYmVyID0gcmVwZWF0ZXIuRnJlcXVlbmN5LklucHV0IC0gcmVwZWF0ZXIuRnJlcXVlbmN5Lk91dHB1dDtcclxuICBjb25zdCBEdXBsZXg6IENoaXJwRHVwbGV4ID0gT2Zmc2V0ID4gMCA/IFwiK1wiIDogT2Zmc2V0IDwgMCA/IFwiLVwiIDogXCJcIjtcclxuICBPZmZzZXQgPSBNYXRoLmFicyhNYXRoLnJvdW5kKE9mZnNldCAqIDEwMCkgLyAxMDApO1xyXG4gIGxldCByVG9uZUZyZXE6IG51bWJlciB8IHVuZGVmaW5lZCA9IChyZXBlYXRlci5TcXVlbGNoVG9uZSAmJiByZXBlYXRlci5TcXVlbGNoVG9uZS5JbnB1dCk7XHJcbiAgbGV0IGNUb25lRnJlcTogbnVtYmVyIHwgdW5kZWZpbmVkID0gKHJlcGVhdGVyLlNxdWVsY2hUb25lICYmIHJlcGVhdGVyLlNxdWVsY2hUb25lLk91dHB1dCk7XHJcbiAgbGV0IER0Y3NDb2RlOiBudW1iZXIgfCB1bmRlZmluZWQgPSAocmVwZWF0ZXIuRGlnaXRhbFRvbmUgJiYgcmVwZWF0ZXIuRGlnaXRhbFRvbmUuSW5wdXQpO1xyXG4gIGxldCBEdGNzUnhDb2RlOiBudW1iZXIgfCB1bmRlZmluZWQgPSAocmVwZWF0ZXIuRGlnaXRhbFRvbmUgJiYgcmVwZWF0ZXIuRGlnaXRhbFRvbmUuT3V0cHV0KTtcclxuICBsZXQgVG9uZTogQ2hpcnBUb25lID0gXCJcIjtcclxuICBjb25zdCBNb2RlOiBDaGlycE1vZGUgPSBcIkZNXCI7XHJcbiAgbGV0IENvbW1lbnQ6IHN0cmluZyA9IGAke3JlcGVhdGVyLlN0YXRlSUR9ICR7cmVwZWF0ZXIuSUR9ICR7cmVwZWF0ZXIuTG9jYXRpb24gJiYgcmVwZWF0ZXIuTG9jYXRpb24uRGlzdGFuY2UgJiYgcmVwZWF0ZXIuTG9jYXRpb24uRGlzdGFuY2UudG9GaXhlZCgyKX0gJHtyZXBlYXRlci5Mb2NhdGlvbiAmJiByZXBlYXRlci5Mb2NhdGlvbi5TdGF0ZX0gJHtyZXBlYXRlci5Mb2NhdGlvbiAmJiByZXBlYXRlci5Mb2NhdGlvbi5Db3VudHl9ICR7cmVwZWF0ZXIuTG9jYXRpb24gJiYgcmVwZWF0ZXIuTG9jYXRpb24uTG9jYWx9ICR7cmVwZWF0ZXIuQ2FsbHNpZ259YDtcclxuICBDb21tZW50ID0gQ29tbWVudC5yZXBsYWNlKC91bmRlZmluZWQvZywgXCIgXCIpLnJlcGxhY2UoL1xccysvZywgXCIgXCIpLnRyaW0oKTtcclxuICAvLyBgJHtpdGVtW1wiU1QvUFJcIl0gfHwgXCJcIn0gJHtpdGVtLkNvdW50eSB8fCBcIlwifSAke2l0ZW0uTG9jYXRpb24gfHwgXCJcIn0gJHtpdGVtLkNhbGwgfHwgXCJcIn0gJHtpdGVtLlNwb25zb3IgfHwgXCJcIn0gJHtpdGVtLkFmZmlsaWF0ZSB8fCBcIlwifSAke2l0ZW0uRnJlcXVlbmN5fSAke2l0ZW0uVXNlIHx8IFwiXCJ9ICR7aXRlbVtcIk9wIFN0YXR1c1wiXSB8fCBcIlwifSAke2l0ZW0uQ29tbWVudCB8fCBcIlwifWAucmVwbGFjZSgvXFxzKy9nLCBcIiBcIik7XHJcbiAgLy8gQ29tbWVudCA9IENvbW1lbnQudHJpbSgpLnJlcGxhY2UoXCIsXCIsIFwiXCIpLnN1YnN0cmluZygwLCAzMSkudHJpbSgpO1xyXG5cclxuICBpZiAoclRvbmVGcmVxKSB7XHJcbiAgICBUb25lID0gXCJUb25lXCI7XHJcbiAgfSBlbHNlIGlmIChEdGNzQ29kZSkge1xyXG4gICAgVG9uZSA9IFwiRFRDU1wiO1xyXG4gIH1cclxuXHJcbiAgaWYgKGNUb25lRnJlcSkge1xyXG4gICAgVG9uZSA9IFwiVFNRTFwiO1xyXG4gIH0gZWxzZSBpZiAoRHRjc1J4Q29kZSkge1xyXG4gICAgVG9uZSA9IFwiRFRDU1wiO1xyXG4gIH1cclxuXHJcbiAgaWYgKChyVG9uZUZyZXEgJiYgY1RvbmVGcmVxICYmIChyVG9uZUZyZXEgIT09IGNUb25lRnJlcSkpKSB7XHJcbiAgICBUb25lID0gXCJDcm9zc1wiO1xyXG4gIH1cclxuXHJcbiAgY1RvbmVGcmVxID0gY1RvbmVGcmVxIHx8IDg4LjU7XHJcbiAgclRvbmVGcmVxID0gclRvbmVGcmVxIHx8IDg4LjU7XHJcbiAgRHRjc0NvZGUgPSBEdGNzQ29kZSB8fCAyMztcclxuICBEdGNzUnhDb2RlID0gRHRjc1J4Q29kZSB8fCAyMztcclxuXHJcbi8vIGxvZyhjaGFsay5ncmVlbihcIk1hZGUgUm93XCIpLCByb3cpO1xyXG4gIHJldHVybiB7XHJcbiAgICAuLi5jaGlycCxcclxuLy8gTG9jYXRpb24sXHJcbiAgICBOYW1lLFxyXG4gICAgRnJlcXVlbmN5LFxyXG4gICAgRHVwbGV4LFxyXG4gICAgT2Zmc2V0LFxyXG4gICAgclRvbmVGcmVxLFxyXG4gICAgY1RvbmVGcmVxLFxyXG4gICAgRHRjc0NvZGUsXHJcbiAgICBEdGNzUnhDb2RlLFxyXG4gICAgVG9uZSxcclxuICAgIE1vZGUsXHJcbiAgICBDb21tZW50LFxyXG4gIH07XHJcbn1cclxuXHJcbmFzeW5jIGZ1bmN0aW9uIHN0YXJ0KCk6IFByb21pc2U8dm9pZD4ge1xyXG4vLyBjb25zdCBjb0ZpbGVzID0gKGF3YWl0IHJlYWRkaXJBc3luYyhcIi4vcmVwZWF0ZXJzL2RhdGEvQ08vXCIpKS5tYXAoKGYpID0+IGAuLi9kYXRhL0NPLyR7Zn1gKTtcclxuLy8gY29uc3QgdXRGaWxlcyA9IChhd2FpdCByZWFkZGlyQXN5bmMoXCIuL3JlcGVhdGVycy9kYXRhL1VUL1wiKSkubWFwKChmKSA9PiBgLi4vZGF0YS9VVC8ke2Z9YCk7XHJcbi8vIGNvbnN0IG5tRmlsZXMgPSAoYXdhaXQgcmVhZGRpckFzeW5jKFwiLi9yZXBlYXRlcnMvZGF0YS9OTS9cIikpLm1hcCgoZikgPT4gYC4uL2RhdGEvTk0vJHtmfWApO1xyXG4vLyBjb25zdCBjb0dyb3VwcyA9IChhd2FpdCByZWFkZGlyQXN5bmMoXCIuL3JlcGVhdGVycy9ncm91cHMvQ08vXCIpKS5tYXAoKGYpID0+IGBncm91cHMvQ08vJHtmfWApO1xyXG4vLyBjb25zdCB1dEdyb3VwcyA9IChhd2FpdCByZWFkZGlyQXN5bmMoXCIuL3JlcGVhdGVycy9ncm91cHMvVVQvXCIpKS5tYXAoKGYpID0+IGBncm91cHMvVVQvJHtmfWApO1xyXG4vLyBjb25zdCBubUdyb3VwcyA9IChhd2FpdCByZWFkZGlyQXN5bmMoXCIuL3JlcGVhdGVycy9ncm91cHMvTk0vXCIpKS5tYXAoKGYpID0+IGBncm91cHMvTk0vJHtmfWApO1xyXG4vLyBjb25zdCBhbGxGaWxlcyA9IFsuLi5jb0ZpbGVzLCAuLi51dEZpbGVzLCAuLi5ubUZpbGVzLCAuLi5jb0dyb3VwcywgLi4udXRHcm91cHMsIC4uLm5tR3JvdXBzXS5maWx0ZXIoKGYpID0+IC9cXC5qc29uJC8udGVzdChmKSkubWFwKChmKSA9PiBmLnJlcGxhY2UoXCIuanNvblwiLCBcIlwiKSk7XHJcbi8vIGZvciAoY29uc3QgZmlsZSBvZiBhbGxGaWxlcykge1xyXG4vLyAgIGF3YWl0IGRvSXQoZmlsZSk7XHJcbi8vIH1cclxuXHJcbi8vIGF3YWl0IGRvSXQoXCJkYXRhL3JlcGVhdGVycy9ncm91cHMvQ08vQ29sb3JhZG8gU3ByaW5ncyAtIENhbGwuanNvblwiLCBcImRhdGEvcmVwZWF0ZXJzL2NoaXJwL2dyb3Vwcy9DTy9Db2xvcmFkbyBTcHJpbmdzIC0gQ2FsbFwiKTtcclxuLy8gYXdhaXQgZG9JdChcImRhdGEvcmVwZWF0ZXJzL3Jlc3VsdHMvQ08vQ29sb3JhZG8gU3ByaW5ncy5qc29uXCIsIFwiZGF0YS9yZXBlYXRlcnMvY2hpcnAvQ08vQ29sb3JhZG8gU3ByaW5nc1wiKTtcclxuICBhd2FpdCBkb0l0KFwiLi4vZGF0YS9yZXBlYXRlcnMvY29udmVydGVkL0NPLmpzb25cIiwgXCIuLi9kYXRhL3JlcGVhdGVycy9jaGlycC9DT1wiKTtcclxuICAvLyBhd2FpdCBkb0l0KFwiLi4vZGF0YS9yZXBlYXRlcnMvZ3JvdXBzL2NvbWJpbmVkL0NPIC0gQ2FsbC5qc29uXCIsIFwiLi4vZGF0YS9yZXBlYXRlcnMvY2hpcnAvZ3JvdXBzL0NPIC0gQ2FsbFwiKTtcclxufVxyXG5cclxuZXhwb3J0IGRlZmF1bHQgc3RhcnQoKTtcclxuIl19