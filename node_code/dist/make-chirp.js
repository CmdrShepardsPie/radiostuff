"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
require("module-alias/register");
const fs_helpers_1 = require("@helpers/fs-helpers");
const log_helpers_1 = require("@helpers/log-helpers");
const i_repeater_structured_1 = require("@interfaces/i-repeater-structured");
const gps_distance_1 = __importDefault(require("gps-distance"));
const log = log_helpers_1.createLog('Make Chirp');
const chirp = {
    Location: null,
    Name: '',
    Frequency: null,
    Duplex: '',
    Offset: null,
    Tone: '',
    rToneFreq: null,
    cToneFreq: null,
    DtcsCode: null,
    DtcsRxCode: null,
    DtcsPolarity: 'NN',
    Mode: 'FM',
    TStep: 5,
    Comment: '',
};
const myPoint = [39.627071500, -104.893322500]; // 4982 S Ulster St
async function doIt(inFileName, outFileName) {
    const simplex = JSON.parse((await fs_helpers_1.readFileAsync('data/frequencies.json')).toString())
        .map((map) => ({ Callsign: map.Name, Frequency: { Output: map.Frequency, Input: map.Frequency } }))
        .filter((filter) => /FM|Voice|Simplex/i.test(filter.Callsign))
        .filter((filter) => !(/Data|Digital|Packet/i.test(filter.Callsign)));
    const repeaters = JSON.parse((await fs_helpers_1.readFileAsync(inFileName)).toString());
    repeaters.forEach((each) => {
        each.Location.Distance = gps_distance_1.default([myPoint, [each.Location.Latitude, each.Location.Longitude]]);
    });
    repeaters.sort((a, b) => a.Location.Distance > b.Location.Distance ? 1 :
        a.Location.Distance < b.Location.Distance ? -1 : 0);
    const mapped = [
        ...simplex,
        ...repeaters
            .filter((filter) => (filter.Frequency.Output >= 144 && filter.Frequency.Output <= 148) ||
            (filter.Frequency.Output >= 222 && filter.Frequency.Output <= 225) ||
            (filter.Frequency.Output >= 420 && filter.Frequency.Output <= 450))
            .filter((filter) => !filter.Digital &&
            filter.Status !== i_repeater_structured_1.RepeaterStatus.OffAir &&
            filter.Use === i_repeater_structured_1.RepeaterUse.Open),
    ]
        .map((map, index) => ({ ...convertToRadio(map), Location: index }));
    const short = mapped
        .slice(0, 128)
        .sort((a, b) => a.Frequency - b.Frequency)
        .map((map, index) => ({ ...map, Location: index }));
    const long = mapped
        .slice(0, 200)
        .sort((a, b) => a.Frequency - b.Frequency)
        .map((map, index) => ({ ...map, Location: index }));
    await fs_helpers_1.writeToJsonAndCsv(outFileName + '-short', short);
    await fs_helpers_1.writeToJsonAndCsv(outFileName + '-long', long);
}
function convertToRadio(repeater) {
    let Name = '';
    if (repeater.Callsign) {
        Name += repeater.Callsign.trim();
    }
    if (repeater.Location && repeater.Location.Local) {
        Name += (Name ? ' ' : '') + repeater.Location.Local.trim();
    }
    if (repeater.Frequency && repeater.Frequency.Output) {
        Name += (Name ? ' ' : '') + repeater.Frequency.Output.toString().trim();
    }
    Name = Name.replace(/[^0-9.a-zA-Z \/]/g, '').trim();
    Name = Name.replace(/[ ]+/g, ' ').trim();
    Name = Name.substr(0, 8).trim();
    const Frequency = repeater.Frequency.Output;
    let Offset = repeater.Frequency.Input - repeater.Frequency.Output;
    const Duplex = Offset > 0 ? '+' : Offset < 0 ? '-' : '';
    Offset = Math.abs(Math.round(Offset * 100) / 100);
    let rToneFreq = (repeater.SquelchTone && repeater.SquelchTone.Input);
    let cToneFreq = (repeater.SquelchTone && repeater.SquelchTone.Output);
    let DtcsCode = (repeater.DigitalTone && repeater.DigitalTone.Input);
    let DtcsRxCode = (repeater.DigitalTone && repeater.DigitalTone.Output);
    let Tone = '';
    const Mode = 'FM';
    let Comment = `${repeater.StateID} ${repeater.ID} ${repeater.Location && repeater.Location.Distance && repeater.Location.Distance.toFixed(2)} ${repeater.Location && repeater.Location.State} ${repeater.Location && repeater.Location.County} ${repeater.Location && repeater.Location.Local} ${repeater.Callsign}`;
    Comment = Comment.replace(/undefined/g, ' ').replace(/\s+/g, ' ').trim();
    // `${item['ST/PR'] || ''} ${item.County || ''} ${item.Location || ''} ${item.Call || ''} ${item.Sponsor || ''} ${item.Affiliate || ''} ${item.Frequency} ${item.Use || ''} ${item['Op Status'] || ''} ${item.Comment || ''}`.replace(/\s+/g, ' ');
    // Comment = Comment.trim().replace(",", "").substring(0, 31).trim();
    if (rToneFreq) {
        Tone = 'Tone';
    }
    else if (DtcsCode) {
        Tone = 'DTCS';
    }
    if (cToneFreq) {
        Tone = 'TSQL';
    }
    else if (DtcsRxCode) {
        Tone = 'DTCS';
    }
    if ((rToneFreq && cToneFreq && (rToneFreq !== cToneFreq))) {
        Tone = 'Cross';
    }
    cToneFreq = cToneFreq || 88.5;
    rToneFreq = rToneFreq || 88.5;
    DtcsCode = DtcsCode || 23;
    DtcsRxCode = DtcsRxCode || 23;
    // log(chalk.green("Made Row"), row);
    return {
        ...chirp,
        // Location,
        Name,
        Frequency,
        Duplex,
        Offset,
        rToneFreq,
        cToneFreq,
        DtcsCode,
        DtcsRxCode,
        Tone,
        Mode,
        Comment,
    };
}
async function start() {
    // const coFiles = (await readdirAsync("./repeaters/data/CO/")).map((f) => `data/CO/${f}`);
    // const utFiles = (await readdirAsync("./repeaters/data/UT/")).map((f) => `data/UT/${f}`);
    // const nmFiles = (await readdirAsync("./repeaters/data/NM/")).map((f) => `data/NM/${f}`);
    // const coGroups = (await readdirAsync("./repeaters/groups/CO/")).map((f) => `groups/CO/${f}`);
    // const utGroups = (await readdirAsync("./repeaters/groups/UT/")).map((f) => `groups/UT/${f}`);
    // const nmGroups = (await readdirAsync("./repeaters/groups/NM/")).map((f) => `groups/NM/${f}`);
    // const allFiles = [...coFiles, ...utFiles, ...nmFiles, ...coGroups, ...utGroups, ...nmGroups].filter((f) => /\.json$/.test(f)).map((f) => f.replace(".json", ""));
    // for (const file of allFiles) {
    //   await doIt(file);
    // }
    // await doIt("data/repeaters/groups/CO/Colorado Springs - Call.json", "data/repeaters/chirp/groups/CO/Colorado Springs - Call");
    // await doIt("data/repeaters/results/CO/Colorado Springs.json", "data/repeaters/chirp/CO/Colorado Springs");
    await doIt('data/repeaters/converted/CO.json', 'data/repeaters/chirp/CO');
    // await doIt('data/repeaters/groups/combined/CO - Call.json', 'data/repeaters/chirp/groups/CO - Call');
}
exports.default = start();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWFrZS1jaGlycC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uL3NyYy9tYWtlLWNoaXJwLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBQUEsaUNBQStCO0FBRS9CLG9EQUF1RTtBQUN2RSxzREFBaUQ7QUFFakQsNkVBQXFHO0FBRXJHLGdFQUFrRDtBQUVsRCxNQUFNLEdBQUcsR0FBNEIsdUJBQVMsQ0FBQyxZQUFZLENBQUMsQ0FBQztBQUU3RCxNQUFNLEtBQUssR0FBVztJQUNwQixRQUFRLEVBQUUsSUFBVztJQUNyQixJQUFJLEVBQUUsRUFBRTtJQUNSLFNBQVMsRUFBRSxJQUFXO0lBQ3RCLE1BQU0sRUFBRSxFQUFFO0lBQ1YsTUFBTSxFQUFFLElBQVc7SUFDbkIsSUFBSSxFQUFFLEVBQUU7SUFDUixTQUFTLEVBQUUsSUFBVztJQUN0QixTQUFTLEVBQUUsSUFBVztJQUN0QixRQUFRLEVBQUUsSUFBVztJQUNyQixVQUFVLEVBQUUsSUFBVztJQUN2QixZQUFZLEVBQUUsSUFBSTtJQUNsQixJQUFJLEVBQUUsSUFBSTtJQUNWLEtBQUssRUFBRSxDQUFDO0lBQ1IsT0FBTyxFQUFFLEVBQUU7Q0FDWixDQUFDO0FBRUYsTUFBTSxPQUFPLEdBQVUsQ0FBQyxZQUFZLEVBQUUsQ0FBQyxhQUFhLENBQUMsQ0FBQyxDQUFDLG1CQUFtQjtBQUUxRSxLQUFLLFVBQVUsSUFBSSxDQUFDLFVBQWtCLEVBQUUsV0FBbUI7SUFDekQsTUFBTSxPQUFPLEdBQ1gsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLE1BQU0sMEJBQWEsQ0FBQyx1QkFBdUIsQ0FBQyxDQUFDLENBQUMsUUFBUSxFQUFFLENBQUM7U0FDbEUsR0FBRyxDQUFDLENBQUMsR0FBc0IsRUFBRSxFQUFFLENBQzlCLENBQUMsRUFBRSxRQUFRLEVBQUUsR0FBRyxDQUFDLElBQUksRUFBRSxTQUFTLEVBQUUsRUFBRSxNQUFNLEVBQUUsR0FBRyxDQUFDLFNBQVMsRUFBRSxLQUFLLEVBQUUsR0FBRyxD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QUksRUFBRSxDQUFDO0lBQzFCLFVBQVUsR0FBRyxVQUFVLElBQUksRUFBRSxDQUFDO0lBRWhDLHFDQUFxQztJQUNuQyxPQUFPO1FBQ0wsR0FBRyxLQUFLO1FBQ1osWUFBWTtRQUNSLElBQUk7UUFDSixTQUFTO1FBQ1QsTUFBTTtRQUNOLE1BQU07UUFDTixTQUFTO1FBQ1QsU0FBUztRQUNULFFBQVE7UUFDUixVQUFVO1FBQ1YsSUFBSTtRQUNKLElBQUk7UUFDSixPQUFPO0tBQ1IsQ0FBQztBQUNKLENBQUM7QUFFRCxLQUFLLFVBQVUsS0FBSztJQUNwQiwyRkFBMkY7SUFDM0YsMkZBQTJGO0lBQzNGLDJGQUEyRjtJQUMzRixnR0FBZ0c7SUFDaEcsZ0dBQWdHO0lBQ2hHLGdHQUFnRztJQUNoRyxvS0FBb0s7SUFDcEssaUNBQWlDO0lBQ2pDLHNCQUFzQjtJQUN0QixJQUFJO0lBRUosaUlBQWlJO0lBQ2pJLDZHQUE2RztJQUMzRyxNQUFNLElBQUksQ0FBQyxrQ0FBa0MsRUFBRSx5QkFBeUIsQ0FBQyxDQUFDO0lBQzFFLHdHQUF3RztBQUMxRyxDQUFDO0FBRUQsa0JBQWUsS0FBSyxFQUFFLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgJ21vZHVsZS1hbGlhcy9yZWdpc3Rlcic7XHJcblxyXG5pbXBvcnQgeyByZWFkRmlsZUFzeW5jLCB3cml0ZVRvSnNvbkFuZENzdiB9IGZyb20gJ0BoZWxwZXJzL2ZzLWhlbHBlcnMnO1xyXG5pbXBvcnQgeyBjcmVhdGVMb2cgfSBmcm9tICdAaGVscGVycy9sb2ctaGVscGVycyc7XHJcbmltcG9ydCB7IENoaXJwRHVwbGV4LCBDaGlycE1vZGUsIENoaXJwVG9uZSwgSUNoaXJwIH0gZnJvbSAnQGludGVyZmFjZXMvaS1jaGlycCc7XHJcbmltcG9ydCB7IElSZXBlYXRlclN0cnVjdHVyZWQsIFJlcGVhdGVyU3RhdHVzLCBSZXBlYXRlclVzZSB9IGZyb20gJ0BpbnRlcmZhY2VzL2ktcmVwZWF0ZXItc3RydWN0dXJlZCc7XHJcbmltcG9ydCB7IElTaW1wbGV4RnJlcXVlbmN5IH0gZnJvbSAnQGludGVyZmFjZXMvaS1zaW1wbGV4LWZyZXF1ZW5jeSc7XHJcbmltcG9ydCBncHNEaXN0YW5jZSwgeyBQb2ludCB9IGZyb20gJ2dwcy1kaXN0YW5jZSc7XHJcblxyXG5jb25zdCBsb2c6ICguLi5tc2c6IGFueVtdKSA9PiB2b2lkID0gY3JlYXRlTG9nKCdNYWtlIENoaXJwJyk7XHJcblxyXG5jb25zdCBjaGlycDogSUNoaXJwID0ge1xyXG4gIExvY2F0aW9uOiBudWxsIGFzIGFueSxcclxuICBOYW1lOiAnJyxcclxuICBGcmVxdWVuY3k6IG51bGwgYXMgYW55LFxyXG4gIER1cGxleDogJycsXHJcbiAgT2Zmc2V0OiBudWxsIGFzIGFueSxcclxuICBUb25lOiAnJyxcclxuICByVG9uZUZyZXE6IG51bGwgYXMgYW55LFxyXG4gIGNUb25lRnJlcTogbnVsbCBhcyBhbnksXHJcbiAgRHRjc0NvZGU6IG51bGwgYXMgYW55LFxyXG4gIER0Y3NSeENvZGU6IG51bGwgYXMgYW55LFxyXG4gIER0Y3NQb2xhcml0eTogJ05OJyxcclxuICBNb2RlOiAnRk0nLFxyXG4gIFRTdGVwOiA1LFxyXG4gIENvbW1lbnQ6ICcnLFxyXG59O1xyXG5cclxuY29uc3QgbXlQb2ludDogUG9pbnQgPSBbMzkuNjI3MDcxNTAwLCAtMTA0Ljg5MzMyMjUwMF07IC8vIDQ5ODIgUyBVbHN0ZXIgU3RcclxuXHJcbmFzeW5jIGZ1bmN0aW9uIGRvSXQoaW5GaWxlTmFtZTogc3RyaW5nLCBvdXRGaWxlTmFtZTogc3RyaW5nKTogUHJvbWlzZTx2b2lkPiB7XHJcbiAgY29uc3Qgc2ltcGxleDogSVJlcGVhdGVyU3RydWN0dXJlZFtdID1cclxuICAgIEpTT04ucGFyc2UoKGF3YWl0IHJlYWRGaWxlQXN5bmMoJ2RhdGEvZnJlcXVlbmNpZXMuanNvbicpKS50b1N0cmluZygpKVxyXG4gICAgICAubWFwKChtYXA6IElTaW1wbGV4RnJlcXVlbmN5KSA9PlxyXG4gICAgICAgICh7IENhbGxzaWduOiBtYXAuTmFtZSwgRnJlcXVlbmN5OiB7IE91dHB1dDogbWFwLkZyZXF1ZW5jeSwgSW5wdXQ6IG1hcC5GcmVxdWVuY3kgfSB9KSlcclxuICAgICAgLmZpbHRlcigoZmlsdGVyOiBJUmVwZWF0ZXJTdHJ1Y3R1cmVkKSA9PiAvRk18Vm9pY2V8U2ltcGxleC9pLnRlc3QoZmlsdGVyLkNhbGxzaWduKSlcclxuICAgICAgLmZpbHRlcigoZmlsdGVyOiBJUmVwZWF0ZXJTdHJ1Y3R1cmVkKSA9PiAhKC9EYXRhfERpZ2l0YWx8UGFja2V0L2kudGVzdChmaWx0ZXIuQ2FsbHNpZ24pKSk7XHJcblxyXG4gIGNvbnN0IHJlcGVhdGVyczogSVJlcGVhdGVyU3RydWN0dXJlZFtdID1cclxuICAgIEpTT04ucGFyc2UoKGF3YWl0IHJlYWRGaWxlQXN5bmMoaW5GaWxlTmFtZSkpLnRvU3RyaW5nKCkpO1xyXG5cclxuICByZXBlYXRlcnMuZm9yRWFjaCgoZWFjaDogSVJlcGVhdGVyU3RydWN0dXJlZCkgPT4ge1xyXG4gICAgZWFjaC5Mb2NhdGlvbi5EaXN0YW5jZSA9IGdwc0Rpc3RhbmNlKFtteVBvaW50LCBbZWFjaC5Mb2NhdGlvbi5MYXRpdHVkZSwgZWFjaC5Mb2NhdGlvbi5Mb25naXR1ZGVdXSk7XHJcbiAgfSk7XHJcblxyXG4gIHJlcGVhdGVycy5zb3J0KChhOiBJUmVwZWF0ZXJTdHJ1Y3R1cmVkLCBiOiBJUmVwZWF0ZXJTdHJ1Y3R1cmVkKSA9PlxyXG4gICAgYS5Mb2NhdGlvbi5EaXN0YW5jZSEgPiBiLkxvY2F0aW9uLkRpc3RhbmNlISA/IDEgOlxyXG4gICAgICBhLkxvY2F0aW9uLkRpc3RhbmNlISA8IGIuTG9jYXRpb24uRGlzdGFuY2UhID8gLTEgOiAwKTtcclxuICBjb25zdCBtYXBwZWQ6IElDaGlycFtdID0gW1xyXG4gICAgLi4uc2ltcGxleCxcclxuICAgIC4uLnJlcGVhdGVyc1xyXG4gICAgICAuZmlsdGVyKChmaWx0ZXI6IElSZXBlYXRlclN0cnVjdHVyZWQpID0+XHJcbiAgICAgICAgKGZpbHRlci5GcmVxdWVuY3kuT3V0cHV0ID49IDE0NCAmJiBmaWx0ZXIuRnJlcXVlbmN5Lk91dHB1dCA8PSAxNDgpIHx8XHJcbiAgICAgICAgKGZpbHRlci5GcmVxdWVuY3kuT3V0cHV0ID49IDIyMiAmJiBmaWx0ZXIuRnJlcXVlbmN5Lk91dHB1dCA8PSAyMjUpIHx8XHJcbiAgICAgICAgKGZpbHRlci5GcmVxdWVuY3kuT3V0cHV0ID49IDQyMCAmJiBmaWx0ZXIuRnJlcXVlbmN5Lk91dHB1dCA8PSA0NTApKVxyXG4gICAgICAuZmlsdGVyKChmaWx0ZXI6IElSZXBlYXRlclN0cnVjdHVyZWQpID0+XHJcbiAgICAgICAgIWZpbHRlci5EaWdpdGFsICYmXHJcbiAgICAgICAgZmlsdGVyLlN0YXR1cyAhPT0gUmVwZWF0ZXJTdGF0dXMuT2ZmQWlyICYmXHJcbiAgICAgICAgZmlsdGVyLlVzZSA9PT0gUmVwZWF0ZXJVc2UuT3BlbiksXHJcbiAgXVxyXG4gICAgLm1hcCgobWFwOiBJUmVwZWF0ZXJTdHJ1Y3R1cmVkLCBpbmRleDogbnVtYmVyKTogSUNoaXJwID0+ICh7IC4uLmNvbnZlcnRUb1JhZGlvKG1hcCksIExvY2F0aW9uOiBpbmRleCB9KSk7XHJcblxyXG4gIGNvbnN0IHNob3J0OiBJQ2hpcnBbXSA9IG1hcHBlZFxyXG4gICAgLnNsaWNlKDAsIDEyOClcclxuICAgIC5zb3J0KChhOiBJQ2hpcnAsIGI6IElDaGlycCkgPT4gYS5GcmVxdWVuY3kgLSBiLkZyZXF1ZW5jeSlcclxuICAgIC5tYXAoKG1hcDogSUNoaXJwLCBpbmRleDogbnVtYmVyKTogSUNoaXJwID0+ICh7IC4uLm1hcCwgTG9jYXRpb246IGluZGV4IH0pKTtcclxuXHJcbiAgY29uc3QgbG9uZzogSUNoaXJwW10gPSBtYXBwZWRcclxuICAgIC5zbGljZSgwLCAyMDApXHJcbiAgICAuc29ydCgoYTogSUNoaXJwLCBiOiBJQ2hpcnApID0+IGEuRnJlcXVlbmN5IC0gYi5GcmVxdWVuY3kpXHJcbiAgICAubWFwKChtYXA6IElDaGlycCwgaW5kZXg6IG51bWJlcik6IElDaGlycCA9PiAoeyAuLi5tYXAsIExvY2F0aW9uOiBpbmRleCB9KSk7XHJcblxyXG4gIGF3YWl0IHdyaXRlVG9Kc29uQW5kQ3N2KG91dEZpbGVOYW1lICsgJy1zaG9ydCcsIHNob3J0KTtcclxuICBhd2FpdCB3cml0ZVRvSnNvbkFuZENzdihvdXRGaWxlTmFtZSArICctbG9uZycsIGxvbmcpO1xyXG59XHJcblxyXG5mdW5jdGlvbiBjb252ZXJ0VG9SYWRpbyhyZXBlYXRlcjogSVJlcGVhdGVyU3RydWN0dXJlZCk6IElDaGlycCB7XHJcbiAgbGV0IE5hbWU6IHN0cmluZyA9ICcnO1xyXG5cclxuICBpZiAocmVwZWF0ZXIuQ2FsbHNpZ24pIHtcclxuICAgIE5hbWUgKz0gcmVwZWF0ZXIuQ2FsbHNpZ24udHJpbSgpO1xyXG4gIH1cclxuXHJcbiAgaWYgKHJlcGVhdGVyLkxvY2F0aW9uICYmIHJlcGVhdGVyLkxvY2F0aW9uLkxvY2FsKSB7XHJcbiAgICBOYW1lICs9IChOYW1lID8gJyAnIDogJycpICsgcmVwZWF0ZXIuTG9jYXRpb24uTG9jYWwudHJpbSgpO1xyXG4gIH1cclxuXHJcbiAgaWYgKHJlcGVhdGVyLkZyZXF1ZW5jeSAmJiByZXBlYXRlci5GcmVxdWVuY3kuT3V0cHV0KSB7XHJcbiAgICBOYW1lICs9IChOYW1lID8gJyAnIDogJycpICsgcmVwZWF0ZXIuRnJlcXVlbmN5Lk91dHB1dC50b1N0cmluZygpLnRyaW0oKTtcclxuICB9XHJcblxyXG4gIE5hbWUgPSBOYW1lLnJlcGxhY2UoL1teMC05LmEtekEtWiBcXC9dL2csICcnKS50cmltKCk7XHJcbiAgTmFtZSA9IE5hbWUucmVwbGFjZSgvWyBdKy9nLCAnICcpLnRyaW0oKTtcclxuICBOYW1lID0gTmFtZS5zdWJzdHIoMCwgOCkudHJpbSgpO1xyXG5cclxuICBjb25zdCBGcmVxdWVuY3k6IG51bWJlciA9IHJlcGVhdGVyLkZyZXF1ZW5jeS5PdXRwdXQ7XHJcbiAgbGV0IE9mZnNldDogbnVtYmVyID0gcmVwZWF0ZXIuRnJlcXVlbmN5LklucHV0IC0gcmVwZWF0ZXIuRnJlcXVlbmN5Lk91dHB1dDtcclxuICBjb25zdCBEdXBsZXg6IENoaXJwRHVwbGV4ID0gT2Zmc2V0ID4gMCA/ICcrJyA6IE9mZnNldCA8IDAgPyAnLScgOiAnJztcclxuICBPZmZzZXQgPSBNYXRoLmFicyhNYXRoLnJvdW5kKE9mZnNldCAqIDEwMCkgLyAxMDApO1xyXG4gIGxldCByVG9uZUZyZXE6IG51bWJlciB8IHVuZGVmaW5lZCA9IChyZXBlYXRlci5TcXVlbGNoVG9uZSAmJiByZXBlYXRlci5TcXVlbGNoVG9uZS5JbnB1dCk7XHJcbiAgbGV0IGNUb25lRnJlcTogbnVtYmVyIHwgdW5kZWZpbmVkID0gKHJlcGVhdGVyLlNxdWVsY2hUb25lICYmIHJlcGVhdGVyLlNxdWVsY2hUb25lLk91dHB1dCk7XHJcbiAgbGV0IER0Y3NDb2RlOiBudW1iZXIgfCB1bmRlZmluZWQgPSAocmVwZWF0ZXIuRGlnaXRhbFRvbmUgJiYgcmVwZWF0ZXIuRGlnaXRhbFRvbmUuSW5wdXQpO1xyXG4gIGxldCBEdGNzUnhDb2RlOiBudW1iZXIgfCB1bmRlZmluZWQgPSAocmVwZWF0ZXIuRGlnaXRhbFRvbmUgJiYgcmVwZWF0ZXIuRGlnaXRhbFRvbmUuT3V0cHV0KTtcclxuICBsZXQgVG9uZTogQ2hpcnBUb25lID0gJyc7XHJcbiAgY29uc3QgTW9kZTogQ2hpcnBNb2RlID0gJ0ZNJztcclxuICBsZXQgQ29tbWVudDogc3RyaW5nID0gYCR7cmVwZWF0ZXIuU3RhdGVJRH0gJHtyZXBlYXRlci5JRH0gJHtyZXBlYXRlci5Mb2NhdGlvbiAmJiByZXBlYXRlci5Mb2NhdGlvbi5EaXN0YW5jZSAmJiByZXBlYXRlci5Mb2NhdGlvbi5EaXN0YW5jZS50b0ZpeGVkKDIpfSAke3JlcGVhdGVyLkxvY2F0aW9uICYmIHJlcGVhdGVyLkxvY2F0aW9uLlN0YXRlfSAke3JlcGVhdGVyLkxvY2F0aW9uICYmIHJlcGVhdGVyLkxvY2F0aW9uLkNvdW50eX0gJHtyZXBlYXRlci5Mb2NhdGlvbiAmJiByZXBlYXRlci5Mb2NhdGlvbi5Mb2NhbH0gJHtyZXBlYXRlci5DYWxsc2lnbn1gO1xyXG4gIENvbW1lbnQgPSBDb21tZW50LnJlcGxhY2UoL3VuZGVmaW5lZC9nLCAnICcpLnJlcGxhY2UoL1xccysvZywgJyAnKS50cmltKCk7XHJcbiAgLy8gYCR7aXRlbVsnU1QvUFInXSB8fCAnJ30gJHtpdGVtLkNvdW50eSB8fCAnJ30gJHtpdGVtLkxvY2F0aW9uIHx8ICcnfSAke2l0ZW0uQ2FsbCB8fCAnJ30gJHtpdGVtLlNwb25zb3IgfHwgJyd9ICR7aXRlbS5BZmZpbGlhdGUgfHwgJyd9ICR7aXRlbS5GcmVxdWVuY3l9ICR7aXRlbS5Vc2UgfHwgJyd9ICR7aXRlbVsnT3AgU3RhdHVzJ10gfHwgJyd9ICR7aXRlbS5Db21tZW50IHx8ICcnfWAucmVwbGFjZSgvXFxzKy9nLCAnICcpO1xyXG4gIC8vIENvbW1lbnQgPSBDb21tZW50LnRyaW0oKS5yZXBsYWNlKFwiLFwiLCBcIlwiKS5zdWJzdHJpbmcoMCwgMzEpLnRyaW0oKTtcclxuXHJcbiAgaWYgKHJUb25lRnJlcSkge1xyXG4gICAgVG9uZSA9ICdUb25lJztcclxuICB9IGVsc2UgaWYgKER0Y3NDb2RlKSB7XHJcbiAgICBUb25lID0gJ0RUQ1MnO1xyXG4gIH1cclxuXHJcbiAgaWYgKGNUb25lRnJlcSkge1xyXG4gICAgVG9uZSA9ICdUU1FMJztcclxuICB9IGVsc2UgaWYgKER0Y3NSeENvZGUpIHtcclxuICAgIFRvbmUgPSAnRFRDUyc7XHJcbiAgfVxyXG5cclxuICBpZiAoKHJUb25lRnJlcSAmJiBjVG9uZUZyZXEgJiYgKHJUb25lRnJlcSAhPT0gY1RvbmVGcmVxKSkpIHtcclxuICAgIFRvbmUgPSAnQ3Jvc3MnO1xyXG4gIH1cclxuXHJcbiAgY1RvbmVGcmVxID0gY1RvbmVGcmVxIHx8IDg4LjU7XHJcbiAgclRvbmVGcmVxID0gclRvbmVGcmVxIHx8IDg4LjU7XHJcbiAgRHRjc0NvZGUgPSBEdGNzQ29kZSB8fCAyMztcclxuICBEdGNzUnhDb2RlID0gRHRjc1J4Q29kZSB8fCAyMztcclxuXHJcbi8vIGxvZyhjaGFsay5ncmVlbihcIk1hZGUgUm93XCIpLCByb3cpO1xyXG4gIHJldHVybiB7XHJcbiAgICAuLi5jaGlycCxcclxuLy8gTG9jYXRpb24sXHJcbiAgICBOYW1lLFxyXG4gICAgRnJlcXVlbmN5LFxyXG4gICAgRHVwbGV4LFxyXG4gICAgT2Zmc2V0LFxyXG4gICAgclRvbmVGcmVxLFxyXG4gICAgY1RvbmVGcmVxLFxyXG4gICAgRHRjc0NvZGUsXHJcbiAgICBEdGNzUnhDb2RlLFxyXG4gICAgVG9uZSxcclxuICAgIE1vZGUsXHJcbiAgICBDb21tZW50LFxyXG4gIH07XHJcbn1cclxuXHJcbmFzeW5jIGZ1bmN0aW9uIHN0YXJ0KCk6IFByb21pc2U8dm9pZD4ge1xyXG4vLyBjb25zdCBjb0ZpbGVzID0gKGF3YWl0IHJlYWRkaXJBc3luYyhcIi4vcmVwZWF0ZXJzL2RhdGEvQ08vXCIpKS5tYXAoKGYpID0+IGBkYXRhL0NPLyR7Zn1gKTtcclxuLy8gY29uc3QgdXRGaWxlcyA9IChhd2FpdCByZWFkZGlyQXN5bmMoXCIuL3JlcGVhdGVycy9kYXRhL1VUL1wiKSkubWFwKChmKSA9PiBgZGF0YS9VVC8ke2Z9YCk7XHJcbi8vIGNvbnN0IG5tRmlsZXMgPSAoYXdhaXQgcmVhZGRpckFzeW5jKFwiLi9yZXBlYXRlcnMvZGF0YS9OTS9cIikpLm1hcCgoZikgPT4gYGRhdGEvTk0vJHtmfWApO1xyXG4vLyBjb25zdCBjb0dyb3VwcyA9IChhd2FpdCByZWFkZGlyQXN5bmMoXCIuL3JlcGVhdGVycy9ncm91cHMvQ08vXCIpKS5tYXAoKGYpID0+IGBncm91cHMvQ08vJHtmfWApO1xyXG4vLyBjb25zdCB1dEdyb3VwcyA9IChhd2FpdCByZWFkZGlyQXN5bmMoXCIuL3JlcGVhdGVycy9ncm91cHMvVVQvXCIpKS5tYXAoKGYpID0+IGBncm91cHMvVVQvJHtmfWApO1xyXG4vLyBjb25zdCBubUdyb3VwcyA9IChhd2FpdCByZWFkZGlyQXN5bmMoXCIuL3JlcGVhdGVycy9ncm91cHMvTk0vXCIpKS5tYXAoKGYpID0+IGBncm91cHMvTk0vJHtmfWApO1xyXG4vLyBjb25zdCBhbGxGaWxlcyA9IFsuLi5jb0ZpbGVzLCAuLi51dEZpbGVzLCAuLi5ubUZpbGVzLCAuLi5jb0dyb3VwcywgLi4udXRHcm91cHMsIC4uLm5tR3JvdXBzXS5maWx0ZXIoKGYpID0+IC9cXC5qc29uJC8udGVzdChmKSkubWFwKChmKSA9PiBmLnJlcGxhY2UoXCIuanNvblwiLCBcIlwiKSk7XHJcbi8vIGZvciAoY29uc3QgZmlsZSBvZiBhbGxGaWxlcykge1xyXG4vLyAgIGF3YWl0IGRvSXQoZmlsZSk7XHJcbi8vIH1cclxuXHJcbi8vIGF3YWl0IGRvSXQoXCJkYXRhL3JlcGVhdGVycy9ncm91cHMvQ08vQ29sb3JhZG8gU3ByaW5ncyAtIENhbGwuanNvblwiLCBcImRhdGEvcmVwZWF0ZXJzL2NoaXJwL2dyb3Vwcy9DTy9Db2xvcmFkbyBTcHJpbmdzIC0gQ2FsbFwiKTtcclxuLy8gYXdhaXQgZG9JdChcImRhdGEvcmVwZWF0ZXJzL3Jlc3VsdHMvQ08vQ29sb3JhZG8gU3ByaW5ncy5qc29uXCIsIFwiZGF0YS9yZXBlYXRlcnMvY2hpcnAvQ08vQ29sb3JhZG8gU3ByaW5nc1wiKTtcclxuICBhd2FpdCBkb0l0KCdkYXRhL3JlcGVhdGVycy9jb252ZXJ0ZWQvQ08uanNvbicsICdkYXRhL3JlcGVhdGVycy9jaGlycC9DTycpO1xyXG4gIC8vIGF3YWl0IGRvSXQoJ2RhdGEvcmVwZWF0ZXJzL2dyb3Vwcy9jb21iaW5lZC9DTyAtIENhbGwuanNvbicsICdkYXRhL3JlcGVhdGVycy9jaGlycC9ncm91cHMvQ08gLSBDYWxsJyk7XHJcbn1cclxuXHJcbmV4cG9ydCBkZWZhdWx0IHN0YXJ0KCk7XHJcbiJdfQ==