"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
require("module-alias/register");
const fs_helpers_1 = require("@helpers/fs-helpers");
const log_helpers_1 = require("@helpers/log-helpers");
const i_repeater_structured_1 = require("@interfaces/i-repeater-structured");
const gps_distance_1 = __importDefault(require("gps-distance"));
const log = log_helpers_1.createLog('Make Chirp');
const chirp = {
    Location: null,
    Name: '',
    Frequency: null,
    Duplex: '',
    Offset: null,
    Tone: '',
    rToneFreq: null,
    cToneFreq: null,
    DtcsCode: null,
    DtcsRxCode: null,
    DtcsPolarity: 'NN',
    Mode: 'FM',
    TStep: 5,
    Comment: '',
};
const myPoint = [39.627071500, -104.893322500]; // 4982 S Ulster St
// const myPoint: Point = [39.742043, -104.991531]; // Denver
async function doIt(inFileName, outFileName) {
    const simplex = JSON.parse((await fs_helpers_1.readFileAsync('../data/frequencies.json')).toString())
        .map((map) => ({ Callsign: map.Name, Frequency: { Output: map.Frequency, Input: map.Frequency } }))
        .filter((filter) => /FM|Voice|Simplex/i.test(filter.Callsign))
        .filter((filter) => !(/Data|Digital|Packet/i.test(filter.Callsign)));
    const repeaters = JSON.parse((await fs_helpers_1.readFileAsync(inFileName)).toString());
    repeaters.forEach((each) => {
        each.Location.Distance = gps_distance_1.default([myPoint, [each.Location.Latitude, each.Location.Longitude]]);
    });
    repeaters.sort((a, b) => a.Location.Distance > b.Location.Distance ? 1 :
        a.Location.Distance < b.Location.Distance ? -1 : 0);
    const mapped = [
        ...simplex,
        ...repeaters
            .filter((filter) => (filter.Frequency.Output >= 144 && filter.Frequency.Output <= 148) ||
            (filter.Frequency.Output >= 222 && filter.Frequency.Output <= 225) ||
            (filter.Frequency.Output >= 420 && filter.Frequency.Output <= 450))
            .filter((filter) => !filter.Digital &&
            filter.Status !== i_repeater_structured_1.RepeaterStatus.OffAir &&
            filter.Use === i_repeater_structured_1.RepeaterUse.Open),
    ]
        .map((map, index) => ({ ...convertToRadio(map), Location: index }));
    const short = mapped
        .slice(0, 128)
        // .sort((a: IChirp, b: IChirp) => a.Frequency - b.Frequency)
        .map((map, index) => ({ ...map, Location: index }));
    const long = mapped
        .slice(0, 200)
        // .sort((a: IChirp, b: IChirp) => a.Frequency - b.Frequency)
        .map((map, index) => ({ ...map, Location: index }));
    await fs_helpers_1.writeToJsonAndCsv(outFileName + '-short', short);
    await fs_helpers_1.writeToJsonAndCsv(outFileName + '-long', long);
}
function convertToRadio(repeater) {
    let Name = '';
    if (repeater.Callsign) {
        Name += repeater.Callsign.trim();
    }
    if (repeater.Location && repeater.Location.Local) {
        Name += (Name ? ' ' : '') + repeater.Location.Local.trim();
    }
    if (repeater.Frequency && repeater.Frequency.Output) {
        Name += (Name ? ' ' : '') + repeater.Frequency.Output.toString().trim();
    }
    Name = Name.replace(/[^0-9.a-zA-Z \/]/g, '').trim();
    Name = Name.replace(/[ ]+/g, ' ').trim();
    Name = Name.substr(0, 8).trim();
    const Frequency = repeater.Frequency.Output;
    let Offset = repeater.Frequency.Input - repeater.Frequency.Output;
    const Duplex = Offset > 0 ? '+' : Offset < 0 ? '-' : '';
    Offset = Math.abs(Math.round(Offset * 100) / 100);
    let rToneFreq = (repeater.SquelchTone && repeater.SquelchTone.Input);
    let cToneFreq = (repeater.SquelchTone && repeater.SquelchTone.Output);
    let DtcsCode = (repeater.DigitalTone && repeater.DigitalTone.Input);
    let DtcsRxCode = (repeater.DigitalTone && repeater.DigitalTone.Output);
    let Tone = '';
    const Mode = 'FM';
    let Comment = `${repeater.StateID} ${repeater.ID} ${repeater.Location && repeater.Location.Distance && repeater.Location.Distance.toFixed(2)} ${repeater.Location && repeater.Location.State} ${repeater.Location && repeater.Location.County} ${repeater.Location && repeater.Location.Local} ${repeater.Callsign}`;
    Comment = Comment.replace(/undefined/g, ' ').replace(/\s+/g, ' ').trim();
    // `${item['ST/PR'] || ''} ${item.County || ''} ${item.Location || ''} ${item.Call || ''} ${item.Sponsor || ''} ${item.Affiliate || ''} ${item.Frequency} ${item.Use || ''} ${item['Op Status'] || ''} ${item.Comment || ''}`.replace(/\s+/g, ' ');
    // Comment = Comment.trim().replace(",", "").substring(0, 31).trim();
    if (rToneFreq) {
        Tone = 'Tone';
    }
    else if (DtcsCode) {
        Tone = 'DTCS';
    }
    if (cToneFreq) {
        Tone = 'TSQL';
    }
    else if (DtcsRxCode) {
        Tone = 'DTCS';
    }
    if ((rToneFreq && cToneFreq && (rToneFreq !== cToneFreq))) {
        Tone = 'Cross';
    }
    cToneFreq = cToneFreq || 88.5;
    rToneFreq = rToneFreq || 88.5;
    DtcsCode = DtcsCode || 23;
    DtcsRxCode = DtcsRxCode || 23;
    // log(chalk.green("Made Row"), row);
    return {
        ...chirp,
        // Location,
        Name,
        Frequency,
        Duplex,
        Offset,
        rToneFreq,
        cToneFreq,
        DtcsCode,
        DtcsRxCode,
        Tone,
        Mode,
        Comment,
    };
}
async function start() {
    // const coFiles = (await readdirAsync("./repeaters/data/CO/")).map((f) => `../data/CO/${f}`);
    // const utFiles = (await readdirAsync("./repeaters/data/UT/")).map((f) => `../data/UT/${f}`);
    // const nmFiles = (await readdirAsync("./repeaters/data/NM/")).map((f) => `../data/NM/${f}`);
    // const coGroups = (await readdirAsync("./repeaters/groups/CO/")).map((f) => `groups/CO/${f}`);
    // const utGroups = (await readdirAsync("./repeaters/groups/UT/")).map((f) => `groups/UT/${f}`);
    // const nmGroups = (await readdirAsync("./repeaters/groups/NM/")).map((f) => `groups/NM/${f}`);
    // const allFiles = [...coFiles, ...utFiles, ...nmFiles, ...coGroups, ...utGroups, ...nmGroups].filter((f) => /\.json$/.test(f)).map((f) => f.replace(".json", ""));
    // for (const file of allFiles) {
    //   await doIt(file);
    // }
    // await doIt("data/repeaters/groups/CO/Colorado Springs - Call.json", "data/repeaters/chirp/groups/CO/Colorado Springs - Call");
    // await doIt("data/repeaters/results/CO/Colorado Springs.json", "data/repeaters/chirp/CO/Colorado Springs");
    await doIt('../data/repeaters/converted/CO.json', '../data/repeaters/chirp/CO');
    // await doIt('../data/repeaters/groups/combined/CO - Call.json', '../data/repeaters/chirp/groups/CO - Call');
}
exports.default = start();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWFrZS1jaGlycC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uL3NyYy9tYWtlLWNoaXJwLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBQUEsaUNBQStCO0FBRS9CLG9EQUF1RTtBQUN2RSxzREFBaUQ7QUFFakQsNkVBQXFHO0FBRXJHLGdFQUFrRDtBQUVsRCxNQUFNLEdBQUcsR0FBNEIsdUJBQVMsQ0FBQyxZQUFZLENBQUMsQ0FBQztBQUU3RCxNQUFNLEtBQUssR0FBVztJQUNwQixRQUFRLEVBQUUsSUFBVztJQUNyQixJQUFJLEVBQUUsRUFBRTtJQUNSLFNBQVMsRUFBRSxJQUFXO0lBQ3RCLE1BQU0sRUFBRSxFQUFFO0lBQ1YsTUFBTSxFQUFFLElBQVc7SUFDbkIsSUFBSSxFQUFFLEVBQUU7SUFDUixTQUFTLEVBQUUsSUFBVztJQUN0QixTQUFTLEVBQUUsSUFBVztJQUN0QixRQUFRLEVBQUUsSUFBVztJQUNyQixVQUFVLEVBQUUsSUFBVztJQUN2QixZQUFZLEVBQUUsSUFBSTtJQUNsQixJQUFJLEVBQUUsSUFBSTtJQUNWLEtBQUssRUFBRSxDQUFDO0lBQ1IsT0FBTyxFQUFFLEVBQUU7Q0FDWixDQUFDO0FBRUYsTUFBTSxPQUFPLEdBQVUsQ0FBQyxZQUFZLEVBQUUsQ0FBQyxhQUFhLENBQUMsQ0FBQyxDQUFDLG1CQUFtQjtBQUMxRSw2REFBNkQ7QUFFN0QsS0FBSyxVQUFVLElBQUksQ0FBQyxVQUFrQixFQUFFLFdBQW1CO0lBQ3pELE1BQU0sT0FBTyxHQUNYLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQyxNQUFNLDBCQUFhLENBQUMsMEJBQTBCLENBQUMsQ0FBQyxDQUFDLFFBQVEsRUFBRSxDQUFDO1NBQ3JFLEdBQUcsQ0FBQyxDQUFDLEdBQXNCLEVBQUUsRUFBRSxDQUM5QixDQUFDLEVBQUUsUUFBUSxFQUFFLEdBQUcsQ0FBQyxJQUFJLEVBQUUsU0FBUyxFQUFFLEVBQUUsTUFBTSxFQUFFLEdBQUcsQ0FBQyxTQUFTLEVBQUUsS0FB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U0FBUztRQUNULFNBQVM7UUFDVCxRQUFRO1FBQ1IsVUFBVTtRQUNWLElBQUk7UUFDSixJQUFJO1FBQ0osT0FBTztLQUNSLENBQUM7QUFDSixDQUFDO0FBRUQsS0FBSyxVQUFVLEtBQUs7SUFDcEIsOEZBQThGO0lBQzlGLDhGQUE4RjtJQUM5Riw4RkFBOEY7SUFDOUYsZ0dBQWdHO0lBQ2hHLGdHQUFnRztJQUNoRyxnR0FBZ0c7SUFDaEcsb0tBQW9LO0lBQ3BLLGlDQUFpQztJQUNqQyxzQkFBc0I7SUFDdEIsSUFBSTtJQUVKLGlJQUFpSTtJQUNqSSw2R0FBNkc7SUFDM0csTUFBTSxJQUFJLENBQUMscUNBQXFDLEVBQUUsNEJBQTRCLENBQUMsQ0FBQztJQUNoRiw4R0FBOEc7QUFDaEgsQ0FBQztBQUVELGtCQUFlLEtBQUssRUFBRSxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0ICdtb2R1bGUtYWxpYXMvcmVnaXN0ZXInO1xuXG5pbXBvcnQgeyByZWFkRmlsZUFzeW5jLCB3cml0ZVRvSnNvbkFuZENzdiB9IGZyb20gJ0BoZWxwZXJzL2ZzLWhlbHBlcnMnO1xuaW1wb3J0IHsgY3JlYXRlTG9nIH0gZnJvbSAnQGhlbHBlcnMvbG9nLWhlbHBlcnMnO1xuaW1wb3J0IHsgQ2hpcnBEdXBsZXgsIENoaXJwTW9kZSwgQ2hpcnBUb25lLCBJQ2hpcnAgfSBmcm9tICdAaW50ZXJmYWNlcy9pLWNoaXJwJztcbmltcG9ydCB7IElSZXBlYXRlclN0cnVjdHVyZWQsIFJlcGVhdGVyU3RhdHVzLCBSZXBlYXRlclVzZSB9IGZyb20gJ0BpbnRlcmZhY2VzL2ktcmVwZWF0ZXItc3RydWN0dXJlZCc7XG5pbXBvcnQgeyBJU2ltcGxleEZyZXF1ZW5jeSB9IGZyb20gJ0BpbnRlcmZhY2VzL2ktc2ltcGxleC1mcmVxdWVuY3knO1xuaW1wb3J0IGdwc0Rpc3RhbmNlLCB7IFBvaW50IH0gZnJvbSAnZ3BzLWRpc3RhbmNlJztcblxuY29uc3QgbG9nOiAoLi4ubXNnOiBhbnlbXSkgPT4gdm9pZCA9IGNyZWF0ZUxvZygnTWFrZSBDaGlycCcpO1xuXG5jb25zdCBjaGlycDogSUNoaXJwID0ge1xuICBMb2NhdGlvbjogbnVsbCBhcyBhbnksXG4gIE5hbWU6ICcnLFxuICBGcmVxdWVuY3k6IG51bGwgYXMgYW55LFxuICBEdXBsZXg6ICcnLFxuICBPZmZzZXQ6IG51bGwgYXMgYW55LFxuICBUb25lOiAnJyxcbiAgclRvbmVGcmVxOiBudWxsIGFzIGFueSxcbiAgY1RvbmVGcmVxOiBudWxsIGFzIGFueSxcbiAgRHRjc0NvZGU6IG51bGwgYXMgYW55LFxuICBEdGNzUnhDb2RlOiBudWxsIGFzIGFueSxcbiAgRHRjc1BvbGFyaXR5OiAnTk4nLFxuICBNb2RlOiAnRk0nLFxuICBUU3RlcDogNSxcbiAgQ29tbWVudDogJycsXG59O1xuXG5jb25zdCBteVBvaW50OiBQb2ludCA9IFszOS42MjcwNzE1MDAsIC0xMDQuODkzMzIyNTAwXTsgLy8gNDk4MiBTIFVsc3RlciBTdFxuLy8gY29uc3QgbXlQb2ludDogUG9pbnQgPSBbMzkuNzQyMDQzLCAtMTA0Ljk5MTUzMV07IC8vIERlbnZlclxuXG5hc3luYyBmdW5jdGlvbiBkb0l0KGluRmlsZU5hbWU6IHN0cmluZywgb3V0RmlsZU5hbWU6IHN0cmluZyk6IFByb21pc2U8dm9pZD4ge1xuICBjb25zdCBzaW1wbGV4OiBJUmVwZWF0ZXJTdHJ1Y3R1cmVkW10gPVxuICAgIEpTT04ucGFyc2UoKGF3YWl0IHJlYWRGaWxlQXN5bmMoJy4uL2RhdGEvZnJlcXVlbmNpZXMuanNvbicpKS50b1N0cmluZygpKVxuICAgICAgLm1hcCgobWFwOiBJU2ltcGxleEZyZXF1ZW5jeSkgPT5cbiAgICAgICAgKHsgQ2FsbHNpZ246IG1hcC5OYW1lLCBGcmVxdWVuY3k6IHsgT3V0cHV0OiBtYXAuRnJlcXVlbmN5LCBJbnB1dDogbWFwLkZyZXF1ZW5jeSB9IH0pKVxuICAgICAgLmZpbHRlcigoZmlsdGVyOiBJUmVwZWF0ZXJTdHJ1Y3R1cmVkKSA9PiAvRk18Vm9pY2V8U2ltcGxleC9pLnRlc3QoZmlsdGVyLkNhbGxzaWduKSlcbiAgICAgIC5maWx0ZXIoKGZpbHRlcjogSVJlcGVhdGVyU3RydWN0dXJlZCkgPT4gISgvRGF0YXxEaWdpdGFsfFBhY2tldC9pLnRlc3QoZmlsdGVyLkNhbGxzaWduKSkpO1xuXG4gIGNvbnN0IHJlcGVhdGVyczogSVJlcGVhdGVyU3RydWN0dXJlZFtdID1cbiAgICBKU09OLnBhcnNlKChhd2FpdCByZWFkRmlsZUFzeW5jKGluRmlsZU5hbWUpKS50b1N0cmluZygpKTtcblxuICByZXBlYXRlcnMuZm9yRWFjaCgoZWFjaDogSVJlcGVhdGVyU3RydWN0dXJlZCkgPT4ge1xuICAgIGVhY2guTG9jYXRpb24uRGlzdGFuY2UgPSBncHNEaXN0YW5jZShbbXlQb2ludCwgW2VhY2guTG9jYXRpb24uTGF0aXR1ZGUsIGVhY2guTG9jYXRpb24uTG9uZ2l0dWRlXV0pO1xuICB9KTtcblxuICByZXBlYXRlcnMuc29ydCgoYTogSVJlcGVhdGVyU3RydWN0dXJlZCwgYjogSVJlcGVhdGVyU3RydWN0dXJlZCkgPT5cbiAgICBhLkxvY2F0aW9uLkRpc3RhbmNlISA+IGIuTG9jYXRpb24uRGlzdGFuY2UhID8gMSA6XG4gICAgICBhLkxvY2F0aW9uLkRpc3RhbmNlISA8IGIuTG9jYXRpb24uRGlzdGFuY2UhID8gLTEgOiAwKTtcbiAgY29uc3QgbWFwcGVkOiBJQ2hpcnBbXSA9IFtcbiAgICAuLi5zaW1wbGV4LFxuICAgIC4uLnJlcGVhdGVyc1xuICAgICAgLmZpbHRlcigoZmlsdGVyOiBJUmVwZWF0ZXJTdHJ1Y3R1cmVkKSA9PlxuICAgICAgICAoZmlsdGVyLkZyZXF1ZW5jeS5PdXRwdXQgPj0gMTQ0ICYmIGZpbHRlci5GcmVxdWVuY3kuT3V0cHV0IDw9IDE0OCkgfHxcbiAgICAgICAgKGZpbHRlci5GcmVxdWVuY3kuT3V0cHV0ID49IDIyMiAmJiBmaWx0ZXIuRnJlcXVlbmN5Lk91dHB1dCA8PSAyMjUpIHx8XG4gICAgICAgIChmaWx0ZXIuRnJlcXVlbmN5Lk91dHB1dCA+PSA0MjAgJiYgZmlsdGVyLkZyZXF1ZW5jeS5PdXRwdXQgPD0gNDUwKSlcbiAgICAgIC5maWx0ZXIoKGZpbHRlcjogSVJlcGVhdGVyU3RydWN0dXJlZCkgPT5cbiAgICAgICAgIWZpbHRlci5EaWdpdGFsICYmXG4gICAgICAgIGZpbHRlci5TdGF0dXMgIT09IFJlcGVhdGVyU3RhdHVzLk9mZkFpciAmJlxuICAgICAgICBmaWx0ZXIuVXNlID09PSBSZXBlYXRlclVzZS5PcGVuKSxcbiAgXVxuICAgIC5tYXAoKG1hcDogSVJlcGVhdGVyU3RydWN0dXJlZCwgaW5kZXg6IG51bWJlcik6IElDaGlycCA9PiAoeyAuLi5jb252ZXJ0VG9SYWRpbyhtYXApLCBMb2NhdGlvbjogaW5kZXggfSkpO1xuXG4gIGNvbnN0IHNob3J0OiBJQ2hpcnBbXSA9IG1hcHBlZFxuICAgIC5zbGljZSgwLCAxMjgpXG4gICAgLy8gLnNvcnQoKGE6IElDaGlycCwgYjogSUNoaXJwKSA9PiBhLkZyZXF1ZW5jeSAtIGIuRnJlcXVlbmN5KVxuICAgIC5tYXAoKG1hcDogSUNoaXJwLCBpbmRleDogbnVtYmVyKTogSUNoaXJwID0+ICh7IC4uLm1hcCwgTG9jYXRpb246IGluZGV4IH0pKTtcblxuICBjb25zdCBsb25nOiBJQ2hpcnBbXSA9IG1hcHBlZFxuICAgIC5zbGljZSgwLCAyMDApXG4gICAgLy8gLnNvcnQoKGE6IElDaGlycCwgYjogSUNoaXJwKSA9PiBhLkZyZXF1ZW5jeSAtIGIuRnJlcXVlbmN5KVxuICAgIC5tYXAoKG1hcDogSUNoaXJwLCBpbmRleDogbnVtYmVyKTogSUNoaXJwID0+ICh7IC4uLm1hcCwgTG9jYXRpb246IGluZGV4IH0pKTtcblxuICBhd2FpdCB3cml0ZVRvSnNvbkFuZENzdihvdXRGaWxlTmFtZSArICctc2hvcnQnLCBzaG9ydCk7XG4gIGF3YWl0IHdyaXRlVG9Kc29uQW5kQ3N2KG91dEZpbGVOYW1lICsgJy1sb25nJywgbG9uZyk7XG59XG5cbmZ1bmN0aW9uIGNvbnZlcnRUb1JhZGlvKHJlcGVhdGVyOiBJUmVwZWF0ZXJTdHJ1Y3R1cmVkKTogSUNoaXJwIHtcbiAgbGV0IE5hbWU6IHN0cmluZyA9ICcnO1xuXG4gIGlmIChyZXBlYXRlci5DYWxsc2lnbikge1xuICAgIE5hbWUgKz0gcmVwZWF0ZXIuQ2FsbHNpZ24udHJpbSgpO1xuICB9XG5cbiAgaWYgKHJlcGVhdGVyLkxvY2F0aW9uICYmIHJlcGVhdGVyLkxvY2F0aW9uLkxvY2FsKSB7XG4gICAgTmFtZSArPSAoTmFtZSA/ICcgJyA6ICcnKSArIHJlcGVhdGVyLkxvY2F0aW9uLkxvY2FsLnRyaW0oKTtcbiAgfVxuXG4gIGlmIChyZXBlYXRlci5GcmVxdWVuY3kgJiYgcmVwZWF0ZXIuRnJlcXVlbmN5Lk91dHB1dCkge1xuICAgIE5hbWUgKz0gKE5hbWUgPyAnICcgOiAnJykgKyByZXBlYXRlci5GcmVxdWVuY3kuT3V0cHV0LnRvU3RyaW5nKCkudHJpbSgpO1xuICB9XG5cbiAgTmFtZSA9IE5hbWUucmVwbGFjZSgvW14wLTkuYS16QS1aIFxcL10vZywgJycpLnRyaW0oKTtcbiAgTmFtZSA9IE5hbWUucmVwbGFjZSgvWyBdKy9nLCAnICcpLnRyaW0oKTtcbiAgTmFtZSA9IE5hbWUuc3Vic3RyKDAsIDgpLnRyaW0oKTtcblxuICBjb25zdCBGcmVxdWVuY3k6IG51bWJlciA9IHJlcGVhdGVyLkZyZXF1ZW5jeS5PdXRwdXQ7XG4gIGxldCBPZmZzZXQ6IG51bWJlciA9IHJlcGVhdGVyLkZyZXF1ZW5jeS5JbnB1dCAtIHJlcGVhdGVyLkZyZXF1ZW5jeS5PdXRwdXQ7XG4gIGNvbnN0IER1cGxleDogQ2hpcnBEdXBsZXggPSBPZmZzZXQgPiAwID8gJysnIDogT2Zmc2V0IDwgMCA/ICctJyA6ICcnO1xuICBPZmZzZXQgPSBNYXRoLmFicyhNYXRoLnJvdW5kKE9mZnNldCAqIDEwMCkgLyAxMDApO1xuICBsZXQgclRvbmVGcmVxOiBudW1iZXIgfCB1bmRlZmluZWQgPSAocmVwZWF0ZXIuU3F1ZWxjaFRvbmUgJiYgcmVwZWF0ZXIuU3F1ZWxjaFRvbmUuSW5wdXQpO1xuICBsZXQgY1RvbmVGcmVxOiBudW1iZXIgfCB1bmRlZmluZWQgPSAocmVwZWF0ZXIuU3F1ZWxjaFRvbmUgJiYgcmVwZWF0ZXIuU3F1ZWxjaFRvbmUuT3V0cHV0KTtcbiAgbGV0IER0Y3NDb2RlOiBudW1iZXIgfCB1bmRlZmluZWQgPSAocmVwZWF0ZXIuRGlnaXRhbFRvbmUgJiYgcmVwZWF0ZXIuRGlnaXRhbFRvbmUuSW5wdXQpO1xuICBsZXQgRHRjc1J4Q29kZTogbnVtYmVyIHwgdW5kZWZpbmVkID0gKHJlcGVhdGVyLkRpZ2l0YWxUb25lICYmIHJlcGVhdGVyLkRpZ2l0YWxUb25lLk91dHB1dCk7XG4gIGxldCBUb25lOiBDaGlycFRvbmUgPSAnJztcbiAgY29uc3QgTW9kZTogQ2hpcnBNb2RlID0gJ0ZNJztcbiAgbGV0IENvbW1lbnQ6IHN0cmluZyA9IGAke3JlcGVhdGVyLlN0YXRlSUR9ICR7cmVwZWF0ZXIuSUR9ICR7cmVwZWF0ZXIuTG9jYXRpb24gJiYgcmVwZWF0ZXIuTG9jYXRpb24uRGlzdGFuY2UgJiYgcmVwZWF0ZXIuTG9jYXRpb24uRGlzdGFuY2UudG9GaXhlZCgyKX0gJHtyZXBlYXRlci5Mb2NhdGlvbiAmJiByZXBlYXRlci5Mb2NhdGlvbi5TdGF0ZX0gJHtyZXBlYXRlci5Mb2NhdGlvbiAmJiByZXBlYXRlci5Mb2NhdGlvbi5Db3VudHl9ICR7cmVwZWF0ZXIuTG9jYXRpb24gJiYgcmVwZWF0ZXIuTG9jYXRpb24uTG9jYWx9ICR7cmVwZWF0ZXIuQ2FsbHNpZ259YDtcbiAgQ29tbWVudCA9IENvbW1lbnQucmVwbGFjZSgvdW5kZWZpbmVkL2csICcgJykucmVwbGFjZSgvXFxzKy9nLCAnICcpLnRyaW0oKTtcbiAgLy8gYCR7aXRlbVsnU1QvUFInXSB8fCAnJ30gJHtpdGVtLkNvdW50eSB8fCAnJ30gJHtpdGVtLkxvY2F0aW9uIHx8ICcnfSAke2l0ZW0uQ2FsbCB8fCAnJ30gJHtpdGVtLlNwb25zb3IgfHwgJyd9ICR7aXRlbS5BZmZpbGlhdGUgfHwgJyd9ICR7aXRlbS5GcmVxdWVuY3l9ICR7aXRlbS5Vc2UgfHwgJyd9ICR7aXRlbVsnT3AgU3RhdHVzJ10gfHwgJyd9ICR7aXRlbS5Db21tZW50IHx8ICcnfWAucmVwbGFjZSgvXFxzKy9nLCAnICcpO1xuICAvLyBDb21tZW50ID0gQ29tbWVudC50cmltKCkucmVwbGFjZShcIixcIiwgXCJcIikuc3Vic3RyaW5nKDAsIDMxKS50cmltKCk7XG5cbiAgaWYgKHJUb25lRnJlcSkge1xuICAgIFRvbmUgPSAnVG9uZSc7XG4gIH0gZWxzZSBpZiAoRHRjc0NvZGUpIHtcbiAgICBUb25lID0gJ0RUQ1MnO1xuICB9XG5cbiAgaWYgKGNUb25lRnJlcSkge1xuICAgIFRvbmUgPSAnVFNRTCc7XG4gIH0gZWxzZSBpZiAoRHRjc1J4Q29kZSkge1xuICAgIFRvbmUgPSAnRFRDUyc7XG4gIH1cblxuICBpZiAoKHJUb25lRnJlcSAmJiBjVG9uZUZyZXEgJiYgKHJUb25lRnJlcSAhPT0gY1RvbmVGcmVxKSkpIHtcbiAgICBUb25lID0gJ0Nyb3NzJztcbiAgfVxuXG4gIGNUb25lRnJlcSA9IGNUb25lRnJlcSB8fCA4OC41O1xuICByVG9uZUZyZXEgPSByVG9uZUZyZXEgfHwgODguNTtcbiAgRHRjc0NvZGUgPSBEdGNzQ29kZSB8fCAyMztcbiAgRHRjc1J4Q29kZSA9IER0Y3NSeENvZGUgfHwgMjM7XG5cbi8vIGxvZyhjaGFsay5ncmVlbihcIk1hZGUgUm93XCIpLCByb3cpO1xuICByZXR1cm4ge1xuICAgIC4uLmNoaXJwLFxuLy8gTG9jYXRpb24sXG4gICAgTmFtZSxcbiAgICBGcmVxdWVuY3ksXG4gICAgRHVwbGV4LFxuICAgIE9mZnNldCxcbiAgICByVG9uZUZyZXEsXG4gICAgY1RvbmVGcmVxLFxuICAgIER0Y3NDb2RlLFxuICAgIER0Y3NSeENvZGUsXG4gICAgVG9uZSxcbiAgICBNb2RlLFxuICAgIENvbW1lbnQsXG4gIH07XG59XG5cbmFzeW5jIGZ1bmN0aW9uIHN0YXJ0KCk6IFByb21pc2U8dm9pZD4ge1xuLy8gY29uc3QgY29GaWxlcyA9IChhd2FpdCByZWFkZGlyQXN5bmMoXCIuL3JlcGVhdGVycy9kYXRhL0NPL1wiKSkubWFwKChmKSA9PiBgLi4vZGF0YS9DTy8ke2Z9YCk7XG4vLyBjb25zdCB1dEZpbGVzID0gKGF3YWl0IHJlYWRkaXJBc3luYyhcIi4vcmVwZWF0ZXJzL2RhdGEvVVQvXCIpKS5tYXAoKGYpID0+IGAuLi9kYXRhL1VULyR7Zn1gKTtcbi8vIGNvbnN0IG5tRmlsZXMgPSAoYXdhaXQgcmVhZGRpckFzeW5jKFwiLi9yZXBlYXRlcnMvZGF0YS9OTS9cIikpLm1hcCgoZikgPT4gYC4uL2RhdGEvTk0vJHtmfWApO1xuLy8gY29uc3QgY29Hcm91cHMgPSAoYXdhaXQgcmVhZGRpckFzeW5jKFwiLi9yZXBlYXRlcnMvZ3JvdXBzL0NPL1wiKSkubWFwKChmKSA9PiBgZ3JvdXBzL0NPLyR7Zn1gKTtcbi8vIGNvbnN0IHV0R3JvdXBzID0gKGF3YWl0IHJlYWRkaXJBc3luYyhcIi4vcmVwZWF0ZXJzL2dyb3Vwcy9VVC9cIikpLm1hcCgoZikgPT4gYGdyb3Vwcy9VVC8ke2Z9YCk7XG4vLyBjb25zdCBubUdyb3VwcyA9IChhd2FpdCByZWFkZGlyQXN5bmMoXCIuL3JlcGVhdGVycy9ncm91cHMvTk0vXCIpKS5tYXAoKGYpID0+IGBncm91cHMvTk0vJHtmfWApO1xuLy8gY29uc3QgYWxsRmlsZXMgPSBbLi4uY29GaWxlcywgLi4udXRGaWxlcywgLi4ubm1GaWxlcywgLi4uY29Hcm91cHMsIC4uLnV0R3JvdXBzLCAuLi5ubUdyb3Vwc10uZmlsdGVyKChmKSA9PiAvXFwuanNvbiQvLnRlc3QoZikpLm1hcCgoZikgPT4gZi5yZXBsYWNlKFwiLmpzb25cIiwgXCJcIikpO1xuLy8gZm9yIChjb25zdCBmaWxlIG9mIGFsbEZpbGVzKSB7XG4vLyAgIGF3YWl0IGRvSXQoZmlsZSk7XG4vLyB9XG5cbi8vIGF3YWl0IGRvSXQoXCJkYXRhL3JlcGVhdGVycy9ncm91cHMvQ08vQ29sb3JhZG8gU3ByaW5ncyAtIENhbGwuanNvblwiLCBcImRhdGEvcmVwZWF0ZXJzL2NoaXJwL2dyb3Vwcy9DTy9Db2xvcmFkbyBTcHJpbmdzIC0gQ2FsbFwiKTtcbi8vIGF3YWl0IGRvSXQoXCJkYXRhL3JlcGVhdGVycy9yZXN1bHRzL0NPL0NvbG9yYWRvIFNwcmluZ3MuanNvblwiLCBcImRhdGEvcmVwZWF0ZXJzL2NoaXJwL0NPL0NvbG9yYWRvIFNwcmluZ3NcIik7XG4gIGF3YWl0IGRvSXQoJy4uL2RhdGEvcmVwZWF0ZXJzL2NvbnZlcnRlZC9DTy5qc29uJywgJy4uL2RhdGEvcmVwZWF0ZXJzL2NoaXJwL0NPJyk7XG4gIC8vIGF3YWl0IGRvSXQoJy4uL2RhdGEvcmVwZWF0ZXJzL2dyb3Vwcy9jb21iaW5lZC9DTyAtIENhbGwuanNvbicsICcuLi9kYXRhL3JlcGVhdGVycy9jaGlycC9ncm91cHMvQ08gLSBDYWxsJyk7XG59XG5cbmV4cG9ydCBkZWZhdWx0IHN0YXJ0KCk7XG4iXX0=