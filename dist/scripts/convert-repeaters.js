(function (factory) {
    if (typeof module === "object" && typeof module.exports === "object") {
        var v = factory(require, exports);
        if (v !== undefined) module.exports = v;
    }
    else if (typeof define === "function" && define.amd) {
        define(["require", "exports", "module-alias/register", "@helpers/fs-helpers", "@helpers/log-helpers", "@interfaces/i-repeater-structured"], factory);
    }
})(function (require, exports) {
    "use strict";
    Object.defineProperty(exports, "__esModule", { value: true });
    require("module-alias/register");
    const fs_helpers_1 = require("@helpers/fs-helpers");
    const log_helpers_1 = require("@helpers/log-helpers");
    const i_repeater_structured_1 = require("@interfaces/i-repeater-structured");
    const log = log_helpers_1.createLog('Convert Repeaters');
    exports.default = (async () => {
        const raw = await fs_helpers_1.getAllFilesFromDirectory('data/repeaters/results/CO');
        log('Got', raw.length, 'files');
        const ids = [];
        const converted = raw
            .reduce((output, input, index) => {
            log('Got', input.length, 'repeaters from file', index + 1);
            return [...output, ...input.map(convertRepeater)];
        }, [])
            .filter((repeater) => {
            if (ids.includes(repeater.ID)) {
                return false;
            }
            else {
                ids.push(repeater.ID);
                return true;
            }
        });
        log('Converted', converted.length, 'repeaters');
        await fs_helpers_1.writeToJsonAndCsv('data/repeaters/converted/CO', converted);
    })();
    function convertRepeater(raw) {
        return {
            ID: convertNumber(raw.ID),
            StateID: convertNumber(raw.state_id),
            Callsign: raw.Call,
            Location: { Latitude: raw.Latitude, Longitude: raw.Longitude, County: raw.County, State: raw['ST/PR'], Local: raw.Location },
            Use: convertRepeaterUse(raw.Use),
            Status: convertRepeaterStatus(raw['Op Status']),
            Frequency: { Input: convertNumber(raw.Uplink) || (raw.Downlink + raw.Offset), Output: raw.Downlink },
            SquelchTone: convertRepeaterSquelchTone(raw['Uplink Tone'], raw['Downlink Tone']),
            DigitalTone: convertRepeaterDigitalTone(raw['Uplink Tone'], raw['Downlink Tone']),
            Digital: convertRepeaterDigitalData(raw),
            VOIP: convertRepeaterVOIP(raw),
        };
    }
    function convertRepeaterUse(raw) {
        switch (raw.toLowerCase()) {
            case 'open':
                return i_repeater_structured_1.RepeaterUse.Open;
            case 'closed':
                return i_repeater_structured_1.RepeaterUse.Closed;
            case 'private':
                return i_repeater_structured_1.RepeaterUse.Private;
            default:
                return i_repeater_structured_1.RepeaterUse.Other;
        }
    }
    function convertRepeaterStatus(raw) {
        if (!raw) {
            return i_repeater_structured_1.RepeaterStatus.Other;
        }
        switch (raw.toLowerCase()) {
            case 'on-air':
                return i_repeater_structured_1.RepeaterStatus.OnAir;
            case 'off-air':
                return i_repeater_structured_1.RepeaterStatus.OffAir;
            case 'testing':
                return i_repeater_structured_1.RepeaterStatus.Testing;
            case 'unknown':
                return i_repeater_structured_1.RepeaterStatus.Unknown;
            default:
                return i_repeater_structured_1.RepeaterStatus.Other;
        }
    }
    function convertRepeaterSquelchTone(rawInput, rawOutput) {
        if (!rawInput && !rawOutput) {
            return undefined;
        }
        const converted = {
            Input: convertNumber(rawInput),
            Output: convertNumber(rawOutput),
        };
        if (converted.Input || converted.Output) {
            return converted;
        }
        return undefined;
    }
    function convertRepeaterDigitalTone(rawInput, rawOutput) {
        if (!rawInput && !rawOutput) {
            return undefined;
        }
        const digitalFilter = /^D(\d+)$/;
        const converted = {
            Input: typeof rawInput === 'string' ? convertNumber(rawInput, digitalFilter) : undefined,
            Output: typeof rawOutput === 'string' ? convertNumber(rawOutput, digitalFilter) : undefined,
        };
        if (converted.Input || converted.Output) {
            return converted;
        }
        return undefined;
    }
    function convertNumber(input, numberFilter = /^([+-]?\d+\.?\d*)$/) {
        if (typeof input === 'number' && !isNaN(input)) {
            return input;
        }
        else if (typeof input === 'number' && isNaN(input)) {
            return undefined;
        }
        else if (typeof input === 'string' && numberFilter.test(input)) {
            const match = input.match(numberFilter);
            if (match && match[1]) {
                const converted = parseFloat(match[1]);
                return !isNaN(converted) ? converted : undefined;
            }
        }
    }
    function convertRepeaterDigitalData(raw) {
        const converted = {
            // TODO: ATV?: boolean;
            DMR: (raw.DGTL.includes('D') || raw['DMR Enabled']) ? { ColorCode: convertNumber(raw['Color Code']), ID: convertNumber(raw['DMR ID']) } : undefined,
            P25: (raw.DGTL.includes('P') || raw['P-25 Digital Enabled']) ? { NAC: convertNumber(raw.NAC) } : undefined,
            DStar: (raw.DGTL.includes('S') || raw['D-STAR Enabled']) ? { Node: raw.Node } : undefined,
            YSF: (raw.DGTL.includes('Y') || raw['YSF Digital Enabled']) ? {
                GroupID: {
                    Input: typeof raw['DG-ID'] === 'number' ? raw['DG-ID'] : typeof raw['DG-ID'] === 'string' ? raw['DG-ID'].split('/')[0].trim() : undefined,
                    Output: typeof raw['DG-ID'] === 'number' ? raw['DG-ID'] : typeof raw['DG-ID'] === 'string' ? raw['DG-ID'].split('/')[1].trim() : undefined,
                },
            } : undefined,
        };
        if (converted.DMR || converted.P25 || converted.DStar || converted.YSF) {
            return converted;
        }
    }
    function convertRepeaterVOIP(raw) {
        const converted = {
            AllStar: (raw.VOIP.includes('A') || raw.AllStar) ? { NodeID: convertNumber(raw.AllStar) } : undefined,
            EchoLink: (raw.VOIP.includes('E') || raw.EchoLink) ? {
                NodeID: raw.EchoLink,
            } : undefined,
            IRLP: (raw.VOIP.includes('I') || raw.IRLP) ? { NodeID: convertNumber(raw.IRLP) } : undefined,
            Wires: (raw.VOIP.includes('W') || raw['WIRES-X']) ? { ID: convertNumber(raw['WIRES-X']) } : undefined,
        };
        if (converted.AllStar || converted.EchoLink || converted.IRLP || converted.Wires) {
            return converted;
        }
    }
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29udmVydC1yZXBlYXRlcnMuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvc2NyaXB0cy9jb252ZXJ0LXJlcGVhdGVycy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7OztJQUFBLGlDQUErQjtJQUUvQixvREFBa0Y7SUFDbEYsc0RBQWlEO0lBRWpELDZFQU0yQztJQUUzQyxNQUFNLEdBQUcsR0FBNEIsdUJBQVMsQ0FBQyxtQkFBbUIsQ0FBQyxDQUFDO0lBRXBFLGtCQUFlLENBQUMsS0FBSyxJQUFtQixFQUFFO1FBQ3hDLE1BQU0sR0FBRyxHQUFxQixNQUFNLHFDQUF3QixDQUFDLDJCQUEyQixDQUFDLENBQUM7UUFDMUYsR0FBRyxDQUFDLEtBQUssRUFBRSxHQUFHLENBQUMsTUFBTSxFQUFFLE9BQU8sQ0FBQyxDQUFDO1FBQ2hDLE1BQU0sR0FBRyxHQUFhLEVBQUUsQ0FBQztRQUN6QixNQUFNLFNBQVMsR0FBMEIsR0FBRzthQUN6QyxNQUFNLENBQUMsQ0FBQyxNQUE2QixFQUFFLEtBQXFCLEVBQUUsS0FBYSxFQUFFLEVBQUU7WUFDOUUsR0FBRyxDQUFDLEtBQUssRUFBRSxLQUFLLENBQUMsTUFBTSxFQUFFLHFCQUFxQixFQUFFLEtBQUssR0FBRyxDQUFDLENBQUMsQ0FBQztZQUMzRCxPQUFPLENBQUMsR0FBRyxNQUFNLEVBQUUsR0FBRyxLQUFLLENBQUMsR0FBRyxDQUFDLGVBQWUsQ0FBQyxDQUFDLENBQUM7UUFDcEQsQ0FBQyxFQUFFLEVBQUUsQ0FBQzthQUNMLE1BQU0sQ0FBQyxDQUFDLFFBQTZCLEVBQUUsRUFBRTtZQUN4QyxJQUFJLEdBQUcsQ0FBQyxRQUFRLENBQUMsUUFBUSxDQUFDLEVBQUUsQ0FBQyxFQUFFO2dCQUM3QixPQUFPLEtBQUssQ0FBQzthQUNkO2lCQUFNO2dCQUNMLEdBQUcsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLEVBQUUsQ0FBQyxDQUFDO2dCQUN0QixPQUFPLElBQUksQ0FBQzthQUNi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QVEsQ0FBQyxHQUFHLENBQUMsSUFBSSxHQUFHLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUUsTUFBTSxFQUFFLGFBQWEsQ0FBQyxHQUFHLENBQUMsT0FBTyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsU0FBUztZQUNyRyxRQUFRLEVBQUUsQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxHQUFHLENBQUMsSUFBSSxHQUFHLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQyxDQUFDO2dCQUNuRCxNQUFNLEVBQUUsR0FBRyxDQUFDLFFBQVE7YUFDckIsQ0FBQyxDQUFDLENBQUMsU0FBUztZQUNiLElBQUksRUFBRSxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLEdBQUcsQ0FBQyxJQUFJLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRSxNQUFNLEVBQUUsYUFBYSxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxTQUFTO1lBQzVGLEtBQUssRUFBRSxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLEdBQUcsQ0FBQyxJQUFJLEdBQUcsQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFLEVBQUUsRUFBRSxhQUFhLENBQUMsR0FBRyxDQUFDLFNBQVMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsU0FBUztTQUN0RyxDQUFDO1FBQ0YsSUFBSSxTQUFTLENBQUMsT0FBTyxJQUFJLFNBQVMsQ0FBQyxRQUFRLElBQUksU0FBUyxDQUFDLElBQUksSUFBSSxTQUFTLENBQUMsS0FBSyxFQUFFO1lBQ2hGLE9BQU8sU0FBUyxDQUFDO1NBQ2xCO0lBQ0gsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAnbW9kdWxlLWFsaWFzL3JlZ2lzdGVyJztcclxuXHJcbmltcG9ydCB7IGdldEFsbEZpbGVzRnJvbURpcmVjdG9yeSwgd3JpdGVUb0pzb25BbmRDc3YgfSBmcm9tICdAaGVscGVycy9mcy1oZWxwZXJzJztcclxuaW1wb3J0IHsgY3JlYXRlTG9nIH0gZnJvbSAnQGhlbHBlcnMvbG9nLWhlbHBlcnMnO1xyXG5pbXBvcnQgeyBJUmVwZWF0ZXJSYXcgfSBmcm9tICdAaW50ZXJmYWNlcy9pLXJlcGVhdGVyLXJhdyc7XHJcbmltcG9ydCB7XHJcbiAgSVJlcGVhdGVyRGlnaXRhbE1vZGVzLFxyXG4gIElSZXBlYXRlclN0cnVjdHVyZWQsXHJcbiAgSVJlcGVhdGVyVk9JUE1vZGVzLFxyXG4gIFJlcGVhdGVyU3RhdHVzLFxyXG4gIFJlcGVhdGVyVXNlLFxyXG59IGZyb20gJ0BpbnRlcmZhY2VzL2ktcmVwZWF0ZXItc3RydWN0dXJlZCc7XHJcblxyXG5jb25zdCBsb2c6ICguLi5tc2c6IGFueVtdKSA9PiB2b2lkID0gY3JlYXRlTG9nKCdDb252ZXJ0IFJlcGVhdGVycycpO1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgKGFzeW5jICgpOiBQcm9taXNlPHZvaWQ+ID0+IHtcclxuICBjb25zdCByYXc6IElSZXBlYXRlclJhd1tdW10gPSBhd2FpdCBnZXRBbGxGaWxlc0Zyb21EaXJlY3RvcnkoJ2RhdGEvcmVwZWF0ZXJzL3Jlc3VsdHMvQ08nKTtcclxuICBsb2coJ0dvdCcsIHJhdy5sZW5ndGgsICdmaWxlcycpO1xyXG4gIGNvbnN0IGlkczogbnVtYmVyW10gPSBbXTtcclxuICBjb25zdCBjb252ZXJ0ZWQ6IElSZXBlYXRlclN0cnVjdHVyZWRbXSA9IHJhd1xyXG4gICAgLnJlZHVjZSgob3V0cHV0OiBJUmVwZWF0ZXJTdHJ1Y3R1cmVkW10sIGlucHV0OiBJUmVwZWF0ZXJSYXdbXSwgaW5kZXg6IG51bWJlcikgPT4ge1xyXG4gICAgICBsb2coJ0dvdCcsIGlucHV0Lmxlbmd0aCwgJ3JlcGVhdGVycyBmcm9tIGZpbGUnLCBpbmRleCArIDEpO1xyXG4gICAgICByZXR1cm4gWy4uLm91dHB1dCwgLi4uaW5wdXQubWFwKGNvbnZlcnRSZXBlYXRlcildO1xyXG4gICAgfSwgW10pXHJcbiAgICAuZmlsdGVyKChyZXBlYXRlcjogSVJlcGVhdGVyU3RydWN0dXJlZCkgPT4ge1xyXG4gICAgICBpZiAoaWRzLmluY2x1ZGVzKHJlcGVhdGVyLklEKSkge1xyXG4gICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICBpZHMucHVzaChyZXBlYXRlci5JRCk7XHJcbiAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIGxvZygnQ29udmVydGVkJywgY29udmVydGVkLmxlbmd0aCwgJ3JlcGVhdGVycycpO1xyXG4gIGF3YWl0IHdyaXRlVG9Kc29uQW5kQ3N2KCdkYXRhL3JlcGVhdGVycy9jb252ZXJ0ZWQvQ08nLCBjb252ZXJ0ZWQpO1xyXG59KSgpO1xyXG5cclxuZnVuY3Rpb24gY29udmVydFJlcGVhdGVyKHJhdzogSVJlcGVhdGVyUmF3KTogSVJlcGVhdGVyU3RydWN0dXJlZCB7XHJcbiAgcmV0dXJuIHtcclxuICAgIElEOiBjb252ZXJ0TnVtYmVyKHJhdy5JRCkgYXMgbnVtYmVyLFxyXG4gICAgU3RhdGVJRDogY29udmVydE51bWJlcihyYXcuc3RhdGVfaWQpIGFzIG51bWJlcixcclxuICAgIENhbGxzaWduOiByYXcuQ2FsbCxcclxuICAgIExvY2F0aW9uOiB7IExhdGl0dWRlOiByYXcuTGF0aXR1ZGUsIExvbmdpdHVkZTogcmF3LkxvbmdpdHVkZSwgQ291bnR5OiByYXcuQ291bnR5LCBTdGF0ZTogcmF3WydTVC9QUiddLCBMb2NhbDogcmF3LkxvY2F0aW9uIH0sXHJcbiAgICBVc2U6IGNvbnZlcnRSZXBlYXRlclVzZShyYXcuVXNlKSxcclxuICAgIFN0YXR1czogY29udmVydFJlcGVhdGVyU3RhdHVzKHJhd1snT3AgU3RhdHVzJ10pLFxyXG4gICAgRnJlcXVlbmN5OiB7IElucHV0OiBjb252ZXJ0TnVtYmVyKHJhdy5VcGxpbmspIHx8IChyYXcuRG93bmxpbmsgKyByYXcuT2Zmc2V0KSwgT3V0cHV0OiByYXcuRG93bmxpbmsgfSxcclxuICAgIFNxdWVsY2hUb25lOiBjb252ZXJ0UmVwZWF0ZXJTcXVlbGNoVG9uZShyYXdbJ1VwbGluayBUb25lJ10sIHJhd1snRG93bmxpbmsgVG9uZSddKSxcclxuICAgIERpZ2l0YWxUb25lOiBjb252ZXJ0UmVwZWF0ZXJEaWdpdGFsVG9uZShyYXdbJ1VwbGluayBUb25lJ10sIHJhd1snRG93bmxpbmsgVG9uZSddKSxcclxuICAgIERpZ2l0YWw6IGNvbnZlcnRSZXBlYXRlckRpZ2l0YWxEYXRhKHJhdyksXHJcbiAgICBWT0lQOiBjb252ZXJ0UmVwZWF0ZXJWT0lQKHJhdyksXHJcbiAgfTtcclxufVxyXG5cclxuZnVuY3Rpb24gY29udmVydFJlcGVhdGVyVXNlKHJhdzogc3RyaW5nKTogUmVwZWF0ZXJVc2Uge1xyXG4gIHN3aXRjaCAocmF3LnRvTG93ZXJDYXNlKCkpIHtcclxuICAgIGNhc2UgJ29wZW4nOlxyXG4gICAgICByZXR1cm4gUmVwZWF0ZXJVc2UuT3BlbjtcclxuICAgIGNhc2UgJ2Nsb3NlZCc6XHJcbiAgICAgIHJldHVybiBSZXBlYXRlclVzZS5DbG9zZWQ7XHJcbiAgICBjYXNlICdwcml2YXRlJzpcclxuICAgICAgcmV0dXJuIFJlcGVhdGVyVXNlLlByaXZhdGU7XHJcbiAgICBkZWZhdWx0OlxyXG4gICAgICByZXR1cm4gUmVwZWF0ZXJVc2UuT3RoZXI7XHJcbiAgfVxyXG59XHJcblxyXG5mdW5jdGlvbiBjb252ZXJ0UmVwZWF0ZXJTdGF0dXMocmF3OiBzdHJpbmcgfCB1bmRlZmluZWQpOiBSZXBlYXRlclN0YXR1cyB7XHJcbiAgaWYgKCFyYXcpIHtcclxuICAgIHJldHVybiBSZXBlYXRlclN0YXR1cy5PdGhlcjtcclxuICB9XHJcbiAgc3dpdGNoIChyYXcudG9Mb3dlckNhc2UoKSkge1xyXG4gICAgY2FzZSAnb24tYWlyJzpcclxuICAgICAgcmV0dXJuIFJlcGVhdGVyU3RhdHVzLk9uQWlyO1xyXG4gICAgY2FzZSAnb2ZmLWFpcic6XHJcbiAgICAgIHJldHVybiBSZXBlYXRlclN0YXR1cy5PZmZBaXI7XHJcbiAgICBjYXNlICd0ZXN0aW5nJzpcclxuICAgICAgcmV0dXJuIFJlcGVhdGVyU3RhdHVzLlRlc3Rpbmc7XHJcbiAgICBjYXNlICd1bmtub3duJzpcclxuICAgICAgcmV0dXJuIFJlcGVhdGVyU3RhdHVzLlVua25vd247XHJcbiAgICBkZWZhdWx0OlxyXG4gICAgICByZXR1cm4gUmVwZWF0ZXJTdGF0dXMuT3RoZXI7XHJcbiAgfVxyXG59XHJcblxyXG5mdW5jdGlvbiBjb252ZXJ0UmVwZWF0ZXJTcXVlbGNoVG9uZShyYXdJbnB1dDogc3RyaW5nIHwgbnVtYmVyIHwgdW5kZWZpbmVkLCByYXdPdXRwdXQ6IHN0cmluZyB8IG51bWJlciB8IHVuZGVmaW5lZCk6IHsgSW5wdXQ/OiBudW1iZXI7IE91dHB1dD86IG51bWJlciB9IHwgdW5kZWZpbmVkIHtcclxuICBpZiAoIXJhd0lucHV0ICYmICFyYXdPdXRwdXQpIHtcclxuICAgIHJldHVybiB1bmRlZmluZWQ7XHJcbiAgfVxyXG4gIGNvbnN0IGNvbnZlcnRlZDogeyBJbnB1dDogbnVtYmVyIHwgdW5kZWZpbmVkOyBPdXRwdXQ6IG51bWJlciB8IHVuZGVmaW5lZCB9ID0ge1xyXG4gICAgSW5wdXQ6IGNvbnZlcnROdW1iZXIocmF3SW5wdXQpLFxyXG4gICAgT3V0cHV0OiBjb252ZXJ0TnVtYmVyKHJhd091dHB1dCksXHJcbiAgfTtcclxuICBpZiAoY29udmVydGVkLklucHV0IHx8IGNvbnZlcnRlZC5PdXRwdXQpIHtcclxuICAgIHJldHVybiBjb252ZXJ0ZWQ7XHJcbiAgfVxyXG4gIHJldHVybiB1bmRlZmluZWQ7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGNvbnZlcnRSZXBlYXRlckRpZ2l0YWxUb25lKHJhd0lucHV0OiBzdHJpbmcgfCBudW1iZXIgfCB1bmRlZmluZWQsIHJhd091dHB1dDogc3RyaW5nIHwgbnVtYmVyIHwgdW5kZWZpbmVkKTogeyBJbnB1dD86IG51bWJlcjsgT3V0cHV0PzogbnVtYmVyIH0gfCB1bmRlZmluZWQge1xyXG4gIGlmICghcmF3SW5wdXQgJiYgIXJhd091dHB1dCkge1xyXG4gICAgcmV0dXJuIHVuZGVmaW5lZDtcclxuICB9XHJcbiAgY29uc3QgZGlnaXRhbEZpbHRlcjogUmVnRXhwID0gL15EKFxcZCspJC87XHJcbiAgY29uc3QgY29udmVydGVkOiB7IElucHV0OiBudW1iZXIgfCB1bmRlZmluZWQ7IE91dHB1dDogbnVtYmVyIHwgdW5kZWZpbmVkIH0gPSB7XHJcbiAgICBJbnB1dDogdHlwZW9mIHJhd0lucHV0ID09PSAnc3RyaW5nJyA/IGNvbnZlcnROdW1iZXIocmF3SW5wdXQsIGRpZ2l0YWxGaWx0ZXIpIDogdW5kZWZpbmVkLFxyXG4gICAgT3V0cHV0OiB0eXBlb2YgcmF3T3V0cHV0ID09PSAnc3RyaW5nJyA/IGNvbnZlcnROdW1iZXIocmF3T3V0cHV0LCBkaWdpdGFsRmlsdGVyKSA6IHVuZGVmaW5lZCxcclxuICB9O1xyXG4gIGlmIChjb252ZXJ0ZWQuSW5wdXQgfHwgY29udmVydGVkLk91dHB1dCkge1xyXG4gICAgcmV0dXJuIGNvbnZlcnRlZDtcclxuICB9XHJcbiAgcmV0dXJuIHVuZGVmaW5lZDtcclxufVxyXG5cclxuZnVuY3Rpb24gY29udmVydE51bWJlcihpbnB1dDogc3RyaW5nIHwgbnVtYmVyIHwgdW5kZWZpbmVkLCBudW1iZXJGaWx0ZXI6IFJlZ0V4cCA9IC9eKFsrLV0/XFxkK1xcLj9cXGQqKSQvKTogbnVtYmVyIHwgdW5kZWZpbmVkIHtcclxuICBpZiAodHlwZW9mIGlucHV0ID09PSAnbnVtYmVyJyAmJiAhaXNOYU4oaW5wdXQpKSB7XHJcbiAgICByZXR1cm4gaW5wdXQ7XHJcbiAgfSBlbHNlIGlmICh0eXBlb2YgaW5wdXQgPT09ICdudW1iZXInICYmIGlzTmFOKGlucHV0KSkge1xyXG4gICAgcmV0dXJuIHVuZGVmaW5lZDtcclxuICB9IGVsc2UgaWYgKHR5cGVvZiBpbnB1dCA9PT0gJ3N0cmluZycgJiYgbnVtYmVyRmlsdGVyLnRlc3QoaW5wdXQpKSB7XHJcbiAgICBjb25zdCBtYXRjaDogUmVnRXhwTWF0Y2hBcnJheSB8IG51bGwgPSBpbnB1dC5tYXRjaChudW1iZXJGaWx0ZXIpO1xyXG4gICAgaWYgKG1hdGNoICYmIG1hdGNoWzFdKSB7XHJcbiAgICAgIGNvbnN0IGNvbnZlcnRlZDogbnVtYmVyID0gcGFyc2VGbG9hdChtYXRjaFsxXSk7XHJcbiAgICAgIHJldHVybiAhaXNOYU4oY29udmVydGVkKSA/IGNvbnZlcnRlZCA6IHVuZGVmaW5lZDtcclxuICAgIH1cclxuICB9XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGNvbnZlcnRSZXBlYXRlckRpZ2l0YWxEYXRhKHJhdzogSVJlcGVhdGVyUmF3KTogSVJlcGVhdGVyRGlnaXRhbE1vZGVzIHwgdW5kZWZpbmVkIHtcclxuICBjb25zdCBjb252ZXJ0ZWQ6IElSZXBlYXRlckRpZ2l0YWxNb2RlcyA9IHtcclxuICAgIC8vIFRPRE86IEFUVj86IGJvb2xlYW47XHJcbiAgICBETVI6IChyYXcuREdUTC5pbmNsdWRlcygnRCcpIHx8IHJhd1snRE1SIEVuYWJsZWQnXSkgPyB7IENvbG9yQ29kZTogY29udmVydE51bWJlcihyYXdbJ0NvbG9yIENvZGUnXSksIElEOiBjb252ZXJ0TnVtYmVyKHJhd1snRE1SIElEJ10pIH0gOiB1bmRlZmluZWQsXHJcbiAgICBQMjU6IChyYXcuREdUTC5pbmNsdWRlcygnUCcpIHx8IHJhd1snUC0yNSBEaWdpdGFsIEVuYWJsZWQnXSkgPyB7IE5BQzogY29udmVydE51bWJlcihyYXcuTkFDKSB9IDogdW5kZWZpbmVkLFxyXG4gICAgRFN0YXI6IChyYXcuREdUTC5pbmNsdWRlcygnUycpIHx8IHJhd1snRC1TVEFSIEVuYWJsZWQnXSkgPyB7IE5vZGU6IHJhdy5Ob2RlIH0gOiB1bmRlZmluZWQsXHJcbiAgICBZU0Y6IChyYXcuREdUTC5pbmNsdWRlcygnWScpIHx8IHJhd1snWVNGIERpZ2l0YWwgRW5hYmxlZCddKSA/IHtcclxuICAgICAgR3JvdXBJRDoge1xyXG4gICAgICAgIElucHV0OiB0eXBlb2YgcmF3WydERy1JRCddID09PSAnbnVtYmVyJyA/IHJhd1snREctSUQnXSA6IHR5cGVvZiByYXdbJ0RHLUlEJ10gPT09ICdzdHJpbmcnID8gcmF3WydERy1JRCddLnNwbGl0KCcvJylbMF0udHJpbSgpIDogdW5kZWZpbmVkLFxyXG4gICAgICAgIE91dHB1dDogdHlwZW9mIHJhd1snREctSUQnXSA9PT0gJ251bWJlcicgPyByYXdbJ0RHLUlEJ10gOiB0eXBlb2YgcmF3WydERy1JRCddID09PSAnc3RyaW5nJyA/IHJhd1snREctSUQnXS5zcGxpdCgnLycpWzFdLnRyaW0oKSA6IHVuZGVmaW5lZCxcclxuICAgICAgfSxcclxuICAgIH0gOiB1bmRlZmluZWQsXHJcbiAgfTtcclxuICBpZiAoY29udmVydGVkLkRNUiB8fCBjb252ZXJ0ZWQuUDI1IHx8IGNvbnZlcnRlZC5EU3RhciB8fCBjb252ZXJ0ZWQuWVNGKSB7XHJcbiAgICByZXR1cm4gY29udmVydGVkO1xyXG4gIH1cclxufVxyXG5cclxuZnVuY3Rpb24gY29udmVydFJlcGVhdGVyVk9JUChyYXc6IElSZXBlYXRlclJhdyk6IElSZXBlYXRlclZPSVBNb2RlcyB8IHVuZGVmaW5lZCB7XHJcbiAgY29uc3QgY29udmVydGVkOiBJUmVwZWF0ZXJWT0lQTW9kZXMgPSB7XHJcbiAgICBBbGxTdGFyOiAocmF3LlZPSVAuaW5jbHVkZXMoJ0EnKSB8fCByYXcuQWxsU3RhcikgPyB7IE5vZGVJRDogY29udmVydE51bWJlcihyYXcuQWxsU3RhcikgfSA6IHVuZGVmaW5lZCxcclxuICAgIEVjaG9MaW5rOiAocmF3LlZPSVAuaW5jbHVkZXMoJ0UnKSB8fCByYXcuRWNob0xpbmspID8ge1xyXG4gICAgICBOb2RlSUQ6IHJhdy5FY2hvTGluayxcclxuICAgIH0gOiB1bmRlZmluZWQsIC8vIFRPRE86IFN0YXR1cz86IEVjaG9MaW5rTm9kZVN0YXR1c1xyXG4gICAgSVJMUDogKHJhdy5WT0lQLmluY2x1ZGVzKCdJJykgfHwgcmF3LklSTFApID8geyBOb2RlSUQ6IGNvbnZlcnROdW1iZXIocmF3LklSTFApIH0gOiB1bmRlZmluZWQsXHJcbiAgICBXaXJlczogKHJhdy5WT0lQLmluY2x1ZGVzKCdXJykgfHwgcmF3WydXSVJFUy1YJ10pID8geyBJRDogY29udmVydE51bWJlcihyYXdbJ1dJUkVTLVgnXSkgfSA6IHVuZGVmaW5lZCxcclxuICB9O1xyXG4gIGlmIChjb252ZXJ0ZWQuQWxsU3RhciB8fCBjb252ZXJ0ZWQuRWNob0xpbmsgfHwgY29udmVydGVkLklSTFAgfHwgY29udmVydGVkLldpcmVzKSB7XHJcbiAgICByZXR1cm4gY29udmVydGVkO1xyXG4gIH1cclxufVxyXG4iXX0=