var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
(function (factory) {
    if (typeof module === "object" && typeof module.exports === "object") {
        var v = factory(require, exports);
        if (v !== undefined) module.exports = v;
    }
    else if (typeof define === "function" && define.amd) {
        define(["require", "exports", "module-alias/register", "@helpers/fs-helpers", "@helpers/log-helpers", "@interfaces/i-repeater-structured", "gps-distance"], factory);
    }
})(function (require, exports) {
    "use strict";
    Object.defineProperty(exports, "__esModule", { value: true });
    require("module-alias/register");
    const fs_helpers_1 = require("@helpers/fs-helpers");
    const log_helpers_1 = require("@helpers/log-helpers");
    const i_repeater_structured_1 = require("@interfaces/i-repeater-structured");
    const gps_distance_1 = __importDefault(require("gps-distance"));
    const log = log_helpers_1.createLog('Make Yaesu');
    const yaesu = {
        Number: null,
        Receive: '',
        Transmit: '',
        Offset: (0).toFixed(5),
        Direction: 'OFF',
        Mode: 'FM',
        Name: '',
        ToneMode: 'OFF',
        CTCSS: '100 Hz',
        DCS: '023',
        UserCTCSS: '1500 Hz',
        Power: 'HIGH',
        Skip: 'OFF',
        Step: '25.0KHz',
        ClockShift: 0,
        Comment: '',
        Bank: 0,
    };
    const myPoint = [39.627071500, -104.893322500]; // 4982 S Ulster St
    async function doIt(inFileName, outFileName) {
        const simplex = JSON.parse((await fs_helpers_1.readFileAsync('data/frequencies.json')).toString())
            .map((map) => ({ Callsign: map.Name, Frequency: { Output: map.Frequency, Input: map.Frequency } }))
            .filter((filter) => /FM|Voice|Simplex/i.test(filter.Callsign));
        // .filter((filter: IRepeaterStructured) => !(/Data|Digital|Packet/i.test(filter.Callsign)));
        const repeaters = JSON.parse((await fs_helpers_1.readFileAsync(inFileName)).toString());
        repeaters.forEach((each) => {
            each.Location.Distance = gps_distance_1.default([myPoint, [each.Location.Latitude, each.Location.Longitude]]);
        });
        repeaters.sort((a, b) => a.Location.Distance > b.Location.Distance ? 1 :
            a.Location.Distance < b.Location.Distance ? -1 : 0);
        const mapped = [
            ...simplex,
            ...repeaters
                .filter((filter) => (filter.Frequency.Output >= 144 && filter.Frequency.Output <= 148) ||
                // (filter.Frequency.Output >= 222 && filter.Frequency.Output <= 225) ||
                (filter.Frequency.Output >= 420 && filter.Frequency.Output <= 450))
                .filter((filter) => (!filter.Digital || filter.Digital.YSF) &&
                filter.Status !== i_repeater_structured_1.RepeaterStatus.OffAir &&
                filter.Use === i_repeater_structured_1.RepeaterUse.Open),
        ]
            .map((map, index) => ({ ...convertToRadio(map), Number: index + 1 }))
            .slice(0, 500)
            .sort((a, b) => parseFloat(a.Receive) - parseFloat(b.Receive))
            .map((map, index) => ({ ...map, Number: index + 1 }));
        return fs_helpers_1.writeToJsonAndCsv(outFileName, mapped);
    }
    function convertToRadio(repeater) {
        let Name = '';
        if (repeater.Callsign) {
            Name += repeater.Callsign.trim();
            if (repeater.ID !== undefined) {
                Name = Name.substr(-3).trim().toUpperCase();
            }
        }
        if (repeater.Location && repeater.Location.Local) {
            Name += (Name ? ' ' : '') + repeater.Location.Local.trim().toLowerCase();
        }
        if (repeater.Frequency && repeater.Frequency.Output) {
            Name += (Name ? ' ' : '') + repeater.Frequency.Output.toString().trim();
        }
        Name = Name.replace(/[^0-9.a-zA-Z\/]/g, '').trim();
        Name = Name.substring(0, 7).trim();
        const Receive = repeater.Frequency.Output.toFixed(5);
        const Transmit = repeater.Frequency.Input.toFixed(5);
        const OffsetNumber = repeater.Frequency.Input - repeater.Frequency.Output;
        const Direction = OffsetNumber > 0 ? '+RPT' : OffsetNumber < 0 ? '-RPT' : 'OFF';
        const Offset = Math.abs(Math.round(OffsetNumber * 100) / 100).toFixed(5);
        const TransmitSquelchTone = (repeater.SquelchTone && repeater.SquelchTone.Input);
        const ReceiveSquelchTone = (repeater.SquelchTone && repeater.SquelchTone.Output);
        const TransmitDigitalTone = (repeater.DigitalTone && repeater.DigitalTone.Input);
        const ReceiveDigitalTone = (repeater.DigitalTone && repeater.DigitalTone.Output);
        let ToneMode = 'OFF';
        const Mode = 'FM';
        let Comment = `${repeater.StateID} ${repeater.ID} ${repeater.Location && repeater.Location.Distance && repeater.Location.Distance.toFixed(2)} ${repeater.Location && repeater.Location.State} ${repeater.Location && repeater.Location.County} ${repeater.Location && repeater.Location.Local} ${repeater.Callsign}`;
        Comment = Comment.replace(/undefined/g, ' ').replace(/\s+/g, ' ').trim();
        if (TransmitSquelchTone) {
            ToneMode = 'TONE ENC';
        }
        else if (TransmitDigitalTone) {
            ToneMode = 'DCS';
        }
        if (TransmitSquelchTone && ReceiveSquelchTone && TransmitSquelchTone === ReceiveSquelchTone) {
            ToneMode = 'TONE SQL';
        }
        else if (TransmitDigitalTone && ReceiveDigitalTone && TransmitDigitalTone === ReceiveDigitalTone) {
            ToneMode = 'DCS';
        }
        const CTCSS = (TransmitSquelchTone || 100).toFixed(1) + ' Hz';
        const DCSNumber = (TransmitDigitalTone || 23);
        const DCS = DCSNumber < 100 ? '0' + DCSNumber : '' + DCSNumber;
        return {
            ...yaesu,
            Receive,
            Transmit,
            Offset,
            Direction,
            Name,
            ToneMode,
            CTCSS,
            DCS,
            Mode,
            Comment,
        };
    }
    async function start() {
        // const coFiles = (await readdirAsync("./repeaters/data/CO/")).map((f) => `data/CO/${f}`);
        // const utFiles = (await readdirAsync("./repeaters/data/UT/")).map((f) => `data/UT/${f}`);
        // const nmFiles = (await readdirAsync("./repeaters/data/NM/")).map((f) => `data/NM/${f}`);
        // const coGroups = (await readdirAsync("./repeaters/groups/CO/")).map((f) => `groups/CO/${f}`);
        // const utGroups = (await readdirAsync("./repeaters/groups/UT/")).map((f) => `groups/UT/${f}`);
        // const nmGroups = (await readdirAsync("./repeaters/groups/NM/")).map((f) => `groups/NM/${f}`);
        // const allFiles = [...coFiles, ...utFiles, ...nmFiles, ...coGroups, ...utGroups, ...nmGroups].filter((f) => /\.json$/.test(f)).map((f) => f.replace(".json", ""));
        // for (const file of allFiles) {
        //   await doIt(file);
        // }
        // await doIt("data/repeaters/groups/CO/Colorado Springs - Call.json", "data/repeaters/yaesu/groups/CO/Colorado Springs - Call");
        // await doIt("data/repeaters/results/CO/Colorado Springs.json", "data/repeaters/yaesu/CO/Colorado Springs");
        await doIt('data/repeaters/converted/CO.json', 'data/repeaters/yaesu/CO');
        // await doIt('data/repeaters/groups/combined/CO - Call.json', 'data/repeaters/yaesu/groups/CO - Call');
    }
    exports.default = start();
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWFrZS15YWVzdS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9zY3JpcHRzL21ha2UteWFlc3UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7SUFBQSxpQ0FBK0I7SUFFL0Isb0RBQXVFO0lBQ3ZFLHNEQUFpRDtJQUNqRCw2RUFBcUc7SUFHckcsZ0VBQWtEO0lBRWxELE1BQU0sR0FBRyxHQUE0Qix1QkFBUyxDQUFDLFlBQVksQ0FBQyxDQUFDO0lBRTdELE1BQU0sS0FBSyxHQUFXO1FBQ3BCLE1BQU0sRUFBRSxJQUFXO1FBQ25CLE9BQU8sRUFBRSxFQUFFO1FBQ1gsUUFBUSxFQUFFLEVBQUU7UUFDWixNQUFNLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDO1FBQ3RCLFNBQVMsRUFBRSxLQUFLO1FBQ2hCLElBQUksRUFBRSxJQUFJO1FBQ1YsSUFBSSxFQUFFLEVBQUU7UUFDUixRQUFRLEVBQUUsS0FBSztRQUNmLEtBQUssRUFBRSxRQUFRO1FBQ2YsR0FBRyxFQUFFLEtBQUs7UUFDVixTQUFTLEVBQUUsU0FBUztRQUNwQixLQUFLLEVBQUUsTUFBTTtRQUNiLElBQUksRUFBRSxLQUFLO1FBQ1gsSUFBSSxFQUFFLFNBQVM7UUFDZixVQUFVLEVBQUUsQ0FBQztRQUNiLE9BQU8sRUFBRSxFQUFFO1FBQ1gsSUFBSSxFQUFFLENBQUM7S0FDUixDQUFDO0lBRUYsTUFBTSxPQUFPLEdBQVUsQ0FBQyxZQUFZLEVBQUUsQ0FBQyxhQUFhLENBQUMsQ0FBQyxDQUFDLG1CQUFtQjtJQUUxRSxLQUFLLFVBQVUsSUFBSSxDQUFDLFVBQWtCLEVBQUUsV0FBbUI7UUFDekQsTUFBTSxPQUFPLEdBQ1gsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLE1BQU0sMEJBQWEsQ0FBQyx1QkFBdUIsQ0FBQyxDQUFDLENBQUMsUUFBUSxFQUFFLENBQUM7YUFDbEUsR0FBRyxDQUFDLENBQUMsR0FBc0IsRUFBRSxF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QUFNLFFBQVEsR0FBVyxRQUFRLENBQUMsU0FBUyxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDN0QsTUFBTSxZQUFZLEdBQVcsUUFBUSxDQUFDLFNBQVMsQ0FBQyxLQUFLLEdBQUcsUUFBUSxDQUFDLFNBQVMsQ0FBQyxNQUFNLENBQUM7UUFDbEYsTUFBTSxTQUFTLEdBQW1CLFlBQVksR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsWUFBWSxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUM7UUFDaEcsTUFBTSxNQUFNLEdBQVcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLFlBQVksR0FBRyxHQUFHLENBQUMsR0FBRyxHQUFHLENBQUMsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDakYsTUFBTSxtQkFBbUIsR0FBdUIsQ0FBQyxRQUFRLENBQUMsV0FBVyxJQUFJLFFBQVEsQ0FBQyxXQUFXLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDckcsTUFBTSxrQkFBa0IsR0FBdUIsQ0FBQyxRQUFRLENBQUMsV0FBVyxJQUFJLFFBQVEsQ0FBQyxXQUFXLENBQUMsTUFBTSxDQUFDLENBQUM7UUFDckcsTUFBTSxtQkFBbUIsR0FBdUIsQ0FBQyxRQUFRLENBQUMsV0FBVyxJQUFJLFFBQVEsQ0FBQyxXQUFXLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDckcsTUFBTSxrQkFBa0IsR0FBdUIsQ0FBQyxRQUFRLENBQUMsV0FBVyxJQUFJLFFBQVEsQ0FBQyxXQUFXLENBQUMsTUFBTSxDQUFDLENBQUM7UUFDckcsSUFBSSxRQUFRLEdBQWtCLEtBQUssQ0FBQztRQUNwQyxNQUFNLElBQUksR0FBYyxJQUFJLENBQUM7UUFDN0IsSUFBSSxPQUFPLEdBQVcsR0FBRyxRQUFRLENBQUMsT0FBTyxJQUFJLFFBQVEsQ0FBQyxFQUFFLElBQUksUUFBUSxDQUFDLFFBQVEsSUFBSSxRQUFRLENBQUMsUUFBUSxDQUFDLFFBQVEsSUFBSSxRQUFRLENBQUMsUUFBUSxDQUFDLFFBQVEsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLElBQUksUUFBUSxDQUFDLFFBQVEsSUFBSSxRQUFRLENBQUMsUUFBUSxDQUFDLEtBQUssSUFBSSxRQUFRLENBQUMsUUFBUSxJQUFJLFFBQVEsQ0FBQyxRQUFRLENBQUMsTUFBTSxJQUFJLFFBQVEsQ0FBQyxRQUFRLElBQUksUUFBUSxDQUFDLFFBQVEsQ0FBQyxLQUFLLElBQUksUUFBUSxDQUFDLFFBQVEsRUFBRSxDQUFDO1FBQzdULE9BQU8sR0FBRyxPQUFPLENBQUMsT0FBTyxDQUFDLFlBQVksRUFBRSxHQUFHLENBQUMsQ0FBQyxPQUFPLENBQUMsTUFBTSxFQUFFLEdBQUcsQ0FBQyxDQUFDLElBQUksRUFBRSxDQUFDO1FBRXpFLElBQUksbUJBQW1CLEVBQUU7WUFDdkIsUUFBUSxHQUFHLFVBQVUsQ0FBQztTQUN2QjthQUFNLElBQUksbUJBQW1CLEVBQUU7WUFDOUIsUUFBUSxHQUFHLEtBQUssQ0FBQztTQUNsQjtRQUVELElBQUksbUJBQW1CLElBQUksa0JBQWtCLElBQUksbUJBQW1CLEtBQUssa0JBQWtCLEVBQUU7WUFDM0YsUUFBUSxHQUFHLFVBQVUsQ0FBQztTQUN2QjthQUFNLElBQUksbUJBQW1CLElBQUksa0JBQWtCLElBQUksbUJBQW1CLEtBQUssa0JBQWtCLEVBQUU7WUFDbEcsUUFBUSxHQUFHLEtBQUssQ0FBQztTQUNsQjtRQUVELE1BQU0sS0FBSyxHQUFXLENBQUMsbUJBQW1CLElBQUksR0FBRyxDQUFDLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxHQUFHLEtBQUssQ0FBQztRQUN0RSxNQUFNLFNBQVMsR0FBVyxDQUFDLG1CQUFtQixJQUFJLEVBQUUsQ0FBQyxDQUFDO1FBQ3RELE1BQU0sR0FBRyxHQUFXLFNBQVMsR0FBRyxHQUFHLENBQUMsQ0FBQyxDQUFDLEdBQUcsR0FBRyxTQUFTLENBQUMsQ0FBQyxDQUFDLEVBQUUsR0FBRyxTQUFTLENBQUM7UUFFdkUsT0FBTztZQUNMLEdBQUcsS0FBSztZQUNSLE9BQU87WUFDUCxRQUFRO1lBQ1IsTUFBTTtZQUNOLFNBQVM7WUFDVCxJQUFJO1lBQ0osUUFBUTtZQUNSLEtBQUs7WUFDTCxHQUFHO1lBQ0gsSUFBSTtZQUNKLE9BQU87U0FDUixDQUFDO0lBQ0osQ0FBQztJQUVELEtBQUssVUFBVSxLQUFLO1FBQ3BCLDJGQUEyRjtRQUMzRiwyRkFBMkY7UUFDM0YsMkZBQTJGO1FBQzNGLGdHQUFnRztRQUNoRyxnR0FBZ0c7UUFDaEcsZ0dBQWdHO1FBQ2hHLG9LQUFvSztRQUNwSyxpQ0FBaUM7UUFDakMsc0JBQXNCO1FBQ3RCLElBQUk7UUFFSixpSUFBaUk7UUFDakksNkdBQTZHO1FBQzNHLE1BQU0sSUFBSSxDQUFDLGtDQUFrQyxFQUFFLHlCQUF5QixDQUFDLENBQUM7UUFDMUUsd0dBQXdHO0lBQzFHLENBQUM7SUFFRCxrQkFBZSxLQUFLLEVBQUUsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAnbW9kdWxlLWFsaWFzL3JlZ2lzdGVyJztcblxuaW1wb3J0IHsgcmVhZEZpbGVBc3luYywgd3JpdGVUb0pzb25BbmRDc3YgfSBmcm9tICdAaGVscGVycy9mcy1oZWxwZXJzJztcbmltcG9ydCB7IGNyZWF0ZUxvZyB9IGZyb20gJ0BoZWxwZXJzL2xvZy1oZWxwZXJzJztcbmltcG9ydCB7IElSZXBlYXRlclN0cnVjdHVyZWQsIFJlcGVhdGVyU3RhdHVzLCBSZXBlYXRlclVzZSB9IGZyb20gJ0BpbnRlcmZhY2VzL2ktcmVwZWF0ZXItc3RydWN0dXJlZCc7XG5pbXBvcnQgeyBJU2ltcGxleEZyZXF1ZW5jeSB9IGZyb20gJ0BpbnRlcmZhY2VzL2ktc2ltcGxleC1mcmVxdWVuY3knO1xuaW1wb3J0IHsgSVlhZXN1LCBZYWVzdURpcmVjdGlvbiwgWWFlc3VNb2RlLCBZYWVzdVRvbmVNb2RlIH0gZnJvbSAnQGludGVyZmFjZXMvaS15YWVzdSc7XG5pbXBvcnQgZ3BzRGlzdGFuY2UsIHsgUG9pbnQgfSBmcm9tICdncHMtZGlzdGFuY2UnO1xuXG5jb25zdCBsb2c6ICguLi5tc2c6IGFueVtdKSA9PiB2b2lkID0gY3JlYXRlTG9nKCdNYWtlIFlhZXN1Jyk7XG5cbmNvbnN0IHlhZXN1OiBJWWFlc3UgPSB7XG4gIE51bWJlcjogbnVsbCBhcyBhbnksXG4gIFJlY2VpdmU6ICcnLFxuICBUcmFuc21pdDogJycsXG4gIE9mZnNldDogKDApLnRvRml4ZWQoNSksXG4gIERpcmVjdGlvbjogJ09GRicsXG4gIE1vZGU6ICdGTScsXG4gIE5hbWU6ICcnLFxuICBUb25lTW9kZTogJ09GRicsXG4gIENUQ1NTOiAnMTAwIEh6JyxcbiAgRENTOiAnMDIzJyxcbiAgVXNlckNUQ1NTOiAnMTUwMCBIeicsXG4gIFBvd2VyOiAnSElHSCcsXG4gIFNraXA6ICdPRkYnLFxuICBTdGVwOiAnMjUuMEtIeicsXG4gIENsb2NrU2hpZnQ6IDAsXG4gIENvbW1lbnQ6ICcnLFxuICBCYW5rOiAwLFxufTtcblxuY29uc3QgbXlQb2ludDogUG9pbnQgPSBbMzkuNjI3MDcxNTAwLCAtMTA0Ljg5MzMyMjUwMF07IC8vIDQ5ODIgUyBVbHN0ZXIgU3RcblxuYXN5bmMgZnVuY3Rpb24gZG9JdChpbkZpbGVOYW1lOiBzdHJpbmcsIG91dEZpbGVOYW1lOiBzdHJpbmcpOiBQcm9taXNlPHZvaWQ+IHtcbiAgY29uc3Qgc2ltcGxleDogSVJlcGVhdGVyU3RydWN0dXJlZFtdID1cbiAgICBKU09OLnBhcnNlKChhd2FpdCByZWFkRmlsZUFzeW5jKCdkYXRhL2ZyZXF1ZW5jaWVzLmpzb24nKSkudG9TdHJpbmcoKSlcbiAgICAgIC5tYXAoKG1hcDogSVNpbXBsZXhGcmVxdWVuY3kpID0+XG4gICAgICAgICh7IENhbGxzaWduOiBtYXAuTmFtZSwgRnJlcXVlbmN5OiB7IE91dHB1dDogbWFwLkZyZXF1ZW5jeSwgSW5wdXQ6IG1hcC5GcmVxdWVuY3kgfSB9KSlcbiAgICAgIC5maWx0ZXIoKGZpbHRlcjogSVJlcGVhdGVyU3RydWN0dXJlZCkgPT4gL0ZNfFZvaWNlfFNpbXBsZXgvaS50ZXN0KGZpbHRlci5DYWxsc2lnbikpO1xuICAvLyAuZmlsdGVyKChmaWx0ZXI6IElSZXBlYXRlclN0cnVjdHVyZWQpID0+ICEoL0RhdGF8RGlnaXRhbHxQYWNrZXQvaS50ZXN0KGZpbHRlci5DYWxsc2lnbikpKTtcblxuICBjb25zdCByZXBlYXRlcnM6IElSZXBlYXRlclN0cnVjdHVyZWRbXSA9XG4gICAgSlNPTi5wYXJzZSgoYXdhaXQgcmVhZEZpbGVBc3luYyhpbkZpbGVOYW1lKSkudG9TdHJpbmcoKSk7XG5cbiAgcmVwZWF0ZXJzLmZvckVhY2goKGVhY2g6IElSZXBlYXRlclN0cnVjdHVyZWQpID0+IHtcbiAgICBlYWNoLkxvY2F0aW9uLkRpc3RhbmNlID0gZ3BzRGlzdGFuY2UoW215UG9pbnQsIFtlYWNoLkxvY2F0aW9uLkxhdGl0dWRlLCBlYWNoLkxvY2F0aW9uLkxvbmdpdHVkZV1dKTtcbiAgfSk7XG5cbiAgcmVwZWF0ZXJzLnNvcnQoKGE6IElSZXBlYXRlclN0cnVjdHVyZWQsIGI6IElSZXBlYXRlclN0cnVjdHVyZWQpID0+XG4gICAgYS5Mb2NhdGlvbi5EaXN0YW5jZSEgPiBiLkxvY2F0aW9uLkRpc3RhbmNlISA/IDEgOlxuICAgICAgYS5Mb2NhdGlvbi5EaXN0YW5jZSEgPCBiLkxvY2F0aW9uLkRpc3RhbmNlISA/IC0xIDogMCk7XG4gIGNvbnN0IG1hcHBlZDogSVlhZXN1W10gPSBbXG4gICAgLi4uc2ltcGxleCxcbiAgICAuLi5yZXBlYXRlcnNcbiAgICAgIC5maWx0ZXIoKGZpbHRlcjogSVJlcGVhdGVyU3RydWN0dXJlZCkgPT5cbiAgICAgICAgKGZpbHRlci5GcmVxdWVuY3kuT3V0cHV0ID49IDE0NCAmJiBmaWx0ZXIuRnJlcXVlbmN5Lk91dHB1dCA8PSAxNDgpIHx8XG4gICAgICAgIC8vIChmaWx0ZXIuRnJlcXVlbmN5Lk91dHB1dCA+PSAyMjIgJiYgZmlsdGVyLkZyZXF1ZW5jeS5PdXRwdXQgPD0gMjI1KSB8fFxuICAgICAgICAoZmlsdGVyLkZyZXF1ZW5jeS5PdXRwdXQgPj0gNDIwICYmIGZpbHRlci5GcmVxdWVuY3kuT3V0cHV0IDw9IDQ1MCkpXG4gICAgICAuZmlsdGVyKChmaWx0ZXI6IElSZXBlYXRlclN0cnVjdHVyZWQpID0+XG4gICAgICAgICghZmlsdGVyLkRpZ2l0YWwgfHwgZmlsdGVyLkRpZ2l0YWwuWVNGKSAmJlxuICAgICAgICBmaWx0ZXIuU3RhdHVzICE9PSBSZXBlYXRlclN0YXR1cy5PZmZBaXIgJiZcbiAgICAgICAgZmlsdGVyLlVzZSA9PT0gUmVwZWF0ZXJVc2UuT3BlbiksXG4gIF1cbiAgICAubWFwKChtYXA6IElSZXBlYXRlclN0cnVjdHVyZWQsIGluZGV4OiBudW1iZXIpOiBJWWFlc3UgPT4gKHsgLi4uY29udmVydFRvUmFkaW8obWFwKSwgTnVtYmVyOiBpbmRleCArIDEgfSkpXG4gICAgLnNsaWNlKDAsIDUwMClcbiAgICAuc29ydCgoYTogSVlhZXN1LCBiOiBJWWFlc3UpID0+IHBhcnNlRmxvYXQoYS5SZWNlaXZlKSAtIHBhcnNlRmxvYXQoYi5SZWNlaXZlKSlcbiAgICAubWFwKChtYXA6IElZYWVzdSwgaW5kZXg6IG51bWJlcik6IElZYWVzdSA9PiAoeyAuLi5tYXAsIE51bWJlcjogaW5kZXggKyAxIH0pKTtcblxuICByZXR1cm4gd3JpdGVUb0pzb25BbmRDc3Yob3V0RmlsZU5hbWUsIG1hcHBlZCk7XG59XG5cbmZ1bmN0aW9uIGNvbnZlcnRUb1JhZGlvKHJlcGVhdGVyOiBJUmVwZWF0ZXJTdHJ1Y3R1cmVkKTogSVlhZXN1IHtcbiAgbGV0IE5hbWU6IHN0cmluZyA9ICcnO1xuXG4gIGlmIChyZXBlYXRlci5DYWxsc2lnbikge1xuICAgIE5hbWUgKz0gcmVwZWF0ZXIuQ2FsbHNpZ24udHJpbSgpO1xuICAgIGlmIChyZXBlYXRlci5JRCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICBOYW1lID0gTmFtZS5zdWJzdHIoLTMpLnRyaW0oKS50b1VwcGVyQ2FzZSgpO1xuICAgIH1cbiAgfVxuXG4gIGlmIChyZXBlYXRlci5Mb2NhdGlvbiAmJiByZXBlYXRlci5Mb2NhdGlvbi5Mb2NhbCkge1xuICAgIE5hbWUgKz0gKE5hbWUgPyAnICcgOiAnJykgKyByZXBlYXRlci5Mb2NhdGlvbi5Mb2NhbC50cmltKCkudG9Mb3dlckNhc2UoKTtcbiAgfVxuXG4gIGlmIChyZXBlYXRlci5GcmVxdWVuY3kgJiYgcmVwZWF0ZXIuRnJlcXVlbmN5Lk91dHB1dCkge1xuICAgIE5hbWUgKz0gKE5hbWUgPyAnICcgOiAnJykgKyByZXBlYXRlci5GcmVxdWVuY3kuT3V0cHV0LnRvU3RyaW5nKCkudHJpbSgpO1xuICB9XG5cbiAgTmFtZSA9IE5hbWUucmVwbGFjZSgvW14wLTkuYS16QS1aXFwvXS9nLCAnJykudHJpbSgpO1xuICBOYW1lID0gTmFtZS5zdWJzdHJpbmcoMCwgNykudHJpbSgpO1xuXG4gIGNvbnN0IFJlY2VpdmU6IHN0cmluZyA9IHJlcGVhdGVyLkZyZXF1ZW5jeS5PdXRwdXQudG9GaXhlZCg1KTtcbiAgY29uc3QgVHJhbnNtaXQ6IHN0cmluZyA9IHJlcGVhdGVyLkZyZXF1ZW5jeS5JbnB1dC50b0ZpeGVkKDUpO1xuICBjb25zdCBPZmZzZXROdW1iZXI6IG51bWJlciA9IHJlcGVhdGVyLkZyZXF1ZW5jeS5JbnB1dCAtIHJlcGVhdGVyLkZyZXF1ZW5jeS5PdXRwdXQ7XG4gIGNvbnN0IERpcmVjdGlvbjogWWFlc3VEaXJlY3Rpb24gPSBPZmZzZXROdW1iZXIgPiAwID8gJytSUFQnIDogT2Zmc2V0TnVtYmVyIDwgMCA/ICctUlBUJyA6ICdPRkYnO1xuICBjb25zdCBPZmZzZXQ6IHN0cmluZyA9IE1hdGguYWJzKE1hdGgucm91bmQoT2Zmc2V0TnVtYmVyICogMTAwKSAvIDEwMCkudG9GaXhlZCg1KTtcbiAgY29uc3QgVHJhbnNtaXRTcXVlbGNoVG9uZTogbnVtYmVyIHwgdW5kZWZpbmVkID0gKHJlcGVhdGVyLlNxdWVsY2hUb25lICYmIHJlcGVhdGVyLlNxdWVsY2hUb25lLklucHV0KTtcbiAgY29uc3QgUmVjZWl2ZVNxdWVsY2hUb25lOiBudW1iZXIgfCB1bmRlZmluZWQgPSAocmVwZWF0ZXIuU3F1ZWxjaFRvbmUgJiYgcmVwZWF0ZXIuU3F1ZWxjaFRvbmUuT3V0cHV0KTtcbiAgY29uc3QgVHJhbnNtaXREaWdpdGFsVG9uZTogbnVtYmVyIHwgdW5kZWZpbmVkID0gKHJlcGVhdGVyLkRpZ2l0YWxUb25lICYmIHJlcGVhdGVyLkRpZ2l0YWxUb25lLklucHV0KTtcbiAgY29uc3QgUmVjZWl2ZURpZ2l0YWxUb25lOiBudW1iZXIgfCB1bmRlZmluZWQgPSAocmVwZWF0ZXIuRGlnaXRhbFRvbmUgJiYgcmVwZWF0ZXIuRGlnaXRhbFRvbmUuT3V0cHV0KTtcbiAgbGV0IFRvbmVNb2RlOiBZYWVzdVRvbmVNb2RlID0gJ09GRic7XG4gIGNvbnN0IE1vZGU6IFlhZXN1TW9kZSA9ICdGTSc7XG4gIGxldCBDb21tZW50OiBzdHJpbmcgPSBgJHtyZXBlYXRlci5TdGF0ZUlEfSAke3JlcGVhdGVyLklEfSAke3JlcGVhdGVyLkxvY2F0aW9uICYmIHJlcGVhdGVyLkxvY2F0aW9uLkRpc3RhbmNlICYmIHJlcGVhdGVyLkxvY2F0aW9uLkRpc3RhbmNlLnRvRml4ZWQoMil9ICR7cmVwZWF0ZXIuTG9jYXRpb24gJiYgcmVwZWF0ZXIuTG9jYXRpb24uU3RhdGV9ICR7cmVwZWF0ZXIuTG9jYXRpb24gJiYgcmVwZWF0ZXIuTG9jYXRpb24uQ291bnR5fSAke3JlcGVhdGVyLkxvY2F0aW9uICYmIHJlcGVhdGVyLkxvY2F0aW9uLkxvY2FsfSAke3JlcGVhdGVyLkNhbGxzaWdufWA7XG4gIENvbW1lbnQgPSBDb21tZW50LnJlcGxhY2UoL3VuZGVmaW5lZC9nLCAnICcpLnJlcGxhY2UoL1xccysvZywgJyAnKS50cmltKCk7XG5cbiAgaWYgKFRyYW5zbWl0U3F1ZWxjaFRvbmUpIHtcbiAgICBUb25lTW9kZSA9ICdUT05FIEVOQyc7XG4gIH0gZWxzZSBpZiAoVHJhbnNtaXREaWdpdGFsVG9uZSkge1xuICAgIFRvbmVNb2RlID0gJ0RDUyc7XG4gIH1cblxuICBpZiAoVHJhbnNtaXRTcXVlbGNoVG9uZSAmJiBSZWNlaXZlU3F1ZWxjaFRvbmUgJiYgVHJhbnNtaXRTcXVlbGNoVG9uZSA9PT0gUmVjZWl2ZVNxdWVsY2hUb25lKSB7XG4gICAgVG9uZU1vZGUgPSAnVE9ORSBTUUwnO1xuICB9IGVsc2UgaWYgKFRyYW5zbWl0RGlnaXRhbFRvbmUgJiYgUmVjZWl2ZURpZ2l0YWxUb25lICYmIFRyYW5zbWl0RGlnaXRhbFRvbmUgPT09IFJlY2VpdmVEaWdpdGFsVG9uZSkge1xuICAgIFRvbmVNb2RlID0gJ0RDUyc7XG4gIH1cblxuICBjb25zdCBDVENTUzogc3RyaW5nID0gKFRyYW5zbWl0U3F1ZWxjaFRvbmUgfHwgMTAwKS50b0ZpeGVkKDEpICsgJyBIeic7XG4gIGNvbnN0IERDU051bWJlcjogbnVtYmVyID0gKFRyYW5zbWl0RGlnaXRhbFRvbmUgfHwgMjMpO1xuICBjb25zdCBEQ1M6IHN0cmluZyA9IERDU051bWJlciA8IDEwMCA/ICcwJyArIERDU051bWJlciA6ICcnICsgRENTTnVtYmVyO1xuXG4gIHJldHVybiB7XG4gICAgLi4ueWFlc3UsXG4gICAgUmVjZWl2ZSxcbiAgICBUcmFuc21pdCxcbiAgICBPZmZzZXQsXG4gICAgRGlyZWN0aW9uLFxuICAgIE5hbWUsXG4gICAgVG9uZU1vZGUsXG4gICAgQ1RDU1MsXG4gICAgRENTLFxuICAgIE1vZGUsXG4gICAgQ29tbWVudCxcbiAgfTtcbn1cblxuYXN5bmMgZnVuY3Rpb24gc3RhcnQoKTogUHJvbWlzZTx2b2lkPiB7XG4vLyBjb25zdCBjb0ZpbGVzID0gKGF3YWl0IHJlYWRkaXJBc3luYyhcIi4vcmVwZWF0ZXJzL2RhdGEvQ08vXCIpKS5tYXAoKGYpID0+IGBkYXRhL0NPLyR7Zn1gKTtcbi8vIGNvbnN0IHV0RmlsZXMgPSAoYXdhaXQgcmVhZGRpckFzeW5jKFwiLi9yZXBlYXRlcnMvZGF0YS9VVC9cIikpLm1hcCgoZikgPT4gYGRhdGEvVVQvJHtmfWApO1xuLy8gY29uc3Qgbm1GaWxlcyA9IChhd2FpdCByZWFkZGlyQXN5bmMoXCIuL3JlcGVhdGVycy9kYXRhL05NL1wiKSkubWFwKChmKSA9PiBgZGF0YS9OTS8ke2Z9YCk7XG4vLyBjb25zdCBjb0dyb3VwcyA9IChhd2FpdCByZWFkZGlyQXN5bmMoXCIuL3JlcGVhdGVycy9ncm91cHMvQ08vXCIpKS5tYXAoKGYpID0+IGBncm91cHMvQ08vJHtmfWApO1xuLy8gY29uc3QgdXRHcm91cHMgPSAoYXdhaXQgcmVhZGRpckFzeW5jKFwiLi9yZXBlYXRlcnMvZ3JvdXBzL1VUL1wiKSkubWFwKChmKSA9PiBgZ3JvdXBzL1VULyR7Zn1gKTtcbi8vIGNvbnN0IG5tR3JvdXBzID0gKGF3YWl0IHJlYWRkaXJBc3luYyhcIi4vcmVwZWF0ZXJzL2dyb3Vwcy9OTS9cIikpLm1hcCgoZikgPT4gYGdyb3Vwcy9OTS8ke2Z9YCk7XG4vLyBjb25zdCBhbGxGaWxlcyA9IFsuLi5jb0ZpbGVzLCAuLi51dEZpbGVzLCAuLi5ubUZpbGVzLCAuLi5jb0dyb3VwcywgLi4udXRHcm91cHMsIC4uLm5tR3JvdXBzXS5maWx0ZXIoKGYpID0+IC9cXC5qc29uJC8udGVzdChmKSkubWFwKChmKSA9PiBmLnJlcGxhY2UoXCIuanNvblwiLCBcIlwiKSk7XG4vLyBmb3IgKGNvbnN0IGZpbGUgb2YgYWxsRmlsZXMpIHtcbi8vICAgYXdhaXQgZG9JdChmaWxlKTtcbi8vIH1cblxuLy8gYXdhaXQgZG9JdChcImRhdGEvcmVwZWF0ZXJzL2dyb3Vwcy9DTy9Db2xvcmFkbyBTcHJpbmdzIC0gQ2FsbC5qc29uXCIsIFwiZGF0YS9yZXBlYXRlcnMveWFlc3UvZ3JvdXBzL0NPL0NvbG9yYWRvIFNwcmluZ3MgLSBDYWxsXCIpO1xuLy8gYXdhaXQgZG9JdChcImRhdGEvcmVwZWF0ZXJzL3Jlc3VsdHMvQ08vQ29sb3JhZG8gU3ByaW5ncy5qc29uXCIsIFwiZGF0YS9yZXBlYXRlcnMveWFlc3UvQ08vQ29sb3JhZG8gU3ByaW5nc1wiKTtcbiAgYXdhaXQgZG9JdCgnZGF0YS9yZXBlYXRlcnMvY29udmVydGVkL0NPLmpzb24nLCAnZGF0YS9yZXBlYXRlcnMveWFlc3UvQ08nKTtcbiAgLy8gYXdhaXQgZG9JdCgnZGF0YS9yZXBlYXRlcnMvZ3JvdXBzL2NvbWJpbmVkL0NPIC0gQ2FsbC5qc29uJywgJ2RhdGEvcmVwZWF0ZXJzL3lhZXN1L2dyb3Vwcy9DTyAtIENhbGwnKTtcbn1cblxuZXhwb3J0IGRlZmF1bHQgc3RhcnQoKTtcbiJdfQ==