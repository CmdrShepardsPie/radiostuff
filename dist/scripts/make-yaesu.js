var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
(function (factory) {
    if (typeof module === "object" && typeof module.exports === "object") {
        var v = factory(require, exports);
        if (v !== undefined) module.exports = v;
    }
    else if (typeof define === "function" && define.amd) {
        define(["require", "exports", "module-alias/register", "@helpers/fs-helpers", "@helpers/log-helpers", "@interfaces/i-repeater-structured", "gps-distance"], factory);
    }
})(function (require, exports) {
    "use strict";
    Object.defineProperty(exports, "__esModule", { value: true });
    require("module-alias/register");
    const fs_helpers_1 = require("@helpers/fs-helpers");
    const log_helpers_1 = require("@helpers/log-helpers");
    const i_repeater_structured_1 = require("@interfaces/i-repeater-structured");
    const gps_distance_1 = __importDefault(require("gps-distance"));
    const log = log_helpers_1.createLog('Make Yaesu');
    const yaesu = {
        Number: null,
        Receive: '',
        Transmit: '',
        Offset: (0).toFixed(5),
        Direction: 'OFF',
        Mode: 'FM',
        Name: '',
        ToneMode: 'OFF',
        CTCSS: '100 Hz',
        DCS: '023',
        UserCTCSS: '1500 Hz',
        Power: 'HIGH',
        Skip: 'OFF',
        Step: '25.0KHz',
        ClockShift: 0,
        Comment: '',
        Bank: 0,
    };
    const myPoint = [39.627071500, -104.893322500]; // 4982 S Ulster St
    async function doIt(inFileName, outFileName) {
        const simplex = JSON.parse((await fs_helpers_1.readFileAsync('data/frequencies.json')).toString())
            .map((map) => ({ Callsign: map.Name, Frequency: { Output: map.Frequency, Input: map.Frequency } }))
            .filter((filter) => /FM|Voice|Simplex/i.test(filter.Callsign));
        // .filter((filter: IRepeaterStructured) => !(/Data|Digital|Packet/i.test(filter.Callsign)));
        const repeaters = JSON.parse((await fs_helpers_1.readFileAsync(inFileName)).toString());
        repeaters.forEach((each) => {
            each.Location.Distance = gps_distance_1.default([myPoint, [each.Location.Latitude, each.Location.Longitude]]);
        });
        repeaters.sort((a, b) => a.Location.Distance > b.Location.Distance ? 1 :
            a.Location.Distance < b.Location.Distance ? -1 : 0);
        const mapped = [
            ...simplex,
            ...repeaters
                .filter((filter) => (filter.Frequency.Output >= 144 && filter.Frequency.Output <= 148) ||
                // (filter.Frequency.Output >= 222 && filter.Frequency.Output <= 225) ||
                (filter.Frequency.Output >= 420 && filter.Frequency.Output <= 450))
                .filter((filter) => (!filter.Digital || filter.Digital.YSF) &&
                filter.Status !== i_repeater_structured_1.RepeaterStatus.OffAir &&
                filter.Use === i_repeater_structured_1.RepeaterUse.Open),
        ]
            .map((map, index) => ({ ...convertToRadio(map), Number: index + 1 }))
            .slice(0, 500)
            .sort((a, b) => parseFloat(a.Receive) - parseFloat(b.Receive))
            .map((map, index) => ({ ...map, Number: index + 1 }));
        return fs_helpers_1.writeToJsonAndCsv(outFileName, mapped, mapped, false);
    }
    function convertToRadio(repeater) {
        let Name = '';
        if (repeater.Callsign) {
            Name += repeater.Callsign.trim();
        }
        if (repeater.Location && repeater.Location.Local) {
            Name += (Name ? ' ' : '') + repeater.Location.Local.trim();
        }
        if (repeater.Frequency && repeater.Frequency.Output) {
            Name += (Name ? ' ' : '') + repeater.Frequency.Output.toString().trim();
        }
        Name = Name.replace(/[^0-9.a-zA-Z \/]/g, '').trim();
        Name = Name.replace(/[ ]+/g, ' ').trim();
        Name = Name.substr(0, 8).trim();
        const Receive = repeater.Frequency.Output.toFixed(5);
        const Transmit = repeater.Frequency.Input.toFixed(5);
        const OffsetNumber = repeater.Frequency.Input - repeater.Frequency.Output;
        const Direction = OffsetNumber > 0 ? '+RPT' : OffsetNumber < 0 ? '-RPT' : 'OFF';
        const Offset = Math.abs(Math.round(OffsetNumber * 100) / 100).toFixed(5);
        const TransmitSquelchTone = (repeater.SquelchTone && repeater.SquelchTone.Input);
        const ReceiveSquelchTone = (repeater.SquelchTone && repeater.SquelchTone.Output);
        const TransmitDigitalTone = (repeater.DigitalTone && repeater.DigitalTone.Input);
        const ReceiveDigitalTone = (repeater.DigitalTone && repeater.DigitalTone.Output);
        let ToneMode = 'OFF';
        const Mode = 'FM';
        let Comment = `${repeater.StateID} ${repeater.ID} ${repeater.Location && repeater.Location.Distance && repeater.Location.Distance.toFixed(2)} ${repeater.Location && repeater.Location.State} ${repeater.Location && repeater.Location.County} ${repeater.Location && repeater.Location.Local} ${repeater.Callsign}`;
        Comment = Comment.replace(/undefined/g, ' ').replace(/\s+/g, ' ').trim();
        if (TransmitSquelchTone) {
            ToneMode = 'TONE ENC';
        }
        else if (TransmitDigitalTone) {
            ToneMode = 'DCS';
        }
        if (TransmitSquelchTone && ReceiveSquelchTone && TransmitSquelchTone === ReceiveSquelchTone) {
            ToneMode = 'TONE SQL';
        }
        else if (TransmitDigitalTone && ReceiveDigitalTone && TransmitDigitalTone === ReceiveDigitalTone) {
            ToneMode = 'DCS';
        }
        const CTCSS = (TransmitSquelchTone || 100).toFixed(1) + ' Hz';
        const DCSNumber = (TransmitDigitalTone || 23);
        const DCS = DCSNumber < 100 ? '0' + DCSNumber : '' + DCSNumber;
        return {
            ...yaesu,
            Receive,
            Transmit,
            Offset,
            Direction,
            Name,
            ToneMode,
            CTCSS,
            DCS,
            Mode,
            Comment,
        };
    }
    async function start() {
        // const coFiles = (await readdirAsync("./repeaters/data/CO/")).map((f) => `data/CO/${f}`);
        // const utFiles = (await readdirAsync("./repeaters/data/UT/")).map((f) => `data/UT/${f}`);
        // const nmFiles = (await readdirAsync("./repeaters/data/NM/")).map((f) => `data/NM/${f}`);
        // const coGroups = (await readdirAsync("./repeaters/groups/CO/")).map((f) => `groups/CO/${f}`);
        // const utGroups = (await readdirAsync("./repeaters/groups/UT/")).map((f) => `groups/UT/${f}`);
        // const nmGroups = (await readdirAsync("./repeaters/groups/NM/")).map((f) => `groups/NM/${f}`);
        // const allFiles = [...coFiles, ...utFiles, ...nmFiles, ...coGroups, ...utGroups, ...nmGroups].filter((f) => /\.json$/.test(f)).map((f) => f.replace(".json", ""));
        // for (const file of allFiles) {
        //   await doIt(file);
        // }
        // await doIt("data/repeaters/groups/CO/Colorado Springs - Call.json", "data/repeaters/yaesu/groups/CO/Colorado Springs - Call");
        // await doIt("data/repeaters/results/CO/Colorado Springs.json", "data/repeaters/yaesu/CO/Colorado Springs");
        await doIt('data/repeaters/converted/CO.json', 'data/repeaters/yaesu/CO');
        // await doIt('data/repeaters/groups/combined/CO - Call.json', 'data/repeaters/yaesu/groups/CO - Call');
    }
    exports.default = start();
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWFrZS15YWVzdS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9zY3JpcHRzL21ha2UteWFlc3UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7SUFBQSxpQ0FBK0I7SUFFL0Isb0RBQXVFO0lBQ3ZFLHNEQUFpRDtJQUNqRCw2RUFBcUc7SUFHckcsZ0VBQWtEO0lBRWxELE1BQU0sR0FBRyxHQUE0Qix1QkFBUyxDQUFDLFlBQVksQ0FBQyxDQUFDO0lBRTdELE1BQU0sS0FBSyxHQUFXO1FBQ3BCLE1BQU0sRUFBRSxJQUFXO1FBQ25CLE9BQU8sRUFBRSxFQUFFO1FBQ1gsUUFBUSxFQUFFLEVBQUU7UUFDWixNQUFNLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDO1FBQ3RCLFNBQVMsRUFBRSxLQUFLO1FBQ2hCLElBQUksRUFBRSxJQUFJO1FBQ1YsSUFBSSxFQUFFLEVBQUU7UUFDUixRQUFRLEVBQUUsS0FBSztRQUNmLEtBQUssRUFBRSxRQUFRO1FBQ2YsR0FBRyxFQUFFLEtBQUs7UUFDVixTQUFTLEVBQUUsU0FBUztRQUNwQixLQUFLLEVBQUUsTUFBTTtRQUNiLElBQUksRUFBRSxLQUFLO1FBQ1gsSUFBSSxFQUFFLFNBQVM7UUFDZixVQUFVLEVBQUUsQ0FBQztRQUNiLE9BQU8sRUFBRSxFQUFFO1FBQ1gsSUFBSSxFQUFFLENBQUM7S0FDUixDQUFDO0lBRUYsTUFBTSxPQUFPLEdBQVUsQ0FBQyxZQUFZLEVBQUUsQ0FBQyxhQUFhLENBQUMsQ0FBQyxDQUFDLG1CQUFtQjtJQUUxRSxLQUFLLFVBQVUsSUFBSSxDQUFDLFVBQWtCLEVBQUUsV0FBbUI7UUFDekQsTUFBTSxPQUFPLEdBQ1gsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLE1BQU0sMEJBQWEsQ0FBQyx1QkFBdUIsQ0FBQyxDQUFDLENBQUMsUUFBUSxFQUFFLENBQUM7YUFDbEUsR0FBRyxDQUFDLENBQUMsR0FBc0IsRUFBRSxF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Q04sU0FBUztZQUNULElBQUk7WUFDSixRQUFRO1lBQ1IsS0FBSztZQUNMLEdBQUc7WUFDSCxJQUFJO1lBQ0osT0FBTztTQUNSLENBQUM7SUFDSixDQUFDO0lBRUQsS0FBSyxVQUFVLEtBQUs7UUFDcEIsMkZBQTJGO1FBQzNGLDJGQUEyRjtRQUMzRiwyRkFBMkY7UUFDM0YsZ0dBQWdHO1FBQ2hHLGdHQUFnRztRQUNoRyxnR0FBZ0c7UUFDaEcsb0tBQW9LO1FBQ3BLLGlDQUFpQztRQUNqQyxzQkFBc0I7UUFDdEIsSUFBSTtRQUVKLGlJQUFpSTtRQUNqSSw2R0FBNkc7UUFDM0csTUFBTSxJQUFJLENBQUMsa0NBQWtDLEVBQUUseUJBQXlCLENBQUMsQ0FBQztRQUMxRSx3R0FBd0c7SUFDMUcsQ0FBQztJQUVELGtCQUFlLEtBQUssRUFBRSxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0ICdtb2R1bGUtYWxpYXMvcmVnaXN0ZXInO1xyXG5cclxuaW1wb3J0IHsgcmVhZEZpbGVBc3luYywgd3JpdGVUb0pzb25BbmRDc3YgfSBmcm9tICdAaGVscGVycy9mcy1oZWxwZXJzJztcclxuaW1wb3J0IHsgY3JlYXRlTG9nIH0gZnJvbSAnQGhlbHBlcnMvbG9nLWhlbHBlcnMnO1xyXG5pbXBvcnQgeyBJUmVwZWF0ZXJTdHJ1Y3R1cmVkLCBSZXBlYXRlclN0YXR1cywgUmVwZWF0ZXJVc2UgfSBmcm9tICdAaW50ZXJmYWNlcy9pLXJlcGVhdGVyLXN0cnVjdHVyZWQnO1xyXG5pbXBvcnQgeyBJU2ltcGxleEZyZXF1ZW5jeSB9IGZyb20gJ0BpbnRlcmZhY2VzL2ktc2ltcGxleC1mcmVxdWVuY3knO1xyXG5pbXBvcnQgeyBJWWFlc3UsIFlhZXN1RGlyZWN0aW9uLCBZYWVzdU1vZGUsIFlhZXN1VG9uZU1vZGUgfSBmcm9tICdAaW50ZXJmYWNlcy9pLXlhZXN1JztcclxuaW1wb3J0IGdwc0Rpc3RhbmNlLCB7IFBvaW50IH0gZnJvbSAnZ3BzLWRpc3RhbmNlJztcclxuXHJcbmNvbnN0IGxvZzogKC4uLm1zZzogYW55W10pID0+IHZvaWQgPSBjcmVhdGVMb2coJ01ha2UgWWFlc3UnKTtcclxuXHJcbmNvbnN0IHlhZXN1OiBJWWFlc3UgPSB7XHJcbiAgTnVtYmVyOiBudWxsIGFzIGFueSxcclxuICBSZWNlaXZlOiAnJyxcclxuICBUcmFuc21pdDogJycsXHJcbiAgT2Zmc2V0OiAoMCkudG9GaXhlZCg1KSxcclxuICBEaXJlY3Rpb246ICdPRkYnLFxyXG4gIE1vZGU6ICdGTScsXHJcbiAgTmFtZTogJycsXHJcbiAgVG9uZU1vZGU6ICdPRkYnLFxyXG4gIENUQ1NTOiAnMTAwIEh6JyxcclxuICBEQ1M6ICcwMjMnLFxyXG4gIFVzZXJDVENTUzogJzE1MDAgSHonLFxyXG4gIFBvd2VyOiAnSElHSCcsXHJcbiAgU2tpcDogJ09GRicsXHJcbiAgU3RlcDogJzI1LjBLSHonLFxyXG4gIENsb2NrU2hpZnQ6IDAsXHJcbiAgQ29tbWVudDogJycsXHJcbiAgQmFuazogMCxcclxufTtcclxuXHJcbmNvbnN0IG15UG9pbnQ6IFBvaW50ID0gWzM5LjYyNzA3MTUwMCwgLTEwNC44OTMzMjI1MDBdOyAvLyA0OTgyIFMgVWxzdGVyIFN0XHJcblxyXG5hc3luYyBmdW5jdGlvbiBkb0l0KGluRmlsZU5hbWU6IHN0cmluZywgb3V0RmlsZU5hbWU6IHN0cmluZyk6IFByb21pc2U8dm9pZD4ge1xyXG4gIGNvbnN0IHNpbXBsZXg6IElSZXBlYXRlclN0cnVjdHVyZWRbXSA9XHJcbiAgICBKU09OLnBhcnNlKChhd2FpdCByZWFkRmlsZUFzeW5jKCdkYXRhL2ZyZXF1ZW5jaWVzLmpzb24nKSkudG9TdHJpbmcoKSlcclxuICAgICAgLm1hcCgobWFwOiBJU2ltcGxleEZyZXF1ZW5jeSkgPT5cclxuICAgICAgICAoeyBDYWxsc2lnbjogbWFwLk5hbWUsIEZyZXF1ZW5jeTogeyBPdXRwdXQ6IG1hcC5GcmVxdWVuY3ksIElucHV0OiBtYXAuRnJlcXVlbmN5IH0gfSkpXHJcbiAgICAgIC5maWx0ZXIoKGZpbHRlcjogSVJlcGVhdGVyU3RydWN0dXJlZCkgPT4gL0ZNfFZvaWNlfFNpbXBsZXgvaS50ZXN0KGZpbHRlci5DYWxsc2lnbikpO1xyXG4gIC8vIC5maWx0ZXIoKGZpbHRlcjogSVJlcGVhdGVyU3RydWN0dXJlZCkgPT4gISgvRGF0YXxEaWdpdGFsfFBhY2tldC9pLnRlc3QoZmlsdGVyLkNhbGxzaWduKSkpO1xyXG5cclxuICBjb25zdCByZXBlYXRlcnM6IElSZXBlYXRlclN0cnVjdHVyZWRbXSA9XHJcbiAgICBKU09OLnBhcnNlKChhd2FpdCByZWFkRmlsZUFzeW5jKGluRmlsZU5hbWUpKS50b1N0cmluZygpKTtcclxuXHJcbiAgcmVwZWF0ZXJzLmZvckVhY2goKGVhY2g6IElSZXBlYXRlclN0cnVjdHVyZWQpID0+IHtcclxuICAgIGVhY2guTG9jYXRpb24uRGlzdGFuY2UgPSBncHNEaXN0YW5jZShbbXlQb2ludCwgW2VhY2guTG9jYXRpb24uTGF0aXR1ZGUsIGVhY2guTG9jYXRpb24uTG9uZ2l0dWRlXV0pO1xyXG4gIH0pO1xyXG5cclxuICByZXBlYXRlcnMuc29ydCgoYTogSVJlcGVhdGVyU3RydWN0dXJlZCwgYjogSVJlcGVhdGVyU3RydWN0dXJlZCkgPT5cclxuICAgIGEuTG9jYXRpb24uRGlzdGFuY2UhID4gYi5Mb2NhdGlvbi5EaXN0YW5jZSEgPyAxIDpcclxuICAgICAgYS5Mb2NhdGlvbi5EaXN0YW5jZSEgPCBiLkxvY2F0aW9uLkRpc3RhbmNlISA/IC0xIDogMCk7XHJcbiAgY29uc3QgbWFwcGVkOiBJWWFlc3VbXSA9IFtcclxuICAgIC4uLnNpbXBsZXgsXHJcbiAgICAuLi5yZXBlYXRlcnNcclxuICAgICAgLmZpbHRlcigoZmlsdGVyOiBJUmVwZWF0ZXJTdHJ1Y3R1cmVkKSA9PlxyXG4gICAgICAgIChmaWx0ZXIuRnJlcXVlbmN5Lk91dHB1dCA+PSAxNDQgJiYgZmlsdGVyLkZyZXF1ZW5jeS5PdXRwdXQgPD0gMTQ4KSB8fFxyXG4gICAgICAgIC8vIChmaWx0ZXIuRnJlcXVlbmN5Lk91dHB1dCA+PSAyMjIgJiYgZmlsdGVyLkZyZXF1ZW5jeS5PdXRwdXQgPD0gMjI1KSB8fFxyXG4gICAgICAgIChmaWx0ZXIuRnJlcXVlbmN5Lk91dHB1dCA+PSA0MjAgJiYgZmlsdGVyLkZyZXF1ZW5jeS5PdXRwdXQgPD0gNDUwKSlcclxuICAgICAgLmZpbHRlcigoZmlsdGVyOiBJUmVwZWF0ZXJTdHJ1Y3R1cmVkKSA9PlxyXG4gICAgICAgICghZmlsdGVyLkRpZ2l0YWwgfHwgZmlsdGVyLkRpZ2l0YWwuWVNGKSAmJlxyXG4gICAgICAgIGZpbHRlci5TdGF0dXMgIT09IFJlcGVhdGVyU3RhdHVzLk9mZkFpciAmJlxyXG4gICAgICAgIGZpbHRlci5Vc2UgPT09IFJlcGVhdGVyVXNlLk9wZW4pLFxyXG4gIF1cclxuICAgIC5tYXAoKG1hcDogSVJlcGVhdGVyU3RydWN0dXJlZCwgaW5kZXg6IG51bWJlcik6IElZYWVzdSA9PiAoeyAuLi5jb252ZXJ0VG9SYWRpbyhtYXApLCBOdW1iZXI6IGluZGV4ICsgMSB9KSlcclxuICAgIC5zbGljZSgwLCA1MDApXHJcbiAgICAuc29ydCgoYTogSVlhZXN1LCBiOiBJWWFlc3UpID0+IHBhcnNlRmxvYXQoYS5SZWNlaXZlKSAtIHBhcnNlRmxvYXQoYi5SZWNlaXZlKSlcclxuICAgIC5tYXAoKG1hcDogSVlhZXN1LCBpbmRleDogbnVtYmVyKTogSVlhZXN1ID0+ICh7IC4uLm1hcCwgTnVtYmVyOiBpbmRleCArIDEgfSkpO1xyXG5cclxuICByZXR1cm4gd3JpdGVUb0pzb25BbmRDc3Yob3V0RmlsZU5hbWUsIG1hcHBlZCwgbWFwcGVkLCBmYWxzZSk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGNvbnZlcnRUb1JhZGlvKHJlcGVhdGVyOiBJUmVwZWF0ZXJTdHJ1Y3R1cmVkKTogSVlhZXN1IHtcclxuICBsZXQgTmFtZTogc3RyaW5nID0gJyc7XHJcblxyXG4gIGlmIChyZXBlYXRlci5DYWxsc2lnbikge1xyXG4gICAgTmFtZSArPSByZXBlYXRlci5DYWxsc2lnbi50cmltKCk7XHJcbiAgfVxyXG5cclxuICBpZiAocmVwZWF0ZXIuTG9jYXRpb24gJiYgcmVwZWF0ZXIuTG9jYXRpb24uTG9jYWwpIHtcclxuICAgIE5hbWUgKz0gKE5hbWUgPyAnICcgOiAnJykgKyByZXBlYXRlci5Mb2NhdGlvbi5Mb2NhbC50cmltKCk7XHJcbiAgfVxyXG5cclxuICBpZiAocmVwZWF0ZXIuRnJlcXVlbmN5ICYmIHJlcGVhdGVyLkZyZXF1ZW5jeS5PdXRwdXQpIHtcclxuICAgIE5hbWUgKz0gKE5hbWUgPyAnICcgOiAnJykgKyByZXBlYXRlci5GcmVxdWVuY3kuT3V0cHV0LnRvU3RyaW5nKCkudHJpbSgpO1xyXG4gIH1cclxuXHJcbiAgTmFtZSA9IE5hbWUucmVwbGFjZSgvW14wLTkuYS16QS1aIFxcL10vZywgJycpLnRyaW0oKTtcclxuICBOYW1lID0gTmFtZS5yZXBsYWNlKC9bIF0rL2csICcgJykudHJpbSgpO1xyXG4gIE5hbWUgPSBOYW1lLnN1YnN0cigwLCA4KS50cmltKCk7XHJcblxyXG4gIGNvbnN0IFJlY2VpdmU6IHN0cmluZyA9IHJlcGVhdGVyLkZyZXF1ZW5jeS5PdXRwdXQudG9GaXhlZCg1KTtcclxuICBjb25zdCBUcmFuc21pdDogc3RyaW5nID0gcmVwZWF0ZXIuRnJlcXVlbmN5LklucHV0LnRvRml4ZWQoNSk7XHJcbiAgY29uc3QgT2Zmc2V0TnVtYmVyOiBudW1iZXIgPSByZXBlYXRlci5GcmVxdWVuY3kuSW5wdXQgLSByZXBlYXRlci5GcmVxdWVuY3kuT3V0cHV0O1xyXG4gIGNvbnN0IERpcmVjdGlvbjogWWFlc3VEaXJlY3Rpb24gPSBPZmZzZXROdW1iZXIgPiAwID8gJytSUFQnIDogT2Zmc2V0TnVtYmVyIDwgMCA/ICctUlBUJyA6ICdPRkYnO1xyXG4gIGNvbnN0IE9mZnNldDogc3RyaW5nID0gTWF0aC5hYnMoTWF0aC5yb3VuZChPZmZzZXROdW1iZXIgKiAxMDApIC8gMTAwKS50b0ZpeGVkKDUpO1xyXG4gIGNvbnN0IFRyYW5zbWl0U3F1ZWxjaFRvbmU6IG51bWJlciB8IHVuZGVmaW5lZCA9IChyZXBlYXRlci5TcXVlbGNoVG9uZSAmJiByZXBlYXRlci5TcXVlbGNoVG9uZS5JbnB1dCk7XHJcbiAgY29uc3QgUmVjZWl2ZVNxdWVsY2hUb25lOiBudW1iZXIgfCB1bmRlZmluZWQgPSAocmVwZWF0ZXIuU3F1ZWxjaFRvbmUgJiYgcmVwZWF0ZXIuU3F1ZWxjaFRvbmUuT3V0cHV0KTtcclxuICBjb25zdCBUcmFuc21pdERpZ2l0YWxUb25lOiBudW1iZXIgfCB1bmRlZmluZWQgPSAocmVwZWF0ZXIuRGlnaXRhbFRvbmUgJiYgcmVwZWF0ZXIuRGlnaXRhbFRvbmUuSW5wdXQpO1xyXG4gIGNvbnN0IFJlY2VpdmVEaWdpdGFsVG9uZTogbnVtYmVyIHwgdW5kZWZpbmVkID0gKHJlcGVhdGVyLkRpZ2l0YWxUb25lICYmIHJlcGVhdGVyLkRpZ2l0YWxUb25lLk91dHB1dCk7XHJcbiAgbGV0IFRvbmVNb2RlOiBZYWVzdVRvbmVNb2RlID0gJ09GRic7XHJcbiAgY29uc3QgTW9kZTogWWFlc3VNb2RlID0gJ0ZNJztcclxuICBsZXQgQ29tbWVudDogc3RyaW5nID0gYCR7cmVwZWF0ZXIuU3RhdGVJRH0gJHtyZXBlYXRlci5JRH0gJHtyZXBlYXRlci5Mb2NhdGlvbiAmJiByZXBlYXRlci5Mb2NhdGlvbi5EaXN0YW5jZSAmJiByZXBlYXRlci5Mb2NhdGlvbi5EaXN0YW5jZS50b0ZpeGVkKDIpfSAke3JlcGVhdGVyLkxvY2F0aW9uICYmIHJlcGVhdGVyLkxvY2F0aW9uLlN0YXRlfSAke3JlcGVhdGVyLkxvY2F0aW9uICYmIHJlcGVhdGVyLkxvY2F0aW9uLkNvdW50eX0gJHtyZXBlYXRlci5Mb2NhdGlvbiAmJiByZXBlYXRlci5Mb2NhdGlvbi5Mb2NhbH0gJHtyZXBlYXRlci5DYWxsc2lnbn1gO1xyXG4gIENvbW1lbnQgPSBDb21tZW50LnJlcGxhY2UoL3VuZGVmaW5lZC9nLCAnICcpLnJlcGxhY2UoL1xccysvZywgJyAnKS50cmltKCk7XHJcblxyXG4gIGlmIChUcmFuc21pdFNxdWVsY2hUb25lKSB7XHJcbiAgICBUb25lTW9kZSA9ICdUT05FIEVOQyc7XHJcbiAgfSBlbHNlIGlmIChUcmFuc21pdERpZ2l0YWxUb25lKSB7XHJcbiAgICBUb25lTW9kZSA9ICdEQ1MnO1xyXG4gIH1cclxuXHJcbiAgaWYgKFRyYW5zbWl0U3F1ZWxjaFRvbmUgJiYgUmVjZWl2ZVNxdWVsY2hUb25lICYmIFRyYW5zbWl0U3F1ZWxjaFRvbmUgPT09IFJlY2VpdmVTcXVlbGNoVG9uZSkge1xyXG4gICAgVG9uZU1vZGUgPSAnVE9ORSBTUUwnO1xyXG4gIH0gZWxzZSBpZiAoVHJhbnNtaXREaWdpdGFsVG9uZSAmJiBSZWNlaXZlRGlnaXRhbFRvbmUgJiYgVHJhbnNtaXREaWdpdGFsVG9uZSA9PT0gUmVjZWl2ZURpZ2l0YWxUb25lKSB7XHJcbiAgICBUb25lTW9kZSA9ICdEQ1MnO1xyXG4gIH1cclxuXHJcbiAgY29uc3QgQ1RDU1M6IHN0cmluZyA9IChUcmFuc21pdFNxdWVsY2hUb25lIHx8IDEwMCkudG9GaXhlZCgxKSArICcgSHonO1xyXG4gIGNvbnN0IERDU051bWJlcjogbnVtYmVyID0gKFRyYW5zbWl0RGlnaXRhbFRvbmUgfHwgMjMpO1xyXG4gIGNvbnN0IERDUzogc3RyaW5nID0gRENTTnVtYmVyIDwgMTAwID8gJzAnICsgRENTTnVtYmVyIDogJycgKyBEQ1NOdW1iZXI7XHJcblxyXG4gIHJldHVybiB7XHJcbiAgICAuLi55YWVzdSxcclxuICAgIFJlY2VpdmUsXHJcbiAgICBUcmFuc21pdCxcclxuICAgIE9mZnNldCxcclxuICAgIERpcmVjdGlvbixcclxuICAgIE5hbWUsXHJcbiAgICBUb25lTW9kZSxcclxuICAgIENUQ1NTLFxyXG4gICAgRENTLFxyXG4gICAgTW9kZSxcclxuICAgIENvbW1lbnQsXHJcbiAgfTtcclxufVxyXG5cclxuYXN5bmMgZnVuY3Rpb24gc3RhcnQoKTogUHJvbWlzZTx2b2lkPiB7XHJcbi8vIGNvbnN0IGNvRmlsZXMgPSAoYXdhaXQgcmVhZGRpckFzeW5jKFwiLi9yZXBlYXRlcnMvZGF0YS9DTy9cIikpLm1hcCgoZikgPT4gYGRhdGEvQ08vJHtmfWApO1xyXG4vLyBjb25zdCB1dEZpbGVzID0gKGF3YWl0IHJlYWRkaXJBc3luYyhcIi4vcmVwZWF0ZXJzL2RhdGEvVVQvXCIpKS5tYXAoKGYpID0+IGBkYXRhL1VULyR7Zn1gKTtcclxuLy8gY29uc3Qgbm1GaWxlcyA9IChhd2FpdCByZWFkZGlyQXN5bmMoXCIuL3JlcGVhdGVycy9kYXRhL05NL1wiKSkubWFwKChmKSA9PiBgZGF0YS9OTS8ke2Z9YCk7XHJcbi8vIGNvbnN0IGNvR3JvdXBzID0gKGF3YWl0IHJlYWRkaXJBc3luYyhcIi4vcmVwZWF0ZXJzL2dyb3Vwcy9DTy9cIikpLm1hcCgoZikgPT4gYGdyb3Vwcy9DTy8ke2Z9YCk7XHJcbi8vIGNvbnN0IHV0R3JvdXBzID0gKGF3YWl0IHJlYWRkaXJBc3luYyhcIi4vcmVwZWF0ZXJzL2dyb3Vwcy9VVC9cIikpLm1hcCgoZikgPT4gYGdyb3Vwcy9VVC8ke2Z9YCk7XHJcbi8vIGNvbnN0IG5tR3JvdXBzID0gKGF3YWl0IHJlYWRkaXJBc3luYyhcIi4vcmVwZWF0ZXJzL2dyb3Vwcy9OTS9cIikpLm1hcCgoZikgPT4gYGdyb3Vwcy9OTS8ke2Z9YCk7XHJcbi8vIGNvbnN0IGFsbEZpbGVzID0gWy4uLmNvRmlsZXMsIC4uLnV0RmlsZXMsIC4uLm5tRmlsZXMsIC4uLmNvR3JvdXBzLCAuLi51dEdyb3VwcywgLi4ubm1Hcm91cHNdLmZpbHRlcigoZikgPT4gL1xcLmpzb24kLy50ZXN0KGYpKS5tYXAoKGYpID0+IGYucmVwbGFjZShcIi5qc29uXCIsIFwiXCIpKTtcclxuLy8gZm9yIChjb25zdCBmaWxlIG9mIGFsbEZpbGVzKSB7XHJcbi8vICAgYXdhaXQgZG9JdChmaWxlKTtcclxuLy8gfVxyXG5cclxuLy8gYXdhaXQgZG9JdChcImRhdGEvcmVwZWF0ZXJzL2dyb3Vwcy9DTy9Db2xvcmFkbyBTcHJpbmdzIC0gQ2FsbC5qc29uXCIsIFwiZGF0YS9yZXBlYXRlcnMveWFlc3UvZ3JvdXBzL0NPL0NvbG9yYWRvIFNwcmluZ3MgLSBDYWxsXCIpO1xyXG4vLyBhd2FpdCBkb0l0KFwiZGF0YS9yZXBlYXRlcnMvcmVzdWx0cy9DTy9Db2xvcmFkbyBTcHJpbmdzLmpzb25cIiwgXCJkYXRhL3JlcGVhdGVycy95YWVzdS9DTy9Db2xvcmFkbyBTcHJpbmdzXCIpO1xyXG4gIGF3YWl0IGRvSXQoJ2RhdGEvcmVwZWF0ZXJzL2NvbnZlcnRlZC9DTy5qc29uJywgJ2RhdGEvcmVwZWF0ZXJzL3lhZXN1L0NPJyk7XHJcbiAgLy8gYXdhaXQgZG9JdCgnZGF0YS9yZXBlYXRlcnMvZ3JvdXBzL2NvbWJpbmVkL0NPIC0gQ2FsbC5qc29uJywgJ2RhdGEvcmVwZWF0ZXJzL3lhZXN1L2dyb3Vwcy9DTyAtIENhbGwnKTtcclxufVxyXG5cclxuZXhwb3J0IGRlZmF1bHQgc3RhcnQoKTtcclxuIl19