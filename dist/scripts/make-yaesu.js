var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
(function (factory) {
    if (typeof module === "object" && typeof module.exports === "object") {
        var v = factory(require, exports);
        if (v !== undefined) module.exports = v;
    }
    else if (typeof define === "function" && define.amd) {
        define(["require", "exports", "module-alias/register", "@helpers/fs-helpers", "@helpers/log-helpers", "@interfaces/i-repeater-structured", "gps-distance"], factory);
    }
})(function (require, exports) {
    "use strict";
    Object.defineProperty(exports, "__esModule", { value: true });
    require("module-alias/register");
    const fs_helpers_1 = require("@helpers/fs-helpers");
    const log_helpers_1 = require("@helpers/log-helpers");
    const i_repeater_structured_1 = require("@interfaces/i-repeater-structured");
    const gps_distance_1 = __importDefault(require("gps-distance"));
    const log = log_helpers_1.createLog('Make Yaesu');
    const yaesu = {
        Number: null,
        Receive: '',
        Transmit: '',
        Offset: (0).toFixed(5),
        Direction: 'OFF',
        Mode: 'FM',
        Name: '',
        ToneMode: 'OFF',
        CTCSS: '100 Hz',
        DCS: '023',
        UserCTCSS: '1500 Hz',
        Power: 'HIGH',
        Skip: 'OFF',
        Step: '25.0KHz',
        ClockShift: 0,
        Comment: '',
        Bank: 0,
    };
    const myPoint = [39.627071500, -104.893322500]; // 4982 S Ulster St
    async function doIt(inFileName, outFileName) {
        const simplex = JSON.parse((await fs_helpers_1.readFileAsync('data/frequencies.json')).toString())
            .map((map) => ({ Callsign: map.Name, Frequency: { Output: map.Frequency, Input: map.Frequency } }))
            .filter((filter) => /FM|Voice|Simplex/i.test(filter.Callsign));
        // .filter((filter: IRepeaterStructured) => !(/Data|Digital|Packet/i.test(filter.Callsign)));
        const repeaters = JSON.parse((await fs_helpers_1.readFileAsync(inFileName)).toString());
        repeaters.forEach((each) => {
            each.Location.Distance = gps_distance_1.default([myPoint, [each.Location.Latitude, each.Location.Longitude]]);
        });
        repeaters.sort((a, b) => a.Location.Distance > b.Location.Distance ? 1 :
            a.Location.Distance < b.Location.Distance ? -1 : 0);
        const mapped = [
            ...simplex,
            ...repeaters
                .filter((filter) => (filter.Frequency.Output >= 144 && filter.Frequency.Output <= 148) ||
                // (filter.Frequency.Output >= 222 && filter.Frequency.Output <= 225) ||
                (filter.Frequency.Output >= 420 && filter.Frequency.Output <= 450))
                .filter((filter) => (!filter.Digital || filter.Digital.YSF) &&
                filter.Status !== i_repeater_structured_1.RepeaterStatus.OffAir &&
                filter.Use === i_repeater_structured_1.RepeaterUse.Open),
        ]
            .map((map, index) => ({ ...convertToRadio(map), Number: index + 1 }))
            .slice(0, 500)
            .sort((a, b) => parseFloat(a.Receive) - parseFloat(b.Receive))
            .map((map, index) => ({ ...map, Number: index + 1 }));
        return fs_helpers_1.writeToJsonAndCsv(outFileName, mapped, mapped, false);
    }
    function convertToRadio(repeater) {
        let Name = '';
        if (repeater.Callsign) {
            Name += repeater.Callsign.trim();
            if (repeater.ID !== undefined) {
                Name = Name.substr(-3).trim().toUpperCase();
            }
        }
        if (repeater.Location && repeater.Location.Local) {
            Name += (Name ? ' ' : '') + repeater.Location.Local.trim().toLowerCase();
        }
        if (repeater.Frequency && repeater.Frequency.Output) {
            Name += (Name ? ' ' : '') + repeater.Frequency.Output.toString().trim();
        }
        Name = Name.replace(/[^0-9.a-zA-Z\/]/g, '').trim();
        Name = Name.substring(0, 7).trim();
        const Receive = repeater.Frequency.Output.toFixed(5);
        const Transmit = repeater.Frequency.Input.toFixed(5);
        const OffsetNumber = repeater.Frequency.Input - repeater.Frequency.Output;
        const Direction = OffsetNumber > 0 ? '+RPT' : OffsetNumber < 0 ? '-RPT' : 'OFF';
        const Offset = Math.abs(Math.round(OffsetNumber * 100) / 100).toFixed(5);
        const TransmitSquelchTone = (repeater.SquelchTone && repeater.SquelchTone.Input);
        const ReceiveSquelchTone = (repeater.SquelchTone && repeater.SquelchTone.Output);
        const TransmitDigitalTone = (repeater.DigitalTone && repeater.DigitalTone.Input);
        const ReceiveDigitalTone = (repeater.DigitalTone && repeater.DigitalTone.Output);
        let ToneMode = 'OFF';
        const Mode = 'FM';
        let Comment = `${repeater.StateID} ${repeater.ID} ${repeater.Location && repeater.Location.Distance && repeater.Location.Distance.toFixed(2)} ${repeater.Location && repeater.Location.State} ${repeater.Location && repeater.Location.County} ${repeater.Location && repeater.Location.Local} ${repeater.Callsign}`;
        Comment = Comment.replace(/undefined/g, ' ').replace(/\s+/g, ' ').trim();
        if (TransmitSquelchTone) {
            ToneMode = 'TONE ENC';
        }
        else if (TransmitDigitalTone) {
            ToneMode = 'DCS';
        }
        if (TransmitSquelchTone && ReceiveSquelchTone && TransmitSquelchTone === ReceiveSquelchTone) {
            ToneMode = 'TONE SQL';
        }
        else if (TransmitDigitalTone && ReceiveDigitalTone && TransmitDigitalTone === ReceiveDigitalTone) {
            ToneMode = 'DCS';
        }
        const CTCSS = (TransmitSquelchTone || 100).toFixed(1) + ' Hz';
        const DCSNumber = (TransmitDigitalTone || 23);
        const DCS = DCSNumber < 100 ? '0' + DCSNumber : '' + DCSNumber;
        return {
            ...yaesu,
            Receive,
            Transmit,
            Offset,
            Direction,
            Name,
            ToneMode,
            CTCSS,
            DCS,
            Mode,
            Comment,
        };
    }
    async function start() {
        // const coFiles = (await readdirAsync("./repeaters/data/CO/")).map((f) => `data/CO/${f}`);
        // const utFiles = (await readdirAsync("./repeaters/data/UT/")).map((f) => `data/UT/${f}`);
        // const nmFiles = (await readdirAsync("./repeaters/data/NM/")).map((f) => `data/NM/${f}`);
        // const coGroups = (await readdirAsync("./repeaters/groups/CO/")).map((f) => `groups/CO/${f}`);
        // const utGroups = (await readdirAsync("./repeaters/groups/UT/")).map((f) => `groups/UT/${f}`);
        // const nmGroups = (await readdirAsync("./repeaters/groups/NM/")).map((f) => `groups/NM/${f}`);
        // const allFiles = [...coFiles, ...utFiles, ...nmFiles, ...coGroups, ...utGroups, ...nmGroups].filter((f) => /\.json$/.test(f)).map((f) => f.replace(".json", ""));
        // for (const file of allFiles) {
        //   await doIt(file);
        // }
        // await doIt("data/repeaters/groups/CO/Colorado Springs - Call.json", "data/repeaters/yaesu/groups/CO/Colorado Springs - Call");
        // await doIt("data/repeaters/results/CO/Colorado Springs.json", "data/repeaters/yaesu/CO/Colorado Springs");
        await doIt('data/repeaters/converted/CO.json', 'data/repeaters/yaesu/CO');
        // await doIt('data/repeaters/groups/combined/CO - Call.json', 'data/repeaters/yaesu/groups/CO - Call');
    }
    exports.default = start();
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWFrZS15YWVzdS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9zY3JpcHRzL21ha2UteWFlc3UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7SUFBQSxpQ0FBK0I7SUFFL0Isb0RBQXVFO0lBQ3ZFLHNEQUFpRDtJQUNqRCw2RUFBcUc7SUFHckcsZ0VBQWtEO0lBRWxELE1BQU0sR0FBRyxHQUE0Qix1QkFBUyxDQUFDLFlBQVksQ0FBQyxDQUFDO0lBRTdELE1BQU0sS0FBSyxHQUFXO1FBQ3BCLE1BQU0sRUFBRSxJQUFXO1FBQ25CLE9BQU8sRUFBRSxFQUFFO1FBQ1gsUUFBUSxFQUFFLEVBQUU7UUFDWixNQUFNLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDO1FBQ3RCLFNBQVMsRUFBRSxLQUFLO1FBQ2hCLElBQUksRUFBRSxJQUFJO1FBQ1YsSUFBSSxFQUFFLEVBQUU7UUFDUixRQUFRLEVBQUUsS0FBSztRQUNmLEtBQUssRUFBRSxRQUFRO1FBQ2YsR0FBRyxFQUFFLEtBQUs7UUFDVixTQUFTLEVBQUUsU0FBUztRQUNwQixLQUFLLEVBQUUsTUFBTTtRQUNiLElBQUksRUFBRSxLQUFLO1FBQ1gsSUFBSSxFQUFFLFNBQVM7UUFDZixVQUFVLEVBQUUsQ0FBQztRQUNiLE9BQU8sRUFBRSxFQUFFO1FBQ1gsSUFBSSxFQUFFLENBQUM7S0FDUixDQUFDO0lBRUYsTUFBTSxPQUFPLEdBQVUsQ0FBQyxZQUFZLEVBQUUsQ0FBQyxhQUFhLENBQUMsQ0FBQyxDQUFDLG1CQUFtQjtJQUUxRSxLQUFLLFVBQVUsSUFBSSxDQUFDLFVBQWtCLEVBQUUsV0FBbUI7UUFDekQsTUFBTSxPQUFPLEdBQ1gsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLE1BQU0sMEJBQWEsQ0FBQyx1QkFBdUIsQ0FBQyxDQUFDLENBQUMsUUFBUSxFQUFFLENBQUM7YUFDbEUsR0FBRyxDQUFDLENBQUMsR0FBc0IsRUFBRSxF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QUFHLFNBQVMsQ0FBQztRQUV2RSxPQUFPO1lBQ0wsR0FBRyxLQUFLO1lBQ1IsT0FBTztZQUNQLFFBQVE7WUFDUixNQUFNO1lBQ04sU0FBUztZQUNULElBQUk7WUFDSixRQUFRO1lBQ1IsS0FBSztZQUNMLEdBQUc7WUFDSCxJQUFJO1lBQ0osT0FBTztTQUNSLENBQUM7SUFDSixDQUFDO0lBRUQsS0FBSyxVQUFVLEtBQUs7UUFDcEIsMkZBQTJGO1FBQzNGLDJGQUEyRjtRQUMzRiwyRkFBMkY7UUFDM0YsZ0dBQWdHO1FBQ2hHLGdHQUFnRztRQUNoRyxnR0FBZ0c7UUFDaEcsb0tBQW9LO1FBQ3BLLGlDQUFpQztRQUNqQyxzQkFBc0I7UUFDdEIsSUFBSTtRQUVKLGlJQUFpSTtRQUNqSSw2R0FBNkc7UUFDM0csTUFBTSxJQUFJLENBQUMsa0NBQWtDLEVBQUUseUJBQXlCLENBQUMsQ0FBQztRQUMxRSx3R0FBd0c7SUFDMUcsQ0FBQztJQUVELGtCQUFlLEtBQUssRUFBRSxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0ICdtb2R1bGUtYWxpYXMvcmVnaXN0ZXInO1xuXG5pbXBvcnQgeyByZWFkRmlsZUFzeW5jLCB3cml0ZVRvSnNvbkFuZENzdiB9IGZyb20gJ0BoZWxwZXJzL2ZzLWhlbHBlcnMnO1xuaW1wb3J0IHsgY3JlYXRlTG9nIH0gZnJvbSAnQGhlbHBlcnMvbG9nLWhlbHBlcnMnO1xuaW1wb3J0IHsgSVJlcGVhdGVyU3RydWN0dXJlZCwgUmVwZWF0ZXJTdGF0dXMsIFJlcGVhdGVyVXNlIH0gZnJvbSAnQGludGVyZmFjZXMvaS1yZXBlYXRlci1zdHJ1Y3R1cmVkJztcbmltcG9ydCB7IElTaW1wbGV4RnJlcXVlbmN5IH0gZnJvbSAnQGludGVyZmFjZXMvaS1zaW1wbGV4LWZyZXF1ZW5jeSc7XG5pbXBvcnQgeyBJWWFlc3UsIFlhZXN1RGlyZWN0aW9uLCBZYWVzdU1vZGUsIFlhZXN1VG9uZU1vZGUgfSBmcm9tICdAaW50ZXJmYWNlcy9pLXlhZXN1JztcbmltcG9ydCBncHNEaXN0YW5jZSwgeyBQb2ludCB9IGZyb20gJ2dwcy1kaXN0YW5jZSc7XG5cbmNvbnN0IGxvZzogKC4uLm1zZzogYW55W10pID0+IHZvaWQgPSBjcmVhdGVMb2coJ01ha2UgWWFlc3UnKTtcblxuY29uc3QgeWFlc3U6IElZYWVzdSA9IHtcbiAgTnVtYmVyOiBudWxsIGFzIGFueSxcbiAgUmVjZWl2ZTogJycsXG4gIFRyYW5zbWl0OiAnJyxcbiAgT2Zmc2V0OiAoMCkudG9GaXhlZCg1KSxcbiAgRGlyZWN0aW9uOiAnT0ZGJyxcbiAgTW9kZTogJ0ZNJyxcbiAgTmFtZTogJycsXG4gIFRvbmVNb2RlOiAnT0ZGJyxcbiAgQ1RDU1M6ICcxMDAgSHonLFxuICBEQ1M6ICcwMjMnLFxuICBVc2VyQ1RDU1M6ICcxNTAwIEh6JyxcbiAgUG93ZXI6ICdISUdIJyxcbiAgU2tpcDogJ09GRicsXG4gIFN0ZXA6ICcyNS4wS0h6JyxcbiAgQ2xvY2tTaGlmdDogMCxcbiAgQ29tbWVudDogJycsXG4gIEJhbms6IDAsXG59O1xuXG5jb25zdCBteVBvaW50OiBQb2ludCA9IFszOS42MjcwNzE1MDAsIC0xMDQuODkzMzIyNTAwXTsgLy8gNDk4MiBTIFVsc3RlciBTdFxuXG5hc3luYyBmdW5jdGlvbiBkb0l0KGluRmlsZU5hbWU6IHN0cmluZywgb3V0RmlsZU5hbWU6IHN0cmluZyk6IFByb21pc2U8dm9pZD4ge1xuICBjb25zdCBzaW1wbGV4OiBJUmVwZWF0ZXJTdHJ1Y3R1cmVkW10gPVxuICAgIEpTT04ucGFyc2UoKGF3YWl0IHJlYWRGaWxlQXN5bmMoJ2RhdGEvZnJlcXVlbmNpZXMuanNvbicpKS50b1N0cmluZygpKVxuICAgICAgLm1hcCgobWFwOiBJU2ltcGxleEZyZXF1ZW5jeSkgPT5cbiAgICAgICAgKHsgQ2FsbHNpZ246IG1hcC5OYW1lLCBGcmVxdWVuY3k6IHsgT3V0cHV0OiBtYXAuRnJlcXVlbmN5LCBJbnB1dDogbWFwLkZyZXF1ZW5jeSB9IH0pKVxuICAgICAgLmZpbHRlcigoZmlsdGVyOiBJUmVwZWF0ZXJTdHJ1Y3R1cmVkKSA9PiAvRk18Vm9pY2V8U2ltcGxleC9pLnRlc3QoZmlsdGVyLkNhbGxzaWduKSk7XG4gIC8vIC5maWx0ZXIoKGZpbHRlcjogSVJlcGVhdGVyU3RydWN0dXJlZCkgPT4gISgvRGF0YXxEaWdpdGFsfFBhY2tldC9pLnRlc3QoZmlsdGVyLkNhbGxzaWduKSkpO1xuXG4gIGNvbnN0IHJlcGVhdGVyczogSVJlcGVhdGVyU3RydWN0dXJlZFtdID1cbiAgICBKU09OLnBhcnNlKChhd2FpdCByZWFkRmlsZUFzeW5jKGluRmlsZU5hbWUpKS50b1N0cmluZygpKTtcblxuICByZXBlYXRlcnMuZm9yRWFjaCgoZWFjaDogSVJlcGVhdGVyU3RydWN0dXJlZCkgPT4ge1xuICAgIGVhY2guTG9jYXRpb24uRGlzdGFuY2UgPSBncHNEaXN0YW5jZShbbXlQb2ludCwgW2VhY2guTG9jYXRpb24uTGF0aXR1ZGUsIGVhY2guTG9jYXRpb24uTG9uZ2l0dWRlXV0pO1xuICB9KTtcblxuICByZXBlYXRlcnMuc29ydCgoYTogSVJlcGVhdGVyU3RydWN0dXJlZCwgYjogSVJlcGVhdGVyU3RydWN0dXJlZCkgPT5cbiAgICBhLkxvY2F0aW9uLkRpc3RhbmNlISA+IGIuTG9jYXRpb24uRGlzdGFuY2UhID8gMSA6XG4gICAgICBhLkxvY2F0aW9uLkRpc3RhbmNlISA8IGIuTG9jYXRpb24uRGlzdGFuY2UhID8gLTEgOiAwKTtcbiAgY29uc3QgbWFwcGVkOiBJWWFlc3VbXSA9IFtcbiAgICAuLi5zaW1wbGV4LFxuICAgIC4uLnJlcGVhdGVyc1xuICAgICAgLmZpbHRlcigoZmlsdGVyOiBJUmVwZWF0ZXJTdHJ1Y3R1cmVkKSA9PlxuICAgICAgICAoZmlsdGVyLkZyZXF1ZW5jeS5PdXRwdXQgPj0gMTQ0ICYmIGZpbHRlci5GcmVxdWVuY3kuT3V0cHV0IDw9IDE0OCkgfHxcbiAgICAgICAgLy8gKGZpbHRlci5GcmVxdWVuY3kuT3V0cHV0ID49IDIyMiAmJiBmaWx0ZXIuRnJlcXVlbmN5Lk91dHB1dCA8PSAyMjUpIHx8XG4gICAgICAgIChmaWx0ZXIuRnJlcXVlbmN5Lk91dHB1dCA+PSA0MjAgJiYgZmlsdGVyLkZyZXF1ZW5jeS5PdXRwdXQgPD0gNDUwKSlcbiAgICAgIC5maWx0ZXIoKGZpbHRlcjogSVJlcGVhdGVyU3RydWN0dXJlZCkgPT5cbiAgICAgICAgKCFmaWx0ZXIuRGlnaXRhbCB8fCBmaWx0ZXIuRGlnaXRhbC5ZU0YpICYmXG4gICAgICAgIGZpbHRlci5TdGF0dXMgIT09IFJlcGVhdGVyU3RhdHVzLk9mZkFpciAmJlxuICAgICAgICBmaWx0ZXIuVXNlID09PSBSZXBlYXRlclVzZS5PcGVuKSxcbiAgXVxuICAgIC5tYXAoKG1hcDogSVJlcGVhdGVyU3RydWN0dXJlZCwgaW5kZXg6IG51bWJlcik6IElZYWVzdSA9PiAoeyAuLi5jb252ZXJ0VG9SYWRpbyhtYXApLCBOdW1iZXI6IGluZGV4ICsgMSB9KSlcbiAgICAuc2xpY2UoMCwgNTAwKVxuICAgIC5zb3J0KChhOiBJWWFlc3UsIGI6IElZYWVzdSkgPT4gcGFyc2VGbG9hdChhLlJlY2VpdmUpIC0gcGFyc2VGbG9hdChiLlJlY2VpdmUpKVxuICAgIC5tYXAoKG1hcDogSVlhZXN1LCBpbmRleDogbnVtYmVyKTogSVlhZXN1ID0+ICh7IC4uLm1hcCwgTnVtYmVyOiBpbmRleCArIDEgfSkpO1xuXG4gIHJldHVybiB3cml0ZVRvSnNvbkFuZENzdihvdXRGaWxlTmFtZSwgbWFwcGVkLCBtYXBwZWQsIGZhbHNlKTtcbn1cblxuZnVuY3Rpb24gY29udmVydFRvUmFkaW8ocmVwZWF0ZXI6IElSZXBlYXRlclN0cnVjdHVyZWQpOiBJWWFlc3Uge1xuICBsZXQgTmFtZTogc3RyaW5nID0gJyc7XG5cbiAgaWYgKHJlcGVhdGVyLkNhbGxzaWduKSB7XG4gICAgTmFtZSArPSByZXBlYXRlci5DYWxsc2lnbi50cmltKCk7XG4gICAgaWYgKHJlcGVhdGVyLklEICE9PSB1bmRlZmluZWQpIHtcbiAgICAgIE5hbWUgPSBOYW1lLnN1YnN0cigtMykudHJpbSgpLnRvVXBwZXJDYXNlKCk7XG4gICAgfVxuICB9XG5cbiAgaWYgKHJlcGVhdGVyLkxvY2F0aW9uICYmIHJlcGVhdGVyLkxvY2F0aW9uLkxvY2FsKSB7XG4gICAgTmFtZSArPSAoTmFtZSA/ICcgJyA6ICcnKSArIHJlcGVhdGVyLkxvY2F0aW9uLkxvY2FsLnRyaW0oKS50b0xvd2VyQ2FzZSgpO1xuICB9XG5cbiAgaWYgKHJlcGVhdGVyLkZyZXF1ZW5jeSAmJiByZXBlYXRlci5GcmVxdWVuY3kuT3V0cHV0KSB7XG4gICAgTmFtZSArPSAoTmFtZSA/ICcgJyA6ICcnKSArIHJlcGVhdGVyLkZyZXF1ZW5jeS5PdXRwdXQudG9TdHJpbmcoKS50cmltKCk7XG4gIH1cblxuICBOYW1lID0gTmFtZS5yZXBsYWNlKC9bXjAtOS5hLXpBLVpcXC9dL2csICcnKS50cmltKCk7XG4gIE5hbWUgPSBOYW1lLnN1YnN0cmluZygwLCA3KS50cmltKCk7XG5cbiAgY29uc3QgUmVjZWl2ZTogc3RyaW5nID0gcmVwZWF0ZXIuRnJlcXVlbmN5Lk91dHB1dC50b0ZpeGVkKDUpO1xuICBjb25zdCBUcmFuc21pdDogc3RyaW5nID0gcmVwZWF0ZXIuRnJlcXVlbmN5LklucHV0LnRvRml4ZWQoNSk7XG4gIGNvbnN0IE9mZnNldE51bWJlcjogbnVtYmVyID0gcmVwZWF0ZXIuRnJlcXVlbmN5LklucHV0IC0gcmVwZWF0ZXIuRnJlcXVlbmN5Lk91dHB1dDtcbiAgY29uc3QgRGlyZWN0aW9uOiBZYWVzdURpcmVjdGlvbiA9IE9mZnNldE51bWJlciA+IDAgPyAnK1JQVCcgOiBPZmZzZXROdW1iZXIgPCAwID8gJy1SUFQnIDogJ09GRic7XG4gIGNvbnN0IE9mZnNldDogc3RyaW5nID0gTWF0aC5hYnMoTWF0aC5yb3VuZChPZmZzZXROdW1iZXIgKiAxMDApIC8gMTAwKS50b0ZpeGVkKDUpO1xuICBjb25zdCBUcmFuc21pdFNxdWVsY2hUb25lOiBudW1iZXIgfCB1bmRlZmluZWQgPSAocmVwZWF0ZXIuU3F1ZWxjaFRvbmUgJiYgcmVwZWF0ZXIuU3F1ZWxjaFRvbmUuSW5wdXQpO1xuICBjb25zdCBSZWNlaXZlU3F1ZWxjaFRvbmU6IG51bWJlciB8IHVuZGVmaW5lZCA9IChyZXBlYXRlci5TcXVlbGNoVG9uZSAmJiByZXBlYXRlci5TcXVlbGNoVG9uZS5PdXRwdXQpO1xuICBjb25zdCBUcmFuc21pdERpZ2l0YWxUb25lOiBudW1iZXIgfCB1bmRlZmluZWQgPSAocmVwZWF0ZXIuRGlnaXRhbFRvbmUgJiYgcmVwZWF0ZXIuRGlnaXRhbFRvbmUuSW5wdXQpO1xuICBjb25zdCBSZWNlaXZlRGlnaXRhbFRvbmU6IG51bWJlciB8IHVuZGVmaW5lZCA9IChyZXBlYXRlci5EaWdpdGFsVG9uZSAmJiByZXBlYXRlci5EaWdpdGFsVG9uZS5PdXRwdXQpO1xuICBsZXQgVG9uZU1vZGU6IFlhZXN1VG9uZU1vZGUgPSAnT0ZGJztcbiAgY29uc3QgTW9kZTogWWFlc3VNb2RlID0gJ0ZNJztcbiAgbGV0IENvbW1lbnQ6IHN0cmluZyA9IGAke3JlcGVhdGVyLlN0YXRlSUR9ICR7cmVwZWF0ZXIuSUR9ICR7cmVwZWF0ZXIuTG9jYXRpb24gJiYgcmVwZWF0ZXIuTG9jYXRpb24uRGlzdGFuY2UgJiYgcmVwZWF0ZXIuTG9jYXRpb24uRGlzdGFuY2UudG9GaXhlZCgyKX0gJHtyZXBlYXRlci5Mb2NhdGlvbiAmJiByZXBlYXRlci5Mb2NhdGlvbi5TdGF0ZX0gJHtyZXBlYXRlci5Mb2NhdGlvbiAmJiByZXBlYXRlci5Mb2NhdGlvbi5Db3VudHl9ICR7cmVwZWF0ZXIuTG9jYXRpb24gJiYgcmVwZWF0ZXIuTG9jYXRpb24uTG9jYWx9ICR7cmVwZWF0ZXIuQ2FsbHNpZ259YDtcbiAgQ29tbWVudCA9IENvbW1lbnQucmVwbGFjZSgvdW5kZWZpbmVkL2csICcgJykucmVwbGFjZSgvXFxzKy9nLCAnICcpLnRyaW0oKTtcblxuICBpZiAoVHJhbnNtaXRTcXVlbGNoVG9uZSkge1xuICAgIFRvbmVNb2RlID0gJ1RPTkUgRU5DJztcbiAgfSBlbHNlIGlmIChUcmFuc21pdERpZ2l0YWxUb25lKSB7XG4gICAgVG9uZU1vZGUgPSAnRENTJztcbiAgfVxuXG4gIGlmIChUcmFuc21pdFNxdWVsY2hUb25lICYmIFJlY2VpdmVTcXVlbGNoVG9uZSAmJiBUcmFuc21pdFNxdWVsY2hUb25lID09PSBSZWNlaXZlU3F1ZWxjaFRvbmUpIHtcbiAgICBUb25lTW9kZSA9ICdUT05FIFNRTCc7XG4gIH0gZWxzZSBpZiAoVHJhbnNtaXREaWdpdGFsVG9uZSAmJiBSZWNlaXZlRGlnaXRhbFRvbmUgJiYgVHJhbnNtaXREaWdpdGFsVG9uZSA9PT0gUmVjZWl2ZURpZ2l0YWxUb25lKSB7XG4gICAgVG9uZU1vZGUgPSAnRENTJztcbiAgfVxuXG4gIGNvbnN0IENUQ1NTOiBzdHJpbmcgPSAoVHJhbnNtaXRTcXVlbGNoVG9uZSB8fCAxMDApLnRvRml4ZWQoMSkgKyAnIEh6JztcbiAgY29uc3QgRENTTnVtYmVyOiBudW1iZXIgPSAoVHJhbnNtaXREaWdpdGFsVG9uZSB8fCAyMyk7XG4gIGNvbnN0IERDUzogc3RyaW5nID0gRENTTnVtYmVyIDwgMTAwID8gJzAnICsgRENTTnVtYmVyIDogJycgKyBEQ1NOdW1iZXI7XG5cbiAgcmV0dXJuIHtcbiAgICAuLi55YWVzdSxcbiAgICBSZWNlaXZlLFxuICAgIFRyYW5zbWl0LFxuICAgIE9mZnNldCxcbiAgICBEaXJlY3Rpb24sXG4gICAgTmFtZSxcbiAgICBUb25lTW9kZSxcbiAgICBDVENTUyxcbiAgICBEQ1MsXG4gICAgTW9kZSxcbiAgICBDb21tZW50LFxuICB9O1xufVxuXG5hc3luYyBmdW5jdGlvbiBzdGFydCgpOiBQcm9taXNlPHZvaWQ+IHtcbi8vIGNvbnN0IGNvRmlsZXMgPSAoYXdhaXQgcmVhZGRpckFzeW5jKFwiLi9yZXBlYXRlcnMvZGF0YS9DTy9cIikpLm1hcCgoZikgPT4gYGRhdGEvQ08vJHtmfWApO1xuLy8gY29uc3QgdXRGaWxlcyA9IChhd2FpdCByZWFkZGlyQXN5bmMoXCIuL3JlcGVhdGVycy9kYXRhL1VUL1wiKSkubWFwKChmKSA9PiBgZGF0YS9VVC8ke2Z9YCk7XG4vLyBjb25zdCBubUZpbGVzID0gKGF3YWl0IHJlYWRkaXJBc3luYyhcIi4vcmVwZWF0ZXJzL2RhdGEvTk0vXCIpKS5tYXAoKGYpID0+IGBkYXRhL05NLyR7Zn1gKTtcbi8vIGNvbnN0IGNvR3JvdXBzID0gKGF3YWl0IHJlYWRkaXJBc3luYyhcIi4vcmVwZWF0ZXJzL2dyb3Vwcy9DTy9cIikpLm1hcCgoZikgPT4gYGdyb3Vwcy9DTy8ke2Z9YCk7XG4vLyBjb25zdCB1dEdyb3VwcyA9IChhd2FpdCByZWFkZGlyQXN5bmMoXCIuL3JlcGVhdGVycy9ncm91cHMvVVQvXCIpKS5tYXAoKGYpID0+IGBncm91cHMvVVQvJHtmfWApO1xuLy8gY29uc3Qgbm1Hcm91cHMgPSAoYXdhaXQgcmVhZGRpckFzeW5jKFwiLi9yZXBlYXRlcnMvZ3JvdXBzL05NL1wiKSkubWFwKChmKSA9PiBgZ3JvdXBzL05NLyR7Zn1gKTtcbi8vIGNvbnN0IGFsbEZpbGVzID0gWy4uLmNvRmlsZXMsIC4uLnV0RmlsZXMsIC4uLm5tRmlsZXMsIC4uLmNvR3JvdXBzLCAuLi51dEdyb3VwcywgLi4ubm1Hcm91cHNdLmZpbHRlcigoZikgPT4gL1xcLmpzb24kLy50ZXN0KGYpKS5tYXAoKGYpID0+IGYucmVwbGFjZShcIi5qc29uXCIsIFwiXCIpKTtcbi8vIGZvciAoY29uc3QgZmlsZSBvZiBhbGxGaWxlcykge1xuLy8gICBhd2FpdCBkb0l0KGZpbGUpO1xuLy8gfVxuXG4vLyBhd2FpdCBkb0l0KFwiZGF0YS9yZXBlYXRlcnMvZ3JvdXBzL0NPL0NvbG9yYWRvIFNwcmluZ3MgLSBDYWxsLmpzb25cIiwgXCJkYXRhL3JlcGVhdGVycy95YWVzdS9ncm91cHMvQ08vQ29sb3JhZG8gU3ByaW5ncyAtIENhbGxcIik7XG4vLyBhd2FpdCBkb0l0KFwiZGF0YS9yZXBlYXRlcnMvcmVzdWx0cy9DTy9Db2xvcmFkbyBTcHJpbmdzLmpzb25cIiwgXCJkYXRhL3JlcGVhdGVycy95YWVzdS9DTy9Db2xvcmFkbyBTcHJpbmdzXCIpO1xuICBhd2FpdCBkb0l0KCdkYXRhL3JlcGVhdGVycy9jb252ZXJ0ZWQvQ08uanNvbicsICdkYXRhL3JlcGVhdGVycy95YWVzdS9DTycpO1xuICAvLyBhd2FpdCBkb0l0KCdkYXRhL3JlcGVhdGVycy9ncm91cHMvY29tYmluZWQvQ08gLSBDYWxsLmpzb24nLCAnZGF0YS9yZXBlYXRlcnMveWFlc3UvZ3JvdXBzL0NPIC0gQ2FsbCcpO1xufVxuXG5leHBvcnQgZGVmYXVsdCBzdGFydCgpO1xuIl19