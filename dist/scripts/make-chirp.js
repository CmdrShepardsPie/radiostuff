var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
(function (factory) {
    if (typeof module === "object" && typeof module.exports === "object") {
        var v = factory(require, exports);
        if (v !== undefined) module.exports = v;
    }
    else if (typeof define === "function" && define.amd) {
        define(["require", "exports", "module-alias/register", "@helpers/fs-helpers", "@helpers/log-helpers", "@interfaces/i-repeater-structured", "gps-distance"], factory);
    }
})(function (require, exports) {
    "use strict";
    Object.defineProperty(exports, "__esModule", { value: true });
    require("module-alias/register");
    const fs_helpers_1 = require("@helpers/fs-helpers");
    const log_helpers_1 = require("@helpers/log-helpers");
    const i_repeater_structured_1 = require("@interfaces/i-repeater-structured");
    const gps_distance_1 = __importDefault(require("gps-distance"));
    const log = log_helpers_1.createLog('Make Chirp');
    const chirp = {
        Location: null,
        Name: '',
        Frequency: null,
        Duplex: '',
        Offset: null,
        Tone: '',
        rToneFreq: null,
        cToneFreq: null,
        DtcsCode: null,
        DtcsRxCode: null,
        DtcsPolarity: 'NN',
        Mode: 'FM',
        TStep: 5,
        Comment: '',
    };
    const myPoint = [39.627071500, -104.893322500]; // 4982 S Ulster St
    async function doIt(inFileName, outFileName) {
        const simplex = JSON.parse((await fs_helpers_1.readFileAsync('data/frequencies.json')).toString())
            .map((map) => ({ Callsign: map.Name, Frequency: { Output: map.Frequency, Input: map.Frequency } }))
            .filter((filter) => /FM|Voice|Simplex/i.test(filter.Callsign))
            .filter((filter) => !(/Data|Digital|Packet/i.test(filter.Callsign)));
        const repeaters = JSON.parse((await fs_helpers_1.readFileAsync(inFileName)).toString());
        repeaters.forEach((each) => {
            each.Location.Distance = gps_distance_1.default([myPoint, [each.Location.Latitude, each.Location.Longitude]]);
        });
        repeaters.sort((a, b) => a.Location.Distance > b.Location.Distance ? 1 :
            a.Location.Distance < b.Location.Distance ? -1 : 0);
        const mapped = [
            ...simplex,
            ...repeaters
                .filter((filter) => (filter.Frequency.Output >= 144 && filter.Frequency.Output <= 148) ||
                (filter.Frequency.Output >= 222 && filter.Frequency.Output <= 225) ||
                (filter.Frequency.Output >= 420 && filter.Frequency.Output <= 450))
                .filter((filter) => !filter.Digital &&
                filter.Status !== i_repeater_structured_1.RepeaterStatus.OffAir &&
                filter.Use === i_repeater_structured_1.RepeaterUse.Open),
        ]
            .map((map, index) => ({ ...convertToRadio(map), Location: index }));
        const short = mapped
            .slice(0, 128)
            .sort((a, b) => a.Frequency - b.Frequency)
            .map((map, index) => ({ ...map, Location: index }));
        const long = mapped
            .slice(0, 200)
            .sort((a, b) => a.Frequency - b.Frequency)
            .map((map, index) => ({ ...map, Location: index }));
        await fs_helpers_1.writeToJsonAndCsv(outFileName + '-short', short);
        await fs_helpers_1.writeToJsonAndCsv(outFileName + '-long', long);
    }
    function convertToRadio(repeater) {
        let Name = '';
        if (repeater.Callsign) {
            Name += repeater.Callsign.trim();
        }
        if (repeater.Location && repeater.Location.Local) {
            Name += (Name ? ' ' : '') + repeater.Location.Local.trim();
        }
        if (repeater.Frequency && repeater.Frequency.Output) {
            Name += (Name ? ' ' : '') + repeater.Frequency.Output.toString().trim();
        }
        Name = Name.replace(/[^0-9.a-zA-Z \/]/g, '').trim();
        Name = Name.replace(/[ ]+/g, ' ').trim();
        Name = Name.substr(0, 8).trim();
        const Frequency = repeater.Frequency.Output;
        let Offset = repeater.Frequency.Input - repeater.Frequency.Output;
        const Duplex = Offset > 0 ? '+' : Offset < 0 ? '-' : '';
        Offset = Math.abs(Math.round(Offset * 100) / 100);
        let rToneFreq = (repeater.SquelchTone && repeater.SquelchTone.Input);
        let cToneFreq = (repeater.SquelchTone && repeater.SquelchTone.Output);
        let DtcsCode = (repeater.DigitalTone && repeater.DigitalTone.Input);
        let DtcsRxCode = (repeater.DigitalTone && repeater.DigitalTone.Output);
        let Tone = '';
        const Mode = 'FM';
        let Comment = `${repeater.StateID} ${repeater.ID} ${repeater.Location && repeater.Location.Distance && repeater.Location.Distance.toFixed(2)} ${repeater.Location && repeater.Location.State} ${repeater.Location && repeater.Location.County} ${repeater.Location && repeater.Location.Local} ${repeater.Callsign}`;
        Comment = Comment.replace(/undefined/g, ' ').replace(/\s+/g, ' ').trim();
        // `${item['ST/PR'] || ''} ${item.County || ''} ${item.Location || ''} ${item.Call || ''} ${item.Sponsor || ''} ${item.Affiliate || ''} ${item.Frequency} ${item.Use || ''} ${item['Op Status'] || ''} ${item.Comment || ''}`.replace(/\s+/g, ' ');
        // Comment = Comment.trim().replace(",", "").substring(0, 31).trim();
        if (rToneFreq) {
            Tone = 'Tone';
        }
        else if (DtcsCode) {
            Tone = 'DTCS';
        }
        if (cToneFreq) {
            Tone = 'TSQL';
        }
        else if (DtcsRxCode) {
            Tone = 'DTCS';
        }
        if ((rToneFreq && cToneFreq && (rToneFreq !== cToneFreq))) {
            Tone = 'Cross';
        }
        cToneFreq = cToneFreq || 88.5;
        rToneFreq = rToneFreq || 88.5;
        DtcsCode = DtcsCode || 23;
        DtcsRxCode = DtcsRxCode || 23;
        // log(chalk.green("Made Row"), row);
        return {
            ...chirp,
            // Location,
            Name,
            Frequency,
            Duplex,
            Offset,
            rToneFreq,
            cToneFreq,
            DtcsCode,
            DtcsRxCode,
            Tone,
            Mode,
            Comment,
        };
    }
    async function start() {
        // const coFiles = (await readdirAsync("./repeaters/data/CO/")).map((f) => `data/CO/${f}`);
        // const utFiles = (await readdirAsync("./repeaters/data/UT/")).map((f) => `data/UT/${f}`);
        // const nmFiles = (await readdirAsync("./repeaters/data/NM/")).map((f) => `data/NM/${f}`);
        // const coGroups = (await readdirAsync("./repeaters/groups/CO/")).map((f) => `groups/CO/${f}`);
        // const utGroups = (await readdirAsync("./repeaters/groups/UT/")).map((f) => `groups/UT/${f}`);
        // const nmGroups = (await readdirAsync("./repeaters/groups/NM/")).map((f) => `groups/NM/${f}`);
        // const allFiles = [...coFiles, ...utFiles, ...nmFiles, ...coGroups, ...utGroups, ...nmGroups].filter((f) => /\.json$/.test(f)).map((f) => f.replace(".json", ""));
        // for (const file of allFiles) {
        //   await doIt(file);
        // }
        // await doIt("data/repeaters/groups/CO/Colorado Springs - Call.json", "data/repeaters/chirp/groups/CO/Colorado Springs - Call");
        // await doIt("data/repeaters/results/CO/Colorado Springs.json", "data/repeaters/chirp/CO/Colorado Springs");
        await doIt('data/repeaters/converted/CO.json', 'data/repeaters/chirp/CO');
        // await doIt('data/repeaters/groups/combined/CO - Call.json', 'data/repeaters/chirp/groups/CO - Call');
    }
    exports.default = start();
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWFrZS1jaGlycC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9zY3JpcHRzL21ha2UtY2hpcnAudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7SUFBQSxpQ0FBK0I7SUFFL0Isb0RBQXVFO0lBQ3ZFLHNEQUFpRDtJQUVqRCw2RUFBcUc7SUFFckcsZ0VBQWtEO0lBRWxELE1BQU0sR0FBRyxHQUE0Qix1QkFBUyxDQUFDLFlBQVksQ0FBQyxDQUFDO0lBRTdELE1BQU0sS0FBSyxHQUFXO1FBQ3BCLFFBQVEsRUFBRSxJQUFXO1FBQ3JCLElBQUksRUFBRSxFQUFFO1FBQ1IsU0FBUyxFQUFFLElBQVc7UUFDdEIsTUFBTSxFQUFFLEVBQUU7UUFDVixNQUFNLEVBQUUsSUFBVztRQUNuQixJQUFJLEVBQUUsRUFBRTtRQUNSLFNBQVMsRUFBRSxJQUFXO1FBQ3RCLFNBQVMsRUFBRSxJQUFXO1FBQ3RCLFFBQVEsRUFBRSxJQUFXO1FBQ3JCLFVBQVUsRUFBRSxJQUFXO1FBQ3ZCLFlBQVksRUFBRSxJQUFJO1FBQ2xCLElBQUksRUFBRSxJQUFJO1FBQ1YsS0FBSyxFQUFFLENBQUM7UUFDUixPQUFPLEVBQUUsRUFBRTtLQUNaLENBQUM7SUFFRixNQUFNLE9BQU8sR0FBVSxDQUFDLFlBQVksRUFBRSxDQUFDLGFBQWEsQ0FBQyxDQUFDLENBQUMsbUJBQW1CO0lBRTFFLEtBQUssVUFBVSxJQUFJLENBQUMsVUFBa0IsRUFBRSxXQUFtQjtRQUN6RCxNQUFNLE9BQU8sR0FDWCxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsTUFBTSwwQkFBYSxDQUFDLHVCQUF1QixDQUFDLENBQUMsQ0FBQyxRQUFRLEVBQUUsQ0FBQzthQUNsRSxHQUFHLENBQUMsQ0FBQyxHQUFzQixFQUFFLEVBQUUsQ0FDOUIsQ0FBQyxFQUFFLFFBQVEsRUFBRSxHQUFHLENBQUMsSUFBSSxFQUFFLFNBQVMsRUFBRSxFQUFFLE1BQU0sRUFBRSxHQUFHLENBQUMsU0FBUyxF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QUM7UUFDOUIsUUFBUSxHQUFHLFFBQVEsSUFBSSxFQUFFLENBQUM7UUFDMUIsVUFBVSxHQUFHLFVBQVUsSUFBSSxFQUFFLENBQUM7UUFFaEMscUNBQXFDO1FBQ25DLE9BQU87WUFDTCxHQUFHLEtBQUs7WUFDWixZQUFZO1lBQ1IsSUFBSTtZQUNKLFNBQVM7WUFDVCxNQUFNO1lBQ04sTUFBTTtZQUNOLFNBQVM7WUFDVCxTQUFTO1lBQ1QsUUFBUTtZQUNSLFVBQVU7WUFDVixJQUFJO1lBQ0osSUFBSTtZQUNKLE9BQU87U0FDUixDQUFDO0lBQ0osQ0FBQztJQUVELEtBQUssVUFBVSxLQUFLO1FBQ3BCLDJGQUEyRjtRQUMzRiwyRkFBMkY7UUFDM0YsMkZBQTJGO1FBQzNGLGdHQUFnRztRQUNoRyxnR0FBZ0c7UUFDaEcsZ0dBQWdHO1FBQ2hHLG9LQUFvSztRQUNwSyxpQ0FBaUM7UUFDakMsc0JBQXNCO1FBQ3RCLElBQUk7UUFFSixpSUFBaUk7UUFDakksNkdBQTZHO1FBQzNHLE1BQU0sSUFBSSxDQUFDLGtDQUFrQyxFQUFFLHlCQUF5QixDQUFDLENBQUM7UUFDMUUsd0dBQXdHO0lBQzFHLENBQUM7SUFFRCxrQkFBZSxLQUFLLEVBQUUsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAnbW9kdWxlLWFsaWFzL3JlZ2lzdGVyJztcblxuaW1wb3J0IHsgcmVhZEZpbGVBc3luYywgd3JpdGVUb0pzb25BbmRDc3YgfSBmcm9tICdAaGVscGVycy9mcy1oZWxwZXJzJztcbmltcG9ydCB7IGNyZWF0ZUxvZyB9IGZyb20gJ0BoZWxwZXJzL2xvZy1oZWxwZXJzJztcbmltcG9ydCB7IENoaXJwRHVwbGV4LCBDaGlycE1vZGUsIENoaXJwVG9uZSwgSUNoaXJwIH0gZnJvbSAnQGludGVyZmFjZXMvaS1jaGlycCc7XG5pbXBvcnQgeyBJUmVwZWF0ZXJTdHJ1Y3R1cmVkLCBSZXBlYXRlclN0YXR1cywgUmVwZWF0ZXJVc2UgfSBmcm9tICdAaW50ZXJmYWNlcy9pLXJlcGVhdGVyLXN0cnVjdHVyZWQnO1xuaW1wb3J0IHsgSVNpbXBsZXhGcmVxdWVuY3kgfSBmcm9tICdAaW50ZXJmYWNlcy9pLXNpbXBsZXgtZnJlcXVlbmN5JztcbmltcG9ydCBncHNEaXN0YW5jZSwgeyBQb2ludCB9IGZyb20gJ2dwcy1kaXN0YW5jZSc7XG5cbmNvbnN0IGxvZzogKC4uLm1zZzogYW55W10pID0+IHZvaWQgPSBjcmVhdGVMb2coJ01ha2UgQ2hpcnAnKTtcblxuY29uc3QgY2hpcnA6IElDaGlycCA9IHtcbiAgTG9jYXRpb246IG51bGwgYXMgYW55LFxuICBOYW1lOiAnJyxcbiAgRnJlcXVlbmN5OiBudWxsIGFzIGFueSxcbiAgRHVwbGV4OiAnJyxcbiAgT2Zmc2V0OiBudWxsIGFzIGFueSxcbiAgVG9uZTogJycsXG4gIHJUb25lRnJlcTogbnVsbCBhcyBhbnksXG4gIGNUb25lRnJlcTogbnVsbCBhcyBhbnksXG4gIER0Y3NDb2RlOiBudWxsIGFzIGFueSxcbiAgRHRjc1J4Q29kZTogbnVsbCBhcyBhbnksXG4gIER0Y3NQb2xhcml0eTogJ05OJyxcbiAgTW9kZTogJ0ZNJyxcbiAgVFN0ZXA6IDUsXG4gIENvbW1lbnQ6ICcnLFxufTtcblxuY29uc3QgbXlQb2ludDogUG9pbnQgPSBbMzkuNjI3MDcxNTAwLCAtMTA0Ljg5MzMyMjUwMF07IC8vIDQ5ODIgUyBVbHN0ZXIgU3RcblxuYXN5bmMgZnVuY3Rpb24gZG9JdChpbkZpbGVOYW1lOiBzdHJpbmcsIG91dEZpbGVOYW1lOiBzdHJpbmcpOiBQcm9taXNlPHZvaWQ+IHtcbiAgY29uc3Qgc2ltcGxleDogSVJlcGVhdGVyU3RydWN0dXJlZFtdID1cbiAgICBKU09OLnBhcnNlKChhd2FpdCByZWFkRmlsZUFzeW5jKCdkYXRhL2ZyZXF1ZW5jaWVzLmpzb24nKSkudG9TdHJpbmcoKSlcbiAgICAgIC5tYXAoKG1hcDogSVNpbXBsZXhGcmVxdWVuY3kpID0+XG4gICAgICAgICh7IENhbGxzaWduOiBtYXAuTmFtZSwgRnJlcXVlbmN5OiB7IE91dHB1dDogbWFwLkZyZXF1ZW5jeSwgSW5wdXQ6IG1hcC5GcmVxdWVuY3kgfSB9KSlcbiAgICAgIC5maWx0ZXIoKGZpbHRlcjogSVJlcGVhdGVyU3RydWN0dXJlZCkgPT4gL0ZNfFZvaWNlfFNpbXBsZXgvaS50ZXN0KGZpbHRlci5DYWxsc2lnbikpXG4gICAgICAuZmlsdGVyKChmaWx0ZXI6IElSZXBlYXRlclN0cnVjdHVyZWQpID0+ICEoL0RhdGF8RGlnaXRhbHxQYWNrZXQvaS50ZXN0KGZpbHRlci5DYWxsc2lnbikpKTtcblxuICBjb25zdCByZXBlYXRlcnM6IElSZXBlYXRlclN0cnVjdHVyZWRbXSA9XG4gICAgSlNPTi5wYXJzZSgoYXdhaXQgcmVhZEZpbGVBc3luYyhpbkZpbGVOYW1lKSkudG9TdHJpbmcoKSk7XG5cbiAgcmVwZWF0ZXJzLmZvckVhY2goKGVhY2g6IElSZXBlYXRlclN0cnVjdHVyZWQpID0+IHtcbiAgICBlYWNoLkxvY2F0aW9uLkRpc3RhbmNlID0gZ3BzRGlzdGFuY2UoW215UG9pbnQsIFtlYWNoLkxvY2F0aW9uLkxhdGl0dWRlLCBlYWNoLkxvY2F0aW9uLkxvbmdpdHVkZV1dKTtcbiAgfSk7XG5cbiAgcmVwZWF0ZXJzLnNvcnQoKGE6IElSZXBlYXRlclN0cnVjdHVyZWQsIGI6IElSZXBlYXRlclN0cnVjdHVyZWQpID0+XG4gICAgYS5Mb2NhdGlvbi5EaXN0YW5jZSEgPiBiLkxvY2F0aW9uLkRpc3RhbmNlISA/IDEgOlxuICAgICAgYS5Mb2NhdGlvbi5EaXN0YW5jZSEgPCBiLkxvY2F0aW9uLkRpc3RhbmNlISA/IC0xIDogMCk7XG4gIGNvbnN0IG1hcHBlZDogSUNoaXJwW10gPSBbXG4gICAgLi4uc2ltcGxleCxcbiAgICAuLi5yZXBlYXRlcnNcbiAgICAgIC5maWx0ZXIoKGZpbHRlcjogSVJlcGVhdGVyU3RydWN0dXJlZCkgPT5cbiAgICAgICAgKGZpbHRlci5GcmVxdWVuY3kuT3V0cHV0ID49IDE0NCAmJiBmaWx0ZXIuRnJlcXVlbmN5Lk91dHB1dCA8PSAxNDgpIHx8XG4gICAgICAgIChmaWx0ZXIuRnJlcXVlbmN5Lk91dHB1dCA+PSAyMjIgJiYgZmlsdGVyLkZyZXF1ZW5jeS5PdXRwdXQgPD0gMjI1KSB8fFxuICAgICAgICAoZmlsdGVyLkZyZXF1ZW5jeS5PdXRwdXQgPj0gNDIwICYmIGZpbHRlci5GcmVxdWVuY3kuT3V0cHV0IDw9IDQ1MCkpXG4gICAgICAuZmlsdGVyKChmaWx0ZXI6IElSZXBlYXRlclN0cnVjdHVyZWQpID0+XG4gICAgICAgICFmaWx0ZXIuRGlnaXRhbCAmJlxuICAgICAgICBmaWx0ZXIuU3RhdHVzICE9PSBSZXBlYXRlclN0YXR1cy5PZmZBaXIgJiZcbiAgICAgICAgZmlsdGVyLlVzZSA9PT0gUmVwZWF0ZXJVc2UuT3BlbiksXG4gIF1cbiAgICAubWFwKChtYXA6IElSZXBlYXRlclN0cnVjdHVyZWQsIGluZGV4OiBudW1iZXIpOiBJQ2hpcnAgPT4gKHsgLi4uY29udmVydFRvUmFkaW8obWFwKSwgTG9jYXRpb246IGluZGV4IH0pKTtcblxuICBjb25zdCBzaG9ydDogSUNoaXJwW10gPSBtYXBwZWRcbiAgICAuc2xpY2UoMCwgMTI4KVxuICAgIC5zb3J0KChhOiBJQ2hpcnAsIGI6IElDaGlycCkgPT4gYS5GcmVxdWVuY3kgLSBiLkZyZXF1ZW5jeSlcbiAgICAubWFwKChtYXA6IElDaGlycCwgaW5kZXg6IG51bWJlcik6IElDaGlycCA9PiAoeyAuLi5tYXAsIExvY2F0aW9uOiBpbmRleCB9KSk7XG5cbiAgY29uc3QgbG9uZzogSUNoaXJwW10gPSBtYXBwZWRcbiAgICAuc2xpY2UoMCwgMjAwKVxuICAgIC5zb3J0KChhOiBJQ2hpcnAsIGI6IElDaGlycCkgPT4gYS5GcmVxdWVuY3kgLSBiLkZyZXF1ZW5jeSlcbiAgICAubWFwKChtYXA6IElDaGlycCwgaW5kZXg6IG51bWJlcik6IElDaGlycCA9PiAoeyAuLi5tYXAsIExvY2F0aW9uOiBpbmRleCB9KSk7XG5cbiAgYXdhaXQgd3JpdGVUb0pzb25BbmRDc3Yob3V0RmlsZU5hbWUgKyAnLXNob3J0Jywgc2hvcnQpO1xuICBhd2FpdCB3cml0ZVRvSnNvbkFuZENzdihvdXRGaWxlTmFtZSArICctbG9uZycsIGxvbmcpO1xufVxuXG5mdW5jdGlvbiBjb252ZXJ0VG9SYWRpbyhyZXBlYXRlcjogSVJlcGVhdGVyU3RydWN0dXJlZCk6IElDaGlycCB7XG4gIGxldCBOYW1lOiBzdHJpbmcgPSAnJztcblxuICBpZiAocmVwZWF0ZXIuQ2FsbHNpZ24pIHtcbiAgICBOYW1lICs9IHJlcGVhdGVyLkNhbGxzaWduLnRyaW0oKTtcbiAgfVxuXG4gIGlmIChyZXBlYXRlci5Mb2NhdGlvbiAmJiByZXBlYXRlci5Mb2NhdGlvbi5Mb2NhbCkge1xuICAgIE5hbWUgKz0gKE5hbWUgPyAnICcgOiAnJykgKyByZXBlYXRlci5Mb2NhdGlvbi5Mb2NhbC50cmltKCk7XG4gIH1cblxuICBpZiAocmVwZWF0ZXIuRnJlcXVlbmN5ICYmIHJlcGVhdGVyLkZyZXF1ZW5jeS5PdXRwdXQpIHtcbiAgICBOYW1lICs9IChOYW1lID8gJyAnIDogJycpICsgcmVwZWF0ZXIuRnJlcXVlbmN5Lk91dHB1dC50b1N0cmluZygpLnRyaW0oKTtcbiAgfVxuXG4gIE5hbWUgPSBOYW1lLnJlcGxhY2UoL1teMC05LmEtekEtWiBcXC9dL2csICcnKS50cmltKCk7XG4gIE5hbWUgPSBOYW1lLnJlcGxhY2UoL1sgXSsvZywgJyAnKS50cmltKCk7XG4gIE5hbWUgPSBOYW1lLnN1YnN0cigwLCA4KS50cmltKCk7XG5cbiAgY29uc3QgRnJlcXVlbmN5OiBudW1iZXIgPSByZXBlYXRlci5GcmVxdWVuY3kuT3V0cHV0O1xuICBsZXQgT2Zmc2V0OiBudW1iZXIgPSByZXBlYXRlci5GcmVxdWVuY3kuSW5wdXQgLSByZXBlYXRlci5GcmVxdWVuY3kuT3V0cHV0O1xuICBjb25zdCBEdXBsZXg6IENoaXJwRHVwbGV4ID0gT2Zmc2V0ID4gMCA/ICcrJyA6IE9mZnNldCA8IDAgPyAnLScgOiAnJztcbiAgT2Zmc2V0ID0gTWF0aC5hYnMoTWF0aC5yb3VuZChPZmZzZXQgKiAxMDApIC8gMTAwKTtcbiAgbGV0IHJUb25lRnJlcTogbnVtYmVyIHwgdW5kZWZpbmVkID0gKHJlcGVhdGVyLlNxdWVsY2hUb25lICYmIHJlcGVhdGVyLlNxdWVsY2hUb25lLklucHV0KTtcbiAgbGV0IGNUb25lRnJlcTogbnVtYmVyIHwgdW5kZWZpbmVkID0gKHJlcGVhdGVyLlNxdWVsY2hUb25lICYmIHJlcGVhdGVyLlNxdWVsY2hUb25lLk91dHB1dCk7XG4gIGxldCBEdGNzQ29kZTogbnVtYmVyIHwgdW5kZWZpbmVkID0gKHJlcGVhdGVyLkRpZ2l0YWxUb25lICYmIHJlcGVhdGVyLkRpZ2l0YWxUb25lLklucHV0KTtcbiAgbGV0IER0Y3NSeENvZGU6IG51bWJlciB8IHVuZGVmaW5lZCA9IChyZXBlYXRlci5EaWdpdGFsVG9uZSAmJiByZXBlYXRlci5EaWdpdGFsVG9uZS5PdXRwdXQpO1xuICBsZXQgVG9uZTogQ2hpcnBUb25lID0gJyc7XG4gIGNvbnN0IE1vZGU6IENoaXJwTW9kZSA9ICdGTSc7XG4gIGxldCBDb21tZW50OiBzdHJpbmcgPSBgJHtyZXBlYXRlci5TdGF0ZUlEfSAke3JlcGVhdGVyLklEfSAke3JlcGVhdGVyLkxvY2F0aW9uICYmIHJlcGVhdGVyLkxvY2F0aW9uLkRpc3RhbmNlICYmIHJlcGVhdGVyLkxvY2F0aW9uLkRpc3RhbmNlLnRvRml4ZWQoMil9ICR7cmVwZWF0ZXIuTG9jYXRpb24gJiYgcmVwZWF0ZXIuTG9jYXRpb24uU3RhdGV9ICR7cmVwZWF0ZXIuTG9jYXRpb24gJiYgcmVwZWF0ZXIuTG9jYXRpb24uQ291bnR5fSAke3JlcGVhdGVyLkxvY2F0aW9uICYmIHJlcGVhdGVyLkxvY2F0aW9uLkxvY2FsfSAke3JlcGVhdGVyLkNhbGxzaWdufWA7XG4gIENvbW1lbnQgPSBDb21tZW50LnJlcGxhY2UoL3VuZGVmaW5lZC9nLCAnICcpLnJlcGxhY2UoL1xccysvZywgJyAnKS50cmltKCk7XG4gIC8vIGAke2l0ZW1bJ1NUL1BSJ10gfHwgJyd9ICR7aXRlbS5Db3VudHkgfHwgJyd9ICR7aXRlbS5Mb2NhdGlvbiB8fCAnJ30gJHtpdGVtLkNhbGwgfHwgJyd9ICR7aXRlbS5TcG9uc29yIHx8ICcnfSAke2l0ZW0uQWZmaWxpYXRlIHx8ICcnfSAke2l0ZW0uRnJlcXVlbmN5fSAke2l0ZW0uVXNlIHx8ICcnfSAke2l0ZW1bJ09wIFN0YXR1cyddIHx8ICcnfSAke2l0ZW0uQ29tbWVudCB8fCAnJ31gLnJlcGxhY2UoL1xccysvZywgJyAnKTtcbiAgLy8gQ29tbWVudCA9IENvbW1lbnQudHJpbSgpLnJlcGxhY2UoXCIsXCIsIFwiXCIpLnN1YnN0cmluZygwLCAzMSkudHJpbSgpO1xuXG4gIGlmIChyVG9uZUZyZXEpIHtcbiAgICBUb25lID0gJ1RvbmUnO1xuICB9IGVsc2UgaWYgKER0Y3NDb2RlKSB7XG4gICAgVG9uZSA9ICdEVENTJztcbiAgfVxuXG4gIGlmIChjVG9uZUZyZXEpIHtcbiAgICBUb25lID0gJ1RTUUwnO1xuICB9IGVsc2UgaWYgKER0Y3NSeENvZGUpIHtcbiAgICBUb25lID0gJ0RUQ1MnO1xuICB9XG5cbiAgaWYgKChyVG9uZUZyZXEgJiYgY1RvbmVGcmVxICYmIChyVG9uZUZyZXEgIT09IGNUb25lRnJlcSkpKSB7XG4gICAgVG9uZSA9ICdDcm9zcyc7XG4gIH1cblxuICBjVG9uZUZyZXEgPSBjVG9uZUZyZXEgfHwgODguNTtcbiAgclRvbmVGcmVxID0gclRvbmVGcmVxIHx8IDg4LjU7XG4gIER0Y3NDb2RlID0gRHRjc0NvZGUgfHwgMjM7XG4gIER0Y3NSeENvZGUgPSBEdGNzUnhDb2RlIHx8IDIzO1xuXG4vLyBsb2coY2hhbGsuZ3JlZW4oXCJNYWRlIFJvd1wiKSwgcm93KTtcbiAgcmV0dXJuIHtcbiAgICAuLi5jaGlycCxcbi8vIExvY2F0aW9uLFxuICAgIE5hbWUsXG4gICAgRnJlcXVlbmN5LFxuICAgIER1cGxleCxcbiAgICBPZmZzZXQsXG4gICAgclRvbmVGcmVxLFxuICAgIGNUb25lRnJlcSxcbiAgICBEdGNzQ29kZSxcbiAgICBEdGNzUnhDb2RlLFxuICAgIFRvbmUsXG4gICAgTW9kZSxcbiAgICBDb21tZW50LFxuICB9O1xufVxuXG5hc3luYyBmdW5jdGlvbiBzdGFydCgpOiBQcm9taXNlPHZvaWQ+IHtcbi8vIGNvbnN0IGNvRmlsZXMgPSAoYXdhaXQgcmVhZGRpckFzeW5jKFwiLi9yZXBlYXRlcnMvZGF0YS9DTy9cIikpLm1hcCgoZikgPT4gYGRhdGEvQ08vJHtmfWApO1xuLy8gY29uc3QgdXRGaWxlcyA9IChhd2FpdCByZWFkZGlyQXN5bmMoXCIuL3JlcGVhdGVycy9kYXRhL1VUL1wiKSkubWFwKChmKSA9PiBgZGF0YS9VVC8ke2Z9YCk7XG4vLyBjb25zdCBubUZpbGVzID0gKGF3YWl0IHJlYWRkaXJBc3luYyhcIi4vcmVwZWF0ZXJzL2RhdGEvTk0vXCIpKS5tYXAoKGYpID0+IGBkYXRhL05NLyR7Zn1gKTtcbi8vIGNvbnN0IGNvR3JvdXBzID0gKGF3YWl0IHJlYWRkaXJBc3luYyhcIi4vcmVwZWF0ZXJzL2dyb3Vwcy9DTy9cIikpLm1hcCgoZikgPT4gYGdyb3Vwcy9DTy8ke2Z9YCk7XG4vLyBjb25zdCB1dEdyb3VwcyA9IChhd2FpdCByZWFkZGlyQXN5bmMoXCIuL3JlcGVhdGVycy9ncm91cHMvVVQvXCIpKS5tYXAoKGYpID0+IGBncm91cHMvVVQvJHtmfWApO1xuLy8gY29uc3Qgbm1Hcm91cHMgPSAoYXdhaXQgcmVhZGRpckFzeW5jKFwiLi9yZXBlYXRlcnMvZ3JvdXBzL05NL1wiKSkubWFwKChmKSA9PiBgZ3JvdXBzL05NLyR7Zn1gKTtcbi8vIGNvbnN0IGFsbEZpbGVzID0gWy4uLmNvRmlsZXMsIC4uLnV0RmlsZXMsIC4uLm5tRmlsZXMsIC4uLmNvR3JvdXBzLCAuLi51dEdyb3VwcywgLi4ubm1Hcm91cHNdLmZpbHRlcigoZikgPT4gL1xcLmpzb24kLy50ZXN0KGYpKS5tYXAoKGYpID0+IGYucmVwbGFjZShcIi5qc29uXCIsIFwiXCIpKTtcbi8vIGZvciAoY29uc3QgZmlsZSBvZiBhbGxGaWxlcykge1xuLy8gICBhd2FpdCBkb0l0KGZpbGUpO1xuLy8gfVxuXG4vLyBhd2FpdCBkb0l0KFwiZGF0YS9yZXBlYXRlcnMvZ3JvdXBzL0NPL0NvbG9yYWRvIFNwcmluZ3MgLSBDYWxsLmpzb25cIiwgXCJkYXRhL3JlcGVhdGVycy9jaGlycC9ncm91cHMvQ08vQ29sb3JhZG8gU3ByaW5ncyAtIENhbGxcIik7XG4vLyBhd2FpdCBkb0l0KFwiZGF0YS9yZXBlYXRlcnMvcmVzdWx0cy9DTy9Db2xvcmFkbyBTcHJpbmdzLmpzb25cIiwgXCJkYXRhL3JlcGVhdGVycy9jaGlycC9DTy9Db2xvcmFkbyBTcHJpbmdzXCIpO1xuICBhd2FpdCBkb0l0KCdkYXRhL3JlcGVhdGVycy9jb252ZXJ0ZWQvQ08uanNvbicsICdkYXRhL3JlcGVhdGVycy9jaGlycC9DTycpO1xuICAvLyBhd2FpdCBkb0l0KCdkYXRhL3JlcGVhdGVycy9ncm91cHMvY29tYmluZWQvQ08gLSBDYWxsLmpzb24nLCAnZGF0YS9yZXBlYXRlcnMvY2hpcnAvZ3JvdXBzL0NPIC0gQ2FsbCcpO1xufVxuXG5leHBvcnQgZGVmYXVsdCBzdGFydCgpO1xuIl19