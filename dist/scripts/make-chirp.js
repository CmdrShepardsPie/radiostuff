var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
(function (factory) {
    if (typeof module === "object" && typeof module.exports === "object") {
        var v = factory(require, exports);
        if (v !== undefined) module.exports = v;
    }
    else if (typeof define === "function" && define.amd) {
        define(["require", "exports", "module-alias/register", "@helpers/fs-helpers", "@helpers/log-helpers", "@interfaces/i-repeater-structured", "gps-distance"], factory);
    }
})(function (require, exports) {
    "use strict";
    Object.defineProperty(exports, "__esModule", { value: true });
    require("module-alias/register");
    const fs_helpers_1 = require("@helpers/fs-helpers");
    const log_helpers_1 = require("@helpers/log-helpers");
    const i_repeater_structured_1 = require("@interfaces/i-repeater-structured");
    const gps_distance_1 = __importDefault(require("gps-distance"));
    const log = log_helpers_1.createLog('Make Chirp');
    const chirp = {
        Location: null,
        Name: '',
        Frequency: null,
        Duplex: '',
        Offset: null,
        Tone: '',
        rToneFreq: null,
        cToneFreq: null,
        DtcsCode: null,
        DtcsRxCode: null,
        DtcsPolarity: 'NN',
        Mode: 'FM',
        TStep: 5,
        Comment: '',
    };
    const myPoint = [39.627071500, -104.893322500]; // 4982 S Ulster St
    async function doIt(inFileName, outFileName) {
        const simplex = JSON.parse((await fs_helpers_1.readFileAsync('data/frequencies.json')).toString())
            .map((map) => ({ Callsign: map.Name, Frequency: { Output: map.Frequency, Input: map.Frequency } }))
            .filter((filter) => /FM|Voice|Simplex/i.test(filter.Callsign))
            .filter((filter) => !(/Data|Digital|Packet/i.test(filter.Callsign)));
        const repeaters = JSON.parse((await fs_helpers_1.readFileAsync(inFileName)).toString());
        repeaters.forEach((each) => {
            each.Location.Distance = gps_distance_1.default([myPoint, [each.Location.Latitude, each.Location.Longitude]]);
        });
        repeaters.sort((a, b) => a.Location.Distance > b.Location.Distance ? 1 :
            a.Location.Distance < b.Location.Distance ? -1 : 0);
        const mapped = [
            ...simplex,
            ...repeaters
                .filter((filter) => (filter.Frequency.Output >= 144 && filter.Frequency.Output <= 148) ||
                (filter.Frequency.Output >= 222 && filter.Frequency.Output <= 225) ||
                (filter.Frequency.Output >= 420 && filter.Frequency.Output <= 450))
                .filter((filter) => !filter.Digital &&
                filter.Status !== i_repeater_structured_1.RepeaterStatus.OffAir &&
                filter.Use === i_repeater_structured_1.RepeaterUse.Open),
        ]
            .map((map, index) => ({ ...convertToRadio(map), Location: index }))
            .slice(0, 200)
            .sort((a, b) => a.Frequency - b.Frequency)
            .map((map, index) => ({ ...map, Location: index }));
        return fs_helpers_1.writeToJsonAndCsv(outFileName, mapped);
    }
    function convertToRadio(repeater) {
        let Name = '';
        if (repeater.Callsign) {
            Name += repeater.Callsign.trim();
            if (repeater.ID !== undefined) {
                Name = Name.substr(-3).trim().toUpperCase();
            }
        }
        if (repeater.Location && repeater.Location.Local) {
            Name += (Name ? ' ' : '') + repeater.Location.Local.trim().toLowerCase();
        }
        if (repeater.Frequency && repeater.Frequency.Output) {
            Name += (Name ? ' ' : '') + repeater.Frequency.Output.toString().trim();
        }
        Name = Name.replace(/[^0-9.a-zA-Z\/]/g, '').trim();
        Name = Name.substring(0, 7).trim();
        const Frequency = repeater.Frequency.Output;
        let Offset = repeater.Frequency.Input - repeater.Frequency.Output;
        const Duplex = Offset > 0 ? '+' : Offset < 0 ? '-' : '';
        Offset = Math.abs(Math.round(Offset * 100) / 100);
        let rToneFreq = (repeater.SquelchTone && repeater.SquelchTone.Input);
        let cToneFreq = (repeater.SquelchTone && repeater.SquelchTone.Output);
        let DtcsCode = (repeater.DigitalTone && repeater.DigitalTone.Input);
        let DtcsRxCode = (repeater.DigitalTone && repeater.DigitalTone.Output);
        let Tone = '';
        const Mode = 'FM';
        let Comment = `${repeater.StateID} ${repeater.ID} ${repeater.Location && repeater.Location.Distance && repeater.Location.Distance.toFixed(2)} ${repeater.Location && repeater.Location.State} ${repeater.Location && repeater.Location.County} ${repeater.Location && repeater.Location.Local} ${repeater.Callsign}`;
        Comment = Comment.replace(/undefined/g, ' ').replace(/\s+/g, ' ').trim();
        // `${item['ST/PR'] || ''} ${item.County || ''} ${item.Location || ''} ${item.Call || ''} ${item.Sponsor || ''} ${item.Affiliate || ''} ${item.Frequency} ${item.Use || ''} ${item['Op Status'] || ''} ${item.Comment || ''}`.replace(/\s+/g, ' ');
        // Comment = Comment.trim().replace(",", "").substring(0, 31).trim();
        if (rToneFreq) {
            Tone = 'Tone';
        }
        else if (DtcsCode) {
            Tone = 'DTCS';
        }
        if (cToneFreq) {
            Tone = 'TSQL';
        }
        else if (DtcsRxCode) {
            Tone = 'DTCS';
        }
        if ((rToneFreq && cToneFreq && (rToneFreq !== cToneFreq))) {
            Tone = 'Cross';
        }
        cToneFreq = cToneFreq || 88.5;
        rToneFreq = rToneFreq || 88.5;
        DtcsCode = DtcsCode || 23;
        DtcsRxCode = DtcsRxCode || 23;
        // log(chalk.green("Made Row"), row);
        return {
            ...chirp,
            // Location,
            Name,
            Frequency,
            Duplex,
            Offset,
            rToneFreq,
            cToneFreq,
            DtcsCode,
            DtcsRxCode,
            Tone,
            Mode,
            Comment,
        };
    }
    async function start() {
        // const coFiles = (await readdirAsync("./repeaters/data/CO/")).map((f) => `data/CO/${f}`);
        // const utFiles = (await readdirAsync("./repeaters/data/UT/")).map((f) => `data/UT/${f}`);
        // const nmFiles = (await readdirAsync("./repeaters/data/NM/")).map((f) => `data/NM/${f}`);
        // const coGroups = (await readdirAsync("./repeaters/groups/CO/")).map((f) => `groups/CO/${f}`);
        // const utGroups = (await readdirAsync("./repeaters/groups/UT/")).map((f) => `groups/UT/${f}`);
        // const nmGroups = (await readdirAsync("./repeaters/groups/NM/")).map((f) => `groups/NM/${f}`);
        // const allFiles = [...coFiles, ...utFiles, ...nmFiles, ...coGroups, ...utGroups, ...nmGroups].filter((f) => /\.json$/.test(f)).map((f) => f.replace(".json", ""));
        // for (const file of allFiles) {
        //   await doIt(file);
        // }
        // await doIt("data/repeaters/groups/CO/Colorado Springs - Call.json", "data/repeaters/chirp/groups/CO/Colorado Springs - Call");
        // await doIt("data/repeaters/results/CO/Colorado Springs.json", "data/repeaters/chirp/CO/Colorado Springs");
        await doIt('data/repeaters/converted/CO.json', 'data/repeaters/chirp/CO');
        // await doIt('data/repeaters/groups/combined/CO - Call.json', 'data/repeaters/chirp/groups/CO - Call');
    }
    exports.default = start();
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWFrZS1jaGlycC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9zY3JpcHRzL21ha2UtY2hpcnAudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7SUFBQSxpQ0FBK0I7SUFFL0Isb0RBQXVFO0lBQ3ZFLHNEQUFpRDtJQUVqRCw2RUFBcUc7SUFFckcsZ0VBQWtEO0lBRWxELE1BQU0sR0FBRyxHQUE0Qix1QkFBUyxDQUFDLFlBQVksQ0FBQyxDQUFDO0lBRTdELE1BQU0sS0FBSyxHQUFXO1FBQ3BCLFFBQVEsRUFBRSxJQUFXO1FBQ3JCLElBQUksRUFBRSxFQUFFO1FBQ1IsU0FBUyxFQUFFLElBQVc7UUFDdEIsTUFBTSxFQUFFLEVBQUU7UUFDVixNQUFNLEVBQUUsSUFBVztRQUNuQixJQUFJLEVBQUUsRUFBRTtRQUNSLFNBQVMsRUFBRSxJQUFXO1FBQ3RCLFNBQVMsRUFBRSxJQUFXO1FBQ3RCLFFBQVEsRUFBRSxJQUFXO1FBQ3JCLFVBQVUsRUFBRSxJQUFXO1FBQ3ZCLFlBQVksRUFBRSxJQUFJO1FBQ2xCLElBQUksRUFBRSxJQUFJO1FBQ1YsS0FBSyxFQUFFLENBQUM7UUFDUixPQUFPLEVBQUUsRUFBRTtLQUNaLENBQUM7SUFFRixNQUFNLE9BQU8sR0FBVSxDQUFDLFlBQVksRUFBRSxDQUFDLGFBQWEsQ0FBQyxDQUFDLENBQUMsbUJBQW1CO0lBRTFFLEtBQUssVUFBVSxJQUFJLENBQUMsVUFBa0IsRUFBRSxXQUFtQjtRQUN6RCxNQUFNLE9BQU8sR0FDWCxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsTUFBTSwwQkFBYSxDQUFDLHVCQUF1QixDQUFDLENBQUMsQ0FBQyxRQUFRLEVBQUUsQ0FBQzthQUNsRSxHQUFHLENBQUMsQ0FBQyxHQUFzQixFQUFFLEVBQUUsQ0FDOUIsQ0FBQyxFQUFFLFFBQVEsRUFBRSxHQUFHLENBQUMsSUFBSSxFQUFFLFNBQVMsRUFBRSxFQUFFLE1BQU0sRUFBRSxHQUFHLENBQUMsU0FBUyxF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M0YsMkZBQTJGO1FBQzNGLDJGQUEyRjtRQUMzRixnR0FBZ0c7UUFDaEcsZ0dBQWdHO1FBQ2hHLGdHQUFnRztRQUNoRyxvS0FBb0s7UUFDcEssaUNBQWlDO1FBQ2pDLHNCQUFzQjtRQUN0QixJQUFJO1FBRUosaUlBQWlJO1FBQ2pJLDZHQUE2RztRQUMzRyxNQUFNLElBQUksQ0FBQyxrQ0FBa0MsRUFBRSx5QkFBeUIsQ0FBQyxDQUFDO1FBQzFFLHdHQUF3RztJQUMxRyxDQUFDO0lBRUQsa0JBQWUsS0FBSyxFQUFFLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgJ21vZHVsZS1hbGlhcy9yZWdpc3Rlcic7XG5cbmltcG9ydCB7IHJlYWRGaWxlQXN5bmMsIHdyaXRlVG9Kc29uQW5kQ3N2IH0gZnJvbSAnQGhlbHBlcnMvZnMtaGVscGVycyc7XG5pbXBvcnQgeyBjcmVhdGVMb2cgfSBmcm9tICdAaGVscGVycy9sb2ctaGVscGVycyc7XG5pbXBvcnQgeyBDaGlycER1cGxleCwgQ2hpcnBNb2RlLCBDaGlycFRvbmUsIElDaGlycCB9IGZyb20gJ0BpbnRlcmZhY2VzL2ktY2hpcnAnO1xuaW1wb3J0IHsgSVJlcGVhdGVyU3RydWN0dXJlZCwgUmVwZWF0ZXJTdGF0dXMsIFJlcGVhdGVyVXNlIH0gZnJvbSAnQGludGVyZmFjZXMvaS1yZXBlYXRlci1zdHJ1Y3R1cmVkJztcbmltcG9ydCB7IElTaW1wbGV4RnJlcXVlbmN5IH0gZnJvbSAnQGludGVyZmFjZXMvaS1zaW1wbGV4LWZyZXF1ZW5jeSc7XG5pbXBvcnQgZ3BzRGlzdGFuY2UsIHsgUG9pbnQgfSBmcm9tICdncHMtZGlzdGFuY2UnO1xuXG5jb25zdCBsb2c6ICguLi5tc2c6IGFueVtdKSA9PiB2b2lkID0gY3JlYXRlTG9nKCdNYWtlIENoaXJwJyk7XG5cbmNvbnN0IGNoaXJwOiBJQ2hpcnAgPSB7XG4gIExvY2F0aW9uOiBudWxsIGFzIGFueSxcbiAgTmFtZTogJycsXG4gIEZyZXF1ZW5jeTogbnVsbCBhcyBhbnksXG4gIER1cGxleDogJycsXG4gIE9mZnNldDogbnVsbCBhcyBhbnksXG4gIFRvbmU6ICcnLFxuICByVG9uZUZyZXE6IG51bGwgYXMgYW55LFxuICBjVG9uZUZyZXE6IG51bGwgYXMgYW55LFxuICBEdGNzQ29kZTogbnVsbCBhcyBhbnksXG4gIER0Y3NSeENvZGU6IG51bGwgYXMgYW55LFxuICBEdGNzUG9sYXJpdHk6ICdOTicsXG4gIE1vZGU6ICdGTScsXG4gIFRTdGVwOiA1LFxuICBDb21tZW50OiAnJyxcbn07XG5cbmNvbnN0IG15UG9pbnQ6IFBvaW50ID0gWzM5LjYyNzA3MTUwMCwgLTEwNC44OTMzMjI1MDBdOyAvLyA0OTgyIFMgVWxzdGVyIFN0XG5cbmFzeW5jIGZ1bmN0aW9uIGRvSXQoaW5GaWxlTmFtZTogc3RyaW5nLCBvdXRGaWxlTmFtZTogc3RyaW5nKTogUHJvbWlzZTx2b2lkPiB7XG4gIGNvbnN0IHNpbXBsZXg6IElSZXBlYXRlclN0cnVjdHVyZWRbXSA9XG4gICAgSlNPTi5wYXJzZSgoYXdhaXQgcmVhZEZpbGVBc3luYygnZGF0YS9mcmVxdWVuY2llcy5qc29uJykpLnRvU3RyaW5nKCkpXG4gICAgICAubWFwKChtYXA6IElTaW1wbGV4RnJlcXVlbmN5KSA9PlxuICAgICAgICAoeyBDYWxsc2lnbjogbWFwLk5hbWUsIEZyZXF1ZW5jeTogeyBPdXRwdXQ6IG1hcC5GcmVxdWVuY3ksIElucHV0OiBtYXAuRnJlcXVlbmN5IH0gfSkpXG4gICAgICAuZmlsdGVyKChmaWx0ZXI6IElSZXBlYXRlclN0cnVjdHVyZWQpID0+IC9GTXxWb2ljZXxTaW1wbGV4L2kudGVzdChmaWx0ZXIuQ2FsbHNpZ24pKVxuICAgICAgLmZpbHRlcigoZmlsdGVyOiBJUmVwZWF0ZXJTdHJ1Y3R1cmVkKSA9PiAhKC9EYXRhfERpZ2l0YWx8UGFja2V0L2kudGVzdChmaWx0ZXIuQ2FsbHNpZ24pKSk7XG5cbiAgY29uc3QgcmVwZWF0ZXJzOiBJUmVwZWF0ZXJTdHJ1Y3R1cmVkW10gPVxuICAgIEpTT04ucGFyc2UoKGF3YWl0IHJlYWRGaWxlQXN5bmMoaW5GaWxlTmFtZSkpLnRvU3RyaW5nKCkpO1xuXG4gIHJlcGVhdGVycy5mb3JFYWNoKChlYWNoOiBJUmVwZWF0ZXJTdHJ1Y3R1cmVkKSA9PiB7XG4gICAgZWFjaC5Mb2NhdGlvbi5EaXN0YW5jZSA9IGdwc0Rpc3RhbmNlKFtteVBvaW50LCBbZWFjaC5Mb2NhdGlvbi5MYXRpdHVkZSwgZWFjaC5Mb2NhdGlvbi5Mb25naXR1ZGVdXSk7XG4gIH0pO1xuXG4gIHJlcGVhdGVycy5zb3J0KChhOiBJUmVwZWF0ZXJTdHJ1Y3R1cmVkLCBiOiBJUmVwZWF0ZXJTdHJ1Y3R1cmVkKSA9PlxuICAgIGEuTG9jYXRpb24uRGlzdGFuY2UhID4gYi5Mb2NhdGlvbi5EaXN0YW5jZSEgPyAxIDpcbiAgICAgIGEuTG9jYXRpb24uRGlzdGFuY2UhIDwgYi5Mb2NhdGlvbi5EaXN0YW5jZSEgPyAtMSA6IDApO1xuICBjb25zdCBtYXBwZWQ6IElDaGlycFtdID0gW1xuICAgIC4uLnNpbXBsZXgsXG4gICAgLi4ucmVwZWF0ZXJzXG4gICAgICAuZmlsdGVyKChmaWx0ZXI6IElSZXBlYXRlclN0cnVjdHVyZWQpID0+XG4gICAgICAgIChmaWx0ZXIuRnJlcXVlbmN5Lk91dHB1dCA+PSAxNDQgJiYgZmlsdGVyLkZyZXF1ZW5jeS5PdXRwdXQgPD0gMTQ4KSB8fFxuICAgICAgICAoZmlsdGVyLkZyZXF1ZW5jeS5PdXRwdXQgPj0gMjIyICYmIGZpbHRlci5GcmVxdWVuY3kuT3V0cHV0IDw9IDIyNSkgfHxcbiAgICAgICAgKGZpbHRlci5GcmVxdWVuY3kuT3V0cHV0ID49IDQyMCAmJiBmaWx0ZXIuRnJlcXVlbmN5Lk91dHB1dCA8PSA0NTApKVxuICAgICAgLmZpbHRlcigoZmlsdGVyOiBJUmVwZWF0ZXJTdHJ1Y3R1cmVkKSA9PlxuICAgICAgICAhZmlsdGVyLkRpZ2l0YWwgJiZcbiAgICAgICAgZmlsdGVyLlN0YXR1cyAhPT0gUmVwZWF0ZXJTdGF0dXMuT2ZmQWlyICYmXG4gICAgICAgIGZpbHRlci5Vc2UgPT09IFJlcGVhdGVyVXNlLk9wZW4pLFxuICBdXG4gICAgLm1hcCgobWFwOiBJUmVwZWF0ZXJTdHJ1Y3R1cmVkLCBpbmRleDogbnVtYmVyKTogSUNoaXJwID0+ICh7IC4uLmNvbnZlcnRUb1JhZGlvKG1hcCksIExvY2F0aW9uOiBpbmRleCB9KSlcbiAgICAuc2xpY2UoMCwgMjAwKVxuICAgIC5zb3J0KChhOiBJQ2hpcnAsIGI6IElDaGlycCkgPT4gYS5GcmVxdWVuY3kgLSBiLkZyZXF1ZW5jeSlcbiAgICAubWFwKChtYXA6IElDaGlycCwgaW5kZXg6IG51bWJlcik6IElDaGlycCA9PiAoeyAuLi5tYXAsIExvY2F0aW9uOiBpbmRleCB9KSk7XG5cbiAgcmV0dXJuIHdyaXRlVG9Kc29uQW5kQ3N2KG91dEZpbGVOYW1lLCBtYXBwZWQpO1xufVxuXG5mdW5jdGlvbiBjb252ZXJ0VG9SYWRpbyhyZXBlYXRlcjogSVJlcGVhdGVyU3RydWN0dXJlZCk6IElDaGlycCB7XG4gIGxldCBOYW1lOiBzdHJpbmcgPSAnJztcblxuICBpZiAocmVwZWF0ZXIuQ2FsbHNpZ24pIHtcbiAgICBOYW1lICs9IHJlcGVhdGVyLkNhbGxzaWduLnRyaW0oKTtcbiAgICBpZiAocmVwZWF0ZXIuSUQgIT09IHVuZGVmaW5lZCkge1xuICAgICAgTmFtZSA9IE5hbWUuc3Vic3RyKC0zKS50cmltKCkudG9VcHBlckNhc2UoKTtcbiAgICB9XG4gIH1cblxuICBpZiAocmVwZWF0ZXIuTG9jYXRpb24gJiYgcmVwZWF0ZXIuTG9jYXRpb24uTG9jYWwpIHtcbiAgICBOYW1lICs9IChOYW1lID8gJyAnIDogJycpICsgcmVwZWF0ZXIuTG9jYXRpb24uTG9jYWwudHJpbSgpLnRvTG93ZXJDYXNlKCk7XG4gIH1cblxuICBpZiAocmVwZWF0ZXIuRnJlcXVlbmN5ICYmIHJlcGVhdGVyLkZyZXF1ZW5jeS5PdXRwdXQpIHtcbiAgICBOYW1lICs9IChOYW1lID8gJyAnIDogJycpICsgcmVwZWF0ZXIuRnJlcXVlbmN5Lk91dHB1dC50b1N0cmluZygpLnRyaW0oKTtcbiAgfVxuXG4gIE5hbWUgPSBOYW1lLnJlcGxhY2UoL1teMC05LmEtekEtWlxcL10vZywgJycpLnRyaW0oKTtcbiAgTmFtZSA9IE5hbWUuc3Vic3RyaW5nKDAsIDcpLnRyaW0oKTtcblxuICBjb25zdCBGcmVxdWVuY3k6IG51bWJlciA9IHJlcGVhdGVyLkZyZXF1ZW5jeS5PdXRwdXQ7XG4gIGxldCBPZmZzZXQ6IG51bWJlciA9IHJlcGVhdGVyLkZyZXF1ZW5jeS5JbnB1dCAtIHJlcGVhdGVyLkZyZXF1ZW5jeS5PdXRwdXQ7XG4gIGNvbnN0IER1cGxleDogQ2hpcnBEdXBsZXggPSBPZmZzZXQgPiAwID8gJysnIDogT2Zmc2V0IDwgMCA/ICctJyA6ICcnO1xuICBPZmZzZXQgPSBNYXRoLmFicyhNYXRoLnJvdW5kKE9mZnNldCAqIDEwMCkgLyAxMDApO1xuICBsZXQgclRvbmVGcmVxOiBudW1iZXIgfCB1bmRlZmluZWQgPSAocmVwZWF0ZXIuU3F1ZWxjaFRvbmUgJiYgcmVwZWF0ZXIuU3F1ZWxjaFRvbmUuSW5wdXQpO1xuICBsZXQgY1RvbmVGcmVxOiBudW1iZXIgfCB1bmRlZmluZWQgPSAocmVwZWF0ZXIuU3F1ZWxjaFRvbmUgJiYgcmVwZWF0ZXIuU3F1ZWxjaFRvbmUuT3V0cHV0KTtcbiAgbGV0IER0Y3NDb2RlOiBudW1iZXIgfCB1bmRlZmluZWQgPSAocmVwZWF0ZXIuRGlnaXRhbFRvbmUgJiYgcmVwZWF0ZXIuRGlnaXRhbFRvbmUuSW5wdXQpO1xuICBsZXQgRHRjc1J4Q29kZTogbnVtYmVyIHwgdW5kZWZpbmVkID0gKHJlcGVhdGVyLkRpZ2l0YWxUb25lICYmIHJlcGVhdGVyLkRpZ2l0YWxUb25lLk91dHB1dCk7XG4gIGxldCBUb25lOiBDaGlycFRvbmUgPSAnJztcbiAgY29uc3QgTW9kZTogQ2hpcnBNb2RlID0gJ0ZNJztcbiAgbGV0IENvbW1lbnQ6IHN0cmluZyA9IGAke3JlcGVhdGVyLlN0YXRlSUR9ICR7cmVwZWF0ZXIuSUR9ICR7cmVwZWF0ZXIuTG9jYXRpb24gJiYgcmVwZWF0ZXIuTG9jYXRpb24uRGlzdGFuY2UgJiYgcmVwZWF0ZXIuTG9jYXRpb24uRGlzdGFuY2UudG9GaXhlZCgyKX0gJHtyZXBlYXRlci5Mb2NhdGlvbiAmJiByZXBlYXRlci5Mb2NhdGlvbi5TdGF0ZX0gJHtyZXBlYXRlci5Mb2NhdGlvbiAmJiByZXBlYXRlci5Mb2NhdGlvbi5Db3VudHl9ICR7cmVwZWF0ZXIuTG9jYXRpb24gJiYgcmVwZWF0ZXIuTG9jYXRpb24uTG9jYWx9ICR7cmVwZWF0ZXIuQ2FsbHNpZ259YDtcbiAgQ29tbWVudCA9IENvbW1lbnQucmVwbGFjZSgvdW5kZWZpbmVkL2csICcgJykucmVwbGFjZSgvXFxzKy9nLCAnICcpLnRyaW0oKTtcbiAgLy8gYCR7aXRlbVsnU1QvUFInXSB8fCAnJ30gJHtpdGVtLkNvdW50eSB8fCAnJ30gJHtpdGVtLkxvY2F0aW9uIHx8ICcnfSAke2l0ZW0uQ2FsbCB8fCAnJ30gJHtpdGVtLlNwb25zb3IgfHwgJyd9ICR7aXRlbS5BZmZpbGlhdGUgfHwgJyd9ICR7aXRlbS5GcmVxdWVuY3l9ICR7aXRlbS5Vc2UgfHwgJyd9ICR7aXRlbVsnT3AgU3RhdHVzJ10gfHwgJyd9ICR7aXRlbS5Db21tZW50IHx8ICcnfWAucmVwbGFjZSgvXFxzKy9nLCAnICcpO1xuICAvLyBDb21tZW50ID0gQ29tbWVudC50cmltKCkucmVwbGFjZShcIixcIiwgXCJcIikuc3Vic3RyaW5nKDAsIDMxKS50cmltKCk7XG5cbiAgaWYgKHJUb25lRnJlcSkge1xuICAgIFRvbmUgPSAnVG9uZSc7XG4gIH0gZWxzZSBpZiAoRHRjc0NvZGUpIHtcbiAgICBUb25lID0gJ0RUQ1MnO1xuICB9XG5cbiAgaWYgKGNUb25lRnJlcSkge1xuICAgIFRvbmUgPSAnVFNRTCc7XG4gIH0gZWxzZSBpZiAoRHRjc1J4Q29kZSkge1xuICAgIFRvbmUgPSAnRFRDUyc7XG4gIH1cblxuICBpZiAoKHJUb25lRnJlcSAmJiBjVG9uZUZyZXEgJiYgKHJUb25lRnJlcSAhPT0gY1RvbmVGcmVxKSkpIHtcbiAgICBUb25lID0gJ0Nyb3NzJztcbiAgfVxuXG4gIGNUb25lRnJlcSA9IGNUb25lRnJlcSB8fCA4OC41O1xuICByVG9uZUZyZXEgPSByVG9uZUZyZXEgfHwgODguNTtcbiAgRHRjc0NvZGUgPSBEdGNzQ29kZSB8fCAyMztcbiAgRHRjc1J4Q29kZSA9IER0Y3NSeENvZGUgfHwgMjM7XG5cbi8vIGxvZyhjaGFsay5ncmVlbihcIk1hZGUgUm93XCIpLCByb3cpO1xuICByZXR1cm4ge1xuICAgIC4uLmNoaXJwLFxuLy8gTG9jYXRpb24sXG4gICAgTmFtZSxcbiAgICBGcmVxdWVuY3ksXG4gICAgRHVwbGV4LFxuICAgIE9mZnNldCxcbiAgICByVG9uZUZyZXEsXG4gICAgY1RvbmVGcmVxLFxuICAgIER0Y3NDb2RlLFxuICAgIER0Y3NSeENvZGUsXG4gICAgVG9uZSxcbiAgICBNb2RlLFxuICAgIENvbW1lbnQsXG4gIH07XG59XG5cbmFzeW5jIGZ1bmN0aW9uIHN0YXJ0KCk6IFByb21pc2U8dm9pZD4ge1xuLy8gY29uc3QgY29GaWxlcyA9IChhd2FpdCByZWFkZGlyQXN5bmMoXCIuL3JlcGVhdGVycy9kYXRhL0NPL1wiKSkubWFwKChmKSA9PiBgZGF0YS9DTy8ke2Z9YCk7XG4vLyBjb25zdCB1dEZpbGVzID0gKGF3YWl0IHJlYWRkaXJBc3luYyhcIi4vcmVwZWF0ZXJzL2RhdGEvVVQvXCIpKS5tYXAoKGYpID0+IGBkYXRhL1VULyR7Zn1gKTtcbi8vIGNvbnN0IG5tRmlsZXMgPSAoYXdhaXQgcmVhZGRpckFzeW5jKFwiLi9yZXBlYXRlcnMvZGF0YS9OTS9cIikpLm1hcCgoZikgPT4gYGRhdGEvTk0vJHtmfWApO1xuLy8gY29uc3QgY29Hcm91cHMgPSAoYXdhaXQgcmVhZGRpckFzeW5jKFwiLi9yZXBlYXRlcnMvZ3JvdXBzL0NPL1wiKSkubWFwKChmKSA9PiBgZ3JvdXBzL0NPLyR7Zn1gKTtcbi8vIGNvbnN0IHV0R3JvdXBzID0gKGF3YWl0IHJlYWRkaXJBc3luYyhcIi4vcmVwZWF0ZXJzL2dyb3Vwcy9VVC9cIikpLm1hcCgoZikgPT4gYGdyb3Vwcy9VVC8ke2Z9YCk7XG4vLyBjb25zdCBubUdyb3VwcyA9IChhd2FpdCByZWFkZGlyQXN5bmMoXCIuL3JlcGVhdGVycy9ncm91cHMvTk0vXCIpKS5tYXAoKGYpID0+IGBncm91cHMvTk0vJHtmfWApO1xuLy8gY29uc3QgYWxsRmlsZXMgPSBbLi4uY29GaWxlcywgLi4udXRGaWxlcywgLi4ubm1GaWxlcywgLi4uY29Hcm91cHMsIC4uLnV0R3JvdXBzLCAuLi5ubUdyb3Vwc10uZmlsdGVyKChmKSA9PiAvXFwuanNvbiQvLnRlc3QoZikpLm1hcCgoZikgPT4gZi5yZXBsYWNlKFwiLmpzb25cIiwgXCJcIikpO1xuLy8gZm9yIChjb25zdCBmaWxlIG9mIGFsbEZpbGVzKSB7XG4vLyAgIGF3YWl0IGRvSXQoZmlsZSk7XG4vLyB9XG5cbi8vIGF3YWl0IGRvSXQoXCJkYXRhL3JlcGVhdGVycy9ncm91cHMvQ08vQ29sb3JhZG8gU3ByaW5ncyAtIENhbGwuanNvblwiLCBcImRhdGEvcmVwZWF0ZXJzL2NoaXJwL2dyb3Vwcy9DTy9Db2xvcmFkbyBTcHJpbmdzIC0gQ2FsbFwiKTtcbi8vIGF3YWl0IGRvSXQoXCJkYXRhL3JlcGVhdGVycy9yZXN1bHRzL0NPL0NvbG9yYWRvIFNwcmluZ3MuanNvblwiLCBcImRhdGEvcmVwZWF0ZXJzL2NoaXJwL0NPL0NvbG9yYWRvIFNwcmluZ3NcIik7XG4gIGF3YWl0IGRvSXQoJ2RhdGEvcmVwZWF0ZXJzL2NvbnZlcnRlZC9DTy5qc29uJywgJ2RhdGEvcmVwZWF0ZXJzL2NoaXJwL0NPJyk7XG4gIC8vIGF3YWl0IGRvSXQoJ2RhdGEvcmVwZWF0ZXJzL2dyb3Vwcy9jb21iaW5lZC9DTyAtIENhbGwuanNvbicsICdkYXRhL3JlcGVhdGVycy9jaGlycC9ncm91cHMvQ08gLSBDYWxsJyk7XG59XG5cbmV4cG9ydCBkZWZhdWx0IHN0YXJ0KCk7XG4iXX0=