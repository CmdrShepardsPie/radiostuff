"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const chalk_1 = require("chalk");
let lastMessageInline = false;
let lastContext;
const bgColors = [
    // "bgBlack",
    "bgRed",
    "bgGreen",
    "bgYellow",
    "bgBlue",
    "bgMagenta",
    "bgCyan",
];
let lastColor = 0;
function createOut(context, color) {
    if (!color) {
        color = bgColors[lastColor];
        lastColor += 1;
        if (lastColor >= bgColors.length) {
            lastColor = 0;
        }
    }
    return { log: createLog(context, color), write: createWrite(context, color) };
}
exports.createOut = createOut;
function createLog(context, color) {
    if (!color) {
        color = bgColors[lastColor];
        lastColor += 1;
        if (lastColor >= bgColors.length) {
            lastColor = 0;
        }
    }
    // @ts-ignore
    const chalkColorFn = chalk_1.default[color];
    return (...msg) => {
        msg = msg.map(prepIfJson);
        // if (lastContext !== context) {
        //   createEmptyLine();
        // }
        if (lastMessageInline) {
            createEmptyLine();
        }
        const args = [chalkColorFn(`${context}:`), ...msg];
        console.log(...args);
        lastMessageInline = false;
        lastContext = context;
    };
}
exports.createLog = createLog;
function createWrite(context, color) {
    if (!color) {
        color = bgColors[lastColor];
        lastColor += 1;
        if (lastColor >= bgColors.length) {
            lastColor = 0;
        }
    }
    // @ts-ignore
    const chalkColorFn = chalk_1.default[color];
    return (...msg) => {
        if (!lastMessageInline) {
            process.stdout.write(chalkColorFn(`${context}:`) + " ");
        }
        if (lastMessageInline && lastContext !== context) {
            createEmptyLine();
            process.stdout.write(chalkColorFn(`${context}:`) + " ");
        }
        process.stdout.write(msg.join(" "));
        lastMessageInline = true;
        lastContext = context;
    };
}
exports.createWrite = createWrite;
function createThrowError(context) {
    const color = bgColors[lastColor];
    lastColor += 1;
    if (lastColor >= bgColors.length) {
        lastColor = 0;
    }
    // @ts-ignore
    const chalkColorFn = chalk_1.default[color];
    return (type, ...msg) => {
        console.log(chalkColorFn(`${context}:`), chalk_1.default.red(`${type} Error:`), ...msg);
        process.exit(1);
    };
}
exports.createThrowError = createThrowError;
function prepIfJson(t) {
    if (t instanceof Error) {
        return t;
    }
    if (typeof t === "string") {
        try {
            t = JSON.parse(t);
        }
        catch (e) {
            /* no empty */
        }
    }
    if (typeof t === "object") {
        try {
            t = JSON.stringify(t, null, 4);
            t = colorizeJsonString(t);
        }
        catch (e) {
            /* no empty */
        }
    }
    return t;
}
function colorizeJsonString(json) {
    // Strings
    json = json.replace(/(\s+)("[^"]*")(,?[\r\n])/gi, `$1${chalk_1.default.yellow("$2")}$3`);
    // booleans, numbers, etc.
    json = json.replace(/(\s+)([^"[{\]}][^[\]{}"\n\r,]*)(,?[\r\n])/gi, `$1${chalk_1.default.cyan("$2")}$3`);
    // Keys
    json = json.replace(/("[^"]*"):/gi, `${chalk_1.default.magenta("$1")}:`);
    return json;
}
function createEmptyLine() {
    console.log();
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibG9nLWhlbHBlcnMuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvaGVscGVycy9sb2ctaGVscGVycy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBLGlDQUEwQjtBQUUxQixJQUFJLGlCQUFpQixHQUFZLEtBQUssQ0FBQztBQUN2QyxJQUFJLFdBQW1CLENBQUM7QUFFeEIsTUFBTSxRQUFRLEdBQUc7SUFDZixhQUFhO0lBQ2IsT0FBTztJQUNQLFNBQVM7SUFDVCxVQUFVO0lBQ1YsUUFBUTtJQUNSLFdBQVc7SUFDWCxRQUFRO0NBVVQsQ0FBQztBQUNGLElBQUksU0FBUyxHQUFHLENBQUMsQ0FBQztBQUVsQixTQUFnQixTQUFTLENBQUMsT0FBZSxFQUFFLEtBQWM7SUFDdkQsSUFBSSxDQUFDLEtBQUssRUFBRTtRQUNWLEtBQUssR0FBRyxRQUFRLENBQUMsU0FBUyxDQUFDLENBQUM7UUFDNUIsU0FBUyxJQUFJLENBQUMsQ0FBQztRQUNmLElBQUksU0FBUyxJQUFJLFFBQVEsQ0FBQyxNQUFNLEVBQUU7WUFDaEMsU0FBUyxHQUFHLENBQUMsQ0FBQztTQUNmO0tBQ0Y7SUFDRCxPQUFPLEVBQUUsR0FBRyxFQUFFLFNBQVMsQ0FBQyxPQUFPLEVBQUUsS0FBSyxDQUFDLEVBQUUsS0FBSyxFQUFFLFdBQVcsQ0FBQyxPQUFPLEVBQUUsS0FBSyxDQUFDLEVBQUUsQ0FBQztBQUNoRixDQUFDO0FBVEQsOEJBU0M7QUFFRCxTQUFnQixTQUFTLENBQUMsT0FBZSxFQUFFLEtBQWM7SUFDdkQsSUFBSSxDQUFDLEtBQUssRUFBRTtRQUNWLEtBQUssR0FBRyxRQUFRLENBQUMsU0FBUyxDQUFDLENBQUM7UUFDNUIsU0FBUyxJQUFJLENBQUMsQ0FBQztRQUNmLElBQUksU0FBUyxJQUFJLFFBQVEsQ0FBQyxNQUFNLEVBQUU7WUFDaEMsU0FBUyxHQUFHLENBQUMsQ0FBQztTQUNmO0tBQ0Y7SUFDRCxhQUFhO0lBQ2IsTUFBTSxZQUFZLEdBQUcsZUFBSyxDQUFDLEtBQUssQ0FBQyxDQUFDO0lBRWxDLE9BQU8sQ0FBQyxHQUFHLEdBQVUsRUFBRSxFQUFFO1FBQ3ZCLEdBQUcsR0FBRyxHQUFHLENBQUMsR0FBRyxDQUFDLFVBQVUsQ0FBQyxDQUFDO1FBRTFCLGlDQUFpQztRQUNqQyx1QkFBdUI7UUFDdkIsSUFBSTtRQUNKLElBQUksaUJBQWlCLEVBQUU7WUFDckIsZUFBZSxFQUFFLENBQUM7U0FDbkI7UUFFRCxNQUFNLElBQUksR0FBRyxDQUFFLFlBQVksQ0FBQyxHQUFHLE9BQU8sR0FBRyxDQUFDLEVBQUUsR0FBRyxHQUFHLENBQUUsQ0FBQztRQUVyRCxPQUFPLENBQUMsR0FBRyxDQUFDLEdBQUcsSUFBSSxDQUFDLENBQUM7UUFDckIsaUJBQWlCLEdBQUcsS0FBSyxDQUFDO1FBQzFCLFdBQVcsR0FBRyxPQUFPLENBQUM7SUFDeEIsQ0FBQyxDQUFDO0FBQ0osQ0FBQztBQTNCRCw4QkEyQkM7QUFFRCxTQUFnQixXQUFXLENBQUMsT0FBZSxFQUFFLEtBQWM7SUFDekQsSUFBSSxDQUFDLEtBQUssRUFBRTtRQUNWLEtBQUssR0FBRyxRQUFRLENBQUMsU0FBUyxDQUFDLENBQUM7UUFDNUIsU0FBUyxJQUFJLENBQUMsQ0FBQztRQUNmLElBQUksU0FBUyxJQUFJLFFBQVEsQ0FBQyxNQUFNLEVBQUU7WUFDaEMsU0FBUyxHQUFHLENBQUMsQ0FBQztTQUNmO0tBQ0Y7SUFDRCxhQUFhO0lBQ2IsTUFBTSxZQUFZLEdBQUcsZUFBSyxDQUFDLEtBQUssQ0FBQyxDQUFDO0lBRWxDLE9BQU8sQ0FBQyxHQUFHLEdBQVUsRUFBRSxFQUFFO1FBQ3ZCLElBQUksQ0FBQyxpQkFBaUIsRUFBRTtZQUN0QixPQUFPLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxZQUFZLENBQUMsR0FBRyxPQUFPLEdBQUcsQ0FBQyxHQUFHLEdBQUcsQ0FBQyxDQUFDO1NBQ3pEO1FBQ0QsSUFBSSxpQkFBaUIsSUFBSSxXQUFXLEtBQUssT0FBTyxFQUFFO1lBQ2hELGVBQWUsRUFBRSxDQUFDO1lBQ2xCLE9BQU8sQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLFlBQVksQ0FBQyxHQUFHLE9BQU8sR0FBRyxDQUFDLEdBQUcsR0FBRyxDQUFDLENBQUM7U0FDekQ7UUFDRCxPQUFPLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUM7UUFDcEMsaUJBQWlCLEdBQUcsSUFBSSxDQUFDO1FBQ3pCLFdBQVcsR0FBRyxPQUFPLENBQUM7SUFDeEIsQ0FBQyxDQUFDO0FBQ0osQ0FBQztBQXZCRCxrQ0F1QkM7QUFFRCxTQUFnQixnQkFBZ0IsQ0FBQyxPQUFlO0lBQzlDLE1BQU0sS0FBSyxHQUFHLFFBQVEsQ0FBQyxTQUFTLENBQUMsQ0FBQztJQUNsQyxTQUFTLElBQUksQ0FBQyxDQUFDO0lBQ2YsSUFBSSxTQUFTLElBQUksUUFBUSxDQUFDLE1BQU0sRUFBRTtRQUNoQyxTQUFTLEdBQUcsQ0FBQyxDQUFDO0tBQ2Y7SUFDRCxhQUFhO0lBQ2IsTUFBTSxZQUFZLEdBQUcsZUFBSyxDQUFDLEtBQUssQ0FBQyxDQUFDO0lBRWxDLE9BQU8sQ0FBQyxJQUFZLEVBQUUsR0FBRyxHQUFVLEVBQUUsRUFBRTtRQUNyQyxPQUFPLENBQUMsR0FBRyxDQUFDLFlBQVksQ0FBQyxHQUFHLE9BQU8sR0FBRyxDQUFDLEVBQUUsZUFBSyxDQUFDLEdBQUcsQ0FBQyxHQUFHLElBQUksU0FBUyxDQUFDLEVBQUUsR0FBRyxHQUFHLENBQUMsQ0FBQztRQUM5RSxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBQ2xCLENBQUMsQ0FBQztBQUNKLENBQUM7QUFiRCw0Q0FhQztBQUVELFNBQVMsVUFBVSxDQUFDLENBQU07SUFDeEIsSUFBSSxDQUFDLFlBQVksS0FBSyxFQUFFO1FBQ3RCLE9BQU8sQ0FBQyxDQUFDO0tBQ1Y7SUFDRCxJQUFJLE9BQU8sQ0FBQyxLQUFLLFFBQVEsRUFBRTtRQUN6QixJQUFJO1lBQ0YsQ0FBQyxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUM7U0FDbkI7UUFBQyxPQUFPLENBQUMsRUFBRTtZQUNWLGNBQWM7U0FDZjtLQUNGO0lBQ0QsSUFBSSxPQUFPLENBQUMsS0FBSyxRQUFRLEVBQUU7UUFDekIsSUFBSTtZQUNGLENBQUMsR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDLENBQUMsRUFBRSxJQUFJLEVBQUUsQ0FBQyxDQUFDLENBQUM7WUFDL0IsQ0FBQyxHQUFHLGtCQUFrQixDQUFDLENBQUMsQ0FBQyxDQUFDO1NBQzNCO1FBQUMsT0FBTyxDQUFDLEVBQUU7WUFDVixjQUFjO1NBQ2Y7S0FDRjtJQUNELE9BQU8sQ0FBQyxDQUFDO0FBQ1gsQ0FBQztBQUVELFNBQVMsa0JBQWtCLENBQUMsSUFBWTtJQUN0QyxVQUFVO0lBQ1YsSUFBSSxHQUFHLElBQUksQ0FBQyxPQUFPLENBQ2pCLDRCQUE0QixFQUM1QixLQUFLLGVBQUssQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLElBQUksQ0FDNUIsQ0FBQztJQUNGLDBCQUEwQjtJQUMxQixJQUFJLEdBQUcsSUFBSSxDQUFDLE9BQU8sQ0FDakIsNkNBQTZDLEVBQzdDLEtBQUssZUFBSyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUMxQixDQUFDO0lBQ0YsT0FBTztJQUNQLElBQUksR0FBRyxJQUFJLENBQUMsT0FBTyxDQUFDLGNBQWMsRUFBRSxHQUFHLGVBQUssQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDO0lBQy9ELE9BQU8sSUFBSSxDQUFDO0FBQ2QsQ0FBQztBQUVELFNBQVMsZUFBZTtJQUN0QixPQUFPLENBQUMsR0FBRyxFQUFFLENBQUM7QUFDaEIsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBjaGFsayBmcm9tIFwiY2hhbGtcIjtcblxubGV0IGxhc3RNZXNzYWdlSW5saW5lOiBib29sZWFuID0gZmFsc2U7XG5sZXQgbGFzdENvbnRleHQ6IHN0cmluZztcblxuY29uc3QgYmdDb2xvcnMgPSBbXG4gIC8vIFwiYmdCbGFja1wiLFxuICBcImJnUmVkXCIsXG4gIFwiYmdHcmVlblwiLFxuICBcImJnWWVsbG93XCIsXG4gIFwiYmdCbHVlXCIsXG4gIFwiYmdNYWdlbnRhXCIsXG4gIFwiYmdDeWFuXCIsXG4gIC8vIFwiYmdXaGl0ZVwiLFxuICAvLyBcImJnQmxhY2tCcmlnaHRcIixcbiAgLy8gXCJiZ1JlZEJyaWdodFwiLFxuICAvLyBcImJnR3JlZW5CcmlnaHRcIixcbiAgLy8gXCJiZ1llbGxvd0JyaWdodFwiLFxuICAvLyBcImJnQmx1ZUJyaWdodFwiLFxuICAvLyBcImJnTWFnZW50YUJyaWdodFwiLFxuICAvLyBcImJnQ3lhbkJyaWdodFwiLFxuICAvLyBcImJnV2hpdGVCcmlnaHRcIixcbl07XG5sZXQgbGFzdENvbG9yID0gMDtcblxuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZU91dChjb250ZXh0OiBzdHJpbmcsIGNvbG9yPzogc3RyaW5nKSB7XG4gIGlmICghY29sb3IpIHtcbiAgICBjb2xvciA9IGJnQ29sb3JzW2xhc3RDb2xvcl07XG4gICAgbGFzdENvbG9yICs9IDE7XG4gICAgaWYgKGxhc3RDb2xvciA+PSBiZ0NvbG9ycy5sZW5ndGgpIHtcbiAgICAgIGxhc3RDb2xvciA9IDA7XG4gICAgfVxuICB9XG4gIHJldHVybiB7IGxvZzogY3JlYXRlTG9nKGNvbnRleHQsIGNvbG9yKSwgd3JpdGU6IGNyZWF0ZVdyaXRlKGNvbnRleHQsIGNvbG9yKSB9O1xufVxuXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlTG9nKGNvbnRleHQ6IHN0cmluZywgY29sb3I/OiBzdHJpbmcpIHtcbiAgaWYgKCFjb2xvcikge1xuICAgIGNvbG9yID0gYmdDb2xvcnNbbGFzdENvbG9yXTtcbiAgICBsYXN0Q29sb3IgKz0gMTtcbiAgICBpZiAobGFzdENvbG9yID49IGJnQ29sb3JzLmxlbmd0aCkge1xuICAgICAgbGFzdENvbG9yID0gMDtcbiAgICB9XG4gIH1cbiAgLy8gQHRzLWlnbm9yZVxuICBjb25zdCBjaGFsa0NvbG9yRm4gPSBjaGFsa1tjb2xvcl07XG5cbiAgcmV0dXJuICguLi5tc2c6IGFueVtdKSA9PiB7XG4gICAgbXNnID0gbXNnLm1hcChwcmVwSWZKc29uKTtcblxuICAgIC8vIGlmIChsYXN0Q29udGV4dCAhPT0gY29udGV4dCkge1xuICAgIC8vICAgY3JlYXRlRW1wdHlMaW5lKCk7XG4gICAgLy8gfVxuICAgIGlmIChsYXN0TWVzc2FnZUlubGluZSkge1xuICAgICAgY3JlYXRlRW1wdHlMaW5lKCk7XG4gICAgfVxuXG4gICAgY29uc3QgYXJncyA9IFsgY2hhbGtDb2xvckZuKGAke2NvbnRleHR9OmApLCAuLi5tc2cgXTtcblxuICAgIGNvbnNvbGUubG9nKC4uLmFyZ3MpO1xuICAgIGxhc3RNZXNzYWdlSW5saW5lID0gZmFsc2U7XG4gICAgbGFzdENvbnRleHQgPSBjb250ZXh0O1xuICB9O1xufVxuXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlV3JpdGUoY29udGV4dDogc3RyaW5nLCBjb2xvcj86IHN0cmluZykge1xuICBpZiAoIWNvbG9yKSB7XG4gICAgY29sb3IgPSBiZ0NvbG9yc1tsYXN0Q29sb3JdO1xuICAgIGxhc3RDb2xvciArPSAxO1xuICAgIGlmIChsYXN0Q29sb3IgPj0gYmdDb2xvcnMubGVuZ3RoKSB7XG4gICAgICBsYXN0Q29sb3IgPSAwO1xuICAgIH1cbiAgfVxuICAvLyBAdHMtaWdub3JlXG4gIGNvbnN0IGNoYWxrQ29sb3JGbiA9IGNoYWxrW2NvbG9yXTtcblxuICByZXR1cm4gKC4uLm1zZzogYW55W10pID0+IHtcbiAgICBpZiAoIWxhc3RNZXNzYWdlSW5saW5lKSB7XG4gICAgICBwcm9jZXNzLnN0ZG91dC53cml0ZShjaGFsa0NvbG9yRm4oYCR7Y29udGV4dH06YCkgKyBcIiBcIik7XG4gICAgfVxuICAgIGlmIChsYXN0TWVzc2FnZUlubGluZSAmJiBsYXN0Q29udGV4dCAhPT0gY29udGV4dCkge1xuICAgICAgY3JlYXRlRW1wdHlMaW5lKCk7XG4gICAgICBwcm9jZXNzLnN0ZG91dC53cml0ZShjaGFsa0NvbG9yRm4oYCR7Y29udGV4dH06YCkgKyBcIiBcIik7XG4gICAgfVxuICAgIHByb2Nlc3Muc3Rkb3V0LndyaXRlKG1zZy5qb2luKFwiIFwiKSk7XG4gICAgbGFzdE1lc3NhZ2VJbmxpbmUgPSB0cnVlO1xuICAgIGxhc3RDb250ZXh0ID0gY29udGV4dDtcbiAgfTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZVRocm93RXJyb3IoY29udGV4dDogc3RyaW5nKSB7XG4gIGNvbnN0IGNvbG9yID0gYmdDb2xvcnNbbGFzdENvbG9yXTtcbiAgbGFzdENvbG9yICs9IDE7XG4gIGlmIChsYXN0Q29sb3IgPj0gYmdDb2xvcnMubGVuZ3RoKSB7XG4gICAgbGFzdENvbG9yID0gMDtcbiAgfVxuICAvLyBAdHMtaWdub3JlXG4gIGNvbnN0IGNoYWxrQ29sb3JGbiA9IGNoYWxrW2NvbG9yXTtcblxuICByZXR1cm4gKHR5cGU6IHN0cmluZywgLi4ubXNnOiBhbnlbXSkgPT4ge1xuICAgIGNvbnNvbGUubG9nKGNoYWxrQ29sb3JGbihgJHtjb250ZXh0fTpgKSwgY2hhbGsucmVkKGAke3R5cGV9IEVycm9yOmApLCAuLi5tc2cpO1xuICAgIHByb2Nlc3MuZXhpdCgxKTtcbiAgfTtcbn1cblxuZnVuY3Rpb24gcHJlcElmSnNvbih0OiBhbnkpOiBhbnkge1xuICBpZiAodCBpbnN0YW5jZW9mIEVycm9yKSB7XG4gICAgcmV0dXJuIHQ7XG4gIH1cbiAgaWYgKHR5cGVvZiB0ID09PSBcInN0cmluZ1wiKSB7XG4gICAgdHJ5IHtcbiAgICAgIHQgPSBKU09OLnBhcnNlKHQpO1xuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgIC8qIG5vIGVtcHR5ICovXG4gICAgfVxuICB9XG4gIGlmICh0eXBlb2YgdCA9PT0gXCJvYmplY3RcIikge1xuICAgIHRyeSB7XG4gICAgICB0ID0gSlNPTi5zdHJpbmdpZnkodCwgbnVsbCwgNCk7XG4gICAgICB0ID0gY29sb3JpemVKc29uU3RyaW5nKHQpO1xuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgIC8qIG5vIGVtcHR5ICovXG4gICAgfVxuICB9XG4gIHJldHVybiB0O1xufVxuXG5mdW5jdGlvbiBjb2xvcml6ZUpzb25TdHJpbmcoanNvbjogc3RyaW5nKTogc3RyaW5nIHtcbiAgLy8gU3RyaW5nc1xuICBqc29uID0ganNvbi5yZXBsYWNlKFxuICAgIC8oXFxzKykoXCJbXlwiXSpcIikoLD9bXFxyXFxuXSkvZ2ksXG4gICAgYCQxJHtjaGFsay55ZWxsb3coXCIkMlwiKX0kM2AsXG4gICk7XG4gIC8vIGJvb2xlYW5zLCBudW1iZXJzLCBldGMuXG4gIGpzb24gPSBqc29uLnJlcGxhY2UoXG4gICAgLyhcXHMrKShbXlwiW3tcXF19XVteW1xcXXt9XCJcXG5cXHIsXSopKCw/W1xcclxcbl0pL2dpLFxuICAgIGAkMSR7Y2hhbGsuY3lhbihcIiQyXCIpfSQzYCxcbiAgKTtcbiAgLy8gS2V5c1xuICBqc29uID0ganNvbi5yZXBsYWNlKC8oXCJbXlwiXSpcIik6L2dpLCBgJHtjaGFsay5tYWdlbnRhKFwiJDFcIil9OmApO1xuICByZXR1cm4ganNvbjtcbn1cblxuZnVuY3Rpb24gY3JlYXRlRW1wdHlMaW5lKCkge1xuICBjb25zb2xlLmxvZygpO1xufVxuIl19